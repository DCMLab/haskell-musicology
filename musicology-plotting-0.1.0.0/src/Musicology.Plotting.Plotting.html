<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Musicology.Plotting.Plotting</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Graphics.Vega.VegaLite</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson.Encode.Pretty</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">encodePretty</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS8</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Temp</span></span><span>                 </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">emptySystemTempFile</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Web.Browser</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Html</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy.IO</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span id="ppSpec"><span class="annot"><span class="annottext">ppSpec :: VegaLite -&gt; IO ()
</span><a href="Musicology.Plotting.Plotting.html#ppSpec"><span class="hs-identifier hs-var hs-var">ppSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS8.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; (VegaLite -&gt; ByteString) -&gt; VegaLite -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encodePretty</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString)
-&gt; (VegaLite -&gt; Value) -&gt; VegaLite -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VegaLite -&gt; Value
</span><span class="hs-identifier hs-var">fromVL</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span id="writeSpec"><span class="annot"><span class="annottext">writeSpec :: FilePath -&gt; VegaLite -&gt; IO ()
</span><a href="Musicology.Plotting.Plotting.html#writeSpec"><span class="hs-identifier hs-var hs-var">writeSpec</span></a></span></span><span> </span><span id="local-6989586621679121780"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121780"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS8.writeFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121780"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; (VegaLite -&gt; ByteString) -&gt; VegaLite -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString)
-&gt; (VegaLite -&gt; Value) -&gt; VegaLite -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VegaLite -&gt; Value
</span><span class="hs-identifier hs-var">fromVL</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><a href="Musicology.Plotting.Plotting.html#viewPlot"><span class="hs-identifier hs-type">viewPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VegaLite</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span id="viewPlot"><span class="annot"><span class="annottext">viewPlot :: VegaLite -&gt; IO ()
</span><a href="Musicology.Plotting.Plotting.html#viewPlot"><span class="hs-identifier hs-var hs-var">viewPlot</span></a></span></span><span> </span><span id="local-6989586621679121776"><span class="annot"><span class="annottext">VegaLite
</span><a href="#local-6989586621679121776"><span class="hs-identifier hs-var">plot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-27"></span><span>  </span><span id="local-6989586621679121775"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121775"><span class="hs-identifier hs-var">fnJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
</span><span class="hs-identifier hs-var">emptySystemTempFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;musicology-plot.json&quot;</span></span><span>
</span><span id="line-28"></span><span>  </span><span id="local-6989586621679121774"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121774"><span class="hs-identifier hs-var">fnH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
</span><span class="hs-identifier hs-var">emptySystemTempFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;musicology-plot.html&quot;</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; VegaLite -&gt; IO ()
</span><a href="Musicology.Plotting.Plotting.html#writeSpec"><span class="hs-identifier hs-var">writeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121775"><span class="hs-identifier hs-var">fnJ</span></a></span><span> </span><span class="annot"><span class="annottext">VegaLite
</span><a href="#local-6989586621679121776"><span class="hs-identifier hs-var">plot</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">TL.writeFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121774"><span class="hs-identifier hs-var">fnH</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Element
   &quot;html&quot;
   '[]
   ('Elements '[&quot;head&quot;, &quot;body&quot;])
   '[GetAttributeName 'ManifestA]
 :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
      :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
          # (((Element
                 &quot;script&quot;
                 '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                 'OnlyText
                 (GetAttributeName 'SrcA
                    : ('TypeA
                       &amp; ('NomoduleA
                          &amp; ('AsyncA
                             &amp; ('DeferA
                                &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
               :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
              :&gt; ())
             # (((Element
                    &quot;script&quot;
                    '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                    'OnlyText
                    (GetAttributeName 'SrcA
                       : ('TypeA
                          &amp; ('NomoduleA
                             &amp; ('AsyncA
                                &amp; ('DeferA
                                   &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                  :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                 :&gt; ())
                # ((Element
                      &quot;script&quot;
                      '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                      'OnlyText
                      (GetAttributeName 'SrcA
                         : ('TypeA
                            &amp; ('NomoduleA
                               &amp; ('AsyncA
                                  &amp; ('DeferA
                                     &amp; ('CrossoriginA
                                        &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                    :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                   :&gt; ())))))
     # (Element
          &quot;body&quot;
          '[]
          'Flow
          (GetAttributeName 'OnafterprintA
             : ('OnbeforeprintA
                &amp; ('OnbeforeunloadA
                   &amp; ('OnhashchangeA
                      &amp; ('OnlanguagechangeA
                         &amp; ('OnmessageA
                            &amp; ('OnmessageerrorA
                               &amp; ('OnofflineA
                                  &amp; ('OnonlineA
                                     &amp; ('OnpagehideA
                                        &amp; ('OnpageshowA
                                           &amp; ('OnpopstateA
                                              &amp; ('OnrejectionhandledA
                                                 &amp; ('OnstorageA
                                                    &amp; ('OnunhandledrejectionA
                                                       &amp; ('OnunloadA &amp; '[]))))))))))))))))
        :&gt; (((Element
                &quot;div&quot;
                '[ 'Flow, 'Palpable]
                ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                '[]
              :@ (Attribute &quot;id&quot; 'True 'False := Text))
             :&gt; ())
            # ((Element
                  &quot;script&quot;
                  '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                  'OnlyText
                  (GetAttributeName 'SrcA
                     : ('TypeA
                        &amp; ('NomoduleA
                           &amp; ('AsyncA
                              &amp; ('DeferA
                                 &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                :@ (Attribute &quot;type&quot; 'False 'False := Text))
               :&gt; Raw Text)))))
-&gt; Text
forall a. Document a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">renderText</span></span><span> </span><span class="annot"><span class="annottext">((Element
    &quot;html&quot;
    '[]
    ('Elements '[&quot;head&quot;, &quot;body&quot;])
    '[GetAttributeName 'ManifestA]
  :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
       :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
           # (((Element
                  &quot;script&quot;
                  '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                  'OnlyText
                  (GetAttributeName 'SrcA
                     : ('TypeA
                        &amp; ('NomoduleA
                           &amp; ('AsyncA
                              &amp; ('DeferA
                                 &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
               :&gt; ())
              # (((Element
                     &quot;script&quot;
                     '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                     'OnlyText
                     (GetAttributeName 'SrcA
                        : ('TypeA
                           &amp; ('NomoduleA
                              &amp; ('AsyncA
                                 &amp; ('DeferA
                                    &amp; ('CrossoriginA
                                       &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                   :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                  :&gt; ())
                 # ((Element
                       &quot;script&quot;
                       '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                       'OnlyText
                       (GetAttributeName 'SrcA
                          : ('TypeA
                             &amp; ('NomoduleA
                                &amp; ('AsyncA
                                   &amp; ('DeferA
                                      &amp; ('CrossoriginA
                                         &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                     :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                    :&gt; ())))))
      # (Element
           &quot;body&quot;
           '[]
           'Flow
           (GetAttributeName 'OnafterprintA
              : ('OnbeforeprintA
                 &amp; ('OnbeforeunloadA
                    &amp; ('OnhashchangeA
                       &amp; ('OnlanguagechangeA
                          &amp; ('OnmessageA
                             &amp; ('OnmessageerrorA
                                &amp; ('OnofflineA
                                   &amp; ('OnonlineA
                                      &amp; ('OnpagehideA
                                         &amp; ('OnpageshowA
                                            &amp; ('OnpopstateA
                                               &amp; ('OnrejectionhandledA
                                                  &amp; ('OnstorageA
                                                     &amp; ('OnunhandledrejectionA
                                                        &amp; ('OnunloadA &amp; '[]))))))))))))))))
         :&gt; (((Element
                 &quot;div&quot;
                 '[ 'Flow, 'Palpable]
                 ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                 '[]
               :@ (Attribute &quot;id&quot; 'True 'False := Text))
              :&gt; ())
             # ((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute &quot;type&quot; 'False 'False := Text))
                :&gt; Raw Text)))))
 -&gt; Text)
-&gt; (Element
      &quot;html&quot;
      '[]
      ('Elements '[&quot;head&quot;, &quot;body&quot;])
      '[GetAttributeName 'ManifestA]
    :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
         :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
             # (((Element
                    &quot;script&quot;
                    '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                    'OnlyText
                    (GetAttributeName 'SrcA
                       : ('TypeA
                          &amp; ('NomoduleA
                             &amp; ('AsyncA
                                &amp; ('DeferA
                                   &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                  :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                 :&gt; ())
                # (((Element
                       &quot;script&quot;
                       '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                       'OnlyText
                       (GetAttributeName 'SrcA
                          : ('TypeA
                             &amp; ('NomoduleA
                                &amp; ('AsyncA
                                   &amp; ('DeferA
                                      &amp; ('CrossoriginA
                                         &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                     :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                    :&gt; ())
                   # ((Element
                         &quot;script&quot;
                         '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                         'OnlyText
                         (GetAttributeName 'SrcA
                            : ('TypeA
                               &amp; ('NomoduleA
                                  &amp; ('AsyncA
                                     &amp; ('DeferA
                                        &amp; ('CrossoriginA
                                           &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                       :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                      :&gt; ())))))
        # (Element
             &quot;body&quot;
             '[]
             'Flow
             (GetAttributeName 'OnafterprintA
                : ('OnbeforeprintA
                   &amp; ('OnbeforeunloadA
                      &amp; ('OnhashchangeA
                         &amp; ('OnlanguagechangeA
                            &amp; ('OnmessageA
                               &amp; ('OnmessageerrorA
                                  &amp; ('OnofflineA
                                     &amp; ('OnonlineA
                                        &amp; ('OnpagehideA
                                           &amp; ('OnpageshowA
                                              &amp; ('OnpopstateA
                                                 &amp; ('OnrejectionhandledA
                                                    &amp; ('OnstorageA
                                                       &amp; ('OnunhandledrejectionA
                                                          &amp; ('OnunloadA &amp; '[]))))))))))))))))
           :&gt; (((Element
                   &quot;div&quot;
                   '[ 'Flow, 'Palpable]
                   ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                   '[]
                 :@ (Attribute &quot;id&quot; 'True 'False := Text))
                :&gt; ())
               # ((Element
                     &quot;script&quot;
                     '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                     'OnlyText
                     (GetAttributeName 'SrcA
                        : ('TypeA
                           &amp; ('NomoduleA
                              &amp; ('AsyncA
                                 &amp; ('DeferA
                                    &amp; ('CrossoriginA
                                       &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                   :@ (Attribute &quot;type&quot; 'False 'False := Text))
                  :&gt; Raw Text)))))
-&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; Element
     &quot;html&quot;
     '[]
     ('Elements '[&quot;head&quot;, &quot;body&quot;])
     '[GetAttributeName 'ManifestA]
   :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
        :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
            # (((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                :&gt; ())
               # (((Element
                      &quot;script&quot;
                      '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                      'OnlyText
                      (GetAttributeName 'SrcA
                         : ('TypeA
                            &amp; ('NomoduleA
                               &amp; ('AsyncA
                                  &amp; ('DeferA
                                     &amp; ('CrossoriginA
                                        &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                    :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                   :&gt; ())
                  # ((Element
                        &quot;script&quot;
                        '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                        'OnlyText
                        (GetAttributeName 'SrcA
                           : ('TypeA
                              &amp; ('NomoduleA
                                 &amp; ('AsyncA
                                    &amp; ('DeferA
                                       &amp; ('CrossoriginA
                                          &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                      :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                     :&gt; ())))))
       # (Element
            &quot;body&quot;
            '[]
            'Flow
            (GetAttributeName 'OnafterprintA
               : ('OnbeforeprintA
                  &amp; ('OnbeforeunloadA
                     &amp; ('OnhashchangeA
                        &amp; ('OnlanguagechangeA
                           &amp; ('OnmessageA
                              &amp; ('OnmessageerrorA
                                 &amp; ('OnofflineA
                                    &amp; ('OnonlineA
                                       &amp; ('OnpagehideA
                                          &amp; ('OnpageshowA
                                             &amp; ('OnpopstateA
                                                &amp; ('OnrejectionhandledA
                                                   &amp; ('OnstorageA
                                                      &amp; ('OnunhandledrejectionA
                                                         &amp; ('OnunloadA &amp; '[]))))))))))))))))
          :&gt; (((Element
                  &quot;div&quot;
                  '[ 'Flow, 'Palpable]
                  ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                  '[]
                :@ (Attribute &quot;id&quot; 'True 'False := Text))
               :&gt; ())
              # ((Element
                    &quot;script&quot;
                    '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                    'OnlyText
                    (GetAttributeName 'SrcA
                       : ('TypeA
                          &amp; ('NomoduleA
                             &amp; ('AsyncA
                                &amp; ('DeferA
                                   &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                  :@ (Attribute &quot;type&quot; 'False 'False := Text))
                 :&gt; Raw Text))))
</span><a href="Musicology.Plotting.Plotting.html#vegaEmbed"><span class="hs-identifier hs-var">vegaEmbed</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121775"><span class="hs-identifier hs-var">fnJ</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">openBrowser</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121774"><span class="hs-identifier hs-var">fnH</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><a href="Musicology.Plotting.Plotting.html#fixRatios"><span class="hs-identifier hs-type">fixRatios</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-35"></span><span id="fixRatios"><span class="annot"><span class="annottext">fixRatios :: Value -&gt; Value
</span><a href="Musicology.Plotting.Plotting.html#fixRatios"><span class="hs-identifier hs-var hs-var">fixRatios</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Object</span></span><span> </span><span id="local-6989586621679121767"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121767"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">J.Object</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; Object -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Object
forall k.
(Eq k, Hashable k) =&gt;
k -&gt; HashMap k Value -&gt; HashMap k Value
</span><a href="#local-6989586621679121766"><span class="hs-identifier hs-var">fixRatio</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;onset&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Object) -&gt; Object -&gt; Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Object
forall k.
(Eq k, Hashable k) =&gt;
k -&gt; HashMap k Value -&gt; HashMap k Value
</span><a href="#local-6989586621679121766"><span class="hs-identifier hs-var">fixRatio</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;offset&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121767"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-36"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>  </span><span id="local-6989586621679121766"><span class="annot"><span class="annottext">fixRatio :: k -&gt; HashMap k Value -&gt; HashMap k Value
</span><a href="#local-6989586621679121766"><span class="hs-identifier hs-var hs-var">fixRatio</span></a></span></span><span> </span><span id="local-6989586621679121765"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679121765"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679121764"><span class="annot"><span class="annottext">HashMap k Value
</span><a href="#local-6989586621679121764"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; k -&gt; HashMap k Value -&gt; HashMap k Value
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v) -&gt; k -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.adjust</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621679121762"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679121765"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k Value
</span><a href="#local-6989586621679121764"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679121762"><span class="annot"><span class="annottext">fix :: Value -&gt; Value
</span><a href="#local-6989586621679121762"><span class="hs-identifier hs-var hs-var">fix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Object</span></span><span> </span><span id="local-6989586621679121761"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121761"><span class="hs-identifier hs-var">rat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Number</span></span><span> </span><span id="local-6989586621679121759"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679121759"><span class="hs-identifier hs-var">num</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text -&gt; Object -&gt; Value
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.lookupDefault</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><span class="hs-identifier hs-var">J.Number</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;numerator&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121761"><span class="hs-identifier hs-var">rat</span></a></span><span>
</span><span id="line-40"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Number</span></span><span> </span><span id="local-6989586621679121757"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679121757"><span class="hs-identifier hs-var">den</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text -&gt; Object -&gt; Value
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.lookupDefault</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><span class="hs-identifier hs-var">J.Number</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;denominator&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121761"><span class="hs-identifier hs-var">rat</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Scientific -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value) -&gt; Scientific -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679121759"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Scientific -&gt; Scientific
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679121757"><span class="hs-identifier hs-var">den</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="#local-6989586621679121762"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span id="local-6989586621679121754"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121754"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121754"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Musicology.Plotting.Plotting.html#fixRatios"><span class="hs-identifier hs-var">fixRatios</span></a></span><span> </span><span id="local-6989586621679121753"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121753"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121753"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span id="local-6989586621679121827"><span id="local-6989586621679121828"><span class="annot"><a href="Musicology.Plotting.Plotting.html#pianorollView"><span class="hs-identifier hs-type">pianorollView</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121828"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121827"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679121828"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToMidi</span></span><span> </span><span class="annot"><a href="#local-6989586621679121828"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121828"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121827"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VLProperty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VLSpec</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-50"></span><span id="pianorollView"><span class="annot"><span class="annottext">pianorollView :: [Note p t] -&gt; Maybe Text -&gt; [(VLProperty, Value)]
</span><a href="Musicology.Plotting.Plotting.html#pianorollView"><span class="hs-identifier hs-var hs-var">pianorollView</span></a></span></span><span> </span><span id="local-6989586621679121750"><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121750"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span id="local-6989586621679121749"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679121749"><span class="hs-identifier hs-var">colorName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679121748"><span class="annot"><span class="annottext">pitches :: [Double]
</span><a href="#local-6989586621679121748"><span class="hs-identifier hs-var hs-var">pitches</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note p t -&gt; Double) -&gt; [Note p t] -&gt; [Double]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Note p t -&gt; Int) -&gt; Note p t -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Int
forall i. ToMidi i =&gt; i -&gt; Int
</span><span class="hs-identifier hs-var">toMidi</span></span><span> </span><span class="annot"><span class="annottext">(p -&gt; Int) -&gt; (Note p t -&gt; p) -&gt; Note p t -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pitch p -&gt; p
forall a. Pitch a -&gt; a
</span><span class="hs-identifier hs-var">toInterval</span></span><span> </span><span class="annot"><span class="annottext">(Pitch p -&gt; p) -&gt; (Note p t -&gt; Pitch p) -&gt; Note p t -&gt; p
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note p t -&gt; Pitch p
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121750"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-52"></span><span>      </span><span id="local-6989586621679121744"><span class="annot"><span class="annottext">minp :: Double
</span><a href="#local-6989586621679121744"><span class="hs-identifier hs-var hs-var">minp</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Double
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679121748"><span class="hs-identifier hs-var">pitches</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span id="local-6989586621679121742"><span class="annot"><span class="annottext">maxp :: Double
</span><a href="#local-6989586621679121742"><span class="hs-identifier hs-var hs-var">maxp</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Double
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679121748"><span class="hs-identifier hs-var">pitches</span></a></span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span id="local-6989586621679121739"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679121739"><span class="hs-identifier hs-var">nj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Note p t] -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121750"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span id="local-6989586621679121738"><span class="annot"><span class="annottext">vals :: [Format] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121738"><span class="hs-identifier hs-var hs-var">vals</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [Format] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">dataFromJson</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [Format] -&gt; (VLProperty, Value))
-&gt; Value -&gt; [Format] -&gt; (VLProperty, Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array -&gt; Value
</span><span class="hs-identifier hs-var">Array</span></span><span> </span><span class="annot"><span class="annottext">(Array -&gt; Value) -&gt; Array -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Musicology.Plotting.Plotting.html#fixRatios"><span class="hs-identifier hs-var">fixRatios</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Array -&gt; Array
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679121739"><span class="hs-identifier hs-var">nj</span></a></span><span>
</span><span id="line-56"></span><span>      </span><span id="local-6989586621679121735"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121735"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>          </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">encoding</span></span><span>
</span><span id="line-58"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; (VLProperty, Value))
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; (VLProperty, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">X</span></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;onset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-59"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">X2</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;offset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-60"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span>
</span><span id="line-61"></span><span>                </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Y</span></span><span>
</span><span id="line-62"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pitch&quot;</span></span><span>
</span><span id="line-63"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Ordinal</span></span><span>
</span><span id="line-64"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PScale</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><span class="hs-identifier hs-var">SDomain</span></span><span> </span><span class="annot"><span class="annottext">(DomainLimits -&gt; ScaleProperty) -&gt; DomainLimits -&gt; ScaleProperty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><span class="hs-identifier hs-var">DNumbers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; [Double]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679121744"><span class="hs-identifier hs-var">minp</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679121742"><span class="hs-identifier hs-var">maxp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">tooltip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><span class="hs-identifier hs-var">TName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pitch&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><span class="hs-identifier hs-var">TmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; (Text -&gt; [EncodingSpec] -&gt; [EncodingSpec])
-&gt; Maybe Text
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; [EncodingSpec]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679121716"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121716"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">color</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><span class="hs-identifier hs-var">MString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121716"><span class="hs-identifier hs-var">cn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679121749"><span class="hs-identifier hs-var">colorName</span></a></span><span>
</span><span id="line-68"></span><span>             </span><span class="hs-comment">-- . position Y [PName &quot;pu&quot;, PmType Quantitative]</span><span>
</span><span id="line-69"></span><span>             </span><span class="hs-comment">-- . position Y2 [PName &quot;pl&quot;, PmType Quantitative]</span><span>
</span><span id="line-70"></span><span>             </span><span class="hs-comment">-- . position Y [PName &quot;pitch&quot;, PmType Quantitative, PBin [Step 1]]</span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-comment">-- tran = transform</span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-comment">--        . calculateAs &quot;datum.pitch+0.5&quot; &quot;pu&quot;</span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-comment">--        . calculateAs &quot;datum.pitch-0.5&quot; &quot;pl&quot;</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">mark</span></span><span> </span><span class="annot"><span class="annottext">Mark
</span><span class="hs-identifier hs-var">Rect</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121738"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121735"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- tran []</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span id="local-6989586621679121710"><span id="local-6989586621679121711"><span class="annot"><a href="Musicology.Plotting.Plotting.html#pianoroll"><span class="hs-identifier hs-type">pianoroll</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121711"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121710"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679121711"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToMidi</span></span><span> </span><span class="annot"><a href="#local-6989586621679121711"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121711"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121710"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VegaLite</span></span></span></span><span>
</span><span id="line-78"></span><span id="pianoroll"><span class="annot"><span class="annottext">pianoroll :: [Note p t] -&gt; VegaLite
</span><a href="Musicology.Plotting.Plotting.html#pianoroll"><span class="hs-identifier hs-var hs-var">pianoroll</span></a></span></span><span> </span><span id="local-6989586621679121708"><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121708"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">[(VLProperty, Value)] -&gt; VegaLite
</span><span class="hs-identifier hs-var">toVegaLite</span></span><span> </span><span class="annot"><span class="annottext">([(VLProperty, Value)] -&gt; VegaLite)
-&gt; [(VLProperty, Value)] -&gt; VegaLite
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">width</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">800</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">height</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121704"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(VLProperty, Value)]
-&gt; [(VLProperty, Value)] -&gt; [(VLProperty, Value)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Note p t] -&gt; Maybe Text -&gt; [(VLProperty, Value)]
forall p t.
(ToJSON p, ToJSON t, Interval p, ToMidi p) =&gt;
[Note p t] -&gt; Maybe Text -&gt; [(VLProperty, Value)]
</span><a href="Musicology.Plotting.Plotting.html#pianorollView"><span class="hs-identifier hs-var">pianorollView</span></a></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121708"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679121704"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121704"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">selection</span></span><span> </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; (VLProperty, Value))
-&gt; ([SelectSpec] -&gt; [SelectSpec])
-&gt; [SelectSpec]
-&gt; (VLProperty, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><span class="hs-identifier hs-var">select</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grid&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><span class="hs-identifier hs-var">Interval</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SelectionProperty
</span><span class="hs-identifier hs-var">BindScales</span></span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621679121807"><span id="local-6989586621679121808"><span class="annot"><a href="Musicology.Plotting.Plotting.html#plotpolysView"><span class="hs-identifier hs-type">plotpolysView</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121808"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121807"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679121808"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToMidi</span></span><span> </span><span class="annot"><a href="#local-6989586621679121808"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121808"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121807"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121808"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121807"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VLProperty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VLSpec</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-87"></span><span id="plotpolysView"><span class="annot"><span class="annottext">plotpolysView :: [Note p t] -&gt; [[Note p t]] -&gt; [(VLProperty, Value)]
</span><a href="Musicology.Plotting.Plotting.html#plotpolysView"><span class="hs-identifier hs-var hs-var">plotpolysView</span></a></span></span><span> </span><span id="local-6989586621679121698"><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121698"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span id="local-6989586621679121697"><span class="annot"><span class="annottext">[[Note p t]]
</span><a href="#local-6989586621679121697"><span class="hs-identifier hs-var">polys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Value] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">layer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121695"><span class="hs-identifier hs-var">background</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679121694"><span class="hs-identifier hs-var">foreground</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679121695"><span class="annot"><span class="annottext">background :: Value
</span><a href="#local-6989586621679121695"><span class="hs-identifier hs-var hs-var">background</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VegaLite -&gt; Value
</span><span class="hs-identifier hs-var">fromVL</span></span><span> </span><span class="annot"><span class="annottext">(VegaLite -&gt; Value) -&gt; VegaLite -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(VLProperty, Value)] -&gt; VegaLite
</span><span class="hs-identifier hs-var">toVegaLite</span></span><span> </span><span class="annot"><span class="annottext">([(VLProperty, Value)] -&gt; VegaLite)
-&gt; [(VLProperty, Value)] -&gt; VegaLite
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Note p t] -&gt; Maybe Text -&gt; [(VLProperty, Value)]
forall p t.
(ToJSON p, ToJSON t, Interval p, ToMidi p) =&gt;
[Note p t] -&gt; Maybe Text -&gt; [(VLProperty, Value)]
</span><a href="Musicology.Plotting.Plotting.html#pianorollView"><span class="hs-identifier hs-var">pianorollView</span></a></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121698"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;#888888&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679121693"><span class="annot"><span class="annottext">polyJson :: Text -&gt; a -&gt; Array
</span><a href="#local-6989586621679121693"><span class="hs-identifier hs-var hs-var">polyJson</span></a></span></span><span> </span><span id="local-6989586621679121692"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121692"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679121691"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121691"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Array -&gt; Array
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621679121690"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; (Value -&gt; Value) -&gt; Value -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Musicology.Plotting.Plotting.html#fixRatios"><span class="hs-identifier hs-var">fixRatios</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679121689"><span class="hs-identifier hs-var">jNotes</span></a></span><span>
</span><span id="line-91"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span id="local-6989586621679121689"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679121689"><span class="hs-identifier hs-var">jNotes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679121691"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679121690"><span class="annot"><span class="annottext">extend :: Value -&gt; Value
</span><a href="#local-6989586621679121690"><span class="hs-identifier hs-var hs-var">extend</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">J.Object</span></span><span> </span><span id="local-6989586621679121688"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121688"><span class="hs-identifier hs-var">note</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">J.Object</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; Object -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Object -&gt; Object
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121692"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679121688"><span class="hs-identifier hs-var">note</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679121685"><span class="annot"><span class="annottext">notedat :: Array
</span><a href="#local-6989586621679121685"><span class="hs-identifier hs-var hs-var">notedat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Note p t] -&gt; Array
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Array
</span><a href="#local-6989586621679121693"><span class="hs-identifier hs-var">polyJson</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;notes&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121698"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679121684"><span class="annot"><span class="annottext">polydat :: Array
</span><a href="#local-6989586621679121684"><span class="hs-identifier hs-var hs-var">polydat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Array] -&gt; Array
forall a. [Vector a] -&gt; Vector a
</span><span class="hs-identifier hs-var">V.concat</span></span><span> </span><span class="annot"><span class="annottext">([Array] -&gt; Array) -&gt; [Array] -&gt; Array
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; [Note p t] -&gt; Array)
-&gt; [Integer] -&gt; [[Note p t]] -&gt; [Array]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Note p t] -&gt; Array
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Array
</span><a href="#local-6989586621679121693"><span class="hs-identifier hs-var">polyJson</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Note p t] -&gt; Array)
-&gt; (Integer -&gt; Text) -&gt; Integer -&gt; [Note p t] -&gt; Array
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Text
forall a. Show a =&gt; Text -&gt; a -&gt; Text
</span><a href="#local-6989586621679121681"><span class="hs-identifier hs-var">mkn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;poly &quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[[Note p t]]
</span><a href="#local-6989586621679121697"><span class="hs-identifier hs-var">polys</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621679121681"><span class="annot"><span class="annottext">mkn :: Text -&gt; a -&gt; Text
</span><a href="#local-6989586621679121681"><span class="hs-identifier hs-var hs-var">mkn</span></a></span></span><span> </span><span id="local-6989586621679121680"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121680"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679121680"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (a -&gt; Text) -&gt; a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; (a -&gt; FilePath) -&gt; a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621679121677"><span class="annot"><span class="annottext">vals :: [Format] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121677"><span class="hs-identifier hs-var hs-var">vals</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [Format] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">dataFromJson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array -&gt; Value
</span><span class="hs-identifier hs-var">Array</span></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679121684"><span class="hs-identifier hs-var">polydat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679121676"><span class="annot"><span class="annottext">pitches :: [Double]
</span><a href="#local-6989586621679121676"><span class="hs-identifier hs-var hs-var">pitches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note p t -&gt; Double) -&gt; [Note p t] -&gt; [Double]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Note p t -&gt; Int) -&gt; Note p t -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Int
forall i. ToMidi i =&gt; i -&gt; Int
</span><span class="hs-identifier hs-var">toMidi</span></span><span> </span><span class="annot"><span class="annottext">(p -&gt; Int) -&gt; (Note p t -&gt; p) -&gt; Note p t -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pitch p -&gt; p
forall a. Pitch a -&gt; a
</span><span class="hs-identifier hs-var">toInterval</span></span><span> </span><span class="annot"><span class="annottext">(Pitch p -&gt; p) -&gt; (Note p t -&gt; Pitch p) -&gt; Note p t -&gt; p
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note p t -&gt; Pitch p
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121698"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621679121675"><span class="annot"><span class="annottext">minp :: Double
</span><a href="#local-6989586621679121675"><span class="hs-identifier hs-var hs-var">minp</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Double
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679121676"><span class="hs-identifier hs-var">pitches</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621679121674"><span class="annot"><span class="annottext">maxp :: Double
</span><a href="#local-6989586621679121674"><span class="hs-identifier hs-var hs-var">maxp</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Double
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679121676"><span class="hs-identifier hs-var">pitches</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679121673"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121673"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">encoding</span></span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; (VLProperty, Value))
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; (VLProperty, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">X</span></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;onset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">X2</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;offset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>      </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">position</span></span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Y</span></span><span>
</span><span id="line-107"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pitch&quot;</span></span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Ordinal</span></span><span>
</span><span id="line-109"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><span class="hs-identifier hs-var">PScale</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><span class="hs-identifier hs-var">SDomain</span></span><span> </span><span class="annot"><span class="annottext">(DomainLimits -&gt; ScaleProperty) -&gt; DomainLimits -&gt; ScaleProperty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><span class="hs-identifier hs-var">DNumbers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; [Double]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679121675"><span class="hs-identifier hs-var">minp</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679121674"><span class="hs-identifier hs-var">maxp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">color</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><span class="hs-identifier hs-var">MName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;name&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><span class="hs-identifier hs-var">MmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Nominal</span></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; [EncodingSpec])
-&gt; ([EncodingSpec] -&gt; [EncodingSpec])
-&gt; [EncodingSpec]
-&gt; [EncodingSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; [EncodingSpec] -&gt; [EncodingSpec]
</span><span class="hs-identifier hs-var">tooltip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><span class="hs-identifier hs-var">TName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pitch&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><span class="hs-identifier hs-var">TmType</span></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><span class="hs-identifier hs-var">Quantitative</span></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621679121694"><span class="annot"><span class="annottext">foreground :: Value
</span><a href="#local-6989586621679121694"><span class="hs-identifier hs-var hs-var">foreground</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VegaLite -&gt; Value
</span><span class="hs-identifier hs-var">fromVL</span></span><span> </span><span class="annot"><span class="annottext">(VegaLite -&gt; Value) -&gt; VegaLite -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(VLProperty, Value)] -&gt; VegaLite
</span><span class="hs-identifier hs-var">toVegaLite</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">mark</span></span><span> </span><span class="annot"><span class="annottext">Mark
</span><span class="hs-identifier hs-var">Rect</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121677"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121673"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121669"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679121669"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121669"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">selection</span></span><span> </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; (VLProperty, Value))
-&gt; ([SelectSpec] -&gt; [SelectSpec])
-&gt; [SelectSpec]
-&gt; (VLProperty, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><span class="hs-identifier hs-var">select</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grid&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><span class="hs-identifier hs-var">Interval</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SelectionProperty
</span><span class="hs-identifier hs-var">BindScales</span></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span id="local-6989586621679121803"><span id="local-6989586621679121804"><span class="annot"><a href="Musicology.Plotting.Plotting.html#plotpolys%27"><span class="hs-identifier hs-type">plotpolys'</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121804"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121803"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679121804"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToMidi</span></span><span> </span><span class="annot"><a href="#local-6989586621679121804"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121804"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121803"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121804"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121803"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VegaLite</span></span></span></span><span>
</span><span id="line-121"></span><span id="plotpolys%27"><span class="annot"><span class="annottext">plotpolys' :: [Note p t] -&gt; [[Note p t]] -&gt; VegaLite
</span><a href="Musicology.Plotting.Plotting.html#plotpolys%27"><span class="hs-identifier hs-var hs-var">plotpolys'</span></a></span></span><span> </span><span id="local-6989586621679121667"><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121667"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span id="local-6989586621679121666"><span class="annot"><span class="annottext">[[Note p t]]
</span><a href="#local-6989586621679121666"><span class="hs-identifier hs-var">polys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="annottext">[(VLProperty, Value)] -&gt; VegaLite
</span><span class="hs-identifier hs-var">toVegaLite</span></span><span> </span><span class="annot"><span class="annottext">([(VLProperty, Value)] -&gt; VegaLite)
-&gt; [(VLProperty, Value)] -&gt; VegaLite
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">width</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">800</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">height</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121665"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(VLProperty, Value)]
-&gt; [(VLProperty, Value)] -&gt; [(VLProperty, Value)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Note p t] -&gt; [[Note p t]] -&gt; [(VLProperty, Value)]
forall p t.
(ToJSON p, ToJSON t, Interval p, ToMidi p) =&gt;
[Note p t] -&gt; [[Note p t]] -&gt; [(VLProperty, Value)]
</span><a href="Musicology.Plotting.Plotting.html#plotpolysView"><span class="hs-identifier hs-var">plotpolysView</span></a></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121667"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="annot"><span class="annottext">[[Note p t]]
</span><a href="#local-6989586621679121666"><span class="hs-identifier hs-var">polys</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679121665"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; (VLProperty, Value)
</span><a href="#local-6989586621679121665"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; (VLProperty, Value)
</span><span class="hs-identifier hs-var">selection</span></span><span> </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; (VLProperty, Value))
-&gt; ([SelectSpec] -&gt; [SelectSpec])
-&gt; [SelectSpec]
-&gt; (VLProperty, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><span class="hs-identifier hs-var">select</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grid&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><span class="hs-identifier hs-var">Interval</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SelectionProperty
</span><span class="hs-identifier hs-var">BindScales</span></span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span id="local-6989586621679121663"><span id="local-6989586621679121664"><span class="annot"><a href="Musicology.Plotting.Plotting.html#plotpolys"><span class="hs-identifier hs-type">plotpolys</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121664"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679121663"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679121664"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToMidi</span></span><span> </span><span class="annot"><a href="#local-6989586621679121664"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121664"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121663"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><a href="#local-6989586621679121664"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679121663"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VegaLite</span></span></span></span><span>
</span><span id="line-130"></span><span id="plotpolys"><span class="annot"><span class="annottext">plotpolys :: [Note p t] -&gt; [[[Note p t]]] -&gt; VegaLite
</span><a href="Musicology.Plotting.Plotting.html#plotpolys"><span class="hs-identifier hs-var hs-var">plotpolys</span></a></span></span><span> </span><span id="local-6989586621679121661"><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121661"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span id="local-6989586621679121660"><span class="annot"><span class="annottext">[[[Note p t]]]
</span><a href="#local-6989586621679121660"><span class="hs-identifier hs-var">polys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Note p t] -&gt; [[Note p t]] -&gt; VegaLite
forall p t.
(ToJSON p, ToJSON t, Interval p, ToMidi p) =&gt;
[Note p t] -&gt; [[Note p t]] -&gt; VegaLite
</span><a href="Musicology.Plotting.Plotting.html#plotpolys%27"><span class="hs-identifier hs-var">plotpolys'</span></a></span><span> </span><span class="annot"><span class="annottext">[Note p t]
</span><a href="#local-6989586621679121661"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="annot"><span class="annottext">([[Note p t]] -&gt; VegaLite) -&gt; [[Note p t]] -&gt; VegaLite
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Note p t]] -&gt; [Note p t]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Note p t]] -&gt; [Note p t]) -&gt; [[[Note p t]]] -&gt; [[Note p t]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[[[Note p t]]]
</span><a href="#local-6989586621679121660"><span class="hs-identifier hs-var">polys</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span id="vegaEmbed"><span class="annot"><span class="annottext">vegaEmbed :: FilePath
-&gt; Element
     &quot;html&quot;
     '[]
     ('Elements '[&quot;head&quot;, &quot;body&quot;])
     '[GetAttributeName 'ManifestA]
   :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
        :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
            # (((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                :&gt; ())
               # (((Element
                      &quot;script&quot;
                      '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                      'OnlyText
                      (GetAttributeName 'SrcA
                         : ('TypeA
                            &amp; ('NomoduleA
                               &amp; ('AsyncA
                                  &amp; ('DeferA
                                     &amp; ('CrossoriginA
                                        &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                    :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                   :&gt; ())
                  # ((Element
                        &quot;script&quot;
                        '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                        'OnlyText
                        (GetAttributeName 'SrcA
                           : ('TypeA
                              &amp; ('NomoduleA
                                 &amp; ('AsyncA
                                    &amp; ('DeferA
                                       &amp; ('CrossoriginA
                                          &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                      :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                     :&gt; ())))))
       # (Element
            &quot;body&quot;
            '[]
            'Flow
            (GetAttributeName 'OnafterprintA
               : ('OnbeforeprintA
                  &amp; ('OnbeforeunloadA
                     &amp; ('OnhashchangeA
                        &amp; ('OnlanguagechangeA
                           &amp; ('OnmessageA
                              &amp; ('OnmessageerrorA
                                 &amp; ('OnofflineA
                                    &amp; ('OnonlineA
                                       &amp; ('OnpagehideA
                                          &amp; ('OnpageshowA
                                             &amp; ('OnpopstateA
                                                &amp; ('OnrejectionhandledA
                                                   &amp; ('OnstorageA
                                                      &amp; ('OnunhandledrejectionA
                                                         &amp; ('OnunloadA &amp; '[]))))))))))))))))
          :&gt; (((Element
                  &quot;div&quot;
                  '[ 'Flow, 'Palpable]
                  ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                  '[]
                :@ (Attribute &quot;id&quot; 'True 'False := Text))
               :&gt; ())
              # ((Element
                    &quot;script&quot;
                    '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                    'OnlyText
                    (GetAttributeName 'SrcA
                       : ('TypeA
                          &amp; ('NomoduleA
                             &amp; ('AsyncA
                                &amp; ('DeferA
                                   &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                  :@ (Attribute &quot;type&quot; 'False 'False := Text))
                 :&gt; Raw Text))))
</span><a href="Musicology.Plotting.Plotting.html#vegaEmbed"><span class="hs-identifier hs-var hs-var">vegaEmbed</span></a></span></span><span> </span><span id="local-6989586621679121658"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121658"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">Element
  &quot;html&quot;
  '[]
  ('Elements '[&quot;head&quot;, &quot;body&quot;])
  '[GetAttributeName 'ManifestA]
</span><span class="hs-identifier hs-var">Html</span></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">Element
  &quot;html&quot;
  '[]
  ('Elements '[&quot;head&quot;, &quot;body&quot;])
  '[GetAttributeName 'ManifestA]
-&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
     :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
         # (((Element
                &quot;script&quot;
                '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                'OnlyText
                (GetAttributeName 'SrcA
                   : ('TypeA
                      &amp; ('NomoduleA
                         &amp; ('AsyncA
                            &amp; ('DeferA
                               &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
              :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
             :&gt; ())
            # (((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                :&gt; ())
               # ((Element
                     &quot;script&quot;
                     '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                     'OnlyText
                     (GetAttributeName 'SrcA
                        : ('TypeA
                           &amp; ('NomoduleA
                              &amp; ('AsyncA
                                 &amp; ('DeferA
                                    &amp; ('CrossoriginA
                                       &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                   :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                  :&gt; ())))))
    # (Element
         &quot;body&quot;
         '[]
         'Flow
         (GetAttributeName 'OnafterprintA
            : ('OnbeforeprintA
               &amp; ('OnbeforeunloadA
                  &amp; ('OnhashchangeA
                     &amp; ('OnlanguagechangeA
                        &amp; ('OnmessageA
                           &amp; ('OnmessageerrorA
                              &amp; ('OnofflineA
                                 &amp; ('OnonlineA
                                    &amp; ('OnpagehideA
                                       &amp; ('OnpageshowA
                                          &amp; ('OnpopstateA
                                             &amp; ('OnrejectionhandledA
                                                &amp; ('OnstorageA
                                                   &amp; ('OnunhandledrejectionA
                                                      &amp; ('OnunloadA &amp; '[]))))))))))))))))
       :&gt; (((Element
               &quot;div&quot;
               '[ 'Flow, 'Palpable]
               ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
               '[]
             :@ (Attribute &quot;id&quot; 'True 'False := Text))
            :&gt; ())
           # ((Element
                 &quot;script&quot;
                 '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                 'OnlyText
                 (GetAttributeName 'SrcA
                    : ('TypeA
                       &amp; ('NomoduleA
                          &amp; ('AsyncA
                             &amp; ('DeferA
                                &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
               :@ (Attribute &quot;type&quot; 'False 'False := Text))
              :&gt; Raw Text))))
-&gt; Element
     &quot;html&quot;
     '[]
     ('Elements '[&quot;head&quot;, &quot;body&quot;])
     '[GetAttributeName 'ManifestA]
   :&gt; ((Element &quot;head&quot; '[] 'Metadata '[]
        :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
            # (((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                :&gt; ())
               # (((Element
                      &quot;script&quot;
                      '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                      'OnlyText
                      (GetAttributeName 'SrcA
                         : ('TypeA
                            &amp; ('NomoduleA
                               &amp; ('AsyncA
                                  &amp; ('DeferA
                                     &amp; ('CrossoriginA
                                        &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                    :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                   :&gt; ())
                  # ((Element
                        &quot;script&quot;
                        '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                        'OnlyText
                        (GetAttributeName 'SrcA
                           : ('TypeA
                              &amp; ('NomoduleA
                                 &amp; ('AsyncA
                                    &amp; ('DeferA
                                       &amp; ('CrossoriginA
                                          &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                      :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                     :&gt; ())))))
       # (Element
            &quot;body&quot;
            '[]
            'Flow
            (GetAttributeName 'OnafterprintA
               : ('OnbeforeprintA
                  &amp; ('OnbeforeunloadA
                     &amp; ('OnhashchangeA
                        &amp; ('OnlanguagechangeA
                           &amp; ('OnmessageA
                              &amp; ('OnmessageerrorA
                                 &amp; ('OnofflineA
                                    &amp; ('OnonlineA
                                       &amp; ('OnpagehideA
                                          &amp; ('OnpageshowA
                                             &amp; ('OnpopstateA
                                                &amp; ('OnrejectionhandledA
                                                   &amp; ('OnstorageA
                                                      &amp; ('OnunhandledrejectionA
                                                         &amp; ('OnunloadA &amp; '[]))))))))))))))))
          :&gt; (((Element
                  &quot;div&quot;
                  '[ 'Flow, 'Palpable]
                  ('Flow ':|: ('Elements '[&quot;dt&quot;, &quot;dt&quot;] ':|: 'Scripting))
                  '[]
                :@ (Attribute &quot;id&quot; 'True 'False := Text))
               :&gt; ())
              # ((Element
                    &quot;script&quot;
                    '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                    'OnlyText
                    (GetAttributeName 'SrcA
                       : ('TypeA
                          &amp; ('NomoduleA
                             &amp; ('AsyncA
                                &amp; ('DeferA
                                   &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                  :@ (Attribute &quot;type&quot; 'False 'False := Text))
                 :&gt; Raw Text))))
forall father child.
Lawful 'Fatherhood father child =&gt;
father -&gt; child -&gt; father :&gt; child
</span><span class="hs-operator hs-var">:&gt;</span></span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">Element &quot;head&quot; '[] 'Metadata '[]
</span><span class="hs-identifier hs-var">Head</span></span><span>
</span><span id="line-135"></span><span>       </span><span class="annot"><span class="annottext">Element &quot;head&quot; '[] 'Metadata '[]
-&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
    # (((Element
           &quot;script&quot;
           '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
           'OnlyText
           (GetAttributeName 'SrcA
              : ('TypeA
                 &amp; ('NomoduleA
                    &amp; ('AsyncA
                       &amp; ('DeferA
                          &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
         :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
        :&gt; ())
       # (((Element
              &quot;script&quot;
              '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
              'OnlyText
              (GetAttributeName 'SrcA
                 : ('TypeA
                    &amp; ('NomoduleA
                       &amp; ('AsyncA
                          &amp; ('DeferA
                             &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
            :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
           :&gt; ())
          # ((Element
                &quot;script&quot;
                '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                'OnlyText
                (GetAttributeName 'SrcA
                   : ('TypeA
                      &amp; ('NomoduleA
                         &amp; ('AsyncA
                            &amp; ('DeferA
                               &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
              :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
             :&gt; ()))))
-&gt; Element &quot;head&quot; '[] 'Metadata '[]
   :&gt; ((Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text)
       # (((Element
              &quot;script&quot;
              '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
              'OnlyText
              (GetAttributeName 'SrcA
                 : ('TypeA
                    &amp; ('NomoduleA
                       &amp; ('AsyncA
                          &amp; ('DeferA
                             &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
            :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
           :&gt; ())
          # (((Element
                 &quot;script&quot;
                 '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                 'OnlyText
                 (GetAttributeName 'SrcA
                    : ('TypeA
                       &amp; ('NomoduleA
                          &amp; ('AsyncA
                             &amp; ('DeferA
                                &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
               :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
              :&gt; ())
             # ((Element
                   &quot;script&quot;
                   '[ 'Metadata, 'Flow, 'Phrasing, 'Scripting]
                   'OnlyText
                   (GetAttributeName 'SrcA
                      : ('TypeA
                         &amp; ('NomoduleA
                            &amp; ('AsyncA
                               &amp; ('DeferA
                                  &amp; ('CrossoriginA &amp; ('IntegrityA &amp; ('ReferrerpolicyA &amp; '[]))))))))
                 :@ (Attribute (GetAttributeName 'SrcA) 'False 'False := Text))
                :&gt; ()))))
forall father child.
Lawful 'Fatherhood father child =&gt;
father -&gt; child -&gt; father :&gt; child
</span><span class="hs-operator hs-var">:&gt;</span></span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[]
</span><span class="hs-identifier hs-var">Title</span></span><span>
</span><span id="line-136"></span><span>          </span><span class="annot"><span class="annottext">Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[]
-&gt; Text -&gt; Element &quot;title&quot; '[ 'Metadata] 'OnlyText '[] :&gt; Text
forall father child.
Lawful 'Fatherhood father child =&gt;
father -&gt; child -&gt; father :&gt; child
</span><span class="hs-operator hs-var">:&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Plot&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-cpp">
          #  Script
</span><span>          </span><span class="hs-operator">:@</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SrcA</span><span> </span><span class="hs-operator">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;https://cdn.jsdelivr.net/npm/vega@3&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">T.Text</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
          #  Script
</span><span>          </span><span class="hs-operator">:@</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SrcA</span><span> </span><span class="hs-operator">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;https://cdn.jsdelivr.net/npm/vega-lite@2&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">T.Text</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>          </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
          #  Script
</span><span>          </span><span class="hs-operator">:@</span><span> </span><span class="hs-special">(</span><span>  </span><span class="hs-identifier">SrcA</span><span>
</span><span id="line-146"></span><span>             </span><span class="hs-operator">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;https://cdn.jsdelivr.net/npm/vega-embed@3&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">T.Text</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>          </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-special">)</span><span class="hs-cpp">
       #  Body
</span><span>       </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span>  </span><span class="hs-identifier">Div</span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-operator">:@</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IdA</span><span> </span><span class="hs-operator">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;vis&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">T.Text</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
          #  Script
</span><span>          </span><span class="hs-operator">:@</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TypeA</span><span> </span><span class="hs-operator">:=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;text/javascript&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">T.Text</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>          </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Raw</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">vegaJsText</span><span> </span><span class="hs-identifier">fn</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Musicology.Plotting.Plotting.html#vegaJsText"><span class="hs-identifier hs-type">vegaJsText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-161"></span><span id="vegaJsText"><span class="annot"><span class="annottext">vegaJsText :: FilePath -&gt; Text
</span><a href="Musicology.Plotting.Plotting.html#vegaJsText"><span class="hs-identifier hs-var hs-var">vegaJsText</span></a></span></span><span> </span><span id="local-6989586621679121644"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121644"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;var spec = \&quot;&quot;</span></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679121644"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;;vegaEmbed('#vis', spec).then(function(result) {}).catch(console.error);&quot;</span></span><span>
</span><span id="line-165"></span></pre></body></html>