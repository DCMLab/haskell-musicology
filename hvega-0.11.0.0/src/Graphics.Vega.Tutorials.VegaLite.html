<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">{-|
Module      : Graphics.Vega.Tutorials.VegaLite
Copyright   : (c) Douglas Burke, 2019-2020
License     : BSD3

Maintainer  : dburke.gw@gmail.com
Stability   : unstable
Portability : CPP, OverloadedStrings

This tutorial is inspired by - in that it starts off as a close copy of - the
&lt;https://github.com/gicentre/elm-vegalite/tree/master/docs/walkthrough Elm Vega-Lite walkthrough&gt;
created by Jo Wood, and
converted as necessary for the differences between @hvega@ and
&lt;https://package.elm-lang.org/packages/gicentre/elm-vegalite/latest elm-vegalite&gt;.
The Elm tutorial is based on the talk given by
&lt;https://youtu.be/9uaHRWj04D4 Wongsuphasawat et al at the 2017 Open Vis Conf&gt;.

The tutorial targets version 4 of the Vega-Lite specification and
the functionality provided in version @0.11.0.0@ of hvega (although
a number of examples could be simplified by removing the
now-optional type information as of Vega-Lite 4.14).

-}</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Graphics.Vega.Tutorials.VegaLite</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- * A Grammar of Graphics</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** How many Haskell extensions do you need?</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-extensions</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** A note on type safety</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-type-safety</span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Comparing hvega to Elm Vega-Lite</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-comment">-- $compare-to-elm</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-comment">-- * What data are we using?</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="hs-comment">-- $datasource</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Creating the Vega-Lite visualization</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-comment">-- $output</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-comment">-- * A Strip Plot</span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-comment">-- $singleview-stripplot</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Our first hvega plot</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlot"><span class="hs-identifier">stripPlot</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Backgrounds</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="hs-comment">-- $background-note</span></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithBackground"><span class="hs-identifier">stripPlotWithBackground</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Challenging the primacy of the x axis</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotY"><span class="hs-identifier">stripPlotY</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Data sources</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier">gaiaData</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Adding color as an encoding</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor"><span class="hs-identifier">stripPlotWithColor</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor2"><span class="hs-identifier">stripPlotWithColor2</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Comparing Ordinal with Nominal data types</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="hs-comment">-- $stripplot-mmtype</span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColorOrdinal"><span class="hs-identifier">stripPlotWithColorOrdinal</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="hs-comment">-- * A Pie Chart</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="hs-comment">-- $pie-chart</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChart"><span class="hs-identifier">pieChart</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChartWithCounting"><span class="hs-identifier">pieChartWithCounting</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Adding an axis</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="hs-comment">-- $add-axis</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxBreakdown"><span class="hs-identifier">parallaxBreakdown</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Creating a value to plot: aggregating data</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="hs-comment">-- $histogram</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#simpleHistogram"><span class="hs-identifier">simpleHistogram</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxHistogram"><span class="hs-identifier">parallaxHistogram</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogram"><span class="hs-identifier">gmagHistogram</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Changing the scale of an axis</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="hs-comment">-- $ylog-histogram</span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#ylogHistogram"><span class="hs-identifier">ylogHistogram</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Stacked Histogram</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogramWithColor"><span class="hs-identifier">gmagHistogramWithColor</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagLineWithColor"><span class="hs-identifier">gmagLineWithColor</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** You don't have to just count</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="hs-comment">-- $histogramChoice</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#yHistogram"><span class="hs-identifier">yHistogram</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount"><span class="hs-identifier">starCount</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount2"><span class="hs-identifier">starCount2</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallax"><span class="hs-identifier">densityParallax</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallaxGrouped"><span class="hs-identifier">densityParallaxGrouped</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Plotting with points</span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-points</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pointPlot"><span class="hs-identifier">pointPlot</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Making a map</span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-map</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#posPlot"><span class="hs-identifier">posPlot</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Using a projection</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlot"><span class="hs-identifier">skyPlot</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Choropleth with joined data</span></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-choropleth</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupToGeo"><span class="hs-identifier">choroplethLookupToGeo</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Layered and Multi-View Compositions</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-layered</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples"><span class="hs-identifier">smallMultiples</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples2"><span class="hs-identifier">smallMultiples2</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityMultiples"><span class="hs-identifier">densityMultiples</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** One plot, two plot, red plot, blue plot</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-multiplot</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#basePlot"><span class="hs-identifier">basePlot</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Composing layers</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredPlot"><span class="hs-identifier">layeredPlot</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredDiversion"><span class="hs-identifier">layeredDiversion</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredCount"><span class="hs-identifier">layeredCount</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotWithGraticules"><span class="hs-identifier">skyPlotWithGraticules</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Concatenating views</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot"><span class="hs-identifier">concatenatedPlot</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot2"><span class="hs-identifier">concatenatedPlot2</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedSkyPlot"><span class="hs-identifier">concatenatedSkyPlot</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Repeated views</span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-repeat</span></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Varying fields field</span></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#repeatPlot"><span class="hs-identifier">repeatPlot</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Repeating Choropleths</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupFromGeo"><span class="hs-identifier">choroplethLookupFromGeo</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Rows and Columns</span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#splomPlot"><span class="hs-identifier">splomPlot</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Interactivity</span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-interactivity</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier">selectionProperties</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#singleSelection"><span class="hs-identifier">singleSelection</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#nearestSelection"><span class="hs-identifier">nearestSelection</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#multiSelection"><span class="hs-identifier">multiSelection</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#eventSelection"><span class="hs-identifier">eventSelection</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelection"><span class="hs-identifier">intervalSelection</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelectionY"><span class="hs-identifier">intervalSelectionY</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Selection Transformations</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-selection-transforms</span></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#transformSelection"><span class="hs-identifier">transformSelection</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Selection and bindings</span></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-selection-binding</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#legendSelection"><span class="hs-identifier">legendSelection</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#widgetSelection"><span class="hs-identifier">widgetSelection</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#bindScales"><span class="hs-identifier">bindScales</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Multiple Coordinated Views</span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-coordinated-views</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews"><span class="hs-identifier">coordinatedViews</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews2"><span class="hs-identifier">coordinatedViews2</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#contextAndFocus"><span class="hs-identifier">contextAndFocus</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Cross-filtering</span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-crossfilter</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#crossFilter"><span class="hs-identifier">crossFilter</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Smoothing and Regressing</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-smoothing</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#loessExample"><span class="hs-identifier">loessExample</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#regressionExample"><span class="hs-identifier">regressionExample</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Errors: lines, bars, bands, and boxes</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-error</span></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorManual"><span class="hs-identifier">errorManual</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorAuto"><span class="hs-identifier">errorAuto</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBars"><span class="hs-identifier">errorBars</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBand"><span class="hs-identifier">errorBand</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBox"><span class="hs-identifier">errorBox</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#comparingErrors"><span class="hs-identifier">comparingErrors</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Dashboard-esque</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="hs-comment">-- $intro-dashboard</span></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#combinedPlot"><span class="hs-identifier">combinedPlot</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="hs-comment">-- * The end</span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="hs-comment">-- $otherstuff</span></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#duplicateAxis"><span class="hs-identifier">duplicateAxis</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#compareCounts"><span class="hs-identifier">compareCounts</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxView"><span class="hs-identifier">parallaxView</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Aitoff projections</span></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="hs-comment">-- $aitoff</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotAitoff"><span class="hs-identifier">skyPlotAitoff</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#clusterCenters"><span class="hs-identifier">clusterCenters</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filter</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">repeat</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if !(MIN_VERSION_base(4, 12, 0))
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-289"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.html"><span class="hs-identifier">Graphics.Vega.VegaLite</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- $intro</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- hvega is a wrapper for the [Vega-Lite visualization</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- grammar](https://vega.github.io/) which itself is based on Leland</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- Wilkinson's [Grammar of</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- Graphics](http://www.springer.com/gb/book/9780387245447).  The</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- grammar provides an expressive way to define how data are</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- represented graphically. The seven key elements of the grammar as</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- represented in hvega and Vega-Lite are:</span><span>
</span><span id="line-299"></span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- [@Data@]: The input to visualize. Example functions: 'dataFromUrl', 'dataFromColumns', and 'dataFromRows'.</span><span>
</span><span id="line-301"></span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- [@Transform@]: Functions to change the data before they are visualized. Example functions: 'filter', 'calculateAs', 'binAs', 'pivot', 'density', and</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- 'regression'. These functions are combined with 'transform'.</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- [@Projection@]: The mapping of 3d global geospatial locations onto a 2d plane . Example function: 'projection'.</span><span>
</span><span id="line-306"></span><span class="hs-comment">--</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- [@Mark@]: The visual symbol, or symbols, that represent the data. Example types, used with 'mark': 'Line', 'Circle', 'Bar', 'Text', and 'Geoshape'. There are also ways to specify the shape to use for the 'Point' type, using the 'MShape' setting and the 'Symbol' type.</span><span>
</span><span id="line-308"></span><span class="hs-comment">--</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- [@Encoding@]: The specification of which data elements are mapped to which mark characteristics (commonly known as channels). Example functions: 'position', 'shape', 'size', and 'color'. These encodings are combined with 'encoding'.</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- [@Scale@]: Descriptions of the way encoded marks represent the data. Example settings: 'SDomain', 'SPadding', and 'SInterpolate'.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- [@Guides@]: Supplementary visual elements that support interpreting the visualization. Example setings: 'AxDomain' (for position encodings) and 'LeTitleColor' (for legend color, size, and shape encodings).</span><span>
</span><span id="line-314"></span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- In common with other languages that build upon a grammar of graphics</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- such as D3 and Vega, this grammar allows fine grain control of</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- visualization design. Unlike those languages, Vega-Lite - and</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- hvega in turn - provide practical default specifications for most of the</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- grammar, allowing for a much more compact high-level form of</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- expression.</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- The [Vega-Lite Example Gallery](https://vega.github.io/vega-lite/examples/)</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- provides a large-number of example visualizations that show off</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- the capabilities of Vega-Lite. Hopefully, by the end of this</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- tutorial, you will be able to create most of them.</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- $intro-extensions</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- The 'Graphics.Vega.VegaLite' module exports a large number of symbols,</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- but does not use any complex type machinery, and so it can be loaded</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- without any extensions, although the extensive use of the 'Data.Text.Text'</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- type means that using the @OverloadedStrings@ extension is __strongly__</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- advised.</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- The module does export several types that conflict with the Prelude,</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- so one suggestion is to use</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">--     &gt; import Prelude hiding (filter, lookup, repeat)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">-- $intro-type-safety</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- The interface provided by @hvega@ provides __limited__ type safety. Various</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- fields such as 'PmType' are limited by the type of the argument (in this</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- case 'Measurement'), but there's no support to check that the type makes</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- sense for the particular column (as @hvega@ itself does not inspect the</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- data source). Similarly, @hvega@ does not stop you from defining</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- properties that are not valid for a given situation - for instance</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- you can say @'toVegaLite' []@ even though the output is not a</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- valid Vega-Lite specification (i.e. it does not validate against</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- the [Vega-Lite schema](https://github.com/vega/schema)).</span><span>
</span><span id="line-349"></span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Version @0.5.0.0@ did add some type safety for a number of functions -</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- primarily 'encoding' and 'transform' - as the types they accept</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- have been restricted (to @['EncodingSpec']@ and @['TransformSpec']@</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- respectively), so that they can not be accidentally combined.</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">-- $compare-to-elm</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- @hvega@ started out as a direct copy of</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- [elm-vegalite](https://package.elm-lang.org/packages/gicentre/elm-vegalite/latest),</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- and has been updated to try and match the functionality of that package.</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- However, @hvega@ has not (yet?) followed @elm-vegalite@ into using</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- functions rather than data structures to define the options: for</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- example, @elm-vegalite@ provides @pQuant n@ which in @hvega@ is the</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- combination of @'PName' n@ and @'PmType' 'Quantitative'@ in @hvega@.</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- The top-level functions - such as 'dataFromUrl', 'encoding', and</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- 'filter' - are generally the same.</span><span>
</span><span id="line-365"></span><span class="hs-comment">--</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- Version @0.5.0.0@ does introduce more-significant changes, in that</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- there are now separate types for a number of functions - such as</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- 'encoding', 'transform', and 'select' - to help reduce the</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- chance of creating invalid visualizations.</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- $datasource</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- Rather than use the Seattle weather dataset, used in the Elm walkthrough</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- (if you go through the [Vega-Lite Example Gallery](https://vega.github.io/vega-lite/examples/)</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- you may also want to look at different data ;-), I am going to use a</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- small datset from the [Gaia satellite](http://sci.esa.int/gaia/),</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- which has - and still is, as of early 2020 - radically-improved our knowledge</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- of our Galaxy. The data itself is from the paper</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- \&quot;Gaia Data Release 2: Observational Hertzsprung-Russell diagrams\&quot;</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- [(preprint on arXiV)](https://arxiv.org/abs/1804.09378)</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- [(NASA ADS link)](https://ui.adsabs.harvard.edu/#abs/arXiv:1804.09378).</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- We are going to use Table 1a, which was downloaded from the</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- [VizieR archive](http://vizier.u-strasbg.fr/viz-bin/VizieR-3?-source=J/A%2bA/616/A10/tablea1a)</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- as a tab-separated file (aka 'TSV' format).</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- The file contains basic measurements for a number of stars in</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- nine open clusters that all lie within 250 parsecs of the Earth</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- (please note, a parsec is a measure of distance, not time, no matter</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- what [some ruggedly-handsome ex-carpenter](https://en.wikipedia.org/wiki/Han_Solo)</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- might claim). The downloaded file is called</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- @gaia-aa-616-a10-table1a.no-header.tsv@, although I have</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- manually edited it to a \&quot;more standard\&quot; TSV form (we Astronomers like</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- our metadata, and tend to stick it in inappropriate places, such as the</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- start of comma- and tab-separated files, which really mucks up</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- other-people's parsing code). The first few rows in the file are:</span><span>
</span><span id="line-395"></span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span class="hs-comment">--</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- +-------------------+---------+-----------+-----------+--------+--------+-------+</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- | Source            | Cluster | RA_ICRS   | DE_ICRS   | Gmag   | plx    | e_plx |</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- +===================+=========+===========+===========+========+========+=======+</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | 49520255665123328 | Hyades  | 064.87461 | +21.75372 | 12.861 | 20.866 | 0.033 |</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- +-------------------+---------+-----------+-----------+--------+--------+-------+</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- | 49729231594420096 | Hyades  | 060.20378 | +18.19388 | 5.790  | 21.789 | 0.045 |</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- +-------------------+---------+-----------+-----------+--------+--------+-------+</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- | 51383893515451392 | Hyades  | 059.80696 | +20.42805 | 12.570 | 22.737 | 0.006 |</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- +-------------------+---------+-----------+-----------+--------+--------+-------+</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | ...               | ...     | ...       | ...       | ...    | ...    | ...   |</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- +-------------------+---------+-----------+-----------+--------+--------+-------+</span><span>
</span><span id="line-408"></span><span class="hs-comment">--</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- The @Source@ column is a numeric identifier for the star in the Gaia database,</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- in this particular case the [\&quot;DR2\&quot; release](https://www.cosmos.esa.int/web/gaia/dr2),</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- the @Cluster@ column tells us which [Star Cluster](https://en.wikipedia.org/wiki/Star_cluster)</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- the star belongs to, @RA_ICRS@ and @DE_ICRS@</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- [locate the star on the sky](https://en.wikipedia.org/wiki/Celestial_coordinate_system)</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- and use the [Equatorial coordinate system](https://en.wikipedia.org/wiki/Equatorial_coordinate_system)</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- (the @ICRS@ term has a meaning too, but it isn't important for our</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- purposes),</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- @Gmag@ measues the &quot;brightness&quot; of the star (as in most-things Astronomical,</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- this is not as obvious as you might think, as I'll go into below),</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- and the @plx@ and @e_plx@ columns give the measured</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- [parallax of the star](https://en.wikipedia.org/wiki/Equatorial_coordinate_system)</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- and its error value, in units of</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- milli [arcseconds](https://en.wikipedia.org/wiki/Minute_and_second_of_arc).</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- And yes, I do realise after complaining about popular-culture references</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- confusing distances and time, I am now measuring distances with angles.</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- I think I've already mentioned that Astronomy is confusing...</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">-- $output</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- The function 'toVegaLite' takes a list of grammar specifications,</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- as will be shown in the examples below, and creates a single JSON object</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- that encodes the entire design. As of @hvega-0.5.0.0@ this targets</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- version 4 of the Vega-Lite schema, but this can be over-ridden with</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- 'toVegaLiteSchema' if needed (although note that this just changes the</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- version number in the schema field, it does not change the output to</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- match a given version).</span><span>
</span><span id="line-435"></span><span class="hs-comment">--</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- There is no concept of ordering to these specification lists, in that</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- @[ dataFromUrl ..., encoding ..., mark ...]@;</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- @[ encoding ..., dataFromUrl ..., mark ... ]@;</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- and</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- @[ encoding ..., mark ..., dataFromUrl ... ]@</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- would all result in the same visualization.</span><span>
</span><span id="line-442"></span><span class="hs-comment">--</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- The output of 'toVegaLite' can be sent to the Vega-Lite runtime to</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- generate the Canvas or SVG output. @hvega@ contains the helper</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- routines:</span><span>
</span><span id="line-446"></span><span class="hs-comment">--</span><span>
</span><span id="line-447"></span><span class="hs-comment">--  * 'fromVL', which is used to extract the JSON contents from 'VegaLite'</span><span>
</span><span id="line-448"></span><span class="hs-comment">--    and create an Aeson 'Data.Aeson.Value';</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="hs-comment">--  * 'toHtml', which creates a HTML page which uses the</span><span>
</span><span id="line-451"></span><span class="hs-comment">--    &lt;https://github.com/vega/vega-embed Vega Embed&gt; Javascript</span><span>
</span><span id="line-452"></span><span class="hs-comment">--    library to display the Vega-Lite visualization;</span><span>
</span><span id="line-453"></span><span class="hs-comment">--</span><span>
</span><span id="line-454"></span><span class="hs-comment">--  * and 'toHtmlFile', which is like 'toHtml' but writes the output</span><span>
</span><span id="line-455"></span><span class="hs-comment">--    to a file.</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- $singleview-stripplot</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- In this section we shall concentrate on creating a single</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- plot. Later on we shall try combining plots, after branching</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- out to explore some of the different ways to visualize</span><span>
</span><span id="line-461"></span><span class="hs-comment">-- multi-dimensional data sets.</span><span>
</span><span id="line-462"></span><span class="hs-comment">--</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- In the examples I link to symbols that have not been used in</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- previous visualizations, to make it easier to see the use</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- of new functionality.</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">{-|

We could encode one of the numeric data fields as a strip plot where
the horizontal position of a tick mark is determined by the value
of the data item. In this case I am going to pick the &quot;@plx@&quot; column:

&lt;&lt;images/vl/stripplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAXAlgY2QGnCgBNZ1ZUxQIJIBXeAGwsgAt10AHAZxQHpf4sAO4A6AOaZ0LWgCNaXAKbxsAewB26BRpGrovACIraYgEL1EC3iwBuCsbF5wum+Fdv3eJMr3uZYAWlgAgDYARmDA0IAGfzIZBgVQ2BE1FX8WBVgiJRF0LmtIAmooADMVeDh0CmBIdABPDgVmPIKAX0JWoqgAEi5sDLhmNk4efndkiSlZEUwVXj6Bh3H-BklLawBmEQArLnVCwkgtVSJMNTFqyAAPS5LMBQYiZg4GG7wMBqa0SABHWlgNJJSJhbJBWp1Dqo1HcLmhgO1WkA Open this visualization in the Vega Editor&gt;

@
'toVegaLite'
    [ 'dataFromUrl' &quot;https:\/\/raw.githubusercontent.com\/DougBurke\/hvega\/master\/hvega\/data\/gaia-aa-616-a10-table1a.no-header.tsv&quot; ['TSV']
    , 'mark' 'Tick' []
    , 'encoding' ('position' 'X' [ 'PName' &quot;plx&quot;, 'PmType' 'Quantitative' ] [])
    ]
@

Notice how there is __no explicit definition__ of the axis details,
color choice or size. These can be customised, as shown in examples
below, but the default values are designed to follow good practice in
visualization design.

Three grammar elements are represented by the three functions
'dataFromUrl', 'mark', and 'encoding'.

The 'encoding' function takes as a single parameter, a list of
specifications that are themselves generated by other functions. In
this case we use the function 'position' to provide an encoding of the
@\&quot;plx\&quot;@ field as the x-position in our plot. The precise way in which
the data value (parallax) is mapped to the x-position will depend on the type of
data we are encoding. We can provide a hint by delcaring the
measurement type of the data field, here 'Quantitative' indicating a
numeric measurement type. The final parameter of position is a list of
any additional encodings in our specification. Here, with only one
encoding, we provide an empty list.

As we build up more complex visualizations we will use many more
encodings. To keep the coding clear, the idiomatic way to do this with
hvega is to chain encoding functions using point-free
style. The example above coded in this way would be

@
let enc = encoding
            . position X [ PName &quot;plx&quot;, PmType Quantitative ]

in toVegaLite
    [ dataFromUrl &quot;https:\/\/raw.githubusercontent.com\/DougBurke\/hvega\/master\/hvega\/data\/gaia-aa-616-a10-table1a.no-header.tsv&quot; [TSV]
    , mark Tick []
    , enc []
    ]
@

-}</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlot"><span class="hs-identifier hs-type">stripPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-523"></span><span id="stripPlot"><span class="annot"><span class="annottext">stripPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlot"><span class="hs-identifier hs-var hs-var">stripPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/DougBurke/hvega/master/hvega/data/gaia-aa-616-a10-table1a.no-header.tsv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Format
</span><a href="Graphics.Vega.VegaLite.Input.html#TSV"><span class="hs-identifier hs-var">TSV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="hs-comment">-- $background-note</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- The default background color for the visualization, at least in the</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- Vega-Embed PNG and SVG output, is white (in Vega-Lite version 4;</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- prior to this it was transparent). In many cases this is</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- perfectly fine, but an explicit color can be specified using the</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- 'BackgroundStyle' configuration option, as shown here, or with the</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- 'background' function, which is used in the choropleth examples</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- below ('choroplethLookupToGeo').</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="hs-comment">{-|

The 'configure' function allows a large number of configuration
options to be configured, each one introduced by the
'configuration' function. Here I set the color to be a light gray
(actually a very-transparent black; the 'Color' type describes the
various supported color specifications, but it is generally safe to assume
that if you can use it in HTML then you can use it here).

&lt;&lt;images/vl/stripplotwithbackground.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEDGD2B2AzAlgc0gLjMSAjAhtANaoBOsArvACaZSmoEAUADADRjuccsB0AjAEpIAXzbgoAW3ykidSABdkxSOIiRq+BfjqgI6iqQA28gBYKFABwDOGAPR3S+AO69UyBaYq4K1gKakcPAKfsG8cJJ2ACKUqABChkR+dqYAbn6o+HbS1iGkKemZdpradpnI+AC0+FUAbPy11fwsldq4Rn78+LzwsJWmfvjUAbwK1qmqEuqIsKTSCrqKAJ6WfvJjEyISYhKQACTW0APSZhY29naF3e6e3rzIsHaHx1lXlUYeyakAzLwAVtYEJN1KE4NRkPB0FgcAAPRYoPxGWhYSCWIxwjjLVbyACOFHwwQ8WmQ6VEWxEQA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;plx\&quot;, PmType Quantitative ]

    conf = 'configure'
             . 'configuration' ('BackgroundStyle' &quot;rgba(0, 0, 0, 0.1)&quot;)

in toVegaLite
    [ dataFromUrl \&quot;https:\/\/raw.githubusercontent.com\/DougBurke\/hvega\/master\/hvega\/data\/gaia-aa-616-a10-table1a.no-header.tsv\&quot; [TSV]
    , mark Tick []
    , enc []
    , conf []
    ]
@

If you want a transparent background (as was the default with Vega-Lite 3
and earlier), you would use

@
'configuration' ('BackgroundStyle' &quot;rgba(0, 0, 0, 0)&quot;)
@

-}</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithBackground"><span class="hs-identifier hs-type">stripPlotWithBackground</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-576"></span><span id="stripPlotWithBackground"><span class="annot"><span class="annottext">stripPlotWithBackground :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithBackground"><span class="hs-identifier hs-var hs-var">stripPlotWithBackground</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/DougBurke/hvega/master/hvega/data/gaia-aa-616-a10-table1a.no-header.tsv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Format
</span><a href="Graphics.Vega.VegaLite.Input.html#TSV"><span class="hs-identifier hs-var">TSV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#BackgroundStyle"><span class="hs-identifier hs-var">BackgroundStyle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rgba(0, 0, 0, 0.1)&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">{-|
There is nothing that forces us to use the x axis, so let's
try a vertical strip plot. To do so requires changing only
__one__ character in the specifiction, that is the first argument to
'position' is now 'Y' rather than 'X':

&lt;&lt;images/vl/stripploty.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAXAlgY2QGnCgBNZ1ZUxQIJIBXeAGwsgAt10AHAZxQHpf4sAO4A6AOaZ0LWgCNaXAKbxsAewB26BRpGrovACIraYgEL1EC3iwBuCsbF5wum+Fdv3eJMr3uZYAWlgAgDYARmDA0IAGfzIZBgVQ2BE1FX8WBVgiJRF0LmtIAmooADMVeDh0CmBIdABPDgVmPIKAX0JWoqgAEi5sDLhmNk4efndkiSlZEUwVXj6Bh3H-BklLawBmEQArLnVCwkgtVSJMNTFqyDrLkswFBiJmDgYAD0KMBqa0SABHWlgNJJSJhbJBWp1Dqo1LcLmhgO1WkA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position 'Y' [ PName &quot;plx&quot;, PmType Quantitative ]

in toVegaLite
    [ dataFromUrl \&quot;https:\/\/raw.githubusercontent.com\/DougBurke\/hvega\/master\/hvega\/data\/gaia-aa-616-a10-table1a.no-header.tsv\&quot; [TSV]
    , mark Tick []
    , enc []
    ]
@
-}</span><span>
</span><span id="line-605"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotY"><span class="hs-identifier hs-type">stripPlotY</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-606"></span><span id="stripPlotY"><span class="annot"><span class="annottext">stripPlotY :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotY"><span class="hs-identifier hs-var hs-var">stripPlotY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-607"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/DougBurke/hvega/master/hvega/data/gaia-aa-616-a10-table1a.no-header.tsv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Format
</span><a href="Graphics.Vega.VegaLite.Input.html#TSV"><span class="hs-identifier hs-var">TSV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="hs-comment">{-|
Since we are going to be using the same data source, let's define it here:

@
gaiaData =
  let addFormat n = (n, 'FoNumber')
      cols = [ \&quot;RA_ICRS\&quot;, \&quot;DE_ICRS\&quot;, \&quot;Gmag\&quot;, \&quot;plx\&quot;, \&quot;e_plx\&quot; ]
      opts = [ 'Parse' (map addFormat cols) ]

  in dataFromUrl &quot;https:\/\/raw.githubusercontent.com\/DougBurke\/hvega\/master\/hvega\/data\/gaia-aa-616-a10-table1a.no-header.tsv&quot; opts
@

The list argument to 'dataFromUrl' allows for some customisation of
the input data.  Previously I used @['TSV']@ to specify the data is in
tab-separated format, but it isn't actually needed here (since the
file name ends in \&quot;.tsv\&quot;). However, I have now explicitly defined how
to parse the numeric columns using 'Parse': this is because the columns
are read in as strings for this file by default, which actually doesn't
cause any problems in most cases, but did cause me significant problems
at one point during the development of the tutorial! There is limited
to no feedback from the visualizer for cases like this (perhaps I should
have used the Javascript console), and I only realised the problem thanks
to the @Data Viewer@ tab in the
&lt;https://vega.github.io/editor/#/ Vega Editor&gt;
(after a
&lt;https://twitter.com/pkgw/status/1167127390880968707 suggestion from a colleague&gt;).

Data can also be defined algorithmically - using 'dataSequence' and
'dataSequenceAs' - or inline - with 'dataFromColumns' or
'dataFromRows' - or directly from JSON (as a 'Data.Aeson.Value') using
'dataFromJson'.

Examples showing 'dataFromColumns' are the 'pieChart' and'skyPlotWithGraticules' plots,
but let's not peak ahead!

-}</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-type">gaiaData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Input.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span>
</span><span id="line-651"></span><span id="gaiaData"><span class="annot"><span class="annottext">gaiaData :: PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var hs-var">gaiaData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118157"><span class="annot"><span class="annottext">addFormat :: a -&gt; (a, DataType)
</span><a href="#local-6989586621679118157"><span class="hs-identifier hs-var hs-var">addFormat</span></a></span></span><span> </span><span id="local-6989586621679118156"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118156"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118156"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataType
</span><a href="Graphics.Vega.VegaLite.Input.html#FoNumber"><span class="hs-identifier hs-var">FoNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>      </span><span id="local-6989586621679118154"><span class="annot"><span class="annottext">cols :: [Text]
</span><a href="#local-6989586621679118154"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;e_plx&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-654"></span><span>      </span><span id="local-6989586621679118153"><span class="annot"><span class="annottext">opts :: [Format]
</span><a href="#local-6989586621679118153"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[(Text, DataType)] -&gt; Format
</span><a href="Graphics.Vega.VegaLite.Input.html#Parse"><span class="hs-identifier hs-var">Parse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; (Text, DataType)) -&gt; [Text] -&gt; [(Text, DataType)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text, DataType)
forall a. a -&gt; (a, DataType)
</span><a href="#local-6989586621679118157"><span class="hs-identifier hs-var">addFormat</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679118154"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/DougBurke/hvega/master/hvega/data/gaia-aa-616-a10-table1a.no-header.tsv&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Format]
</span><a href="#local-6989586621679118153"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="hs-comment">{-|

One question would be how the parallaxes vary by cluster: as parallax is measuring distance,
then are the clusters similar distances away from us, or is there a range of values? A
first look is to use another \&quot;channel\&quot; to represent (i.e. encode) the cluster:

&lt;&lt;images/vl/stripplotwithcolor.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAXAlgY2QGnCgBNZ1ZUxQIJIBXeAGwsgAt10AHAZxQHpf4sAO4A6AOaZ0LWgCNaXAKbxsAewB26BRpGrovACIraYgEL1EC3iwBuCsbF5wum+Fdv3eJMr3uZYAWlgAgDYARmDA0IAGfzIZBgVQ2BE1FX8WBVgiJRF0LmtIAmooADMVeDh0CipiqA4ERWrCWqgAcTgxZjVaaBklQubayAAlAEEAfQBJAGFhgGUunr74AZaaDgYAD0Xe-qK1yH0AUSnZhbRIbt2V-ZbIBXGN7Yur5chBiABfQe+v-cgACRcbAZODMNicHj8dzJCRSWQiTAqXjA0EOGH+BiSSzWAAsIgAVlx1KsoFpVERMGpOmgajRVAxytVICVMAoGERmNMGPIXIUMABPDgKLoqaBU2BMT63KDPSgfUpsjnMJ6k4qQdBCkUXACOtFgGkkpEwtjV1EgsE2mC4zKw6ASzAACghJQxLWAABROACUkF+1H90sIkFUalZNMo30+QA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;plx\&quot;, PmType Quantitative, 'PAxis' [ 'AxTitle' \&quot;Parallax (mas)\&quot; ] ]
            . 'color' [ 'MName' \&quot;Cluster\&quot;, MmType 'Nominal' ]

in toVegaLite
    [ gaiaData
    , mark Tick []
    , enc []
    ]
@

Now each tick mark is colored by the cluster, and a legend is automatically
added to indicate this mapping. Fortunately the number of clusters in the
sample is small enough to make this readable! The 'color' function has
added this mapping, just by giving the column to use (with 'MName') and
its type ('MmType'). The constructors generally begin with @P@ for
position and @M@ for mark, and as we'll see there are other property
types such as facet and text.

Vega-Lite supports several data types, represented
by the 'Measurement' type. We have already seen 'Quantitative', which
is used for numeric data, and here we use 'Nominal' for the clusters,
since they have no obvious ordering.

The labelling for the X axis has been tweaked using 'PAxis', in this
case the default value for the label (the column name) has been
over-ridden by an explicit value.

-}</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor"><span class="hs-identifier hs-type">stripPlotWithColor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-701"></span><span id="stripPlotWithColor"><span class="annot"><span class="annottext">stripPlotWithColor :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor"><span class="hs-identifier hs-var hs-var">stripPlotWithColor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118151"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118151"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-703"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-704"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-707"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-708"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-709"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118151"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-710"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-comment">{-|

As of Vega-Lite version 4.14 we can now drop the type information when
it can be inferred. I am a little hazy of the rules, so I am going to
include the information (as it also means I don't have to change
the existing code!). However, as an example, we don't need to
add the @MmType Nominal@ setting to the 'color' channel, since the
following creates the same visualization as 'stripPlotWithColor':

&lt;https://vega.github.io/editor/#/url/vega-lite/N4IgtghgTg1iBcIAuBLAxnANCAJhJECoArlADYIgAWSSADgM7wD0zUEA7gHQDmKSVYgCNiDAKZQ0AewB2SMXK7SwzACJTiPAEKkYY5lQBuYnhGaQG8qAeOnmeAs1MoIAWghuAbAEZP77wAMrgRCZGLeEFwyUq5UYhA4ElxIDIYg2ABmUlCQSEQgdNDi+QDikDyUMsRgQhLpIABKAIIA+gCSAMINAMqV1bVQ9XRkAB59NXXYqgCi7V29iFUTg9hiLcNji-11AL572AAkDGhxkJQ09EystpF8AsJcKFLMx6dmN65k-PqGACxcACsGLJ6gppDgUDIKvBQNIyNl8hkUGIyDhKB0yKIrCAdthNqAkSi0YgNvVUEgwpQAArQCBkMgQEYAAgAFBYAJRkgCedDElAAjsQIHJ+PgUMYcXsgA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;plx\&quot;, PmType Quantitative, 'PTitle' \&quot;Parallax (mas)\&quot; ]
            . 'color' [ 'MName' \&quot;Cluster\&quot; ]

in toVegaLite
    [ gaiaData
    , mark Tick []
    , enc []
    ]
@

Note that as well as removing @MmType Nominal@ from the 'color' encoding, I have
switched to the 'PTitle' option (which is the same as @PAxis [AxTitle ...]@.

-}</span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor2"><span class="hs-identifier hs-type">stripPlotWithColor2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-741"></span><span id="stripPlotWithColor2"><span class="annot"><span class="annottext">stripPlotWithColor2 :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColor2"><span class="hs-identifier hs-var hs-var">stripPlotWithColor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118143"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118143"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PTitle"><span class="hs-identifier hs-var">PTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-747"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-748"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-749"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118143"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-750"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-comment">-- $stripplot-mmtype</span><span>
</span><span id="line-754"></span><span class="hs-comment">-- It is instructive to see what happens if we change the mark type for</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- the color encoding from 'Nominal' to 'Ordinal'.</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-comment">{-|

&lt;&lt;images/vl/stripplotwithcolorordinal.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAXAlgY2QGnCgBNZ1ZUxQIJIBXeAGwsgAt10AHAZxQHpf4sAO4A6AOaZ0LWgCNaXAKbxsAewB26BRpGrovACIraYgEL1EC3iwBuCsbF5wum+Fdv3eJMr3uZYAWlgAgDYARmDA0IAGfzIZBgVQ2BE1FX8WBVgiJRF0LmtIAmooADMVeDh0CipiqA4ERWrCWqgAcTgxZjVaaBklQubayAAlAEEAfQBJAGFhgGUunr74AZaaDgYAD0Xe-qK1yH0AUSnZhbRIbt2V-ZbIBXGN7Yur5chBiABfQe+v-cgACRcbAZODMNicHj8dzJCRSWQiTAqXjA0EOGH+BiSSzWAAsIgAVlx1KsoFpVERMGpOmgajRVAxytVICVMAoGERmNMGPIXIUMABPDgKZjlSlqWBMT63KDPSgfUpsjnMJ6k4qQdBCkUXACOtFgGkkpEwtjV1EgsE2mC4zKw6ASzAACghJQxLWAABROACUkF+1H90sIkFUalZNMo30+QA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;plx\&quot;, PmType Quantitative, PAxis [ AxTitle \&quot;Parallax (mas)\&quot; ] ]
            . color [ MName \&quot;Cluster\&quot;, MmType 'Ordinal' ]

in toVegaLite
    [ gaiaData
    , mark Tick []
    , enc []
    ]
@

As can be seen, the choice of color scale has changed to one more
appropriate for an ordered set of values.
-}</span><span>
</span><span id="line-778"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColorOrdinal"><span class="hs-identifier hs-type">stripPlotWithColorOrdinal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-779"></span><span id="stripPlotWithColorOrdinal"><span class="annot"><span class="annottext">stripPlotWithColorOrdinal :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#stripPlotWithColorOrdinal"><span class="hs-identifier hs-var hs-var">stripPlotWithColorOrdinal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118141"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118141"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-781"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-782"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Ordinal"><span class="hs-identifier hs-var">Ordinal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-785"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-786"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-787"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118141"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-788"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span class="hs-comment">-- $pie-chart</span><span>
</span><span id="line-792"></span><span class="hs-comment">-- Before adding a second axis, let's temporarily look at another</span><span>
</span><span id="line-793"></span><span class="hs-comment">-- \&quot;one dimensiona&quot; chart, namel the humble pie chart.</span><span>
</span><span id="line-794"></span><span class="hs-comment">-- The 'Arc' mark type allows you to create pie charts, as well as more</span><span>
</span><span id="line-795"></span><span class="hs-comment">-- complex visualizations which we won't discuss further in this</span><span>
</span><span id="line-796"></span><span class="hs-comment">-- tutorial.</span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span class="hs-comment">{-|

In this example we embed the data for the pie chart - namely the number
of stars per cluster - in the vsualization itself (using
'dataFromColumns' to create column data labelled \&quot;cluster\&quot; and
\&quot;count\&quot;). The 'position' encoding is set to 'Theta', which is
given the star counts, and the 'color' is set to the
Cluster name.

&lt;&lt;images/vl/piechart.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4IgtghgTg1iBcJoGMQBoQBMIBcINADcIAbAVwFMBnBAbVGXKpwqgSRIAcALCAAgAKrdCGQB7MgDscCAOwAWAAwBfNAyYs2iAEIkIk8XwCMI8VJnx5ADgCcq9WWbDEAYTGQ+24RjPSERgFYAZntRDWcQAAkATwhMalMJP3gAwNDGR012AEkXPgAmIJsTHySLIPyA9PCtEFyCgDZFfMTzBHkbfOrMiIA5AHE8-PlU1uSlFTUwntqBEgoASziE0rb4IwqG7qdZqAhqCk4KMYsbIKtlAF1VEAASKmRuCkh2bhwcTip4AHpvwgoAOYQAB0AIWOG4ZAARsCFmJvg8npA-oCIABaEjgih-eTAgBWVDEkhEFAMYkwC0kAIIIAhFDwNIAZgsKCRMOxfDIMDhokd2ABHMj6HDg3ALf4gG7iEhiLSgZms9mIDI7EQ8vmISTuSmkSXKZRAA Open this visualization in the Vega Editor&gt;

@
let manualData = 'dataFromColumns' []
                 . 'dataColumn' &quot;cluster&quot; ('Strings' clusters)
                 . dataColumn &quot;count&quot; ('Numbers' counts)
                 $ []

    clusters = [ \&quot;alpha Per\&quot;, \&quot;Blanco 1\&quot;, \&quot;Coma Ber\&quot;, \&quot;Hyades\&quot;, \&quot;IC 2391\&quot;
               , \&quot;IC 2602\&quot;, \&quot;NGC 2451\&quot;, \&quot;Pleiades\&quot;, \&quot;Praesepe\&quot;]
    counts = [ 740, 489, 153, 515, 325, 492, 400, 1326, 938]

    enc = encoding
          . position 'Theta' [PName &quot;count&quot;, PmType Quantitative]
          . color [MName &quot;cluster&quot;, MmType Nominal]

in toVegaLite
   [ manualData
   , mark 'Arc' []
   , enc []
   ]
@

-}</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChart"><span class="hs-identifier hs-type">pieChart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-836"></span><span id="pieChart"><span class="annot"><span class="annottext">pieChart :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChart"><span class="hs-identifier hs-var hs-var">pieChart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118139"><span class="annot"><span class="annottext">manualData :: PropertySpec
</span><a href="#local-6989586621679118139"><span class="hs-identifier hs-var hs-var">manualData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromColumns"><span class="hs-identifier hs-var">dataFromColumns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-838"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec)
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cluster&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Strings"><span class="hs-identifier hs-var">Strings</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679118135"><span class="hs-identifier hs-var">clusters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679118133"><span class="hs-identifier hs-var">counts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec) -&gt; [DataColumn] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>      </span><span id="local-6989586621679118135"><span class="annot"><span class="annottext">clusters :: [Text]
</span><a href="#local-6989586621679118135"><span class="hs-identifier hs-var hs-var">clusters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alpha Per&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Blanco 1&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Coma Ber&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Hyades&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IC 2391&quot;</span></span><span>
</span><span id="line-843"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IC 2602&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;NGC 2451&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Pleiades&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Praesepe&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-844"></span><span>      </span><span id="local-6989586621679118133"><span class="annot"><span class="annottext">counts :: [Double]
</span><a href="#local-6989586621679118133"><span class="hs-identifier hs-var hs-var">counts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">740</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">489</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">153</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">515</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">325</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">492</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1326</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">938</span></span><span class="hs-special">]</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>      </span><span id="local-6989586621679118132"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118132"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-847"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Theta"><span class="hs-identifier hs-var">Theta</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-851"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679118139"><span class="hs-identifier hs-var">manualData</span></a></span><span>
</span><span id="line-852"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Arc"><span class="hs-identifier hs-var">Arc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-853"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118132"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-854"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="hs-comment">{-|

There are three main changes to 'pieChart':

 - 'MInnerRadius' is used to impose a minimum radius on the pie slices
   (so leaving a hole in the center);

 - the 'ViewStyle' configuration is used to turn off the plot edge;

 - and the count value is calculated automatically by the 'PAggregate'
   method (summing over the \&quot;Cluster\&quot; column), rather than having a
   hand-generated table of values encoded in the visualization.

&lt;&lt;images/vl/piechartwithcounting.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4Igxg9gdgZglgcxALlANzgUwO4tAZwBcAnCAa0xSgFcAbWgXwYBoQBbAQ2LLxEIE8ADpWQguYEKzhQomYgCUOAEzjV8KAEwAGFiCUdCHXtWK0UIABaFCg-MgD094h2wA6BHEIXqAIzVzIKEJMINdINnsAEQhqBAAhEwp7CzRMBA57TiI5ZNT0+31De3S4DgBaDnKANgBGKoqarTLDH1pMGo5XKAgyi0xlOVdCfDRJEBgIYk5CXkEufBFQAHFOJFEaNh85MfkAQQB9AEkAYXkAZXMNreIxwVoAD0vqTe3WSIBRI9OL9efrscw+zuj1+LxuTF0ABJ8GA+pxzFYbHZHHlOh4vL5XHAIPYYXCMqiyrRPJh7GgACyuABW+GgAKgkBUUDWoC8mEMvA4CAQxDSBhE4BiQTGAmE5gAjtQOEFPAY4KkQLpILRJrx4JhaEpzMdaGpgjdWKKBd02NIOGYIUA Open this visualization in the Vega Editor&gt; 

@
let enc = encoding
          . position Theta ['PAggregate' 'Count', PmType Quantitative]
          . color [MName &quot;Cluster&quot;, MmType Nominal]

in toVegaLite
   [ gaiaData
   , mark Arc ['MInnerRadius' 20]
   , enc []
   , configure (configuration ('ViewStyle' ['ViewNoStroke']) [])
   ]
@

-}</span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChartWithCounting"><span class="hs-identifier hs-type">pieChartWithCounting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-891"></span><span id="pieChartWithCounting"><span class="annot"><span class="annottext">pieChartWithCounting :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#pieChartWithCounting"><span class="hs-identifier hs-var hs-var">pieChartWithCounting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118129"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118129"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-893"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Theta"><span class="hs-identifier hs-var">Theta</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-894"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-897"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-898"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Arc"><span class="hs-identifier hs-var">Arc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MInnerRadius"><span class="hs-identifier hs-var">MInnerRadius</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118129"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-900"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ViewConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStyle"><span class="hs-identifier hs-var">ViewStyle</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ViewConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewNoStroke"><span class="hs-identifier hs-var">ViewNoStroke</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span class="hs-comment">-- $add-axis</span><span>
</span><span id="line-905"></span><span class="hs-comment">-- While the strip plot shows the range of parallaxes, it is hard to</span><span>
</span><span id="line-906"></span><span class="hs-comment">-- make out the distribution of values, since the ticks overlap. Even</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- changing the opacity of the ticks - by adding an encoding channel</span><span>
</span><span id="line-908"></span><span class="hs-comment">-- like @'opacity' [ 'MNumber' 0.6 ]@, or by setting the 'MOpacity'</span><span>
</span><span id="line-909"></span><span class="hs-comment">-- property of the 'mark' - only helps so much. Adding a second</span><span>
</span><span id="line-910"></span><span class="hs-comment">-- axis is easy to do, so let's see how the parallax distribution</span><span>
</span><span id="line-911"></span><span class="hs-comment">-- varies with cluster membership.</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">{-|

The 'stripPlotWithColor' visualization can be changed to show two
variables just by adding a second 'position' declaration, which
shows that the 7 milli-arcsecond range is rather crowded:

&lt;&lt;images/vl/parallaxbreakdown.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAXAlgY2QGnCgBNZ1ZUxQIJIBXeAGwsgAt10AHAZxQHpf4sAO4A6AOaZ0LWgCNaXAKbxsAewB26BRpGrovACIraYgEL1EC3iwBuCsbF5wum+Fdv3eJMr3uZYAWlgAgDYARmDA0IAGfzIZBgVQ2BE1FX8WBVgiJRF0LmtIAmooADMVeDh0CipiqA4ERWrCWqgAcTgxZjVaaBklQubayAAlAEEAfQBJAGFhgGUunr74AZaaDgYAD0Xe-qK1yH0AUSnZhbRIbt2V-ZbIBXGN7Yur5chBiABfQe+v-cgACRcbAZODMNicHj8dzJCRSWQiTAqXjA0EOGH+BiSSzWAAsIgAVlx1KsoFpVERMGpOmgajRVAxytVICVMAoGERmNMGPIXIUMABPDgKLoqaBU2BMT63KDPSgfUpsjnMJ6k4qQdBCkUXACOtFgGkkpEwtjV1EgsE2mC4zKw6ASzAACghJQxLWAABROACUkF+1Glg0gAuZrPZnIu3N5e0FwtF4rUkr9hED9PUrJplG+nyAA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;plx\&quot;, PmType Quantitative, PAxis [ AxTitle \&quot;Parallax (mas)\&quot; ] ]
            . position Y [ PName \&quot;Cluster\&quot;, PmType Nominal ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

in toVegaLite
    [ gaiaData
    , mark Tick []
    , enc []
    ]
@

I have left the color-encoding in, as it makes it easier to compare to
'stripPlotWithColor', even though it replicates the information provided
by the position of the mark on the Y axis. The 'yHistogram' example
below shows how the legend can be removed from a visualization.

-}</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxBreakdown"><span class="hs-identifier hs-type">parallaxBreakdown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-944"></span><span id="parallaxBreakdown"><span class="annot"><span class="annottext">parallaxBreakdown :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxBreakdown"><span class="hs-identifier hs-var hs-var">parallaxBreakdown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118123"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118123"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-946"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-947"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-948"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-951"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-952"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-953"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118123"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-954"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span class="hs-comment">-- $histogram</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- We can also \&quot;create\&quot; data to be plotted, by aggregating data. In this</span><span>
</span><span id="line-959"></span><span class="hs-comment">-- case we can create a histogram showing the number of stars with the</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- same parallax value (well, a range of parallaxes).</span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="hs-comment">{-|

Since sensible (hopefully) defaults are provided for unspecified settings, it
is relatively easy to write generic representations of a particular
visualization. The following function expands upon the previous
specifications by:

 * taking a field name, rather than hard coding it;

 * the use of @'PBin' []@ to ask for the x-axis values to be binned;

 * the addition of a second axis ('Y') which is used for the
   aggregated value ('Count', which means that no column has
   to be specified with @PName@);

 * and the change from 'Tick' to 'Bar' for the 'mark'.

Note that we did not have to specify how we wanted the histogram
calculation to proceed - e.g. the number of bins, the bin widths,
or edges - although we could have added this, by using a non-empty
list of 'BinProperty' values with 'PBin', if the defaults are not
sufficient.

@
simpleHistogram :: T.Text -&gt; VegaLite
simpleHistogram field =
  let enc = encoding
              . position X [ PName field, PmType Quantitative, 'PBin' [] ]
              . position Y [ PAggregate Count, PmType Quantitative ]

  in toVegaLite
       [ gaiaData
       , mark 'Bar' []
       , enc []
       ]
@

-}</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#simpleHistogram"><span class="hs-identifier hs-type">simpleHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1002"></span><span id="simpleHistogram"><span class="annot"><span class="annottext">simpleHistogram :: Text -&gt; VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#simpleHistogram"><span class="hs-identifier hs-var hs-var">simpleHistogram</span></a></span></span><span> </span><span id="local-6989586621679118122"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118122"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118121"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118121"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1004"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118122"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1005"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1008"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1009"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1010"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118121"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1011"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="hs-comment">{-|

With 'simpleHistogram' it becomes easy to get a histogram of the parallax
values:

&lt;&lt;images/vl/parallaxhistogram.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAjBkA04oBNYAXWVMUCCSAV3gBszIALIogBwGcUB6b+WAO4A6AOYBLIk2rpqHAKbwAxgHsAdkTnqhK6NwAiy6iIBCtRHO5MAbnJGxucDhviWbd7oRLc7Y2AFpYfwA2AEYggJCABj8SdDo5ENghVWU-JjlYfAUhIg4rHDwqADNleDgiMgpKKjYEeUrC6qgAcTgRRlVqaHQFAqbKSAAlAEEAfQBJAGFBgGUOrp74Pv6oNjoAD3nu3twVqD0AUQnpubRITu2l3ZXIOVG1zbOLxchGiABfRs+P68gAEg4inScEYLHYXF4biS4kk0iEYmU3EBwPsUL8dAkFisABYhAArDhqZa3VQqfBiVTtNBVKiPciQIpiOR0fCMB44DAUshEeDUOTYKBEACebDkjAAjtRYOoJMQxDZIO9rlQhZVILARCJ4LZiGKzipqOoOZBhaKJVKZSQiPKxd8wEq8JAVKpGVTyJ93kA Open this visualization in the Vega Editor&gt;

@parallaxHistogram = 'simpleHistogram' \&quot;plx\&quot;@

We can see that although parallaxes around 20 to 25 milli-arcseconds
dominated the earlier visualizations, such as 'stripPlotWithColor',
__most__ of the stars have a much-smalled parallax, with values
in the range 5 to 10.

-}</span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span class="hs-comment">-- TODO XXX explain parallax</span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxHistogram"><span class="hs-identifier hs-type">parallaxHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1034"></span><span id="parallaxHistogram"><span class="annot"><span class="annottext">parallaxHistogram :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxHistogram"><span class="hs-identifier hs-var hs-var">parallaxHistogram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#simpleHistogram"><span class="hs-identifier hs-var">simpleHistogram</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span class="hs-comment">{-|

A different column (or field) of the input data can be viewed,
just by changing the name in the specification:

&lt;&lt;images/vl/gmaghistogram.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAjBkA04oBNYAXWVMUCCSAV3gBszIALIogBwGcUB6b+WAO4A6AOYBLIk2rpqHAKbwAxgHsAdkTnqhK6NwAiy6iIBCtRHO5MAbnJGxucDhviWbd7oRLc7Y2AFpYfwA2AEYggJCABj8SdDo5ENghVWU-JjlYfAUhIg4rHDwqADNleDgiMgpKKjYEeUrC6qgAcTgRRlVqaHQFAqbKSAAlAEEAfQBJAGFBgGUOrp74Pv6oNjoAD3nu3twVqD0AUQnpubRITu2l3ZXIOVG1zbOLxchGiABfRs+P68gAEg4inScEYLHYXF4biS4kk0iEYmU3EBwPsUL8dAkFisABYhAArDhqZa3VQqfBiVTtNBVKiPciQIpiOR0fCMVqwdrYDAUshEeDUORcyBEACebDkjAAjtRYOoJMQxDZIO9rlQRZVIByRPBbMQJWcVNR1DgoKLxVKZXKSERFRLvmAVXhICpVIyqeRPu8gA Open this visualization in the Vega Editor&gt;

@gmagHistogram = simpleHistogram \&quot;Gmag\&quot;@

Here we can see that the number of stars with a given magnitude
rises up until a value of around 18, and then drops off.

-}</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span class="hs-comment">-- TODO XXX explain magnitudes</span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogram"><span class="hs-identifier hs-type">gmagHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1055"></span><span id="gmagHistogram"><span class="annot"><span class="annottext">gmagHistogram :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogram"><span class="hs-identifier hs-var hs-var">gmagHistogram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#simpleHistogram"><span class="hs-identifier hs-var">simpleHistogram</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span class="hs-comment">-- $ylog-histogram</span><span>
</span><span id="line-1060"></span><span class="hs-comment">-- In the case of 'parallaxHistogram', the data is __dominated__ by</span><span>
</span><span id="line-1061"></span><span class="hs-comment">-- stars with small parallaxes. Changing the scale of the</span><span>
</span><span id="line-1062"></span><span class="hs-comment">-- Y axis to use a logarithmic, rather than linear, scale /might/</span><span>
</span><span id="line-1063"></span><span class="hs-comment">-- provide more information:</span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="hs-comment">{-|

&lt;&lt;images/vl/yloghistogram.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFALYCGATgNYZjCQDOK5A9pbDZIuaQJ6T5QAZvAA2Ijs24A7ROwGQUPAA7tMkAEYVIAX0IRIAE1IpSNUBH0BXcuLWoUS+ugD0z7gHcAdIngpol9Ut6WHIAY2YpFFhIz3DiZwARZktEACFrNmdoADdYRFJnMkYQrNz85yMTZ3z4UgBaUnqANgBGJoaWnDqTdRFYFtJPKWY6uFIDEM8Uemz+In1BSTI0THMLfSUKYLN59agAcTJEDilLYnUQub2LSAAlAEEAfQBJAGFbgGUTs4vyK+uoEoRAAPb7nS56AGQBIAURe7y+alO4L+kOukFgjyBoKRP0uuwg2l2RMJkMgABJ6KE4GQOPZHC5nGVBj4-AFPPBmM4qTSCsy6iJfLAmQAWTwAK3oEX+Cl8fQ4+1ItTAAAUKKQxKRgbB6DLouEDPAZDt1pAcbQCUJ4LARAYONj-qb1EaaExLLA0TdFCoOABHSykSK+YzwXKOm5a+C61aylDytRq7ia4FgAAURQAlDpiZ7IHxVpaGKENapaAplKXICJmMddIXSIguHljJXwpZIuH9N7K-7Ayhg-2w8SiHX9OEpMJjqsidogA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName &quot;plx&quot;, PmType Quantitative, PBin [], PAxis [ AxTitle &quot;Parallax (mas)&quot; ] ]
            . position Y [ PAggregate Count, PmType Quantitative, 'PScale' [ 'SType' 'ScLog' ] ]

in toVegaLite
   [ gaiaData
   , mark Bar [ 'MFill' &quot;orange&quot;, 'MStroke' &quot;gray&quot; ]
   , enc []
   , 'height' 300
   , 'title' &quot;Gaia Parallaxes&quot; []
   ]
@

There are four new changes to the visualization created by 'simpleHistogram' (since 'PAxis'
has been used above):

 1. an explicit choice of scaling for the Y channel (using 'PScale');

 2. the fill ('MFill') and edge ('MStroke') colors of the histogram bars are different;

 3. the height of the overall visualization has been increased;

 4. and a title has been added.

If you view this in the Vega Editor you will see the following warning:

@
A log scale is used to encode bar's y. This can be misleading as the height of the bar can be arbitrary based on the scale domain. You may want to use point mark instead.
@

-}</span><span>
</span><span id="line-1103"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#ylogHistogram"><span class="hs-identifier hs-type">ylogHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1104"></span><span id="ylogHistogram"><span class="annot"><span class="annottext">ylogHistogram :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#ylogHistogram"><span class="hs-identifier hs-var hs-var">ylogHistogram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1105"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118118"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118118"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1106"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1107"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1110"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1111"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MFill"><span class="hs-identifier hs-var">MFill</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;orange&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gray&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1112"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118118"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1113"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-1114"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gaia Parallaxes&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1115"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span class="hs-comment">{-|

A color encoding can also be added. When used with the 'Tick' mark -
'stripPlotWithColor' - the result was that each tick mark was colored
by the \&quot;Cluster\&quot; field, but for the 'Bar' mark the result is that
the bars are stacked together. I have also taken the opportunity to
widen the plot ('width'); define the binning scheme used, with @'Step'
1@; and configure the location of the x axis tick marks, using
'AxValues'.

&lt;&lt;images/vl/gmaghistogramwithcolor.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFALYCGATgNYZQBGFkhEkAJqSqTaBMwK7kAbGjBQoADgGd0AemnlSAdwB0ieCmi9avCbHIBjAPYA7FLBNLDxaQBEDvRACF+lWNOgA3WIlLSyE0+Runt7SbBzS3vCkALSkMQBsAIzxsYk40Ry0ArCJpEpGBtFwpCy6SigS7oxEzABmBuRkaJjcPMxiFDpcNW1QAOJkiMJGvMS0utW9PJAASgCCAPoAkgDCMwDKw6Pj5JNTUGICAB5bYxNM+5DWAKLLa5uYkCNnuxdTkLALhyePzzuQPQgAF8eiDgRdIAp4Cx1DQACx4CEAEgkejgZGEqHEUlkwTyqnUmiU8AM0lR6J8eOiAjUrnccKUACsJMY9h8jIYWPAjEMWj1IIYBA0uJBavBYAIWMIVgJtAFGFAUABPMSwYYGYjc0hCIFvKA-MCtNqi8WS4QDUhDPXMWjckX+WBiGiJXWAxUqtWPACOvFIJjU7Hgnj2xtIR3gEhF7m1vFgkcwAG0CGAAKz4MBpdOJNNgABMOAAumCeK7jUqRZbEOQvOxPVBDLwTArIMrVcIfX6UAGu8Hi6X68YxbzDSCgUA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, binning, axis ]
            . position Y [ PAggregate Count, PmType Quantitative ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    binning = PBin [ 'Step' 1 ]
    axis = PAxis [ 'AxValues' (Numbers [ 0, 5 .. 20 ]) ]

in toVegaLite
   [ gaiaData
   , mark Bar []
   , enc []
   , height 300
   , 'width' 400
   ]
@

Note that @hvega@ will allow you to combine a 'color' encoding with a 'ScLog'
scale, even though a Vega-Lite viewer will not display the
resulting Vega-Lite specification, saying

@Cannot stack non-linear scale (log)@

-}</span><span>
</span><span id="line-1157"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogramWithColor"><span class="hs-identifier hs-type">gmagHistogramWithColor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1158"></span><span id="gmagHistogramWithColor"><span class="annot"><span class="annottext">gmagHistogramWithColor :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagHistogramWithColor"><span class="hs-identifier hs-var hs-var">gmagHistogramWithColor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118110"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118110"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1160"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118109"><span class="hs-identifier hs-var">binning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118108"><span class="hs-identifier hs-var">axis</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1161"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1162"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span>      </span><span id="local-6989586621679118109"><span class="annot"><span class="annottext">binning :: PositionChannel
</span><a href="#local-6989586621679118109"><span class="hs-identifier hs-var hs-var">binning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1165"></span><span>      </span><span id="local-6989586621679118108"><span class="annot"><span class="annottext">axis :: PositionChannel
</span><a href="#local-6989586621679118108"><span class="hs-identifier hs-var hs-var">axis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DataValues -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxValues"><span class="hs-identifier hs-var">AxValues</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1168"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1169"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1170"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118110"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1171"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-1172"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1173"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span class="hs-comment">{-|

Notice how we never needed to state explicitly that we wished our bars
to be stacked. This was reasoned directly by Vega-Lite based on the
combination of bar marks and color channel encoding. If we were to
change just the mark function from 'Bar' to 'Line', Vega-Lite produces an
unstacked series of lines, which makes sense because unlike bars,
lines do not occlude one another to the same extent.

&lt;&lt;images/vl/gmaglinewithcolor.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFALYCGATgNYZQA28AdrJIRJACakqk2gRsBXcrRowUKAA4BndAHpZ5UgHcAdIngpoAgEYCpscgGMA9gxSwzKk8VkARYwMQAhIZVizoAN1iJSsslLm5B7evrKc3LK+8KQAtKRxAGwAjInxyTix3Nq0sMmkKgzGsXCk7AYqKFKeLERsAGbG5GRomHz8bBIU+rx1HVAA4mSIogwCxNoGtf38kABKAIIA+gCSAMJzAMqj45Pk0zNQErQAHjsTU6yHkLYAoqsb25iQYxf7VzOQsEvHZ8+ve0gfQgAF8+mDQVdIEp4OxNDQACx4KEAEikhjgZFEqEkMnkoQK6k0OhU8GMsnRmL8BNi9HMsk8CJUACspKYDl8GCZ2IwRm0+pATLQmrxIPV4LBaOxRGtaHogiwoCgAJ4SZj-YzERikEQgj5QP5gdodMUSqWiIakEb6tjaRiiwKwCQ0ZJ64FK1XqqAARwEpDMGi48G8BxNpBO8Ckos8OoEsCjmAA2gQwABWfBgDIZ5LpsAAJhwAF0Ifw3SblaKrYhyD4uF7BQ4zIrICq1aJff6UIGuyGS2WoCYGOK+UawSCgA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, binning, axis ]
            . position Y [ PAggregate Count, PmType Quantitative ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    binning = PBin [ Step 1 ]
    axis = PAxis [ AxValues (Numbers [ 0, 5 .. 20 ]) ]

in toVegaLite
   [ gaiaData
   , mark 'Line' []
   , enc []
   , height 300
   , width 400
   ]
@

-}</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagLineWithColor"><span class="hs-identifier hs-type">gmagLineWithColor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1209"></span><span id="gmagLineWithColor"><span class="annot"><span class="annottext">gmagLineWithColor :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gmagLineWithColor"><span class="hs-identifier hs-var hs-var">gmagLineWithColor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118104"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1211"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118103"><span class="hs-identifier hs-var">binning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118102"><span class="hs-identifier hs-var">axis</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1212"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1213"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>      </span><span id="local-6989586621679118103"><span class="annot"><span class="annottext">binning :: PositionChannel
</span><a href="#local-6989586621679118103"><span class="hs-identifier hs-var hs-var">binning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1216"></span><span>      </span><span id="local-6989586621679118102"><span class="annot"><span class="annottext">axis :: PositionChannel
</span><a href="#local-6989586621679118102"><span class="hs-identifier hs-var hs-var">axis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DataValues -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxValues"><span class="hs-identifier hs-var">AxValues</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1219"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1220"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1221"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118104"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1222"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-1223"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1224"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span class="hs-comment">-- $histogramChoice</span><span>
</span><span id="line-1228"></span><span class="hs-comment">-- The previous histogram visualizations have taken advantage of Vega-Lite's</span><span>
</span><span id="line-1229"></span><span class="hs-comment">-- ability to bin up ('Count') a field, but there are a number of aggregation</span><span>
</span><span id="line-1230"></span><span class="hs-comment">-- properties (as defined by the 'Operation' type). For example, there</span><span>
</span><span id="line-1231"></span><span class="hs-comment">-- are a number of measures of the \&quot;spread\&quot; of a population, such as</span><span>
</span><span id="line-1232"></span><span class="hs-comment">-- the sample standard deviation ('Stdev').</span><span>
</span><span id="line-1233"></span><span class="hs-comment">--</span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- You can also synthesize new data based on existing data, with the</span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- 'transform' operation. Unlike the 'encoding' function, the order</span><span>
</span><span id="line-1236"></span><span class="hs-comment">-- of the arguments to 'transform' do matter, as they control the</span><span>
</span><span id="line-1237"></span><span class="hs-comment">-- data flow (e.g. you can not filter a data set if you have not</span><span>
</span><span id="line-1238"></span><span class="hs-comment">-- created the field to be filtered).</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="hs-comment">{-|
The aim for this visualization is to show the spread in the @Gmag@ field
for each cluster, so we now swap the axis on which the aggregate is
being applied (so that the cluster names appear on the y axis),
and hide the legend that is applied (using @'MLegend' []@) since
we can read off the color mapping from the y axis.

&lt;&lt;images/vl/yhistogram.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuMxIHsAOsDGAlgC4CeqYADAHQBsANFKdgKbmQBGCkAvneFABNYRWOVAQIkAK7wANmwAWRItgDOKAPQb4sAO5UA5sQVT2U1c3h5MAOyLM7Va9A0ARTFIMAhGYmYaFADdmA1gNOFV7eADg0I0hEQ1QglgAWlg0mgBGGnSsilSRdllmLNgqG0xUhWZYAUsqIlVAyD4JKAAzTHg4IjF+dshceAt+9sGAcTgDNhspaHZLVoHxyAAlAEEAfQBJAGE1gGVZ+cX4ZfGJIdkADxOFpbbLqFcAUV2D47RIOYfzp8ukGYW2wt3uZ0gKwg3BWMOhT0gABJVHganBFMo1JoNLFykYiCZ2FQCJgNCi0WFcalZMR-IEACxUABWqlsFygDmsAgINhmaHEV2ssm6YkgHQIzFkAjYe1k5iirUYJBYs0w0B5sHkDEgJQMDmlaDmslkvBWkDu-LFEqlbCmsBm2vtBngIWErG+kXqLW1THdUAAjlJYHZiMICMEeACoGRLeLJQaoLL5Y8lSrvpV1TZNTx+KbJNYbOK+egYdwgA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, PAggregate 'Stdev' ]
            . position Y [ PName \&quot;Cluster\&quot;, PmType Nominal ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal, 'MLegend' [] ]

in toVegaLite
   [ gaiaData
   , mark Bar [ 'MOpacity' 0.6 ]
   , enc []
   ]
@

The bar opacity is reduced slightly with 'MOpacity 0.6' so that the
x-axis grid lines are visible. An alternative would be to change the
'AxZIndex' value for the 'X' encoding so that it is drawn on top of
the bars.

-}</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#yHistogram"><span class="hs-identifier hs-type">yHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1272"></span><span id="yHistogram"><span class="annot"><span class="annottext">yHistogram :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#yHistogram"><span class="hs-identifier hs-var hs-var">yHistogram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1273"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118100"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118100"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1274"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Stdev"><span class="hs-identifier hs-var">Stdev</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1275"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1276"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1279"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1280"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MOpacity"><span class="hs-identifier hs-var">MOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.6</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1281"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118100"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1282"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span class="hs-comment">{-|

Aggregation can happen in the position channel - as we've seen with
the 'PAggregate' option - or as a 'transform', where we create
new data to replace or augment the existing data. In the following
example I use the 'aggregate' transform to calculate the number of
rows in the original dataset per cluster with the
'Count' operation. This effectively replaces
the data, and creates a new one with the fields @\&quot;Cluster\&quot;@ and
@\&quot;count\&quot;@.

The other two major new items in this visualization are that the
X axis has been ordered to match the Y axis (using 'ByChannel' and
'PSort' in the 'position' encoding), and I have specified my own SVG
definition for the symbols with 'SymPath' and 'MShape'.

&lt;&lt;images/vl/starcount.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxhIBzWdAVwAcAjATz0MgGEAba5aAU1kgBdADRR45Sr3Lw+LAmXS0WkAMY1E0SKMjxkytdQ2QAvoOPERxSFniwA1i1AkoPKnd4B1AJYATaAAsWAEZhYghIZC8AL15ggAY40OcIuHR3ZXoOeBUHJJJIVC8ODmVGXmL0AHctMJd-eFpY-EgAWTBEgFogsAAZdoA6ACYAZmEOuKHh3rAQ8cnpieGADmEJwe6+iYA2QdX+gE4AFgW9w-3puZ29o4vFlbWNsC6xtam+uZGX+c2x7qia5LQRiNZS0dBeIzEYx5SA+GTwRy1SDUWAlZr+aDQWjIXAAelxCEq-XIXgC1Ho3H4ag0vA0-TUWFxABEaOQAEIo9y4-wANyk8FxNh4-G5fOkuLh0AF0i88A68DlWyCW3lQTiHSlmV4QXg-UQ6A6-l48B8-H60GQPIB+Qw2BkiOc4VotmQTVItWSAHEbORlIhqFh6PxrY6oAAlACCAH0AJJsMMAZT9AaDAjyocgtA4AA9k4Hg+nHZAmQBRWPxpPNf35tMe-K8KNZ3NVlPBuvmZwdsDQqwAEmQKiNNmUGKxOPxYt1JLJ9H6XnQuIHQ4Fk46HFJvFxPMO-QAVsh0IhrZBaWofBDffgnPlm6QCl5yj5lJxuHw0y5MJoryfEGeL6UTG0IEQSrdAsAheASh7ZJmCvOt70ffR1E0QtwmAt1IAAR2oJBoFJGQvD5EN8ngbMvD0b88OgDgMIAOVbWAwHQVAwB4F0TFqLtoKgalCkvUhzGMIA Open this visualization in the Vega Editor&gt;

@
let trans = 'transform'
            . 'aggregate' [ 'opAs' 'Count' \&quot;\&quot; \&quot;count\&quot; ]
                        [ \&quot;Cluster\&quot; ]

    enc = encoding
          . position X [ PName \&quot;Cluster\&quot;
                       , PmType Nominal
                       , 'PSort' [ 'ByChannel' 'ChY' ]
                       ]
          . position Y [ PName \&quot;count\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Number of stars\&quot; ]
                       ]

    star = 'SymPath' \&quot;M 0,-1 L 0.23,-0.23 L 1,-0.23 L 0.38,0.21 L 0.62,0.94 L 0,0.49 L -0.62,0.94 L -0.38,0.21 L -1,-0.23 L -0.23,-0.23 L 0,-1 z\&quot;

in toVegaLite [ gaiaData
              , trans []
              , enc []
              , mark 'Point' [ 'MShape' star
                           , MStroke \&quot;black\&quot;
                           , 'MStrokeWidth' 1
                           , MFill \&quot;yellow\&quot;
                           , 'MSize' 100
                           ]
              ]
@

Notes:

- the star design is based on a
&lt;https://upload.wikimedia.org/wikipedia/commons/a/a5/Star_with_eyes.svg Wikipedia design&gt;,
after some hacking and downsizing (such as losing the cute eyes);

- when using 'Count' with 'opAs', the first 'FieldName' argument is ignored,
so I set it to the empty string @\&quot;\&quot;@ (it's be great if the API were such
we didn't have to write dummy arguments, but at present @hvega@
doesn't provide this level of safety);

- although the order of operations of 'transform' is important, here
  I only have one (the 'aggregate' call);

- and the order of the arguments to 'toVegaLite' does not matter (so you
  can have the 'transform' appear before 'encoding' or after it).

-}</span><span>
</span><span id="line-1353"></span><span>
</span><span id="line-1354"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount"><span class="hs-identifier hs-type">starCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1355"></span><span id="starCount"><span class="annot"><span class="annottext">starCount :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount"><span class="hs-identifier hs-var hs-var">starCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1356"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118096"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118096"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1357"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1358"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span>      </span><span id="local-6989586621679118092"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118092"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1361"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-1362"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1363"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#ByChannel"><span class="hs-identifier hs-var">ByChannel</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChY"><span class="hs-identifier hs-var">ChY</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1364"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1365"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span>
</span><span id="line-1366"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1367"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of stars&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1368"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1369"></span><span>
</span><span id="line-1370"></span><span>      </span><span class="hs-comment">-- based on https://upload.wikimedia.org/wikipedia/commons/a/a5/Star_with_eyes.svg</span><span>
</span><span id="line-1371"></span><span>      </span><span id="local-6989586621679118088"><span class="annot"><span class="annottext">star :: Symbol
</span><a href="#local-6989586621679118088"><span class="hs-identifier hs-var hs-var">star</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Symbol
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SymPath"><span class="hs-identifier hs-var">SymPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;M 0,-1 L 0.23,-0.23 L 1,-0.23 L 0.38,0.21 L 0.62,0.94 L 0,0.49 L -0.62,0.94 L -0.38,0.21 L -1,-0.23 L -0.23,-0.23 L 0,-1 z&quot;</span></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1374"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118096"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1375"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118092"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1376"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MShape"><span class="hs-identifier hs-var">MShape</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679118088"><span class="hs-identifier hs-var">star</span></a></span><span>
</span><span id="line-1377"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-1378"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1379"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MFill"><span class="hs-identifier hs-var">MFill</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;yellow&quot;</span></span><span>
</span><span id="line-1380"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">100</span></span><span>
</span><span id="line-1381"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-1382"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1383"></span><span>
</span><span id="line-1384"></span><span>
</span><span id="line-1385"></span><span class="hs-comment">{-|

I've shown that the number of stars per cluster increases when
ordered by increasing count of the number of stars per cluster,
which is perhaps not the most informative visualization. How about
if I ask if there's a correlation between number of stars and
distance to the cluster (under the assumption that objects further
away can be harder to detect, so there /might/ be some form of
correlation)?

To do this, I tweak 'starCount' so that we also calculate the
parallax to each cluster in the 'transform' - in this case taking
the median value of the distribution thanks to the 'Median' operation - and
then using this new field to order the X axis with 'ByFieldOp'. Since
parallax is inversely correlated with distance we use the
'Descending' option to ensure the clusters are drawn from near to
far. We can see that there is no obvious relation with distance.

&lt;&lt;images/vl/starcount2.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTIBzWdAVwAcAjATz0MgGEAbW5aAU1iQAugBpi5SPErV+leALZFy5YJHT02kAMZ1E0SKKjxkWxLSyNBkAL7iVJNRq1Z+AEwCWSQ8dP5I9FwAHgD6rm4+kKge-FwR-oFBthIkwik2xGLEkFjwsADWbGQUfDT5-ADqHm7QABZsAIz2JR4AXvyNAAydzRCQpejlWoxc8NqFvVDRXFxazLFc6ADuhin9tfD0Hf4AsmA9ALQNYAAy+wB0AEwAzKIHnVfXp2BN94-PD9cAHKIPl8dnB4ANkuv3OAE4ACwfMGQ8HPN4gsFQhGfH5-AFgI53P5PM5vG4496Au7HVqrSTQZhbLT0dAefSQYh2bJuBTwIprWiwWb+WrQaD0ZC4AD0IoQS3OlA8dVojF4gl0+n4+nOuiwIoAInRKAAhbnlEW1ABucngItyfEERtN8hFbOg5vkXgO8HgByBDSBroanQOjpG-Aa8HOiHQB1q-HgbkE52gyGNFIoGGwCk5DgCeWQ21IKUkAHFcpQzBYrEJJpIAEoAQRCAEkOJWAMolyzWCsURKtstJjOagCi9cbLf85jb5bzFH4IS7o9L1knGXIS7ALL6ABJkNpI7ktPzBcKxbaQ9LZYxzh50CKtzvzceDlwZfwRcbIecAFbIdCIJOQFW6TxEGLfBij6JIQMnKIYjiLRuF4AQJwzL9YAMED1E0fxciSIwoNieIoESMJ3EiTAYyEfwYy3FVAOLNcVBgakc0gMMsAZeBZnSSZIFYCCM2iPDu3bSCqRpfwAEdaCQaAZQUDxTV7Ch4CCDw-FIGAZS4JiADl51gMB0FQMA+CzZJl2ZZodG-aJgNIDIbCAA Open this visualization in the Vega Editor&gt;

@
let trans = transform
            . aggregate [ opAs Count \&quot;\&quot; \&quot;count\&quot;
                        , opAs 'Median' \&quot;plx\&quot; \&quot;plx_med\&quot;
                        ]
                        [ \&quot;Cluster\&quot; ]

    enc = encoding
          . position X [ PName \&quot;Cluster\&quot;
                       , PSort [ 'ByFieldOp' \&quot;plx_med\&quot; 'Max'
                               , 'Descending'
                               ]
                       ]
          . position Y [ PName \&quot;count\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Number of stars\&quot; ]
                       ]

    star = SymPath \&quot;M 0,-1 L 0.23,-0.23 L 1,-0.23 L 0.38,0.21 L 0.62,0.94 L 0,0.49 L -0.62,0.94 L -0.38,0.21 L -1,-0.23 L -0.23,-0.23 L 0,-1 z\&quot;

in toVegaLite [ gaiaData
              , trans []
              , enc []
              , mark Point [ MShape star
                           , MStroke \&quot;black\&quot;
                           , MStrokeWidth 1
                           , MFill \&quot;yellow\&quot;
                           , MSize 100
                           ]
              ]
@

Notes:

- I find the \&quot;Data Viewer\&quot; section of the
&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTIBzWdAVwAcAjATz0MgGEAbW5aAU1iQAugBpi5SPErV+leALZFy5YJHT02kAMZ1E0SKKjxkWxLSyNBkAL7iVJNRq1Z+AEwCWSQ8dP5I9FwAHgD6rm4+kKge-FwR-oFBthIkwik2xGLEkFjwsADWbGQUfDT5-ADqHm7QABZsAIz2JR4AXvyNAAydzRCQpejlWoxc8NqFvVDRXFxazLFc6ADuhin9tfD0Hf4AsmA9ALQNYAAy+wB0AEwAzKIHnVfXp2BN94-PD9cAHKIPl8dnB4ANkuv3OAE4ACwfMGQ8HPN4gsFQhGfH5-AFgI53P5PM5vG4496Au7HVqrSTQZhbLT0dAefSQYh2bJuBTwIprWiwWb+WrQaD0ZC4AD0IoQS3OlA8dVojF4gl0+n4+nOuiwIoAInRKAAhbnlEW1ABucngItyfEERtN8hFbOg5vkXgO8HgByBDSBroanQOjpG-Aa8HOiHQB1q-HgbkE52gyGNFIoGGwCk5DgCeWQ21IKUkAHFcpQzBYrEJJpIAEoAQRCAEkOJWAMolyzWCsURKtstJjOagCi9cbLf85jb5bzFH4IS7o9L1knGXIS7ALL6ABJkNpI7ktPzBcKxbaQ9LZYxzh50CKtzvzceDlwZfwRcbIecAFbIdCIJOQFW6TxEGLfBij6JIQMnKIYjiLRuF4AQJwzL9YAMED1E0fxciSIwoNieIoESMJ3EiTAYyEfwYy3FVAOLNcVBgakc0gMMsAZeBZnSSZIFYCCM2iPDu3bSCqRpfwAEdaCQaAZQUDxTV7Ch4CCDw-FIGAZS4JiADl51gMB0FQMA+CzZJl2ZZodG-aJgNIDIbCAA Vega Editor&gt;
rather useful when creating new data columns or structures,
as you can actually see what has been created (I find Firefox works much
better than Chrome here);

- the use of 'ByFieldOp' here is a bit un-settling, as you need to
give it an aggregation-style operation to apply to the data field,
but in this case we have already done this with 'opAs' (so I pick
'Max' as we just need something that copies the value over).

We revisit this data in 'layeredCount'.

-}</span><span>
</span><span id="line-1455"></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount2"><span class="hs-identifier hs-type">starCount2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1458"></span><span id="starCount2"><span class="annot"><span class="annottext">starCount2 :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#starCount2"><span class="hs-identifier hs-var hs-var">starCount2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1459"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118082"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118082"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1460"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number&quot;</span></span><span>
</span><span id="line-1461"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_med&quot;</span></span><span>
</span><span id="line-1462"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-1463"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>      </span><span id="local-6989586621679118080"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118080"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1466"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-1467"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1468"></span><span>                         </span><span class="hs-comment">-- I think I want a ByField back</span><span>
</span><span id="line-1469"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Operation -&gt; SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#ByFieldOp"><span class="hs-identifier hs-var">ByFieldOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_med&quot;</span></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Max"><span class="hs-identifier hs-var">Max</span></a></span><span>
</span><span id="line-1470"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span>
</span><span id="line-1471"></span><span>                                 </span><span class="hs-special">]</span><span>
</span><span id="line-1472"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1473"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number&quot;</span></span><span>
</span><span id="line-1474"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1475"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of stars&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1476"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span>      </span><span id="local-6989586621679118076"><span class="annot"><span class="annottext">star :: Symbol
</span><a href="#local-6989586621679118076"><span class="hs-identifier hs-var hs-var">star</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Symbol
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SymPath"><span class="hs-identifier hs-var">SymPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;M 0,-1 L 0.23,-0.23 L 1,-0.23 L 0.38,0.21 L 0.62,0.94 L 0,0.49 L -0.62,0.94 L -0.38,0.21 L -1,-0.23 L -0.23,-0.23 L 0,-1 z&quot;</span></span><span>
</span><span id="line-1479"></span><span>
</span><span id="line-1480"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1481"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118082"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1482"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118080"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1483"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MShape"><span class="hs-identifier hs-var">MShape</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679118076"><span class="hs-identifier hs-var">star</span></a></span><span>
</span><span id="line-1484"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-1485"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1486"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MFill"><span class="hs-identifier hs-var">MFill</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;yellow&quot;</span></span><span>
</span><span id="line-1487"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">100</span></span><span>
</span><span id="line-1488"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-1489"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1490"></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span>
</span><span id="line-1493"></span><span class="hs-comment">{-|

Vega-Lite supports a number of data transformations, including
several \&quot;pre-canned\&quot; transformations, such as a
kernel-density estimator, which I will use here to
look for structure in the parallax distribution. The earlier
use of a fixed-bin histogram - 'parallaxHistogram' and 'ylogHistogram' -
showed a peak around 5 to 10 milli-arcseconds, and a secondary
one around 20 to 25 milli-arcseconds, but can we infer anything more
from the data?

I have already shown that the 'transform'
function works in a similar manner to 'encoding', in that
it is applied to one or more transformations. In this
example I use the 'density' transform - which is __new to Vega Lite 4__ -
to \&quot;smooth\&quot; the data without having to pre-judge the data
(although there are options to configure the density estimation).
The transform creates new fields - called \&quot;value\&quot; and \&quot;density\&quot;
by default - which can then be displayed as any other field. In this
case I switch from 'Bar' or 'Line' to use the 'Area' encoding, which
fills in the area from the value down to the axis.

&lt;&lt;images/vl/densityparallax.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hIATAUxQEtoBPPKABwBsAPSAXwF0AacKLeLADW9UBAiR0DeAGNqdfAAYAdAHZe4qMjjohZepABGTWSI3jI22LrIAReMgAW9AgCZuYACw8+E2g318SEEyeEg+dnNSeGgw-DELAFdYJgNHaGgGZFwAehyEAHdlAHNqR0TDROQyWBl0RGgKaGU6rBzbdETigCFkvRzHADcyYvgcgW0ageHRnJIYsdHKeABaeFWANgBGDbWtxRXY4zIt+GVEdBXHUPJYZWhkQchzCQxsGNFfC2lYas-NTSQADiAmKBkQiSwhhqzy+gIASgBBAD6AEkAMLwgDK4Mh0NgsIB31YuKhMJeAMgtgAomjMTighCyQSKYCyMjmGxGXiYXCwOwvgKIJE+JAACTIGTXARpDJZXI5GZnUrQcqGZSUdA5SXSsZKlZMahkRWeZQAK2Q9UJUAodRIlEQYPiX0gXLACUBqEoZCYJAMg3gTES+lZUH8gSgAEdEkhoNQYpRhtbAfAWJRkKIYNQmBHID9AyY2ELxCLAQp3ZAvT6-UFyFRaM8wzQAgZo7H43Gk8XS1A6ogvU73QL2EA Open this visualization in the Vega Editor&gt;

@
let trans = transform
            . 'density' \&quot;plx\&quot; []

    enc = encoding
          . position X [ PName \&quot;value\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;parallax\&quot; ]
                       ]
          . position Y [ PName \&quot;density\&quot;, PmType Quantitative ]

in toVegaLite
     [ gaiaData
     , mark 'Area' [ MOpacity 0.7
                 , MStroke \&quot;black\&quot;
                 , 'MStrokeDash' [ 2, 4 ]
                 , ]
     , trans []
     , enc []
     ]
@

The parallax distribution shows multiple peaks within the
5 to 10 milli-arcsecond range, and separate peaks at 12
and 22 milli-arcseconds.

The properties of the area mark are set here to add a black,
dashed line around the edge of the area. The 'DashStyle' configures
the pattern by giving the lengths, in pixels,
of the \&quot;on\&quot; and \&quot;off&quot; segments, so here the gaps are twice the
length of the line segments. This was done more to show that it
can be done, rather than because it aids this particular visualization!

-}</span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallax"><span class="hs-identifier hs-type">densityParallax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1555"></span><span id="densityParallax"><span class="annot"><span class="annottext">densityParallax :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallax"><span class="hs-identifier hs-var hs-var">densityParallax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1556"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118075"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118075"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1557"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [DensityProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#density"><span class="hs-identifier hs-var">density</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span>      </span><span id="local-6989586621679118073"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118073"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1560"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;value&quot;</span></span><span>
</span><span id="line-1561"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1562"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1563"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1564"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;density&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1565"></span><span>
</span><span id="line-1566"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1567"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1568"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Area"><span class="hs-identifier hs-var">Area</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MOpacity"><span class="hs-identifier hs-var">MOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.7</span></span><span>
</span><span id="line-1569"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-1570"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeDash"><span class="hs-identifier hs-var">MStrokeDash</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1571"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-1572"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118075"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1573"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118073"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1574"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span class="hs-comment">{-|

The density estimation can be configured using 'DensityProperty'.
Here we explicitly label the new fields to create (rather than
use the defaults), and ensure the calculation is done per cluster.
This means that the data range for each cluster is used to
perform the KDE, which in this case is useful (as it ensures the
highest fidelity), but there are times when you may wish to ensure
a consistent scale for the evaluation (in which case you'd use
the 'DnExtent' option, as well as possibly 'DnSteps', to define
the grid). The final change is to switch from density estimation
to counts for the dependent axis.

&lt;&lt;images/vl/densityparallaxgrouped.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTIBzWdAVwAcAjATz0MgGEAbW5aAU1iQAugBpi5SPGRsCkAB4BrACb9IoqMxVqxEigGM6iaDPxxa-ceQiRVKAJbRW+SPS7zIegL7FdNrPCwimzAkOj08PqOzmAADAB0AOwaMMz0ai6B-PCQXlZQyvDQOfhkFLSwXGyQABbQ0PTIuAD0zQgA7vGUjjW0jLyChsb8xvGGWM0AInSUAEIVivzNNQBu-JTwzQF8gstrG82Fxc0b9vAAtPAXAGwAjNeXt7HnxYxc-Lfw8Yjo5zXZqlg8RMK3UekgGGwRRCehsEVgyAypFhFAA4gFKNVELQsIxBGDrBQAEoAQQA+gBJDhEgDKWJxeKE+UJrnc9Nx+OZ1kgkwAopTqXSXNiOUyUTZ+GS3B5hQz8SifORFWA8sRIAASZD6f4Bap1BpNVr7L7daC9RjxezoZpanWbY3nLiOJYrAAs8QAVsh0IgCVARoZlPZEJjSuDDFxMCEIfZ+FxlNVuLwBEyoE50lj0Fhg-AqqrJDLkSzULH49UlKo-ZJ00jIABHWhIaCOIr2NZVijweT2UykGCOd7VAAKgVzXC7uW8XMgMVCJbjCZcWkrKRr1QbTZbzfbKS7Pejzegg5cHCMJlyyvzUCGJdDpB8XiAA Open this visualization in the Vega Editor&gt;

@
let trans = transform
            . density &quot;plx&quot; [ 'DnAs' \&quot;xkde\&quot; \&quot;ykde\&quot;
                            , 'DnGroupBy' [ \&quot;Cluster\&quot; ]
                            , 'DnCounts' True
                            ]

    enc = encoding
          . position X [ PName \&quot;xkde\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Parallax\&quot; ]
                       ]
          . position Y [ PName \&quot;ykde\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Counts\&quot; ]
                       ]
          . color [ MName \&quot;Cluster\&quot;
                  , MmType Nominal
                  ]

in toVegaLite
     [ gaiaData
     , mark Area [ MOpacity 0.7 ]
     , trans []
     , enc []
     ]
@

Note how the clusters separate out in pretty cleanly, but - as
also shown in the 'pointPlot' visualization below - it is pretty
busy around 7 milli arcseconds.

The counts here (the Y axis) are __significantly larger__ than
seen than the actual count of stars, shown in 'starCount'. It
appears that the @'DnCounts' True@ option is interpreted as
&lt;https://vega.github.io/vega-lite/docs/density.html#example-stacked-density-estimates multiplying the density values by the number of values in a group&gt;,
which means that there is a bin-width effect. This is explored
further in the 'compareCounts' plot below.

-}</span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallaxGrouped"><span class="hs-identifier hs-type">densityParallaxGrouped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1636"></span><span id="densityParallaxGrouped"><span class="annot"><span class="annottext">densityParallaxGrouped :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#densityParallaxGrouped"><span class="hs-identifier hs-var hs-var">densityParallaxGrouped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1637"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118070"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118070"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1638"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [DensityProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#density"><span class="hs-identifier hs-var">density</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnAs"><span class="hs-identifier hs-var">DnAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xkde&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span>
</span><span id="line-1639"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnGroupBy"><span class="hs-identifier hs-var">DnGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1640"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnCounts"><span class="hs-identifier hs-var">DnCounts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1641"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span>      </span><span id="local-6989586621679118066"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118066"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1644"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xkde&quot;</span></span><span>
</span><span id="line-1645"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1646"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1647"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1648"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span>
</span><span id="line-1649"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1650"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Counts&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1651"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1652"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-1653"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1654"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-1657"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1658"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Area"><span class="hs-identifier hs-var">Area</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MOpacity"><span class="hs-identifier hs-var">MOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.7</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1659"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118070"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1660"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118066"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1661"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span class="hs-comment">-- $intro-points</span><span>
</span><span id="line-1665"></span><span class="hs-comment">-- At this point we make a signifiant detour from the Elm Vega-Lite</span><span>
</span><span id="line-1666"></span><span class="hs-comment">-- walkthtough, and look a bit more at the 'Point' mark, rather than creating</span><span>
</span><span id="line-1667"></span><span class="hs-comment">-- small-multiple plots. Don't worry, we'll get to them later.</span><span>
</span><span id="line-1668"></span><span class="hs-comment">--</span><span>
</span><span id="line-1669"></span><span class="hs-comment">-- I apologize for the alliterative use of point here.</span><span>
</span><span id="line-1670"></span><span>
</span><span id="line-1671"></span><span class="hs-comment">{-|

Here I use the 'Point' mark to display the individual
@Gmag, plx@ pairs, encoding by __both__ 'color' and 'shape.
Since the encoding uses the same field of the data (the @Cluster@
name), Vega-Lite is smart enough to only display one legend,
which contains the point shape and color used for each cluster.

Since the parallax values are bunched together at low values,
a logarithmic scale ('ScLog') is used for the y axis, along with
commands to define the actual axis domain - by turning off the
'IsNice' support and listing the minimum and maximum values
for the axis with 'SDomain'.

&lt;&lt;images/vl/pointplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMAWADDgNOFALYCGATgNYZQAOA9vAHZqESQAmpKpNoE7AK7kANjRgoUtAM7oA9HPKkA7gDpE8FNEEAjQdNjkAxvRawWqk8TkAReoMQAhYZVhzoAN1iJScstJRDdy8fOS4eOR94UgBaUliANgBGBLiknBieHRFYJNJVJnoYuFIOQ1UUaQ9INgFIADN6cjI0TH4BdloKAz4iDvYAcTJEcSZBYh1DGr7+yAAlAEEAfQBJAGE5gGVR8cnyaf662hEADx2JqdrDyBsAUVWN7cxIMYv9q9nYJeOz59e9yAzCAAXxmoJBtUgyngHC0NFwBCIkAAJNIjHAyOJUFJZAoQvkNFpdKp4PQ5GiMb58TERJo3B4sKoAFbSUwHKDmEwcZgjNozSAmERNPgNeCwEQccRrET6QLvKAoACetFgo3oxGYpDEwI+kGk0FIKpF9TFEqlMoClwVytVf3Vmu1ut+YGAovFkueQ1II3w1qNzwAjoJSCxNNx4F5IDr+YretcTe7xD92R09UYtbaXZx1aRmDQANoAZlUAFZfYWAEwAXV9kCV-qgQp9UCY8CMmfqWoM0eu9czkCDIZQYeHkbBRB7UBMTBNvJdoOBQA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
                    . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative ]
                    . position Y [ PName \&quot;plx\&quot;, PmType Quantitative, PScale scaleOpts ]
                    . color cluster
                    . shape cluster

    scaleOpts = [ SType ScLog, 'SDomain' ('DNumbers' [3.5, 32]), 'SNice' ('IsNice' False) ]
    cluster = [ MName \&quot;Cluster\&quot;, MmType Nominal ]
, 
in toVegaLite [ gaiaData
              , mark Point []
              , enc []
              , width 400
              , height 400
              ]
@

We can see that each cluster appears to have a separate parallax
value (something we have seen in earlier plots, such as 'parallaxBreakdown'),
and that it doesn't really vary with Gmag. What this is telling
us is that for these star clusters, the distance to each member star
is similar, and that they are generally at different distances
from us. However, it's a bit hard to tell exactly what is going
on around 5 to 6 milli arcseconds, as the clusters overlap here.

This line of thinking leads us nicely to map making, but before we
try some cartography, I wanted to briefly provide some context for
these plots. The
&lt;https://lco.global/spacebook/distance/parallax-and-distance-measurement/ parallax of a star&gt;
is a measure of its distance from us, but it is an inverse relationship,
so that nearer stars have a larger parallax than those further from us.
The @Gmag@ column measures the apparent brightness of the star, with the
@G@ part indicating what
&lt;https://www.cosmos.esa.int/web/gaia/iow_20180316 part of the spectrum&gt;
is used (for Gaia, the @G@ band is pretty broad, covering much of
the visible spectrum), and the @mag@ part is because optical Astronomy
tends to use

 * &lt;https://www.skyandtelescope.com/astronomy-resources/the-stellar-magnitude-system/ the logarithm of the measured flux&gt;

 * and then subtract this from a constant

so that larger values mean fainter sources. These are also
&lt;https://en.wikipedia.org/wiki/Apparent_magnitude apparent magnitues&gt;,
so that they measure the flux of the star as measured at Earth,
rather than its intrinsic luminosity (often defined as an object's
&lt;https://en.wikipedia.org/wiki/Absolute_magnitude absolute magnitude&gt;).

We can see that the further the cluster is from us - that is, as we
move down this graph to smaller parallax values - then the
smallest stellar magnitude we can see in a cluster tends to increase,
but that there are stars up to the maximum value (20) in each cluster.
This information can be used to look at the
distribution of absolute magnitudes of stars in a cluster, which
tells us about its evolutionary state - such as is it newly formed or old -
amongst other things. However, this is straying far from the
aim of this tutorial, so lets get back to plotting things.

-}</span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#pointPlot"><span class="hs-identifier hs-type">pointPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1751"></span><span id="pointPlot"><span class="annot"><span class="annottext">pointPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#pointPlot"><span class="hs-identifier hs-var hs-var">pointPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1752"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118065"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118065"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1753"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1754"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="annot"><span class="annottext">[ScaleProperty]
</span><a href="#local-6989586621679118064"><span class="hs-identifier hs-var">scaleOpts</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1755"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#shape"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">[MarkChannel]
</span><a href="#local-6989586621679118062"><span class="hs-identifier hs-var">cluster</span></a></span><span>
</span><span id="line-1756"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="annot"><span class="annottext">[MarkChannel]
</span><a href="#local-6989586621679118062"><span class="hs-identifier hs-var">cluster</span></a></span><span>
</span><span id="line-1757"></span><span>
</span><span id="line-1758"></span><span>      </span><span id="local-6989586621679118064"><span class="annot"><span class="annottext">scaleOpts :: [ScaleProperty]
</span><a href="#local-6989586621679118064"><span class="hs-identifier hs-var hs-var">scaleOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3.5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">32</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1759"></span><span>      </span><span id="local-6989586621679118062"><span class="annot"><span class="annottext">cluster :: [MarkChannel]
</span><a href="#local-6989586621679118062"><span class="hs-identifier hs-var hs-var">cluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1760"></span><span>
</span><span id="line-1761"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1762"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1763"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118065"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1764"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1765"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1766"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span class="hs-comment">-- $intro-map</span><span>
</span><span id="line-1769"></span><span class="hs-comment">-- We have some hint that the different clusters are distinct objects</span><span>
</span><span id="line-1770"></span><span class="hs-comment">-- in space, in that they appear to be different distances from us,</span><span>
</span><span id="line-1771"></span><span class="hs-comment">-- but where does the \&quot;cluster\&quot; in the name \&quot;Stellar Cluster\&quot;</span><span>
</span><span id="line-1772"></span><span class="hs-comment">-- come from? Well, we can try plotting up the position of each star</span><span>
</span><span id="line-1773"></span><span class="hs-comment">-- on the sky - using the @RA_ICRS@ and @DE_ICRS@ fields - to find out.</span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span class="hs-comment">{-|

The following specification should only contain one new feature - other
than sneakily switching from 'Point' to 'Circle' type for the mark - and
that is displaying the x axis (namely Right Ascension) in reverse (using
@'PSort' [ 'Descending' ]@. This is needed because Right Ascension
is measured from right to left. I like to explain it by talking about
oranges, and how we are at the center of an orange looking out at its
skin, and so have the direction reversed to if you were outside, looking
in. This may be why I don't get invited to too many parties.
You can see that we also have one cluster that straddles the
0 and 360 degrees Right Ascension meridian, which will lead to some
fun later ('clusterCenters').

&lt;&lt;images/vl/posplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFALYCGATgNYZQDG85tANrJIRJACakqk2gQOAV3JMaMFCgAOAZ3QB6eeVIB3AHSJ4KaEIBGQmbEYB7AHYpY5tbWPF5AEWNDEAIRGVY86ADdYiUvJkMhbkXr7+8ty88v7wpAC0pAkAbACMyYmpOPG8uiyppGqmxvFwpJxGaigy3mxEHABmxuRkaJgCghxSFIb89Z1QAOJkiOKmQsS6RnUDgpAASgCCAPoAkgDC8wDKYxNT5DOzUFJMAB67k9PsR5D2AKJrmzuYkOOXB9ezkLDLJ+cvb32kH6EAAvv1wWDrpAVPBONoaAAWPDQgAkMlocDI4lQ0jkinChU02j0angxnkGKxAUJ8SYWk83kRagAVjIzIdvqYbJx4KZRu1+pAbExmvxIA14LAmJxxOsmAYQmwoCgAJ5SVgA2x80hiUGfKD-MAdToSqUy8RLR7bQ6mjG6zXGri2Uh8mgAbQI2GSOAAuvgoKZ4LRHQ1dYZ9SCoOzyG0oBUMZZefzbXM1RrxABHISkcxaHjwXypjikU7wGTilBaFiWpCoMCLROmGTk0xgAAUFUQAEpIJDBJHTaq+l9JdLZS97tadgaOPaa+1nWQ3Zh3fEAJxezf+wPB0Ph2CDgaQdOOyDZ3NV3hVouzqCl8uV6tn+ywZg6qtmDtd3v9sFEI9hTMSUBWNcFQSAA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X (axOpts \&quot;RA_ICRS\&quot; \&quot;Right Ascension (deg)\&quot; ++ [ raScale, 'PSort' [ 'Descending' ] ])
            . position Y (axOpts \&quot;DE_ICRS\&quot; \&quot;Declination (deg)\&quot; ++ [ decScale ])
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    axOpts field lbl = [ PName field, PmType Quantitative, PAxis [ AxTitle lbl ]]

    scaleOpts minVal maxVal = [ SDomain (DNumbers [ minVal, maxVal ]), SNice (IsNice False) ]
    raScale = PScale (scaleOpts 0 360)
    decScale = PScale (scaleOpts (-90) 90)

in toVegaLite [ gaiaData
              , mark 'Circle' []
              , enc []
              , width 400
              , height 300
              ]
@

We can see that these clusters are indeed localised on the sky,
with &lt;https://en.wikipedia.org/wiki/Hyades_(star_cluster) Hyades&gt;
looking like it covers the largest area. However, we should be
careful and __not forget__ either
&lt;https://www.youtube.com/watch?v=E9IuXEwpU7U Grover's hard work&gt;
or
&lt;https://www.youtube.com/watch?v=MMiKyfd6hA0 Father Ted's explanation to Father Dougal&gt;,
since these clusters are different distances from us, which
makes size a tricky thing to measure from this plot.

There is also the fact that I have used possibly the worst
way of displaying the Right Ascension and Declination data. Although
the night sky is not the same as the Earth's surface, the issues
when trying to display the Globe on a flat surface also apply to
displaying up the sky. For this plot the distortions near the
pole are huge, although fortunately we don't have any clusters
too close to either pole.

-}</span><span>
</span><span id="line-1832"></span><span>
</span><span id="line-1833"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#posPlot"><span class="hs-identifier hs-type">posPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1834"></span><span id="posPlot"><span class="annot"><span class="annottext">posPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#posPlot"><span class="hs-identifier hs-var hs-var">posPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1835"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118057"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118057"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1836"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118056"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Right Ascension (deg)&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118055"><span class="hs-identifier hs-var">raScale</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118056"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Declination (deg)&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679118054"><span class="hs-identifier hs-var">decScale</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1838"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1839"></span><span>
</span><span id="line-1840"></span><span>      </span><span id="local-6989586621679118056"><span class="annot"><span class="annottext">axOpts :: Text -&gt; Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118056"><span class="hs-identifier hs-var hs-var">axOpts</span></a></span></span><span> </span><span id="local-6989586621679118053"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118053"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621679118052"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118052"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118053"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118052"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1841"></span><span>
</span><span id="line-1842"></span><span>      </span><span id="local-6989586621679118051"><span class="annot"><span class="annottext">scaleOpts :: Double -&gt; Double -&gt; [ScaleProperty]
</span><a href="#local-6989586621679118051"><span class="hs-identifier hs-var hs-var">scaleOpts</span></a></span></span><span> </span><span id="local-6989586621679118050"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118050"><span class="hs-identifier hs-var">minVal</span></a></span></span><span> </span><span id="local-6989586621679118049"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118049"><span class="hs-identifier hs-var">maxVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118050"><span class="hs-identifier hs-var">minVal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118049"><span class="hs-identifier hs-var">maxVal</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1843"></span><span>      </span><span id="local-6989586621679118055"><span class="annot"><span class="annottext">raScale :: PositionChannel
</span><a href="#local-6989586621679118055"><span class="hs-identifier hs-var hs-var">raScale</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; [ScaleProperty]
</span><a href="#local-6989586621679118051"><span class="hs-identifier hs-var">scaleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">360</span></span><span class="hs-special">)</span><span>
</span><span id="line-1844"></span><span>      </span><span id="local-6989586621679118054"><span class="annot"><span class="annottext">decScale :: PositionChannel
</span><a href="#local-6989586621679118054"><span class="hs-identifier hs-var hs-var">decScale</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; [ScaleProperty]
</span><a href="#local-6989586621679118051"><span class="hs-identifier hs-var">scaleOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span class="hs-special">)</span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1847"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1848"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118057"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1849"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1850"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-1851"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1852"></span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span class="hs-comment">{-|
Vega-Lite supports a large number of projections - via the
'Projection' type - which we use below to create
a similar visualization to 'posPlot'. Here I use the
'Longitude' and 'Latitude' channels, along with a
'Mercator' 'projection', to display the data.

The trick in this case is that longitude runs from -180 to 180
degrees, but the data has Right Ascension going from 0
to 360 degrees. Here we take advantage of Vega Lite's
__data transformation__ capabilities and create a new
column - which I call @longitude@ - and is defined as
\&quot;Right Ascension - 360\&quot; when the Right Ascension is
greater than 180, otherwise it is just set to the
Right Ascension value. The &quot;expression&quot; support
is essentially a sub-set of Javascript, and the @datum@
object refers to the current row. The new data column
can then be used with the 'Longitude' channel.
Thankfully the 'Latitude' channel can use the Declination values
without any conversion.

As can be seen, this flips the orientation compared to
'posPlot', and makes the center of the plot have a
longiture (or Right Ascension), of 0 degrees.

&lt;&lt;images/vl/skyplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTJ5k8oAbdRAcwEtoBXAEwFNIAaY8pADG8WkLa140HvkgcpbLADoASgEEA+gEkAwioDKYAHxgAjAA4ADGAD8Yee2XrtewwFowAZgBs1-A8VVTV0DSAEwAF9iAF1+CEgACy5mRgToGgAWS0s4qCx4WABrGmFmWCFaHly5KXgaMgo2WFoStOgAB2RcAHpuhAB3JRZoBLYAIzZkLnKGaURoJSF0LG6AEXQ2RgAhJsKuboSANy5GeG785GlYA+PT7ocz0+Z4N3gX71NvV9NLN2h4MaVUzwJSIdBuJLwbiwJTQZCHPjhSAYbBSerheLtApTdHkQQAcXyjBKiEUY2miLxFGcIX0JLJFNyVMg7VoAA96VhybBKVSoKsAKIuUKyUlcxkYihcDSsjmihk8yVRcjKyLVfrMDgjGieACsOWIkAAJMghEl8q1oB0ur1biDhqMxkpmOhuqbzWc7W5aKx9ocMkoAFbIBi8lmwdCBrhCaAuxD1GAAT3aMjy0xE0EwkAi1S4iCWHGYTFxFCW9B5+AaglQzC4tA4JVlvMEptEqeAkHdXCwqcghzKmuY1F4UGgyd79GJOclSZTJQAjmwkLH-rHjs2KJVGHmG5WYKxKo2CqJJBzVRBp4JJCvOO3kbX6yVBcK6SPZ73F8vWFJmOvLxRM3QWhY3aBMazrXcoB0WhJiuPhR3HElliLURsyZOgGGGW8wIfSDIHoJhWGwt8xznWRP3mb81x4VV-2EBga2JSsogiIA Open this visualization in the Vega Editor&gt;

@
let trans = transform
                . 'calculateAs'
                  &quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS&quot;
                  &quot;longitude&quot;

    axOpts field = [ PName field, PmType Quantitative ]

    enc = encoding
            . position 'Longitude' (axOpts &quot;longitude&quot;)
            . position 'Latitude' (axOpts \&quot;DE_ICRS\&quot;)
            . color [ MName \&quot;plx\&quot;
                    , MmType Quantitative
                    , 'MScale' [ SType ScLog
                             , 'SScheme' \&quot;viridis\&quot; []
                             ]
                    , MLegend [ 'LTitle' &quot;parallax&quot; ]
                    ]
            . 'tooltip' [ 'TName' \&quot;Cluster\&quot;, 'TmType' Nominal ]

in toVegaLite [ width 400
              , height 350
              , 'projection' [ 'PrType' 'Mercator' ]
              , gaiaData
              , trans []
              , enc []
              , mark Circle []
              ]
@

The other major change made to 'posPlot' is that the stars are now
color-encoded by the log of their parallax value
rather than cluster membership,
and the color scheme has been changed to use the \&quot;viridis\&quot; color
scale.
The 'LTitle' option is set for the legend (on the
'color' channel) rather than use the default (which in
this case would be @\&quot;plx\&quot;@).

Since parallax is a numeric value, with ordering (i.e. 'Quantitative'),
the legend has changed from a list of symbols to a gradient bar.
To account for this lost of information, I have added a 'tooltip'
encoding so that when the pointer is moved over a star its cluster
name will be displayed. This is, unfortunately,
/only/ visible in the interactive version of the visualization.

__Note that__ the tooltip behavior changed in Vega Lite 4 (or in the
code used to display the visualizations around this time), since
prior to this tooltips were on by default. Now tooltips have to be
explicitly enabled (with 'tooltip' or 'tooltips').

From this visualization we can see that the apparent size of the cluster
(if we approximate each cluster as a circle, then we can think of the radius
of the circle as a measure of size) depends on parallax, with larger
sizes having larger parallaxes. This is because the distance to a star
is inversely-dependent on its parallax, so larger parallaxes mean the
star is closer to us. However, there is no reason that the intrinsic
size - that is its actual radius - of each cluster is the same.
We can see that although the Hyades and Pleiades clusters overlap
on the sky, they have significantly-different parallaxes (as can
be seen in 'pointPlot' for example), with Hyades being the closer
of the two.

It is possible to add graticules - with the aptly-named
'graticule' function - but this requires the use of layers,
which we haven't covered yet. If you are impatient you can jump
right to 'skyPlotWithGraticules'!

If you want to see how to &quot;create your own projection&quot;, see
'skyPlotAitoff', which uses the
&lt;https://en.wikipedia.org/wiki/Aitoff_projection Aitoff projection&gt;
(which is unfortunately not available to
Vega-Lite directly).

-}</span><span>
</span><span id="line-1958"></span><span>
</span><span id="line-1959"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlot"><span class="hs-identifier hs-type">skyPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-1960"></span><span id="skyPlot"><span class="annot"><span class="annottext">skyPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlot"><span class="hs-identifier hs-var hs-var">skyPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1961"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118047"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118047"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-1962"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span>
</span><span id="line-1963"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS&quot;</span></span><span>
</span><span id="line-1964"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span>
</span><span id="line-1965"></span><span>
</span><span id="line-1966"></span><span>      </span><span id="local-6989586621679118045"><span class="annot"><span class="annottext">axOpts :: Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118045"><span class="hs-identifier hs-var hs-var">axOpts</span></a></span></span><span> </span><span id="local-6989586621679118044"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118044"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118044"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1967"></span><span>
</span><span id="line-1968"></span><span>      </span><span id="local-6989586621679118043"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118043"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-1969"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Longitude"><span class="hs-identifier hs-var">Longitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118045"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1970"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Latitude"><span class="hs-identifier hs-var">Latitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679118045"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1971"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-1972"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-1973"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MScale"><span class="hs-identifier hs-var">MScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span>
</span><span id="line-1974"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Double] -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SScheme"><span class="hs-identifier hs-var">SScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;viridis&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1975"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-1976"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitle"><span class="hs-identifier hs-var">LTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1977"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-1978"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#tooltip"><span class="hs-identifier hs-var">tooltip</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1979"></span><span>              </span><span class="hs-comment">-- note: opacity doesn't really help here</span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">350</span></span><span>
</span><span id="line-1982"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-1983"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProjectionProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#projection"><span class="hs-identifier hs-var">projection</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrType"><span class="hs-identifier hs-var">PrType</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="Graphics.Vega.VegaLite.Geometry.html#Mercator"><span class="hs-identifier hs-var">Mercator</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1984"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-1985"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118047"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1986"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118043"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1987"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1988"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1989"></span><span>
</span><span id="line-1990"></span><span>
</span><span id="line-1991"></span><span class="hs-comment">-- $intro-choropleth</span><span>
</span><span id="line-1992"></span><span class="hs-comment">-- There are some things vega-lite can do, don't fit as well into the</span><span>
</span><span id="line-1993"></span><span class="hs-comment">-- flow of looking at astronomy data!  But having examples is helpful.</span><span>
</span><span id="line-1994"></span><span class="hs-comment">-- So we bring our eyes back to earth, and demonstrate a basic</span><span>
</span><span id="line-1995"></span><span class="hs-comment">-- &quot;choropleth&quot;, a map - in the sense of pictures of bounded geographical</span><span>
</span><span id="line-1996"></span><span class="hs-comment">-- regions - with data for each location indicated by color.</span><span>
</span><span id="line-1997"></span><span class="hs-comment">--</span><span>
</span><span id="line-1998"></span><span class="hs-comment">-- Don't worry, we'll soon be back staring at the stars!</span><span>
</span><span id="line-1999"></span><span class="hs-comment">--</span><span>
</span><span id="line-2000"></span><span class="hs-comment">-- The choropleth examples (there's another one later on)</span><span>
</span><span id="line-2001"></span><span class="hs-comment">-- use a map of the United States as the data source, which we abstract</span><span>
</span><span id="line-2002"></span><span class="hs-comment">-- out into a helper function:</span><span>
</span><span id="line-2003"></span><span class="hs-comment">--</span><span>
</span><span id="line-2004"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2005"></span><span class="hs-comment">-- usGeoData :: T.Text -&gt; Data</span><span>
</span><span id="line-2006"></span><span class="hs-comment">-- usGeoData f = dataFromUrl \&quot;https:\/\/raw.githubusercontent.com\/vega\/vega\/master\/docs\/data\/us-10m.json\&quot; ['TopojsonFeature' f]</span><span>
</span><span id="line-2007"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2008"></span><span class="hs-comment">--</span><span>
</span><span id="line-2009"></span><span class="hs-comment">-- The argument gives the \&quot;topological\&quot; feature in the input file to</span><span>
</span><span id="line-2010"></span><span class="hs-comment">-- display (via 'TopojsonFeature'). You can read more information on this</span><span>
</span><span id="line-2011"></span><span class="hs-comment">-- in the &lt;https://vega.github.io/vega-lite/docs/data.html#topojson Vega-Lite documentation&gt;.</span><span>
</span><span id="line-2012"></span><span class="hs-comment">--</span><span>
</span><span id="line-2013"></span><span class="hs-comment">-- This section was contributed by Adam Conner-Sax. Thanks!</span><span>
</span><span id="line-2014"></span><span>
</span><span id="line-2015"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#usGeoData"><span class="hs-identifier hs-type">usGeoData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Input.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span>
</span><span id="line-2016"></span><span id="usGeoData"><span class="annot"><span class="annottext">usGeoData :: Text -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#usGeoData"><span class="hs-identifier hs-var hs-var">usGeoData</span></a></span></span><span> </span><span id="local-6989586621679118030"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118030"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/vega/vega/master/docs/data/us-10m.json&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; Format
</span><a href="Graphics.Vega.VegaLite.Input.html#TopojsonFeature"><span class="hs-identifier hs-var">TopojsonFeature</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679118030"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span class="hs-comment">{-|

Our first choropleth is based on the
&lt;https://vega.github.io/vega-lite/examples/geo_choropleth.html Choropleth&gt;
example from the Vega-Lite
&lt;https://vega.github.io/vega-lite/examples/ Example Gallery&gt;.

The key elements are:

   * Using the 'TopojsonFeature' feature for the data source (thanks to @usGeoData@).
   * Choosing the correct &quot;feature&quot; name in the geographic data, here @\&quot;counties\&quot;@
     in the argument to our @usGeoData@ helper function.
   * Performing a Vega-Lite lookup to join the data to be plotted (the unemployment rate)
     to the geographic data.  In this case, the column name in the unemployment data - @\&quot;id\&quot;@
     given as the first argument to 'lookup' - is the same as the column name in the
     geographic data, the third argument to 'lookup'. Those can be different.
   * Specifying a projection, that is a mapping from (longitude, latitude) to (x,y)
     coordinates. Since we are looking at data for the main-land United States of
     America we use 'AlbersUsa' (rather than looking at the whole globe, as we did
     in earlier visualizations), which lets us view the continental USA as well as Alaska and Hawaii.
   * Using the 'Geoshape' mark.

&lt;&lt;images/vl/choroplethlookuptogeo.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTJVZ0d8zyKATeaePU4higV1gBt2kABbRoAB2S4A9FIQB3AHQBzAJbQh3AEbdkAU1gBjdImi6TCo1ikA3XUvg27DrPGSnYUxugPJPLB9yIulhifOgAnlhm0ArQyNaQnAwAvgA0SeSQANa64YIqjJDpXBCUKrp8jMjsBJAIppAAuhlgaS2QYehZ3GL5hUnJxI3FUEK6Kkoi7ADMAAyzI5AusFmCSrroyELwYrpFxJDMrOz0pbwC+MKiEtKy8Iqq6lo6+kYm0RY0jvbfzq7unm8viOAWQAFoAIyzLAKABWyGM+0yGGwLBOlF0LF4e0uRkC0HK1VSUGg4V2gmg6DE6HhiMGEDapTkBXU7AArPNFgASZAGMYuQQicSSGS2ezKNQaTQKFToKS8-kOMXwMF8NS6GwAFjhCMQSKgYmosN0BgJiLoMDJOKg8D4mn0yAAqsg2IyoGYjIwVIglCckpAjGFYH6uGUKoVLvU9iNMrzbdbgJAFcFrZAxLxQhsED69m7MqTyZcAI7cJAE1gE2yJcj01qLTTwAxZJTUQIRm0AL2x+oDxlQExOg2SQA Open this visualization in the Vega Editor&gt;

@
let unemploymentData = dataFromUrl \&quot;https:\/\/raw.githubusercontent.com\/vega\/vega\/master\/docs\/data\/unemployment.tsv\&quot; []

in toVegaLite
   [ usGeoData \&quot;counties\&quot;
   , transform
     . 'lookup' \&quot;id\&quot; unemploymentData \&quot;id\&quot; ('LuFields' [\&quot;rate\&quot;])
     $ []
   , projection [PrType 'AlbersUsa']
   , encoding
     . color [ MName \&quot;rate\&quot;, MmType Quantitative, MScale [ SScheme &quot;purpleorange&quot; [] ] ]
     $ []
   , mark Geoshape []
   , width 500
   , height 300
   , 'background' &quot;azure&quot;
   ]
@

So, we have seen how to join data between two datasets - thanks to
'lookup' - and display the unemployment rate (from one data source)
on a map (defined from another data source).

I have chosen a
&lt;https://vega.github.io/vega/docs/schemes/index.html#diverging diverging color scheme&gt;
for the rate, mainly just because I can, but also because I wanted to see how
the areas with high rates were clustered. I've also shown how the 'background'
function can be used (it is simpler than the 'configuration' approach
used earlier in 'stripPlotWithBackground').

Our next choropleth - 'choroplethLookupFromGeo' - will show how we can join
multiple fields across data sources, but this requires understanding how
Vega-Lite handles multiple views, which is fortunately next in our
tutorial.

-}</span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupToGeo"><span class="hs-identifier hs-type">choroplethLookupToGeo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2083"></span><span id="choroplethLookupToGeo"><span class="annot"><span class="annottext">choroplethLookupToGeo :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupToGeo"><span class="hs-identifier hs-var hs-var">choroplethLookupToGeo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2084"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118028"><span class="annot"><span class="annottext">unemploymentData :: PropertySpec
</span><a href="#local-6989586621679118028"><span class="hs-identifier hs-var hs-var">unemploymentData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/vega/vega/master/docs/data/unemployment.tsv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2087"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#usGeoData"><span class="hs-identifier hs-var">usGeoData</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;counties&quot;</span></span><span>
</span><span id="line-2088"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2089"></span><span>       </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; PropertySpec
-&gt; Text
-&gt; LookupFields
-&gt; [TransformSpec]
-&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679118028"><span class="hs-identifier hs-var">unemploymentData</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; LookupFields
</span><a href="Graphics.Vega.VegaLite.Core.html#LuFields"><span class="hs-identifier hs-var">LuFields</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rate&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2090"></span><span>       </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; [TransformSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2091"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProjectionProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#projection"><span class="hs-identifier hs-var">projection</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Projection -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrType"><span class="hs-identifier hs-var">PrType</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="Graphics.Vega.VegaLite.Geometry.html#AlbersUsa"><span class="hs-identifier hs-var">AlbersUsa</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2092"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2093"></span><span>       </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rate&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MScale"><span class="hs-identifier hs-var">MScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Double] -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SScheme"><span class="hs-identifier hs-var">SScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;purpleorange&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2094"></span><span>       </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2095"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2096"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">500</span></span><span>
</span><span id="line-2097"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-2098"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#background"><span class="hs-identifier hs-var">background</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;azure&quot;</span></span><span>
</span><span id="line-2099"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-2100"></span><span>
</span><span id="line-2101"></span><span>
</span><span id="line-2102"></span><span class="hs-comment">-- $intro-layered</span><span>
</span><span id="line-2103"></span><span class="hs-comment">-- The Stacked-Histogram plot - created by 'gmagHistogramWithColor' - showed</span><span>
</span><span id="line-2104"></span><span class="hs-comment">-- the distribution of the \&quot;Gmag\&quot; field by cluster, but it was hard to</span><span>
</span><span id="line-2105"></span><span class="hs-comment">-- compare them. A common approach in this situation is to split up</span><span>
</span><span id="line-2106"></span><span class="hs-comment">-- the data into multiple plots -</span><span>
</span><span id="line-2107"></span><span class="hs-comment">-- the &lt;https://en.wikipedia.org/wiki/Small_multiple small multiple&gt;</span><span>
</span><span id="line-2108"></span><span class="hs-comment">-- approach (also known as trellis plots) - which we can easily achieve in</span><span>
</span><span id="line-2109"></span><span class="hs-comment">-- Vega Lite. It also gets us back on track with the Elm walkthrough.</span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span class="hs-comment">{-|

Our first attempt is with the 'column' function, which tells
Vega-Lite to create a plot for each @Cluster@ field (and introduces
us to the @F@ family of 'FacetChannel' constructors).

The legend has been turned off with @'MLegend' []@, since it doesn't
add anything to this visulization (as the individual plots, labelled
by the cluster name, provide the same information).

&lt;&lt;images/vl/smallmultiples.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAjBkA04oBNYAXWVMUCCSAV3gBszIALIogBwGcUB6b+WAO4A6AOYBLIk2rpqHAKbwAxgHsAdkTnqhK6NwAiy6iIBCtRHO5MAbnJGxucDhviWbd7oRLc7Y2AFpYfwA2AEYggJCABj8SdDo5ENghVWU-JjlYfAUhIg4rHDwqADNleDgiMgpKKjYEeUrC6qgAcTgRRlVqaHQFAqbKSAAlAEEAfQBJAGFBgGUOrp74Pv6oNjoAD3nu3twVqD0AUQnpubRITu2l3ZXIOVG1zbOLxchGiABfRs+P68gAEg4inScEYLHYXF4biS4kk0iEYmU3EBwPsUL8dAkFisABYhAArDhqZa3VQqfBiVTtNBVKgqOilSqQIpiOR0fCMSZ0WTOHBQIgATzYcg6ymgFNgDGwUHiIk07LQnTodHe1yoj3ITJZbMYrVg7SlkHQFLIRHg1DkBoFQsYAEdqLB1BJiGIbJAVY1IHSuqpGczWfKoJzuTs+YLhU9ReKGO7qpB+Q1+pA9SJ4LZiOGoCpqOplrGrRnIHaHUQnSXXaqBrB1mIOIyS0R4owAHILBRgZRFMAzEjwWvfSj9mOZtTMqnkT7vIA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, PBin [] ]
            . position Y yAxis
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal, MLegend [] ]
            . 'column' [ 'FName' \&quot;Cluster\&quot;, 'FmType' Nominal ]

    yAxis = [ PAggregate Count
            , PmType Quantitative
            , PAxis [ AxTitle \&quot;Number of Stars\&quot; ]
            ]

in toVegaLite
     [ gaiaData
     , mark Bar []
     , enc []
     ]
@

Since we have nine clusters in the sample, the overall visualization is
too wide, unless you have a very-large monitor. Can we do better?

-}</span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples"><span class="hs-identifier hs-type">smallMultiples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2150"></span><span id="smallMultiples"><span class="annot"><span class="annottext">smallMultiples :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples"><span class="hs-identifier hs-var hs-var">smallMultiples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2151"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118022"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118022"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2152"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2153"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679118021"><span class="hs-identifier hs-var">yAxis</span></a></span><span>
</span><span id="line-2154"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2155"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2156"></span><span>
</span><span id="line-2157"></span><span>      </span><span id="local-6989586621679118021"><span class="annot"><span class="annottext">yAxis :: [PositionChannel]
</span><a href="#local-6989586621679118021"><span class="hs-identifier hs-var hs-var">yAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span>
</span><span id="line-2158"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2159"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of Stars&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2160"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2163"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2164"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2165"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118022"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2166"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span>
</span><span id="line-2169"></span><span class="hs-comment">{-|

The number of columns used in small-multiple can be defined using the
'columns' function. However, this requires us to:

 * move the facet definition out from the encoding and into the top-level,
   with the 'facetFlow' function;

 * and define the plot as a separate specification, and apply it
   with 'specification' and 'asSpec'.

The actual syntactic changes to 'smallMultiples' are actually
fairly minor:

@
let enc = encoding
            . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, PBin [] ]
            . position Y yAxis
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal, MLegend [] ]

    yAxis = [ PAggregate Count
            , PmType Quantitative
            , PAxis [ AxTitle \&quot;Number of Stars\&quot; ]
            ]

in toVegaLite
     [ gaiaData
     , 'columns' 4
     , 'facetFlow' [ FName \&quot;Cluster\&quot;, FmType Nominal ]
     , 'specification' ('asSpec' [ mark Bar [], enc [] ])
     ]
@

&lt;&lt;images/vl/smallmultiples2.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zUBRk-EIVpyY4Gga3FK6wyUlE0DYYnqqEKp1EeByBSybH4eGgDSGeD45lSUHgAE8vhMRLIobACCkoMEWFIMagmng8G97pArmgUWj6VBarB6lTINwoYR4DgsPwBYTiQcAI5YWASDgINj6SAs2aQAm-DaQPksHAGBD8BqiLASUEaqXG2XyxWIeAq43vDWwBZsCjIh3wYINAByRxwYBEmTAo0QZTV9xeGGj6qgABIKEJoiYGiRyFRaFYwuxODwmGwRNQkymjNmnHgONpdAAWJgAKwo4lBkARzTEHtQNfeWVgQn4+VhnPRmOxZmm+KJ1qgETJYgpap7ojEmTYMLQTweQA Open this visualization in the Vega Editor&gt;

Note that Vega Lite does support a @\&quot;facet\&quot;@ field in its encodings,
but hvega follows Elm VegaLite and requires you to use this
&lt;https://github.com/gicentre/elm-vegalite/issues/5#issuecomment-514501218 wrapped facet&gt; approach.

I chose 4 columns rather than 3 here to show how &quot;empty&quot; plots
are encoded. You can see how a 3-column version looks in the
next plot, 'densityMultiples'.

-}</span><span>
</span><span id="line-2215"></span><span>
</span><span id="line-2216"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples2"><span class="hs-identifier hs-type">smallMultiples2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2217"></span><span id="smallMultiples2"><span class="annot"><span class="annottext">smallMultiples2 :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#smallMultiples2"><span class="hs-identifier hs-var hs-var">smallMultiples2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2218"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118017"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118017"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2219"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2220"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679118016"><span class="hs-identifier hs-var">yAxis</span></a></span><span>
</span><span id="line-2221"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2222"></span><span>
</span><span id="line-2223"></span><span>      </span><span id="local-6989586621679118016"><span class="annot"><span class="annottext">yAxis :: [PositionChannel]
</span><a href="#local-6989586621679118016"><span class="hs-identifier hs-var hs-var">yAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span>
</span><span id="line-2224"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2225"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of Stars&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2226"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-2227"></span><span>
</span><span id="line-2228"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2229"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2230"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#columns"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">4</span></span><span>
</span><span id="line-2231"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#facetFlow"><span class="hs-identifier hs-var">facetFlow</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2232"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118017"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2233"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-2234"></span><span>
</span><span id="line-2235"></span><span>
</span><span id="line-2236"></span><span class="hs-comment">{-|

Earlier - in 'densityParallaxGrouped' - I used the Kernel-Density
Estimation support in Vega Lite 4 to show smoothed parallax
distributions, grouped by cluster. We can combine this with
the 'facetFlow' approach to generate a plot per cluster
of the parallax distribution. I have used 'DnExtent' to ensure
that the density estimation is done on the same grid for
each cluster.

The most important thing in this example is that I have
used a sensible number of columns (ending up in a three by three grid)!
The other significant changes to 'smallMultiples2' is that I have
used the 'FHeader' option to control how the facet headers
are displayed: the title (which in this case was @\&quot;Cluster\&quot;@)
has been hidden, and the per-plot labels made larger, but moved
down so that they lie within each plot. I am not 100% convinced
this is an intended use of 'HLabelPadding', but it seems to work!

&lt;&lt;images/vl/densitymultiples.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zUBRk-EIVp-D0Ygo2VyhAA2vdCrNICwcMoyNwAJ5gyBDPB8cyQAC67yhpmRCw0cVSUARhP4WJxnX4C0kEjBvhSYAAzL5sfdMHFARwkQdLndZi8MGzTiYcBoGqUYusMlJRNA2GJ6qhIRlRHgcgUsmx+HhoA1UejplB4AivhMRLIFbACIzIMEWFI9agmng8G97pArmh2VBMtrdQ0CUTKX9TeSDgBHLCwCQcBBsfTS3ELNgUTXwDjBBoABVK1rwsCWgqK7qhPO9G19-qdJLJSc6JrNkejscQGcTIYyhdT6cz4agCikFG5kGLGDHgtLUAAJBQhNETA0SOQqLQrGF2JweEw2CJqHOF0Z1048BxtLoACxMABWFHE0sgauagMITPeWVgQn4+WVHS1OprFE0TMY5TmiWI2l-KEC1aPAejEecNQOR160wGCdVzaB5UVQgnAAJgvTs7VgWCADFxHgUY2AAL37LwiIzeAs2dLBXSI9C4NPFgxAaHA2BYEh+XHSlIEbftGgtK0CHSKdH3EP0lTQJ4HiAA Open this visualization in the Vega Editor&gt;

@
let trans = transform
            . density &quot;plx&quot; [ DnAs \&quot;xkde\&quot; \&quot;ykde\&quot;
                            , DnGroupBy [ \&quot;Cluster\&quot; ]
                            , 'DnExtent' 0 30
                            ]

    enc = encoding
          . position X [ PName \&quot;xkde\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Parallax\&quot; ]
                       ]
          . position Y [ PName \&quot;ykde\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Density\&quot; ]
                       ]
          . color [ MName \&quot;Cluster\&quot;
                  , MmType Nominal
                  , MLegend []
                  ]

    headerOpts = [ 'HLabelFontSize' 16
                 , 'HLabelAlign' 'AlignRight'
                 , 'HLabelAnchor' 'AEnd'
                 , 'HLabelPadding' (-24)
                 , 'HNoTitle'
                 ]

    spec = asSpec [ enc []
                  , trans []
                  , mark Area [ ]
                  ]

in toVegaLite
     [ gaiaData
     , columns 3
     , facetFlow [ FName \&quot;Cluster\&quot;
                 , FmType Nominal
                 , 'FHeader' headerOpts
                 ]
     , specification spec
     ]
@

-}</span><span>
</span><span id="line-2304"></span><span>
</span><span id="line-2305"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#densityMultiples"><span class="hs-identifier hs-type">densityMultiples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2306"></span><span id="densityMultiples"><span class="annot"><span class="annottext">densityMultiples :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#densityMultiples"><span class="hs-identifier hs-var hs-var">densityMultiples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2307"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679118011"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118011"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2308"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [DensityProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#density"><span class="hs-identifier hs-var">density</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnAs"><span class="hs-identifier hs-var">DnAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xkde&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span>
</span><span id="line-2309"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnGroupBy"><span class="hs-identifier hs-var">DnGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2310"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnExtent"><span class="hs-identifier hs-var">DnExtent</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30</span></span><span>
</span><span id="line-2311"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-2312"></span><span>
</span><span id="line-2313"></span><span>      </span><span id="local-6989586621679118009"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118009"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2314"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xkde&quot;</span></span><span>
</span><span id="line-2315"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2316"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2317"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-2318"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span>
</span><span id="line-2319"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2320"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Density&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2321"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-2322"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-2323"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2324"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2325"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span>      </span><span id="local-6989586621679118008"><span class="annot"><span class="annottext">headerOpts :: [HeaderProperty]
</span><a href="#local-6989586621679118008"><span class="hs-identifier hs-var hs-var">headerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HLabelFontSize"><span class="hs-identifier hs-var">HLabelFontSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">16</span></span><span>
</span><span id="line-2328"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HAlign -&gt; HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HLabelAlign"><span class="hs-identifier hs-var">HLabelAlign</span></a></span><span> </span><span class="annot"><span class="annottext">HAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignRight"><span class="hs-identifier hs-var">AlignRight</span></a></span><span>
</span><span id="line-2329"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">APosition -&gt; HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HLabelAnchor"><span class="hs-identifier hs-var">HLabelAnchor</span></a></span><span> </span><span class="annot"><span class="annottext">APosition
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AEnd"><span class="hs-identifier hs-var">AEnd</span></a></span><span>
</span><span id="line-2330"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HLabelPadding"><span class="hs-identifier hs-var">HLabelPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">24</span></span><span class="hs-special">)</span><span>
</span><span id="line-2331"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HNoTitle"><span class="hs-identifier hs-var">HNoTitle</span></a></span><span>
</span><span id="line-2332"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span>      </span><span id="local-6989586621679118000"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679118000"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118009"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2335"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679118011"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2336"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Area"><span class="hs-identifier hs-var">Area</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2337"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2338"></span><span>
</span><span id="line-2339"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2340"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2341"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#columns"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-2342"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#facetFlow"><span class="hs-identifier hs-var">facetFlow</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-2343"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2344"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HeaderProperty] -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FHeader"><span class="hs-identifier hs-var">FHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderProperty]
</span><a href="#local-6989586621679118008"><span class="hs-identifier hs-var">headerOpts</span></a></span><span>
</span><span id="line-2345"></span><span>                   </span><span class="hs-comment">-- do not have access to plx field here</span><span>
</span><span id="line-2346"></span><span>                   </span><span class="hs-comment">-- and xkde,ykde is not useful here as want to</span><span>
</span><span id="line-2347"></span><span>                   </span><span class="hs-comment">-- sort by the xkde value when ykde is max</span><span>
</span><span id="line-2348"></span><span>                   </span><span class="hs-comment">-- , FSort [ ByFieldOp &quot;xkde&quot; Median ]</span><span>
</span><span id="line-2349"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-2350"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679118000"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-2351"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-2352"></span><span>
</span><span id="line-2353"></span><span>
</span><span id="line-2354"></span><span class="hs-comment">-- $intro-multiplot</span><span>
</span><span id="line-2355"></span><span class="hs-comment">-- There are four ways in which multiple views may be combined:</span><span>
</span><span id="line-2356"></span><span class="hs-comment">--</span><span>
</span><span id="line-2357"></span><span class="hs-comment">-- * The __facet operator__ takes subsets of a dataset (facets) and</span><span>
</span><span id="line-2358"></span><span class="hs-comment">--   separately applies the same view specification to each of</span><span>
</span><span id="line-2359"></span><span class="hs-comment">--   those facets (as seen with the 'column' function above).</span><span>
</span><span id="line-2360"></span><span class="hs-comment">--   Available functions to create faceted views:</span><span>
</span><span id="line-2361"></span><span class="hs-comment">--   'column', 'row', 'facet', 'facetFlow', and 'specification'.</span><span>
</span><span id="line-2362"></span><span class="hs-comment">--</span><span>
</span><span id="line-2363"></span><span class="hs-comment">-- * The __layer operator__ creates different views of the data but</span><span>
</span><span id="line-2364"></span><span class="hs-comment">--   each is layered (superposed) on the same same space; for example</span><span>
</span><span id="line-2365"></span><span class="hs-comment">--   a trend line layered on top of a scatterplot.</span><span>
</span><span id="line-2366"></span><span class="hs-comment">--   Available functions to create a layered view: 'layer' and 'asSpec'.</span><span>
</span><span id="line-2367"></span><span class="hs-comment">--</span><span>
</span><span id="line-2368"></span><span class="hs-comment">-- * The __concatenation operator__ allows arbitrary views (potentially</span><span>
</span><span id="line-2369"></span><span class="hs-comment">--   with different datasets) to be assembled in rows or columns.</span><span>
</span><span id="line-2370"></span><span class="hs-comment">--   This allows \'dashboards\' to be built.</span><span>
</span><span id="line-2371"></span><span class="hs-comment">--   Available functions to create concatenated views:</span><span>
</span><span id="line-2372"></span><span class="hs-comment">--   'vConcat', 'hConcat', and 'asSpec'.</span><span>
</span><span id="line-2373"></span><span class="hs-comment">--</span><span>
</span><span id="line-2374"></span><span class="hs-comment">-- * The __repeat operator__ is a concise way of combining multiple views</span><span>
</span><span id="line-2375"></span><span class="hs-comment">--   with only small data-driven differences in each view.</span><span>
</span><span id="line-2376"></span><span class="hs-comment">--   Available functions for repeated views: 'repeat' and 'specification'.</span><span>
</span><span id="line-2377"></span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span class="hs-comment">{-|

We start with a \&quot;basic\&quot; plot for the dataset: the median value
of the parallax of the stars in each cluster.

&lt;&lt;images/vl/baseplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEC2CGBOBrSAuKAjBkA04oBNYAXWVMUCCSAV3gBszIALIogBwGcUB6b+WAO4A6AOYBLIk2rpqHAKbwAxgHsAdkTnqhK6NwAiy6iIBCtRHO5MAbnJGxucDhviWbd7oRLc7Y2AFpYfwA2AEYggJCABj8SdDo5ENghVWU-JjlYfAUhIg4rHDwqADNleDgiMgpKKjYEeUrC6qgAcTgRRlVqaHQFAqbKSAAlAEEAfQBJAGFBgGUOrp74Pv6oNjoAD3nu3twVqD0AUQnpubRITu2l3ZXIOVG1zbOLxchGiABfRs+P68gAEg4inScEYLHYXF4biS4kk0iEYmU3EBwPsUL8dAkFisABYhAArDhqZa3VQqfBiVTtNBVKiPciQIpiOR0fCMSZ0WTOHBQIgATzYcg6ymgFNgDHe1yovMqDKZLMYD25kFgIhE8FsxEFZ2gcnJsFUSr5AsYAEdqPqiBJiGIbJBvmAJXhICpVIyqeRPu8gA Open this visualization in the Vega Editor&gt;

@
let plx = position Y [ PName \&quot;plx\&quot;, PmType Quantitative, PAggregate Median ]
    cluster = position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]
    enc = encoding . cluster . plx

in toVegaLite
      [ gaiaData
      , mark Bar []
      , enc []
      ]
@
-}</span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#basePlot"><span class="hs-identifier hs-type">basePlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2402"></span><span id="basePlot"><span class="annot"><span class="annottext">basePlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#basePlot"><span class="hs-identifier hs-var hs-var">basePlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2403"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117998"><span class="annot"><span class="annottext">plx :: BuildEncodingSpecs
</span><a href="#local-6989586621679117998"><span class="hs-identifier hs-var hs-var">plx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2404"></span><span>      </span><span id="local-6989586621679117997"><span class="annot"><span class="annottext">cluster :: BuildEncodingSpecs
</span><a href="#local-6989586621679117997"><span class="hs-identifier hs-var hs-var">cluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2405"></span><span>      </span><span id="local-6989586621679117996"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117996"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117997"><span class="hs-identifier hs-var">cluster</span></a></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117998"><span class="hs-identifier hs-var">plx</span></a></span><span>
</span><span id="line-2406"></span><span>
</span><span id="line-2407"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2408"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2409"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2410"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117996"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2411"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2412"></span><span>
</span><span id="line-2413"></span><span>
</span><span id="line-2414"></span><span class="hs-comment">{-|

We start our exploration by combining two visualizations, layering
one on top of the other. The base plot shows the same data as
'basePlot', and then on top we will show a horizontal line that
indicates the median parallax for all the stars in the sample.

&lt;&lt;images/vl/layeredplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zUAAkFELRJg0k5CotCsYXYnB4TDYImo31+RhBTjwHG0ugALEwAFYUcTrKB4WAATzaqAA2h1gJATDgNA1uKVUlApKJoGwxPVUBSrmgsmx+HhoA0hng+OYGZB4ASyPwJiJZKzYAQHkr3hAKVSaQccFhgpAXmAALrvM5iZms9loDqQAkFHl8gUHS5i2AsFg4AwIaUHWT8FmwMRiiVShoARywfvgHAQbH0uvSb3SkFEYkybHNwCeDyAA Open this visualization in the Vega Editor&gt;

@
let plx = position Y [ PName \&quot;plx\&quot;, PmType Quantitative, PAggregate Median ]
    cluster = position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]

    perCluster = [ mark Bar [], encoding (cluster []) ]
    allClusters = [ mark 'Rule' [] ]

in toVegaLite
      [ gaiaData
      , encoding (plx [])
      , 'layer' (map 'asSpec' [perCluster, allClusters])
      ]
@

For this visualization, the specification starts with the data
source and an encoding, but __only__ for the y axis (which means
that all layered plots use the same encoding for the axis). The
'layer' function introduces the different visualizations that
will be combined, each as there own \&quot;specification\&quot; (hence
the need to apply 'asSpec' to both @perCluster@ and @allClusters@).
Note that there is no x-axis encoding for the 'Rule', since the
data applies to all clusters (i.e. it should span the
whole visualization).

-}</span><span>
</span><span id="line-2450"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredPlot"><span class="hs-identifier hs-type">layeredPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2451"></span><span id="layeredPlot"><span class="annot"><span class="annottext">layeredPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredPlot"><span class="hs-identifier hs-var hs-var">layeredPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2452"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117995"><span class="annot"><span class="annottext">plx :: BuildEncodingSpecs
</span><a href="#local-6989586621679117995"><span class="hs-identifier hs-var hs-var">plx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2453"></span><span>      </span><span id="local-6989586621679117994"><span class="annot"><span class="annottext">cluster :: BuildEncodingSpecs
</span><a href="#local-6989586621679117994"><span class="hs-identifier hs-var hs-var">cluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2454"></span><span>
</span><span id="line-2455"></span><span>      </span><span id="local-6989586621679117993"><span class="annot"><span class="annottext">perCluster :: [PropertySpec]
</span><a href="#local-6989586621679117993"><span class="hs-identifier hs-var hs-var">perCluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117994"><span class="hs-identifier hs-var">cluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2456"></span><span>      </span><span id="local-6989586621679117992"><span class="annot"><span class="annottext">allClusters :: [PropertySpec]
</span><a href="#local-6989586621679117992"><span class="hs-identifier hs-var hs-var">allClusters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2457"></span><span>
</span><span id="line-2458"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2459"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2460"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117995"><span class="hs-identifier hs-var">plx</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117993"><span class="hs-identifier hs-var">perCluster</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117992"><span class="hs-identifier hs-var">allClusters</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2462"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2463"></span><span>
</span><span id="line-2464"></span><span>
</span><span id="line-2465"></span><span class="hs-comment">{-|

This example is similar to 'layeredPlot' but includes an x-axis
encoding for the second layer. We use this to show the range of the
data - so the minimum to maximum parallax range of each cluster - with
the 'Rule' type. The difference to the previous plot is that an
extra positional encoding is added ('Y2') to define the end point
of each line ('Y' is used as the start point).

&lt;&lt;images/vl/layereddiversion.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFACYCGKpGYoEEkArgE4A2VMKKADgM7oD0fRqQDuAOkTwU0egCN63WIwDGAewB2KWBtGqAtnwAiK+ogBCTANaw+0AG6xEpPrtLdNjG-cd8yFPo-hSAFpSYIA2AEYwkIicIIoZZlgI0lE1FSC4UmJFURRuW0hCWigAMxVGFzRMGhKoTlJGBSpauqgAcRdENjV6XRlFIqI2yAAlAEEAfQBJAGFRgGUevoHGIba6TmYAD2X+weKNyAMAURn5pcxIXv21w5HYSa3dq5vVyGHaAF9Pn4gvw6QYTwYhSKi4AhESAAEm4SjgLjYqC4vAEXlSEikslE8BUfDhCKc6KCzEk1lsABZRAArbjqdZQZikACeg0wAG1Pq1aJAXIwLC1INx4AAvWBUABMBCgKGZnHFVyU8GUSUgAM+dC0qmI8DU3RqGp5zMFpXgsGYxDYzyKUFIiEQjAc5AVUF0sB1pDUNsgsvlbAAjvRPShJOR4PY1Ya-t97tRDbzGgKrox6KrY5q1Nrdfq4xsoMyJSazRarTtvXaHU7NGwXLt1XnIMaapBTebLVdrfhbfbHY5q1ddLrvb6XZBA8HQyGI9GSjOwNGALqArUqHV6wUvagt4vtqCzZjydzDuWj9KDtSkVhfetQVRqU054A-L5AA Open this visualization in the Vega Editor&gt;

@
let plx op = position Y [ PName \&quot;plx\&quot;, PmType Quantitative, PAggregate op ]
    cluster = position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]

    median = [ mark Circle [ 'MSize' 20 ]
             , encoding (plx Median [])
             ]
    range = [ mark Rule [ ]
            , encoding
                . plx 'Min'
                . position 'Y2' [ PName &quot;plx&quot;, PAggregate 'Max' ]
                $ []
            ]

in toVegaLite
      [ gaiaData
      , encoding (cluster [])
      , layer (map asSpec [ median, range ])
      , width 300
      , height 300
      ]
@

The 'MSize' option is used to change the size of the circles so that they
do not drown out the lines (the size value indicates the area of the mark,
and so for circles the radius is proportional to the square root of this
size value; in practical terms I adjusted the value until I got something
that looked sensible).

Note that the y axis is automatically labelled with the different
operation types that were applied - median, minimum, and maximum -
although there is no indication of what marks map to these operations.

-}</span><span>
</span><span id="line-2512"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredDiversion"><span class="hs-identifier hs-type">layeredDiversion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2513"></span><span id="layeredDiversion"><span class="annot"><span class="annottext">layeredDiversion :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredDiversion"><span class="hs-identifier hs-var hs-var">layeredDiversion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2514"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117989"><span class="annot"><span class="annottext">plx :: Operation -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117989"><span class="hs-identifier hs-var hs-var">plx</span></a></span></span><span> </span><span id="local-6989586621679117988"><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679117988"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="#local-6989586621679117988"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2515"></span><span>      </span><span id="local-6989586621679117987"><span class="annot"><span class="annottext">cluster :: BuildEncodingSpecs
</span><a href="#local-6989586621679117987"><span class="hs-identifier hs-var hs-var">cluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2516"></span><span>
</span><span id="line-2517"></span><span>      </span><span id="local-6989586621679117986"><span class="annot"><span class="annottext">median :: [PropertySpec]
</span><a href="#local-6989586621679117986"><span class="hs-identifier hs-var hs-var">median</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117989"><span class="hs-identifier hs-var">plx</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2518"></span><span>      </span><span id="local-6989586621679117985"><span class="annot"><span class="annottext">range :: [PropertySpec]
</span><a href="#local-6989586621679117985"><span class="hs-identifier hs-var hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Operation -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117989"><span class="hs-identifier hs-var">plx</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Min"><span class="hs-identifier hs-var">Min</span></a></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y2"><span class="hs-identifier hs-var">Y2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Max"><span class="hs-identifier hs-var">Max</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2519"></span><span>
</span><span id="line-2520"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2521"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2522"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117987"><span class="hs-identifier hs-var">cluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2523"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117986"><span class="hs-identifier hs-var">median</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117985"><span class="hs-identifier hs-var">range</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2524"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-2525"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-2526"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span>
</span><span id="line-2529"></span><span class="hs-comment">{-|

In this example (adapted from an example provided by Jo Wood)
I display the same data as in 'starCount', but
as two layers: the first is a histogram (using the 'Bar' mark),
and the second displays the count value as a label with the
'Text' mark.

&lt;&lt;images/vl/layeredcount.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxhIBzWdAVwAcAjATz0MgGEAba5aAU1kgBdADRR45Sr3Lw+LAmXS0WkAMY1E0SKMjxkytdQ2QAvoOPERxSAAteAS3LXN+AEwBWAAzCraxKgcsZABudrwA7oGQPFQA1rwsiNQcHMbG3hCQACYy8IHEGdSwHMpO0LTIuAD0lQhhAHTkdtDW1PTc-L58GnVqWJUAIjTkAEKFcZXWQVLwlVi6fLATU9KV2dAz0nbwALTwOwBsAIz7u4ce2+v0HLyH8HWI6Nu28Jn8ddDIQVr5UBjYMnkSCRILR4LBkPF8KAgUDIABxObkZSJLD0fjfGHAgBKAEEAPoASTYWIAysjqKj0elMVBaBwAB7kykCamYyD9ACihOJZPwkBRaJZP1hvDxdMZfIF6OFYHMQLlsupkDCdkyzRYAGYPF4rAASZAqWxzErQMoVarLO6NZqtOp2dCVA1GmaW7YcJq8SpBAAsdQAVsh0IgMVBoE1rpE+PTnFAAHIUwVgdCoMA8MHIMC0fhgFRcHhU35B6AkuwAL0hYEOAA40lYOPBGOj8EQgdCYZA5rAYsp6GCQyLEGpMnZEEioTKMmoOJhATSMv5eBxMspONwFv2aVFMDGyLxB+hh6PlMxtJhXgI+a8DXvD0ja3OMtBGFnkegsCP4MVWZvruQb5FQUyW8WDObRonQOI2HQacLygSgGxMCdFSQyAJVIJD51CJcVzzddvzZQNYB3SA9yHEcxygE8oDPJsoCvFQb3Ikx8PbJ8X0lN8Py-DCxHpOw9HwRJkiQ+9N2YKFIAXbC+QMIxtDYitIAAR2oJAw3WMMpi0Xj+ISJIUhlBUIFEiA21hTtuwkzJxLAbZ9nk59FKjTQTOBUiDyY8c5xgXho0iKTlxk9RNAc9ioBUtSmhkOwtNc2E0LMzcApwtcqR4rciMidzgL5KjIBo2Csl4a9EGAuLWMc1930QT8NzZeA+IEsAhI4ESWIyGyyGSoLDBC0NKr5CKNCizT4m0BrdME-SjJIGaFUEEBjCAA Open this visualization in the Vega Editor&gt;


@
let trans = transform
            . aggregate [ opAs Count \&quot;\&quot; \&quot;count\&quot; ]
                        [ \&quot;Cluster\&quot; ]

    chanSort = [ ByChannel ChY, Descending ]

    baseEnc = encoding
              . position X [ PName \&quot;Cluster\&quot;
                           , PmType Nominal
                           , PSort chanSort
                           , PAxis []
                           ]
              . position Y [ PName \&quot;count\&quot;
                           , PmType Quantitative
                           , PAxis []
                           ]

    barEnc = baseEnc
             . color [ MName \&quot;Cluster\&quot;
                     , MmType Nominal
                     , MLegend [ 'LStrokeColor' \&quot;gray\&quot;
                               , 'LPadding' 10
                               ]
                     , MSort chanSort
                     ]

    labelEnc = baseEnc
               . 'text' [ TName \&quot;count\&quot;, TmType Quantitative ]

    barSpec = asSpec [ barEnc [], mark Bar [] ]
    labelSpec = asSpec [ labelEnc [], mark 'Text' [ 'MdY' (-6) ] ]

    cfg = configure
          . configuration (ViewStyle [ViewNoStroke])

in toVegaLite [ width 300
              , height 250
              , cfg []
              , gaiaData
              , title \&quot;Number of stars per cluster\&quot; [ TFontSize 18 ]
              , trans []
              , layer [ barSpec, labelSpec ]
              ]
@

Both axes have been dropped from this visualization since
the cluster name can be found from the legend and the
count is included in the plot. The same sort order is
used for the X axis and the color mapping, so that its
easy to compare (the first item in the legend is the
cluster with the most counts). Note that this changes the
color mapping (cluster to color) compared to previous
plots such as 'parallaxBreakdown'.

-}</span><span>
</span><span id="line-2598"></span><span>
</span><span id="line-2599"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredCount"><span class="hs-identifier hs-type">layeredCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2600"></span><span id="layeredCount"><span class="annot"><span class="annottext">layeredCount :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#layeredCount"><span class="hs-identifier hs-var hs-var">layeredCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2601"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117982"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117982"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2602"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2603"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2604"></span><span>
</span><span id="line-2605"></span><span>      </span><span id="local-6989586621679117981"><span class="annot"><span class="annottext">chanSort :: [SortProperty]
</span><a href="#local-6989586621679117981"><span class="hs-identifier hs-var hs-var">chanSort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#ByChannel"><span class="hs-identifier hs-var">ByChannel</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChY"><span class="hs-identifier hs-var">ChY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2606"></span><span>
</span><span id="line-2607"></span><span>      </span><span id="local-6989586621679117980"><span class="annot"><span class="annottext">baseEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117980"><span class="hs-identifier hs-var hs-var">baseEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2608"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-2609"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2610"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="annot"><span class="annottext">[SortProperty]
</span><a href="#local-6989586621679117981"><span class="hs-identifier hs-var">chanSort</span></a></span><span>
</span><span id="line-2611"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2612"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-2613"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span>
</span><span id="line-2614"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2615"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2616"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-2617"></span><span>
</span><span id="line-2618"></span><span>      </span><span id="local-6989586621679117979"><span class="annot"><span class="annottext">barEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117979"><span class="hs-identifier hs-var hs-var">barEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117980"><span class="hs-identifier hs-var">baseEnc</span></a></span><span>
</span><span id="line-2619"></span><span>               </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-2620"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2621"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LStrokeColor"><span class="hs-identifier hs-var">LStrokeColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gray&quot;</span></span><span>
</span><span id="line-2622"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LPadding"><span class="hs-identifier hs-var">LPadding</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span>
</span><span id="line-2623"></span><span>                                 </span><span class="hs-special">]</span><span>
</span><span id="line-2624"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSort"><span class="hs-identifier hs-var">MSort</span></a></span><span> </span><span class="annot"><span class="annottext">[SortProperty]
</span><a href="#local-6989586621679117981"><span class="hs-identifier hs-var">chanSort</span></a></span><span>
</span><span id="line-2625"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-2626"></span><span>
</span><span id="line-2627"></span><span>      </span><span id="local-6989586621679117975"><span class="annot"><span class="annottext">labelEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117975"><span class="hs-identifier hs-var hs-var">labelEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117980"><span class="hs-identifier hs-var">baseEnc</span></a></span><span>
</span><span id="line-2628"></span><span>                 </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2629"></span><span>
</span><span id="line-2630"></span><span>      </span><span id="local-6989586621679117973"><span class="annot"><span class="annottext">barSpec :: VLSpec
</span><a href="#local-6989586621679117973"><span class="hs-identifier hs-var hs-var">barSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117979"><span class="hs-identifier hs-var">barEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2631"></span><span>      </span><span id="local-6989586621679117972"><span class="annot"><span class="annottext">labelSpec :: VLSpec
</span><a href="#local-6989586621679117972"><span class="hs-identifier hs-var hs-var">labelSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117975"><span class="hs-identifier hs-var">labelEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MdY"><span class="hs-identifier hs-var">MdY</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">6</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2632"></span><span>
</span><span id="line-2633"></span><span>      </span><span id="local-6989586621679117969"><span class="annot"><span class="annottext">cfg :: [ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117969"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span>
</span><span id="line-2634"></span><span>            </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; BuildConfigureSpecs -&gt; [ConfigureSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ViewConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStyle"><span class="hs-identifier hs-var">ViewStyle</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ViewConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewNoStroke"><span class="hs-identifier hs-var">ViewNoStroke</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2635"></span><span>
</span><span id="line-2636"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-2637"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">250</span></span><span>
</span><span id="line-2638"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117969"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2639"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2640"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of stars per cluster&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; TitleConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#TFontSize"><span class="hs-identifier hs-var">TFontSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">18</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2641"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117982"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2642"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117973"><span class="hs-identifier hs-var">barSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117972"><span class="hs-identifier hs-var">labelSpec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2643"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2644"></span><span>
</span><span id="line-2645"></span><span>
</span><span id="line-2646"></span><span class="hs-comment">-- TODO: can I plot the mean / median of the parallax for each cluster</span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span class="hs-comment">{-|

As promised earlier (in 'skyPlot'), now that we have layers, we can
add graticules to a projection. In this case I create two graticule layers,
the \&quot;base\&quot; layer (@grats@), which creates the grey lines that cover
the map - using a spacing of 60 degrees (4 hours) for longitude and
15 degrees for latitude - and then an extra layer (@grats0@), which shows blue lines
at longitude seprations of 180 degrees
and latitude spacings of 90 degrees. In this case the central horizontal and
vertical lines represent 0 degrees, and the one at the left shows
-180 degrees. There are no latitude lines for -90 or +90 since the
default is to stop at &#177;85 degrees (see 'GrExtent' for a way to
change this).

I added the second graticule layer to see if I could get by without
labels for the grid lines, but decided this did not work out too well,
so ended with two layers, one each for the Right Ascension and
Declination values, using 'dataFromColumns' to manually create the
label positions and label content to display with the 'Text' mark.

&lt;&lt;images/vl/skyplotwithgraticules.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMAWADDgNOFAO7wAmK0GYAzAKwFGQAkAzgMZwC2AhtTChQAHVugD0YgG6xEPAHSJ4lAK4AjOfAD2Yjtx5SZPALQAbJbClY5AK1aaAdpEIRIQgE6brsdii2PMwJAoAJ5CsPxcsG7sPCiabpAAvs5QJjzBUdQA2kQQoBAFULxuANbU+YUFkKwoHiWwAOrklNQ4cnQplVA1deGYkIhusMFOuZXVtZr1APJCPOxKI5htHWOFQaF9UIiwmqzQPGGQa2DJJ5BksXwBA26x8OzKJluBNbBC2QBsBGAAjHQAXUSiTGZ0KgWKZX6Oz2ByO+CglxQ1zAgUG90ez3KE3e2V+AA4fgBOHBA4GdVHnWo8eysABm8S42ROeRZVR4rH4JgcihQyjI4QpXUgMRMmNiWwusWUXDkACUAIIAfQAkgBhOUAZTAAD4-oSwAB+MBImXy5XqrVgIy0b5gTCm2WK1UazXHLoQEFdAFCoo8Ur8BbRLG+qXI8psyDKNwmfioYSiCR3YgKJTQNTKVhRdgOFCwewoOQ5rhiAAimmUiAAQtH6mJoNJZGJeG83PXG-okfpZPBjDxjJ9fp8jDxfjgjMjVM9fvJ7JojHAeAK3HIUKxJKMPVAGW5eGgAmyXHM3FmI1v1gBxXiIfj2GWqTK+4XOy1u-p3rgPhJP8ZCEwAD1ve9H0PKpSwAURdLUgM-EDzyqWAlT-QD32AhJQK9D1MMKMFxnzHMyHgewbwPLcRU0bkElI89IDpeBYBMMh+GQzcaI4HgsRuXRYEifhJHgNxyHgTkEQ2I5+m5G9cLIkJxKgABHZQaV8ZFfGkViyOeHZ7CYm4VM4qBjw4tJAOwyppPGNIVP5F5aPoxj+AgqC3VE2TJUU5SlHudSLPWOIKN8D4bjohjdKgNUTEzPNvygNzb00LgiI4pIf0gbliKUGzsRChyJJ5TKBScWLNn4DyCy8tTwjMz1QQpCp1khbEyCWMAOigDikH8KB2HzaKirEyU83-NBRNUDkGKIwbNA+XzESuM8PUgSQOOUWBOUwHJ4MCEwp34IcqFElDrV+AAmH5IBanBZvBNLdv6M6DqgI6jG+UTLuugptruqAsEeyAjteqB3p-PJbtjfp8T+o7TvO962QBE5ZsgfDNEI4iFuFIb91ROzQq5XbXJK98EqS2MPrS+4+UK4L7LCi7+ri-oypU7yqtS9LeSymm8f6QDCbkyBmYq+AfMR2qxnqqpGuo4UyGe1YyI6xAusgQTkBGyNGdi2Bho08YxqzMx7ElRKyDILFEdDLsMfGZbIrW5ktrB-gjCwOh+qO2HqFdugPtBnbwZ+93DtaN7qDd6qCgRrokZRtGSMpGSdexwIcrpgOGaJqA50S+xkvJqyCtstP+BGfn3KU8rVJFtnIw5ovstp-g+eKgWher0WY9BIgfSYHN7DohPgBBRIgA Open this visualization in the Vega Editor&gt;

@
let trans = transform
                . calculateAs
                  &quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS&quot;
                  &quot;longitude&quot;

    axOpts field = [ PName field, PmType Quantitative ]

    enc = encoding
            . position Longitude (axOpts &quot;longitude&quot;)
            . position Latitude (axOpts \&quot;DE_ICRS\&quot;)
            . color [ MName \&quot;plx\&quot;
                    , MmType Quantitative
                    , MScale [ SType ScLog
                             , SScheme \&quot;viridis\&quot; []
                             ]
                    , MLegend [ LTitle &quot;parallax&quot; ]
                    ]
            . tooltip [ TName \&quot;Cluster\&quot;, TmType Nominal ]

    stars = asSpec [ gaiaData, trans [], enc [], mark Circle [] ]
    grats = asSpec [ 'graticule' [ 'GrStep' (60, 15) ]
                   , mark 'Geoshape' [ MStroke &quot;grey&quot;
                                   , 'MStrokeOpacity' 0.5
                                   , 'MStrokeWidth' 0.5
                                   ]
                   ]
    grats0 = asSpec [ graticule [ GrStep (180, 90)
                                ]
                    , mark Geoshape [ ]
                    ]

    raData = dataFromColumns []
                 . dataColumn &quot;x&quot; (Numbers [ -120, -60, 60, 120 ])
                 . dataColumn &quot;y&quot; (Numbers [ 0, 0, 0, 0 ])
                 . dataColumn &quot;lbl&quot; (Strings [ &quot;16h&quot;, &quot;20h&quot;, &quot;4h&quot;, &quot;8h&quot; ])

    decData = dataFromColumns []
                 . dataColumn &quot;x&quot; (Numbers [ 0, 0 ])
                 . dataColumn &quot;y&quot; (Numbers [ -45, 45 ])
                 . dataColumn &quot;lbl&quot; (Strings [ &quot;-45&quot;, &quot;45&quot; ])

    encLabels = encoding
                . position Longitude (axOpts &quot;x&quot;)
                . position Latitude (axOpts &quot;y&quot;)
                . text [ TName &quot;lbl&quot;, TmType Nominal ]

    raLabels = asSpec [ raData []
                      , encLabels []
                      , mark Text [ 'MAlign' 'AlignCenter'
                                  , 'MBaseline' 'AlignTop'
                                  , MdY 5
                                  ]
                      ]
    decLabels = asSpec [ decData []
                       , encLabels []
                       , mark Text [ MAlign AlignRight
                                   , MBaseline 'AlignMiddle'
                                   , 'MdX' (-5)
                                   ]
                      ]

in toVegaLite [ width 400
              , height 350
              , projection [ PrType Mercator ]
              , layer [ grats, grats0, stars, raLabels, decLabels ]
              ]
@

The layers are drawn in the order they are specified, which is why the
grid lines are drawn under the data (and labels).

You can see the distortion in this particular projection (the
&lt;https://en.wikipedia.org/wiki/Mercator_projection Mercator projection&gt;),
as the spacing between the latitude lines increases as you move towards the
bottom and top of the plot. There are a number of other projections you
can chose from, such as the 'Orthographic' projection I use in
'concatenatedSkyPlot'.

-}</span><span>
</span><span id="line-2752"></span><span>
</span><span id="line-2753"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotWithGraticules"><span class="hs-identifier hs-type">skyPlotWithGraticules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2754"></span><span id="skyPlotWithGraticules"><span class="annot"><span class="annottext">skyPlotWithGraticules :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotWithGraticules"><span class="hs-identifier hs-var hs-var">skyPlotWithGraticules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2755"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117967"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117967"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-2756"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span>
</span><span id="line-2757"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS&quot;</span></span><span>
</span><span id="line-2758"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span>
</span><span id="line-2759"></span><span>
</span><span id="line-2760"></span><span>      </span><span id="local-6989586621679117966"><span class="annot"><span class="annottext">axOpts :: Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117966"><span class="hs-identifier hs-var hs-var">axOpts</span></a></span></span><span> </span><span id="local-6989586621679117965"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117965"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117965"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2761"></span><span>
</span><span id="line-2762"></span><span>      </span><span id="local-6989586621679117964"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117964"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2763"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Longitude"><span class="hs-identifier hs-var">Longitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117966"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2764"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Latitude"><span class="hs-identifier hs-var">Latitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117966"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2765"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-2766"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-2767"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MScale"><span class="hs-identifier hs-var">MScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span>
</span><span id="line-2768"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Double] -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SScheme"><span class="hs-identifier hs-var">SScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;viridis&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2769"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-2770"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitle"><span class="hs-identifier hs-var">LTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2771"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-2772"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#tooltip"><span class="hs-identifier hs-var">tooltip</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2773"></span><span>              </span><span class="hs-comment">-- note: opacity doesn't really help here</span><span>
</span><span id="line-2774"></span><span>
</span><span id="line-2775"></span><span>      </span><span id="local-6989586621679117963"><span class="annot"><span class="annottext">stars :: VLSpec
</span><a href="#local-6989586621679117963"><span class="hs-identifier hs-var hs-var">stars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117967"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117964"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2776"></span><span>      </span><span id="local-6989586621679117962"><span class="annot"><span class="annottext">grats :: VLSpec
</span><a href="#local-6989586621679117962"><span class="hs-identifier hs-var hs-var">grats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[GraticuleProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#graticule"><span class="hs-identifier hs-var">graticule</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; GraticuleProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#GrStep"><span class="hs-identifier hs-var">GrStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">60</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">15</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2777"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grey&quot;</span></span><span>
</span><span id="line-2778"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeOpacity"><span class="hs-identifier hs-var">MStrokeOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-2779"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-2780"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-2781"></span><span>                     </span><span class="hs-special">]</span><span>
</span><span id="line-2782"></span><span>      </span><span id="local-6989586621679117958"><span class="annot"><span class="annottext">grats0 :: VLSpec
</span><a href="#local-6989586621679117958"><span class="hs-identifier hs-var hs-var">grats0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[GraticuleProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#graticule"><span class="hs-identifier hs-var">graticule</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; GraticuleProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#GrStep"><span class="hs-identifier hs-var">GrStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">180</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span class="hs-special">)</span><span>
</span><span id="line-2783"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-2784"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2785"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-2786"></span><span>
</span><span id="line-2787"></span><span>      </span><span class="hs-comment">-- hmmm, tried to use &quot;&#7476;&quot; / \u1D34 but this does not get converted</span><span>
</span><span id="line-2788"></span><span>      </span><span class="hs-comment">-- properly (is there a UTF-8/16 issue going on, or am I</span><span>
</span><span id="line-2789"></span><span>      </span><span class="hs-comment">-- just failing to understand modern text encoding yet again?)</span><span>
</span><span id="line-2790"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2791"></span><span>      </span><span class="hs-comment">-- this also affects &#176; / \u00b0 so not sure what's going on</span><span>
</span><span id="line-2792"></span><span>      </span><span id="local-6989586621679117957"><span class="annot"><span class="annottext">raData :: [DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117957"><span class="hs-identifier hs-var hs-var">raData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromColumns"><span class="hs-identifier hs-var">dataFromColumns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2793"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec)
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-2794"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">120</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">60</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">60</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">120</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2795"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span>
</span><span id="line-2796"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2797"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lbl&quot;</span></span><span>
</span><span id="line-2798"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Strings"><span class="hs-identifier hs-var">Strings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;16h&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;20h&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;4h&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;8h&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2799"></span><span>
</span><span id="line-2800"></span><span>      </span><span id="local-6989586621679117956"><span class="annot"><span class="annottext">decData :: [DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117956"><span class="hs-identifier hs-var hs-var">decData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromColumns"><span class="hs-identifier hs-var">dataFromColumns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2801"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec)
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-2802"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2803"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span>
</span><span id="line-2804"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">45</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">45</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2805"></span><span>                   </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lbl&quot;</span></span><span>
</span><span id="line-2806"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Strings"><span class="hs-identifier hs-var">Strings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-45&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;45&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2807"></span><span>
</span><span id="line-2808"></span><span>      </span><span id="local-6989586621679117955"><span class="annot"><span class="annottext">encLabels :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117955"><span class="hs-identifier hs-var hs-var">encLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2809"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Longitude"><span class="hs-identifier hs-var">Longitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117966"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2810"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Latitude"><span class="hs-identifier hs-var">Latitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117966"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2811"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lbl&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2812"></span><span>
</span><span id="line-2813"></span><span>      </span><span id="local-6989586621679117954"><span class="annot"><span class="annottext">raLabels :: VLSpec
</span><a href="#local-6989586621679117954"><span class="hs-identifier hs-var hs-var">raLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117957"><span class="hs-identifier hs-var">raData</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2814"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117955"><span class="hs-identifier hs-var">encLabels</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2815"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MAlign"><span class="hs-identifier hs-var">MAlign</span></a></span><span> </span><span class="annot"><span class="annottext">HAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignCenter"><span class="hs-identifier hs-var">AlignCenter</span></a></span><span>
</span><span id="line-2816"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MBaseline"><span class="hs-identifier hs-var">MBaseline</span></a></span><span> </span><span class="annot"><span class="annottext">VAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignTop"><span class="hs-identifier hs-var">AlignTop</span></a></span><span>
</span><span id="line-2817"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MdY"><span class="hs-identifier hs-var">MdY</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span>
</span><span id="line-2818"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-2819"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-2820"></span><span>      </span><span id="local-6989586621679117949"><span class="annot"><span class="annottext">decLabels :: VLSpec
</span><a href="#local-6989586621679117949"><span class="hs-identifier hs-var hs-var">decLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117956"><span class="hs-identifier hs-var">decData</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2821"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117955"><span class="hs-identifier hs-var">encLabels</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2822"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MAlign"><span class="hs-identifier hs-var">MAlign</span></a></span><span> </span><span class="annot"><span class="annottext">HAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignRight"><span class="hs-identifier hs-var">AlignRight</span></a></span><span>
</span><span id="line-2823"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MBaseline"><span class="hs-identifier hs-var">MBaseline</span></a></span><span> </span><span class="annot"><span class="annottext">VAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignMiddle"><span class="hs-identifier hs-var">AlignMiddle</span></a></span><span>
</span><span id="line-2824"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MdX"><span class="hs-identifier hs-var">MdX</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-2825"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-2826"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-2827"></span><span>
</span><span id="line-2828"></span><span>      </span><span class="hs-comment">-- don't know how to change the center</span><span>
</span><span id="line-2829"></span><span>
</span><span id="line-2830"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">350</span></span><span>
</span><span id="line-2831"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-2832"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProjectionProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#projection"><span class="hs-identifier hs-var">projection</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrType"><span class="hs-identifier hs-var">PrType</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="Graphics.Vega.VegaLite.Geometry.html#Mercator"><span class="hs-identifier hs-var">Mercator</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2833"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117962"><span class="hs-identifier hs-var">grats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117958"><span class="hs-identifier hs-var">grats0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117963"><span class="hs-identifier hs-var">stars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117954"><span class="hs-identifier hs-var">raLabels</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117949"><span class="hs-identifier hs-var">decLabels</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2834"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2835"></span><span>
</span><span id="line-2836"></span><span>
</span><span id="line-2837"></span><span>
</span><span id="line-2838"></span><span class="hs-comment">{-|

Instead of layering one view on top of another (superposition), we can
place them side by side in a row or column (juxtaposition). In
Vega-Lite this is referred to as /concatenation/:

&lt;&lt;images/vl/concatenatedplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zULqiYkIIhADaHUKpxMOA0DW4pXWnSkomgbDE9VQQM6VzQWTY-Dw0AaQzwfHMqSg8AAnmR+BMRLJ4bACG97phiQV0ZjsQdLoTILAWCwcAYEOSDrJ+HDYGIOSSyQ0AI5YUXwDgINj6SAvKqq17vCDIzAgsEHCFrTUZGEiOEIiobKCo4DMrE4vFmaZE0kCqARKliGkqo2nRlI22sqC1Lkcrk8vmSBpCkVilLOyUHGVyhXy5XqjDp1UAXXekAAJBQhNETA0SOQqLQrGF2JweEw2CJqIXi0Yq048BxtLoACxMABWFHEUMgX0ybERaCeDyAA Open this visualization in the Vega Editor&gt;

@
let enc field = encoding
                 . position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]
                 . position Y [ PName field, PmType Quantitative, PAggregate Median ]

    parallaxes = [ mark Bar [], enc \&quot;plx\&quot; [] ]
    magnitudes = [ mark Bar [], enc \&quot;Gmag\&quot; [] ]

    specs = map asSpec [ parallaxes, magnitudes ]

in toVegaLite
      [ gaiaData
      , 'vConcat' specs
      ]
@

The 'hConcat' function would align the two plots horizontally,
rather than vertically (and is used in 'concatenatedSkyPlot').

Note that as the axes are identical apart from the field for the y axis,
the encoding has been moved into a function to enforce this constraint
(this ensures the x axis is the same, which makes it easier to visually
compare the two plots). However, there is no requirement that the
two plots be &quot;compatible&quot; (they could use different data sources).

-}</span><span>
</span><span id="line-2874"></span><span>
</span><span id="line-2875"></span><span>
</span><span id="line-2876"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot"><span class="hs-identifier hs-type">concatenatedPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2877"></span><span id="concatenatedPlot"><span class="annot"><span class="annottext">concatenatedPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot"><span class="hs-identifier hs-var hs-var">concatenatedPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2878"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117946"><span class="annot"><span class="annottext">enc :: Text -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679117945"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117945"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2879"></span><span>                   </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2880"></span><span>                   </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117945"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2881"></span><span>
</span><span id="line-2882"></span><span>      </span><span id="local-6989586621679117944"><span class="annot"><span class="annottext">parallaxes :: [PropertySpec]
</span><a href="#local-6989586621679117944"><span class="hs-identifier hs-var hs-var">parallaxes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2883"></span><span>      </span><span id="local-6989586621679117943"><span class="annot"><span class="annottext">magnitudes :: [PropertySpec]
</span><a href="#local-6989586621679117943"><span class="hs-identifier hs-var hs-var">magnitudes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117946"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2884"></span><span>
</span><span id="line-2885"></span><span>      </span><span id="local-6989586621679117942"><span class="annot"><span class="annottext">specs :: [VLSpec]
</span><a href="#local-6989586621679117942"><span class="hs-identifier hs-var hs-var">specs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117944"><span class="hs-identifier hs-var">parallaxes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117943"><span class="hs-identifier hs-var">magnitudes</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2886"></span><span>
</span><span id="line-2887"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2888"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2889"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="#local-6989586621679117942"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-2890"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2891"></span><span>
</span><span id="line-2892"></span><span>
</span><span id="line-2893"></span><span class="hs-comment">{-|

The alignment of the plots can be adjusted with 'spacing', which we
use here to remove the vertical gap between the two plots (the
example is written so that we can see the only difference between
the two plot specifications is the addition of @'PAxis' []@ to the
parallax plot).

&lt;&lt;images/vl/concatenatedplot2.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zULqiYkIIhADaHUKpxMOA0DW4pXWnSkomgbDE9VQQM6VzQWTY-Dw0AaQzwfHMqSg8AAnmR+BMRLJ4bACCkoLAFmwKIQmng8G97phiQV0ZjsQdLoTILAWCwcAYEOSDrJ+HDYGIhSSyQ0AI5YeXwDgINj6SAvKr617vCDIzAgsEHCFrY0ZGEiOEIiobKCo4C8rE4vFmaZE0lSqARKliGl6m2nblI938qC1EVCkViiWSBoyuUKumQJX+yBqjVazW6w0YIv6gC670gABIKEJoiYGiRyFRaFYwuxODwmGwRNQa3WjK2nHgONpdAAWJgAKwo4ihkAoJSE8MRYF8Fa+mTYK+ATweQA Open this visualization in the Vega Editor&gt;

@
let enc field flag = encoding
                       . position X ([ PName \&quot;Cluster\&quot;, PmType Nominal ] ++
                                     if flag then [ PAxis [] ] else [])
                       . position Y [ PName field, PmType Quantitative, PAggregate Median ]

    parallaxes = [ mark Bar [], enc \&quot;plx\&quot; True [] ]
    magnitudes = [ mark Bar [], enc \&quot;Gmag\&quot; False [] ]

    specs = map asSpec [ parallaxes, magnitudes ]

in toVegaLite
      [ gaiaData
      , 'spacing' 0
      , vConcat specs
      ]
@

Even though we set 'spacing' to @0@ there is still a small gap between
the plots: this can be removed by using @'bounds' 'Flush'@, but we'll
leave using that until the grand finale.

-}</span><span>
</span><span id="line-2928"></span><span>
</span><span id="line-2929"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot2"><span class="hs-identifier hs-type">concatenatedPlot2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-2930"></span><span id="concatenatedPlot2"><span class="annot"><span class="annottext">concatenatedPlot2 :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedPlot2"><span class="hs-identifier hs-var hs-var">concatenatedPlot2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2931"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117940"><span class="annot"><span class="annottext">enc :: Text -&gt; Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117940"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679117939"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117939"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621679117938"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117938"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-2932"></span><span>                         </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-2933"></span><span>                                       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117938"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2934"></span><span>                         </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117939"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2935"></span><span>
</span><span id="line-2936"></span><span>      </span><span id="local-6989586621679117937"><span class="annot"><span class="annottext">parallaxes :: [PropertySpec]
</span><a href="#local-6989586621679117937"><span class="hs-identifier hs-var hs-var">parallaxes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117940"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2937"></span><span>      </span><span id="local-6989586621679117936"><span class="annot"><span class="annottext">magnitudes :: [PropertySpec]
</span><a href="#local-6989586621679117936"><span class="hs-identifier hs-var hs-var">magnitudes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117940"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2938"></span><span>
</span><span id="line-2939"></span><span>      </span><span id="local-6989586621679117935"><span class="annot"><span class="annottext">specs :: [VLSpec]
</span><a href="#local-6989586621679117935"><span class="hs-identifier hs-var hs-var">specs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117937"><span class="hs-identifier hs-var">parallaxes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117936"><span class="hs-identifier hs-var">magnitudes</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2940"></span><span>
</span><span id="line-2941"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-2942"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-2943"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#spacing"><span class="hs-identifier hs-var">spacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2944"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="#local-6989586621679117935"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-2945"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2946"></span><span>
</span><span id="line-2947"></span><span>
</span><span id="line-2948"></span><span class="hs-comment">{-|

In 'skyPlotWithGraticules' I used the 'Mercator' projection to display
the stars on the sky, but promised I would also show you data using the
&lt;https://en.wikipedia.org/wiki/Orthographic_projection_in_cartography Orthographic projection&gt;.

The main specification (that is, the argument of 'toVegaLite') starts
with a change to the plot defaults, using 'configure' to ensure
that no border is drawn around the plot (note that in 'combinedPlot'
I do the same thing, but by setting the stroke color to
@Just \&quot;transparent\&quot;@ rather than @Nothing@). The default data
stream is set up, to ensure we have \&quot;longitude\&quot; and
\&quot;DE_ICRS&quot; values to display. It then has three
versions of the same visualization, varying only on rotation angle and
label, stacked horizontally with 'hConcat'.

Each plot - created with the @rSpec@ helper function - defines
a plot size, uses the 'Orthographic' projection with the
given rotation (the @lambda@ term of 'PrRotate') to change the
center of the display, and then the plot itself is formed from
four layers:

1. 'sphere' is used to indicate the area of the plot covered by the sky
   (filled with a blue variant);

2. graticules are drawn at every 30 degrees (longitude, so 2 hours
   in Right Ascension) and 15 degrees (latitude);

3. the stars are drawn using color to encode the parallax of the
   star and the symbol shape the cluster membership (although the density
   of points is such that it can be hard to make the shapes out);

4. and a label is added at the center of the plot to indicate the
   Right Ascension (the label could be determined automatically from
   the rotation angle, but it was easier to just specify it directly).

Since the data values have two different encodings - 'color' and 'shape' -
there are two legends added. I place them in different locations using
'LOrient': the parallax goes to the right of the plots (which is the
default) and the symbol shapes to the bottom. Both use larger-than-default
font sizes for the text (title and label).

&lt;&lt;images/vl/concatenatedskyplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxQSTJ5k8oAbdRAcwEtoBXAEwFNIAaY8pADG8WkLa140HvkgcpbLADoASgEEA+gEkAwioDKYAHxgAjAA4ADGAD8Yee2XrtewwFowAZgBs1-A8VVTV0DSAEwAF9iAF1+CEgACyEGEWgaInIycigErmZGBLT8T0tLOOzIAHdmDmgEmhKy8PiAB1h0ACsuIWhmBhpgGABPFpkoTDr0RgQWhOYhPih26CkxgjdTACYysB3LaIjywUkhrlh05pIs7IoseFgAawHIVGZaWhpKWnmuACNaNg8XhQaAjMaQRhcdDIBLwUaQQ6XQQOeDPZCzM5jOCAqI3CCIvGkJG3e5PfDXQlQZBwdAPLgAdRqdRoliUAFYjpTINT2nTPtMuEM+MTBDzaVwAPIteBCVhC-Csjkiiig+GySHQ2Hw5UErko57TKTzCRjQbUrgtACyzEQmHSJWBpjZB1xeN1NwpN0gd0enxa6BtaU5Xq4iGSHBtjAGyviyXo53JMYory4tA4ftoAA9hZSKsgRLRTdyhLksOCAG7MWA1ZjUYHDNV0KYI4Nc1XggCObCQvRWvXLQKT8ULkMQ6cTua9mGYoaKS3yhRzk+O8F+qYAYgxoPpmAAvMamAAsrdzMFYhb991EkmzJ7b564m8Q273B+8Q8iSfdXMkvc4RZTNNPgAEQAURcUJ63bT4ux7VgjQHFsk25LVTQ-F4ZyA2QdABc1zjvL1oNkW0sBtUQl2XSAR1DcciWXQRp1nT5fnQaBoHQHACLxKjVw3Lcd33Ggjy4wiH0+IRcOkfCP3iXtCyfF9BPwUx33oz9l2-QkYHQdBaF6FpnkA2jIBwtg8MWBtwRIsiPk07j6CYVh-0MzDjIclh2G4CyiKgWDn3g-seFdQlguyOyIE9CofTJOjJzkeUwCVSjRHyRBxNnM4KLbMFPmkTMg2Q34qFTG1wXYgydS4uQpFRclIHLURAWofACEGWh-k+cx6nrbNlO2esEssCIDiq0Nw0jaNKLyudBiMz52o+KCcuIjibKQyjfycry6rm2QhSWxtID83sEKCkSm0czyANcz5bxBZbfO7fy+2YRDQpud6SE+6Jwm-SLEjyAo50aVsqiZepilKUG2k6bpen6OqfMgCYEimGY5gWetllWdI9mBfY7J404E0IYlIsEaKXPeT4UqEP4ASBe7Do1GE4TO5VqpWNEMVgLFYBxYlwtirTKYnOKxTpRlagh3Z2XO7kaT5dVef25CJclaVZVBFk5eQpGWdQsJcyF+J9Tqw1enEC86vNK0bTtFqHTMZ0Ik+-E73JklfVkf1AyykMw3QCMmEmuK4wd4W4t2qAWizf2uXzUQi3zUsKyrGs6yZ8F6CjE2KiR46Atewc1KorhR1oz2tMY59PmrIH49PSQ11oBSBIPY8ZJBMSfavd54FvLuz2geT+NfITVPot2wvlzarpc1NjLAiD9G8h6jqek7AvW8XDbFyjo5MyTMvO2T1+sxByNPuhy5o0PS5rudIBYtiOMbn9eNbselLMTu1NknuUAJJmSku-LSclHzfzfB+ae5A86yR0npZgBkdo3WwsffCWdPgX3IvAi6HlnKoMXvNBgBCvIHU7JvIub0dSCw9hzUWkctIcASklOKKVGBpVkHTZ8J89br2mmAigRVkAlUQGVdAFVjZVTNqQeqjUuDNUIG1DqsgtjdSgL1XYA0WTDTzpAMaQcJr7zbFwfKC8sJ0A6hQ7Bq1L62VnkaeeRDLGQH2lg2QhcXpvVnqQra11iGyDupZGCVDvFBVoSFS4P04Gcn+rkBcwMoaXDBtLBoySvQwy6D0PoXC5FIxRmjOEGMLLY2kOkLYeNdgjRSScTKLUyYMNJFTD4shab00BGvZmUJWbwn0bIs0PM+YCxCvQ08jCq4UHVlLZkCpdaUXVvyFWQj4jqylDKOUOs2Gnn1j0w2lUOYDIhAgS2Jo0TSDtraEmBAnZOhdHQxp4zmk+wDLXUagdg5RhMVpcOJNJmCEPrHQepdE7WzkSnLgZZPiVmrBGTOITZA5x3lNdeXjTorIoNRMc996LI2rExWQ9dFzX2HJ-Nu49lJ-3-sPMFkBpQIH7sC6lEDyU-xUjAr8ji-zbTkYfZeIRV42M8WE9FeCUJsxxaeQ+plzLXwRVAHBi10JYsrkPR+zFWLsU4kPZufFnztyElS0uEDxIYIxYIFlUCJ4co0vLdiul9IWOMjK0BQqFV2Nwb4y6hDeVoPwf4rplC4LhIRJEt0YyuQTOQiwmg2yuQcLycIDK0kUWHUEfLERYiJFSMpP0mqzwGoMyUa1KiqioCHg0ZALRGx+pQEGno9540Q7fO4oIlxblrEePdaRexyKP7coCa49x8qN7BtFV6shg7jLBILiK7esD1Jumib9GI5RhAMFeF8uRlYuCVHObyMYiAJC0FdmugZ4RIBsFgK0nIbEWjIFwAAekfQgSoSgPIJDYL8MyZxki8OfEoZIWBH3AXQGwRgAAhK9dJH0JAHIweAj67h4Vg-BxDKJH0IeYPANw8AcPeBUrh0wlg3ArH+FwUw8AlC2jcLkeA3BYBKGgMgcsWUXiYDuDNFJ9LRGSooAAcTuFuyAR6sBrhTdxZwArsGKHE+-OlcdiKyb4VpflrgZNiZU9xLgGggUabk5cUKrpdSQAACQQruJ8Qo0B71PsfWh99rBP2-CUH0R9FnENobcN8aQ9nDxKA6MgfoIAIhAA Open this visualization in the Vega Editor (although the link is long, and may not work with Internet Explorer)&gt;

@
let trans = transform
              . calculateAs
                \&quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS\&quot;
                \&quot;longitude\&quot;

    axOpts field = [ PName field, PmType Quantitative ]
    legend ttl o = MLegend [ LTitle ttl
                           , 'LOrient' o
                           , 'LTitleFontSize' 16
                           , 'LLabelFontSize' 14
                           ]
    enc = encoding
            . position Longitude (axOpts \&quot;longitude\&quot;)
            . position Latitude (axOpts \&quot;DE_ICRS\&quot;)
            . color [ MName \&quot;plx\&quot;
                    , MmType Quantitative
                    , MScale [ SType ScLog
                             , SScheme \&quot;viridis\&quot; []
                             ]
                    , legend \&quot;parallax\&quot; 'LORight'
                    ]
            . shape [ MName \&quot;Cluster\&quot;
                    , MmType Nominal
                    , legend \&quot;cluster\&quot; 'LOBottom'
                    ]
            . tooltip [ TName \&quot;Cluster\&quot;, TmType Nominal ]

    stars = asSpec [ enc [], mark Point [] ]
    grats = asSpec [ graticule [ GrStepMinor (30, 15) ]
                   , mark Geoshape [ MStroke \&quot;grey\&quot;
                                   , MStrokeOpacity 0.5
                                   , MStrokeWidth 0.5
                                   ]
                   ]

    lblData r h0 =
      let r0 = -r
          lbl = h0 &lt;&gt; \&quot;h\&quot;
      in dataFromColumns []
         . dataColumn \&quot;x\&quot; (Numbers [ r0 ])
         . dataColumn \&quot;y\&quot; (Numbers [ 0 ])
         . dataColumn \&quot;lbl\&quot; (Strings [ lbl ])

    encLabels = encoding
                . position Longitude (axOpts \&quot;x\&quot;)
                . position Latitude (axOpts \&quot;y\&quot;)
                . text [ TName \&quot;lbl\&quot;, TmType Nominal ]
    labels r h0 = asSpec [ lblData r h0 []
                         , encLabels []
                         , mark Text [ MAlign AlignCenter
                                     , MBaseline AlignTop
                                     , MdY 5
                                     ]
                         ]

    bg = asSpec [ 'sphere', mark Geoshape [ MFill \&quot;aliceblue\&quot; ] ]

    rSpec r h0 = asSpec [ width 300
                        , height 300
                        , projection [ PrType 'Orthographic'
                                     , 'PrRotate' r 0 0
                                     ]
                        , layer [ bg, grats, stars, labels r h0 ]
                        ]

    s1 = rSpec (-120) \&quot;8\&quot;
    s2 = rSpec 0 \&quot;12\&quot;
    s3 = rSpec 120 \&quot;4\&quot;

    setup = configure . configuration (ViewStyle [ ViewNoStroke ])

in toVegaLite [ setup []
              , gaiaData
              , trans []
              , 'hConcat' [ s1, s2, s3 ] ]
@

-}</span><span>
</span><span id="line-3073"></span><span>
</span><span id="line-3074"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedSkyPlot"><span class="hs-identifier hs-type">concatenatedSkyPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3075"></span><span id="concatenatedSkyPlot"><span class="annot"><span class="annottext">concatenatedSkyPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#concatenatedSkyPlot"><span class="hs-identifier hs-var hs-var">concatenatedSkyPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3076"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117933"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117933"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-3077"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span>
</span><span id="line-3078"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.RA_ICRS &gt; 180 ? datum.RA_ICRS - 360 : datum.RA_ICRS&quot;</span></span><span>
</span><span id="line-3079"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span>
</span><span id="line-3080"></span><span>
</span><span id="line-3081"></span><span>      </span><span id="local-6989586621679117932"><span class="annot"><span class="annottext">axOpts :: Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117932"><span class="hs-identifier hs-var hs-var">axOpts</span></a></span></span><span> </span><span id="local-6989586621679117931"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117931"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117931"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3082"></span><span>      </span><span id="local-6989586621679117930"><span class="annot"><span class="annottext">legend :: Text -&gt; LegendOrientation -&gt; MarkChannel
</span><a href="#local-6989586621679117930"><span class="hs-identifier hs-var hs-var">legend</span></a></span></span><span> </span><span id="local-6989586621679117929"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117929"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span id="local-6989586621679117928"><span class="annot"><span class="annottext">LegendOrientation
</span><a href="#local-6989586621679117928"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitle"><span class="hs-identifier hs-var">LTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117929"><span class="hs-identifier hs-var">ttl</span></a></span><span>
</span><span id="line-3083"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LegendOrientation -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOrient"><span class="hs-identifier hs-var">LOrient</span></a></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="#local-6989586621679117928"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-3084"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitleFontSize"><span class="hs-identifier hs-var">LTitleFontSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">16</span></span><span>
</span><span id="line-3085"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LLabelFontSize"><span class="hs-identifier hs-var">LLabelFontSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">14</span></span><span>
</span><span id="line-3086"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-3087"></span><span>      </span><span id="local-6989586621679117924"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117924"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3088"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Longitude"><span class="hs-identifier hs-var">Longitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117932"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;longitude&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3089"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Latitude"><span class="hs-identifier hs-var">Latitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117932"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3090"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-3091"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-3092"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MScale"><span class="hs-identifier hs-var">MScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span>
</span><span id="line-3093"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Double] -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SScheme"><span class="hs-identifier hs-var">SScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;viridis&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3094"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-3095"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendOrientation -&gt; MarkChannel
</span><a href="#local-6989586621679117930"><span class="hs-identifier hs-var">legend</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax&quot;</span></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="Graphics.Vega.VegaLite.Legend.html#LORight"><span class="hs-identifier hs-var">LORight</span></a></span><span>
</span><span id="line-3096"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-3097"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#shape"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-3098"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-3099"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendOrientation -&gt; MarkChannel
</span><a href="#local-6989586621679117930"><span class="hs-identifier hs-var">legend</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cluster&quot;</span></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOBottom"><span class="hs-identifier hs-var">LOBottom</span></a></span><span>
</span><span id="line-3100"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-3101"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#tooltip"><span class="hs-identifier hs-var">tooltip</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3102"></span><span>
</span><span id="line-3103"></span><span>      </span><span id="local-6989586621679117921"><span class="annot"><span class="annottext">stars :: VLSpec
</span><a href="#local-6989586621679117921"><span class="hs-identifier hs-var hs-var">stars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117924"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3104"></span><span>      </span><span id="local-6989586621679117920"><span class="annot"><span class="annottext">grats :: VLSpec
</span><a href="#local-6989586621679117920"><span class="hs-identifier hs-var hs-var">grats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[GraticuleProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#graticule"><span class="hs-identifier hs-var">graticule</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; GraticuleProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#GrStepMinor"><span class="hs-identifier hs-var">GrStepMinor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">15</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3105"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grey&quot;</span></span><span>
</span><span id="line-3106"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeOpacity"><span class="hs-identifier hs-var">MStrokeOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-3107"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-3108"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-3109"></span><span>                     </span><span class="hs-special">]</span><span>
</span><span id="line-3110"></span><span>
</span><span id="line-3111"></span><span>      </span><span class="hs-comment">-- make the user work out what the new central location is</span><span>
</span><span id="line-3112"></span><span>      </span><span id="local-6989586621679117918"><span class="annot"><span class="annottext">lblData :: Double -&gt; Text -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117918"><span class="hs-identifier hs-var hs-var">lblData</span></a></span></span><span> </span><span id="local-6989586621679117917"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117917"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679117916"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117916"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3113"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117915"><span class="annot"><span class="annottext">r0 :: Double
</span><a href="#local-6989586621679117915"><span class="hs-identifier hs-var hs-var">r0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117917"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-3114"></span><span>            </span><span id="local-6989586621679117914"><span class="annot"><span class="annottext">lbl :: Text
</span><a href="#local-6989586621679117914"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117916"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-3115"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromColumns"><span class="hs-identifier hs-var">dataFromColumns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3116"></span><span>           </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec)
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117915"><span class="hs-identifier hs-var">r0</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3117"></span><span>           </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3118"></span><span>           </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lbl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Strings"><span class="hs-identifier hs-var">Strings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117914"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3119"></span><span>
</span><span id="line-3120"></span><span>      </span><span id="local-6989586621679117913"><span class="annot"><span class="annottext">encLabels :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117913"><span class="hs-identifier hs-var hs-var">encLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3121"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Longitude"><span class="hs-identifier hs-var">Longitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117932"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3122"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Latitude"><span class="hs-identifier hs-var">Latitude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117932"><span class="hs-identifier hs-var">axOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3123"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lbl&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3124"></span><span>      </span><span id="local-6989586621679117912"><span class="annot"><span class="annottext">labels :: Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117912"><span class="hs-identifier hs-var hs-var">labels</span></a></span></span><span> </span><span id="local-6989586621679117911"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117911"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679117910"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117910"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="#local-6989586621679117918"><span class="hs-identifier hs-var">lblData</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117911"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117910"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3125"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117913"><span class="hs-identifier hs-var">encLabels</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3126"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MAlign"><span class="hs-identifier hs-var">MAlign</span></a></span><span> </span><span class="annot"><span class="annottext">HAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignCenter"><span class="hs-identifier hs-var">AlignCenter</span></a></span><span>
</span><span id="line-3127"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MBaseline"><span class="hs-identifier hs-var">MBaseline</span></a></span><span> </span><span class="annot"><span class="annottext">VAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignTop"><span class="hs-identifier hs-var">AlignTop</span></a></span><span>
</span><span id="line-3128"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MdY"><span class="hs-identifier hs-var">MdY</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span>
</span><span id="line-3129"></span><span>                                       </span><span class="hs-special">]</span><span>
</span><span id="line-3130"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-3131"></span><span>
</span><span id="line-3132"></span><span>      </span><span id="local-6989586621679117909"><span class="annot"><span class="annottext">bg :: VLSpec
</span><a href="#local-6989586621679117909"><span class="hs-identifier hs-var hs-var">bg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#sphere"><span class="hs-identifier hs-var">sphere</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MFill"><span class="hs-identifier hs-var">MFill</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;aliceblue&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3133"></span><span>
</span><span id="line-3134"></span><span>      </span><span id="local-6989586621679117907"><span class="annot"><span class="annottext">rSpec :: Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117907"><span class="hs-identifier hs-var hs-var">rSpec</span></a></span></span><span> </span><span id="local-6989586621679117906"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117906"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679117905"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117905"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-3135"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-3136"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProjectionProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#projection"><span class="hs-identifier hs-var">projection</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Projection -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrType"><span class="hs-identifier hs-var">PrType</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="Graphics.Vega.VegaLite.Geometry.html#Orthographic"><span class="hs-identifier hs-var">Orthographic</span></a></span><span>
</span><span id="line-3137"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrRotate"><span class="hs-identifier hs-var">PrRotate</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117906"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-3138"></span><span>                                       </span><span class="hs-special">]</span><span>
</span><span id="line-3139"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117909"><span class="hs-identifier hs-var">bg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117920"><span class="hs-identifier hs-var">grats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117921"><span class="hs-identifier hs-var">stars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117912"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117906"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117905"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3140"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-3141"></span><span>
</span><span id="line-3142"></span><span>      </span><span id="local-6989586621679117902"><span class="annot"><span class="annottext">s1 :: VLSpec
</span><a href="#local-6989586621679117902"><span class="hs-identifier hs-var hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117907"><span class="hs-identifier hs-var">rSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">120</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;8&quot;</span></span><span>
</span><span id="line-3143"></span><span>      </span><span id="local-6989586621679117901"><span class="annot"><span class="annottext">s2 :: VLSpec
</span><a href="#local-6989586621679117901"><span class="hs-identifier hs-var hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117907"><span class="hs-identifier hs-var">rSpec</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;12&quot;</span></span><span>
</span><span id="line-3144"></span><span>      </span><span id="local-6989586621679117900"><span class="annot"><span class="annottext">s3 :: VLSpec
</span><a href="#local-6989586621679117900"><span class="hs-identifier hs-var hs-var">s3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Text -&gt; VLSpec
</span><a href="#local-6989586621679117907"><span class="hs-identifier hs-var">rSpec</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">120</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;4&quot;</span></span><span>
</span><span id="line-3145"></span><span>
</span><span id="line-3146"></span><span>      </span><span id="local-6989586621679117899"><span class="annot"><span class="annottext">setup :: [ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117899"><span class="hs-identifier hs-var hs-var">setup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span> </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; BuildConfigureSpecs -&gt; [ConfigureSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ViewConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStyle"><span class="hs-identifier hs-var">ViewStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ViewConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewNoStroke"><span class="hs-identifier hs-var">ViewNoStroke</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3147"></span><span>
</span><span id="line-3148"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117899"><span class="hs-identifier hs-var">setup</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3149"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-3150"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117933"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3151"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#hConcat"><span class="hs-identifier hs-var">hConcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117902"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117901"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117900"><span class="hs-identifier hs-var">s3</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3152"></span><span>
</span><span id="line-3153"></span><span>
</span><span id="line-3154"></span><span class="hs-comment">-- $intro-repeat</span><span>
</span><span id="line-3155"></span><span class="hs-comment">-- Creating the same plot but with a different field is common-enough</span><span>
</span><span id="line-3156"></span><span class="hs-comment">-- that Vega-Lite provides the 'repeat' operator.</span><span>
</span><span id="line-3157"></span><span>
</span><span id="line-3158"></span><span>
</span><span id="line-3159"></span><span class="hs-comment">{-|

The 'concatenatedPlot' example can be extended to view the
distribution of several fields - in this case Right Ascension,
Declination, parallax, and magnitude:

&lt;&lt;images/vl/repeatplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmAOsCGAXSAuMwYHsDuGYA2pAEoCCA+gJIDCpAypADRQAiAojfU65PABsAHiygBxALZIA5pAC6AX2bgoAZ0QBjQqAgRIU6AGtCkAEZJoLFXoAmqJNuu7IAV2gCTACxQp4q9AD0AdBIeAB00gCWKJ4upi6qsNAaOAB2KLDpYSkSAWw4LtIAQm6GsAGeAG6w0kgBUqoZ0BXVtQF2KHW1kUgAtEh9AGwAjIP9wwAMvZ2mArDDSGGpOL2eyDZJYSiqlVa6zgBmONBSaJg6+87wFomOl5eQkjImqS4Spkl7984U3Iwvbw+lmU3yuwgB70+INB7C4dH+mEgr0hwKc90gsEoghEiORQMgaN0CkJxP2SicGNSKRskVSsnOhMgOKwkAOkVgAhsJloAgSTVEkBQAE9EC8cBJaUgPOT0UK7t9WezOdoYAhkGcoNB8JAZQqZNI4LUMiYJLAaUhUl90cLRYiAI4uC0oaKoSLVAn3UlElS6yAAElUGjWUi8Pj8gQCrUWURicTCkRwAUDwbqUd6Ami5UqABYwgArVRpL6QFKpNn0rDEhRAA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
           . position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]
           . position Y [ 'PRepeat' 'Row', PmType Quantitative, PAggregate Median ]

    spec = asSpec [ gaiaData
                  , mark Bar []
                  , enc [] ]

    rows = [ \&quot;RA_ICRS\&quot;, \&quot;DE_ICRS\&quot;, \&quot;plx\&quot;, \&quot;Gmag\&quot; ]

in toVegaLite
      [ 'repeat' [ 'RowFields' rows ]
      , 'specification' spec
      ]
@


This more compact specification replaces the data field name
(for example @'PName' \&quot;plx\&quot;@) with a reference to the repeating field
('PRepeat') either as a 'Row' or 'Column' depending on the desired
layout. We then compose the specifications by providing a set of
'RowFields' (or 'ColumnFields') containing a list of the fields to which
we wish to apply the specification (identified with the function
'specification' which should follow the repeat function provided to
toVegaLite).

-}</span><span>
</span><span id="line-3197"></span><span>
</span><span id="line-3198"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#repeatPlot"><span class="hs-identifier hs-type">repeatPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3199"></span><span id="repeatPlot"><span class="annot"><span class="annottext">repeatPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#repeatPlot"><span class="hs-identifier hs-var hs-var">repeatPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3200"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117897"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117897"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3201"></span><span>             </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3202"></span><span>             </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Row"><span class="hs-identifier hs-var">Row</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3203"></span><span>
</span><span id="line-3204"></span><span>      </span><span id="local-6989586621679117894"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679117894"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-3205"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3206"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117897"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3207"></span><span>
</span><span id="line-3208"></span><span>      </span><span id="local-6989586621679117893"><span class="annot"><span class="annottext">rows :: [Text]
</span><a href="#local-6989586621679117893"><span class="hs-identifier hs-var hs-var">rows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3209"></span><span>
</span><span id="line-3210"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-3211"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#RowFields"><span class="hs-identifier hs-var">RowFields</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679117893"><span class="hs-identifier hs-var">rows</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3212"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117894"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-3213"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-3214"></span><span>
</span><span id="line-3215"></span><span>
</span><span id="line-3216"></span><span class="hs-comment">{-|

If we want to plot more than one map from the same table of data
we need to do the lookup in the other order, using lookup to add the
geographic data to the data table. Charting this way requires
specifiying a few things differently than in the previous
choropleth example ('choroplethLookupToGeo'):

  * We're using 'LuAs' in 'lookup', rather than 'LuFields', which lets
    us use all the fields (columns) in the source rather than a specified
    subset.
  * We use a different set of geographic features (state rather than county
    outlines) from @usGeoData@.
  * The plot is defined as a 'specification', but does not directly refer
    to the value being displayed. This is set \&quot;externally\&quot; with the
    call to 'repeat'. Since we have just had an example with
    'RowFields', this time we use 'ColumnFields' to stack the maps
    horizontally.
  * Since the different fields have vastly-different ranges (a maximum of
    roughly 0.01 for \&quot;engineers\&quot; whereas the \&quot;population\&quot; field is
    a billion times larger), the color scaling is set to vary per field
    with 'resolve'.

&lt;&lt;images/vl/choroplethlookupfromgeo.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmDOB7ANgN1pAXGYl4GMBDZDbXfFRaLKASwDsATWAB1ifYBdIBfHgGnBQ4bQtzKQKyAK4BbejQDakFohbTkY2ogX8o7AOYNYsaPEh7IAC2nRotIvQSQAugKF42+GqAgRInNCE9PAAZlSySkJ+ONExUITm2JAGsIgWcTGQodCIkWSZ8ZCMYoQ+hfFQtsg01pycLPCYAPTNQQDuAHRGnDYARtLwphT0nFydFLLN6AaE07CzzbKJY9DNjIj48OulzYMAtACMAAyynQBWSLoVReHQy+I42bBitqRQ8JxizpacAJ5sWqcNSIS46Xg3CDuSpZADWsD+tVojEgN2hMMgyEQiFh0hYSJRhR4cRcgiyy2gsJ8eECOPekD6mnwVMsn1y8IA8ixCPhaP8aMdOgAmX4A+mpRDwKyEQHo-wlL7lSqQaq1Kz1RotNqELo9fqDYY6MajCZ5eaLGZzZafUzrTbbBVzVTqTScbT0AD6hmMpngHpsdgcwQQE3gqFRMTlUHayN6NAAzMdjmS-CpcudYPg3eCJP9AcliH1fQBVeBlKOQdgURgMAxKopSKj15WhWiwZAoiQiF6PSQoOQKKNZPP0gCO0mCbq+bvQGRhUBIqSY1KobdGQLUFigBiCNa4ABlDHHsInjsTKkOPtL809W+3O9u0luAmLahKwYO4uewOjIAASAgrFgZY1Q1JpWktbo+X6TptGaQDgLmS19mQPlYGmAAWC4rjnKARlbOsyGJHggA Open this visualization in the Vega Editor&gt;

@
let popEngHurrData = dataFromUrl \&quot;https:\/\/raw.githubusercontent.com\/vega\/vega\/master\/docs\/data\/population_engineers_hurricanes.csv\&quot; []

    plotWidth = 300

    viz = [ popEngHurrData
          , width plotWidth
          , transform
            . lookup \&quot;id\&quot; (usGeoData \&quot;states\&quot;) \&quot;id\&quot; ('LuAs' \&quot;geo\&quot;)
            $ []
          , projection [PrType AlbersUsa]
          , encoding
            . shape [MName \&quot;geo\&quot;, MmType GeoFeature]
            . color [MRepeat 'Column', MmType Quantitative, MLegend [LOrient 'LOTop', 'LGradientLength' plotWidth]]
            $ []
          , mark Geoshape [MStroke \&quot;black\&quot;, MStrokeOpacity 0.2]
          ]

in toVegaLite
   [ specification $ asSpec viz
   , resolve
     . resolution (RScale [(ChColor, Independent)])
     $ []
   , repeat ['ColumnFields' [\&quot;population\&quot;, \&quot;engineers\&quot;, \&quot;hurricanes\&quot;]]
   ]
@

By moving the legend to the top of each visualization, I have taken
advantage of the fixed with (here 300 pixels) to ensure the
color bar uses the full width (with 'LGradientLength').

-}</span><span>
</span><span id="line-3275"></span><span>
</span><span id="line-3276"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupFromGeo"><span class="hs-identifier hs-type">choroplethLookupFromGeo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3277"></span><span id="choroplethLookupFromGeo"><span class="annot"><span class="annottext">choroplethLookupFromGeo :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#choroplethLookupFromGeo"><span class="hs-identifier hs-var hs-var">choroplethLookupFromGeo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3278"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117890"><span class="annot"><span class="annottext">popEngHurrData :: PropertySpec
</span><a href="#local-6989586621679117890"><span class="hs-identifier hs-var hs-var">popEngHurrData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Format] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromUrl"><span class="hs-identifier hs-var">dataFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://raw.githubusercontent.com/vega/vega/master/docs/data/population_engineers_hurricanes.csv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3279"></span><span>
</span><span id="line-3280"></span><span>      </span><span id="local-6989586621679117889"><span class="annot"><span class="annottext">plotWidth :: Double
</span><a href="#local-6989586621679117889"><span class="hs-identifier hs-var hs-var">plotWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-3281"></span><span>
</span><span id="line-3282"></span><span>      </span><span id="local-6989586621679117888"><span class="annot"><span class="annottext">viz :: [PropertySpec]
</span><a href="#local-6989586621679117888"><span class="hs-identifier hs-var hs-var">viz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117890"><span class="hs-identifier hs-var">popEngHurrData</span></a></span><span>
</span><span id="line-3283"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117889"><span class="hs-identifier hs-var">plotWidth</span></a></span><span>
</span><span id="line-3284"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-3285"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; PropertySpec
-&gt; Text
-&gt; LookupFields
-&gt; [TransformSpec]
-&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#usGeoData"><span class="hs-identifier hs-var">usGeoData</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;states&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; LookupFields
</span><a href="Graphics.Vega.VegaLite.Core.html#LuAs"><span class="hs-identifier hs-var">LuAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;geo&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3286"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; [TransformSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3287"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProjectionProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Geometry.html#projection"><span class="hs-identifier hs-var">projection</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Projection -&gt; ProjectionProperty
</span><a href="Graphics.Vega.VegaLite.Geometry.html#PrType"><span class="hs-identifier hs-var">PrType</span></a></span><span> </span><span class="annot"><span class="annottext">Projection
</span><a href="Graphics.Vega.VegaLite.Geometry.html#AlbersUsa"><span class="hs-identifier hs-var">AlbersUsa</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3288"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3289"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#shape"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;geo&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#GeoFeature"><span class="hs-identifier hs-var">GeoFeature</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3290"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arrangement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MRepeat"><span class="hs-identifier hs-var">MRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Column"><span class="hs-identifier hs-var">Column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LegendOrientation -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOrient"><span class="hs-identifier hs-var">LOrient</span></a></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOTop"><span class="hs-identifier hs-var">LOTop</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LGradientLength"><span class="hs-identifier hs-var">LGradientLength</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117889"><span class="hs-identifier hs-var">plotWidth</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-3291"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3292"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Geoshape"><span class="hs-identifier hs-var">Geoshape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeOpacity"><span class="hs-identifier hs-var">MStrokeOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">]</span><span>
</span><span id="line-3293"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3294"></span><span>
</span><span id="line-3295"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-3296"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">(VLSpec -&gt; PropertySpec) -&gt; VLSpec -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117888"><span class="hs-identifier hs-var">viz</span></a></span><span>
</span><span id="line-3297"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ResolveSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#resolve"><span class="hs-identifier hs-var">resolve</span></a></span><span>
</span><span id="line-3298"></span><span>       </span><span class="annot"><span class="annottext">([ResolveSpec] -&gt; PropertySpec)
-&gt; ([ResolveSpec] -&gt; [ResolveSpec])
-&gt; [ResolveSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Resolve -&gt; [ResolveSpec] -&gt; [ResolveSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#resolution"><span class="hs-identifier hs-var">resolution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Channel, Resolution)] -&gt; Resolve
</span><a href="Graphics.Vega.VegaLite.Foundation.html#RScale"><span class="hs-identifier hs-var">RScale</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChColor"><span class="hs-identifier hs-var">ChColor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Resolution
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Independent"><span class="hs-identifier hs-var">Independent</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3299"></span><span>       </span><span class="annot"><span class="annottext">([ResolveSpec] -&gt; PropertySpec) -&gt; [ResolveSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3300"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ColumnFields"><span class="hs-identifier hs-var">ColumnFields</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;population&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;engineers&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hurricanes&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-3301"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-3302"></span><span>
</span><span id="line-3303"></span><span>
</span><span id="line-3304"></span><span class="hs-comment">{-|

We can combine repeated rows and columns to create a grid of
views, such as a scatterplot matrix, adding in color
encoding to separate out the clusters:

&lt;&lt;images/vl/splomplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmAOsCGAXSAuMoIRgewHcMwBtSAJQEEB9ASQGFyBlSAGigBEBROxl9yPAA2ADzZQA4gFskAc0gBdVuByQAxniEBXKQDtiZKr2bjI3Y-yjCxA6XMUqAvstwBnRGuLZVM6AGsvSFcASwAvWGIAVgEUAE9EYkE8YN00ZxVcABNUJC8M1S1oIUSACxQUeFd0AHpq6CQCADpZYJQSrQAjLVdYaA1U2FTGjSlqjjwtWQAhQr9YapKAN1hZJGqZVxReheXV6uyUNdXgpABaJDOANgBGS-PrgAZTw46hWGukRt08U5LkTN6jRQrkWbHyuAAZnhoDI0JhvDhVPAkNAenlERjJDJ5JhILodB1emDMYiKDQGCZcfipIToMSSbhrIlqbT6QyzDwKSwqQSiS4GVBYNQmTyaUTwThHBKpYj0qTBhpMikcVgJepNNDAhDgrAhJlEvRtJs+VA4gkqXgpCkkMU5RjIGJ4ZBtbr9U64IhUIkNNo9JBnKb4hFcQBHLRIVKtVDBZb+-mk2JanV6wIe5BwqDQQhxwPmqBhiMoKNF2MyyVOfmQAAkrjUfxkpXKlRq1V2nxabU6jWCeGqtfrazbpyErXmiwALI0AFauPD6Sv9bUq4BSxxAA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PRepeat Column, PmType Quantitative ]
            . position Y [ PRepeat Row, PmType Quantitative ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    spec = asSpec [ gaiaData
                  , mark Point [ MSize 5 ]
                  , enc [] ]

    fields = [ \&quot;RA_ICRS\&quot;, \&quot;DE_ICRS\&quot;, \&quot;plx\&quot;, \&quot;Gmag\&quot; ]

in toVegaLite
      [ repeat [ RowFields fields, ColumnFields fields ]
      , specification spec
      ]
@

To be honest, this is not the best dataset to use here, as
there is no direct correlation between location (the @RA_ICRS@
and @DE_ICRS@ fields) and the other columns, but it's the
dataset I chose, so we are stuck with it.

Once you have sub-plots as a specification, you can combine
them horizontally and vertically to make a dashboard style
visualization. Interested parties should check out the
&lt;https://github.com/gicentre/elm-vegalite/tree/master/docs/walkthrough#building-a-dashboard-1240 Building a Dashboard&gt; section of the
Elm Vega-Lite Walkthrough for more details.

-}</span><span>
</span><span id="line-3344"></span><span>
</span><span id="line-3345"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#splomPlot"><span class="hs-identifier hs-type">splomPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3346"></span><span id="splomPlot"><span class="annot"><span class="annottext">splomPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#splomPlot"><span class="hs-identifier hs-var hs-var">splomPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117875"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117875"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3348"></span><span>             </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Column"><span class="hs-identifier hs-var">Column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3349"></span><span>             </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Row"><span class="hs-identifier hs-var">Row</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3350"></span><span>             </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3351"></span><span>
</span><span id="line-3352"></span><span>      </span><span id="local-6989586621679117874"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679117874"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-3353"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3354"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117875"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3355"></span><span>
</span><span id="line-3356"></span><span>      </span><span id="local-6989586621679117873"><span class="annot"><span class="annottext">fields :: [Text]
</span><a href="#local-6989586621679117873"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3357"></span><span>
</span><span id="line-3358"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-3359"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#RowFields"><span class="hs-identifier hs-var">RowFields</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679117873"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ColumnFields"><span class="hs-identifier hs-var">ColumnFields</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679117873"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3360"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117874"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-3361"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-3362"></span><span>
</span><span id="line-3363"></span><span>
</span><span id="line-3364"></span><span class="hs-comment">-- $intro-interactivity</span><span>
</span><span id="line-3365"></span><span class="hs-comment">-- Interaction is enabled by creating /selections/ that may be combined with</span><span>
</span><span id="line-3366"></span><span class="hs-comment">-- the kinds of specifications already described. Selections involve three</span><span>
</span><span id="line-3367"></span><span class="hs-comment">-- components:</span><span>
</span><span id="line-3368"></span><span class="hs-comment">--</span><span>
</span><span id="line-3369"></span><span class="hs-comment">--  * __Events__ are those actions that trigger the interaction such as</span><span>
</span><span id="line-3370"></span><span class="hs-comment">--    clicking at a location on screen or pressing a key.</span><span>
</span><span id="line-3371"></span><span class="hs-comment">--</span><span>
</span><span id="line-3372"></span><span class="hs-comment">--  * __Points of interest__ are the elements of the visualization with</span><span>
</span><span id="line-3373"></span><span class="hs-comment">--    which the interaction occurs, such as the set of points selected</span><span>
</span><span id="line-3374"></span><span class="hs-comment">--    on a scatterplot.</span><span>
</span><span id="line-3375"></span><span class="hs-comment">--</span><span>
</span><span id="line-3376"></span><span class="hs-comment">--  * __Predicates__ (i.e. Boolean functions) identify whether or not</span><span>
</span><span id="line-3377"></span><span class="hs-comment">--    something is included in the selection. These need not be limited</span><span>
</span><span id="line-3378"></span><span class="hs-comment">--    to only those parts of the visualization directly selected through</span><span>
</span><span id="line-3379"></span><span class="hs-comment">--    interaction.</span><span>
</span><span id="line-3380"></span><span>
</span><span id="line-3381"></span><span class="hs-comment">{-|

The next several plots show different types of selection -
select a single point, a range of plots, or follow the mouse - and
all have the same basic structure. To avoid repetition, and mistakes,
I am going to introduce a helper function which creates the
plot structure but without the selection definition, and then
use that to build up the plots.

The helper function, 'selectionProperties', takes two arguments, which are
the selection name and the plot title. The selection name is used
to identify the selection, as a visualization can support multiple
selections, and the plot title has been added mainly to show some
minor customization (the use of 'TOrient' to move the title to the
bottom).

The definition of this helper function is:

@
selectionProps selName label =
  let posOpts field = [ PName field
                      , PmType Quantitative
                      , PScale [ 'SZero' False ]
                      ]

      enc = encoding
               . position X (posOpts \&quot;Gmag\&quot;)
               . position Y (posOpts \&quot;plx\&quot;)

               . color [ 'MSelectionCondition' ('SelectionName' selName)
                           [ MName \&quot;Cluster\&quot;, MmType Nominal ]
                           [ 'MString' &quot;grey&quot; ]
                       ]

               . 'opacity' [ MSelectionCondition (SelectionName selName)
                            [ 'MNumber' 1.0 ]
                            [ MNumber 0.3 ]
                         ]

               . 'size' [ MSelectionCondition (SelectionName selName)
                            [ MNumber 40 ]
                            [ MNumber 5 ]
                         ]

      trans = transform
                 . 'filter' ('FExpr' \&quot;datum.DE_ICRS &lt; -20\&quot;)

  in [ gaiaData
     , trans []
     , mark Point []
     , enc []
     , title label [ TOrient SBottom ]
     ]
@

The three non-selection-related features added here are that
'SZero' is used to tell Vega Lite that we do not need 0 displayed
on either axis, which leads to a \&quot;tight\&quot; bounding box around
the data, a 'filter' is used to select a subset of rows, namely
only those with a declination less than -20 (via 'FExpr'),
and the plot title is moved to the bottom with 'TOrient'.

The main change is that the selection is used in the encoding section,
identified by name, using 'SelectionName' and the supplied
argument. It is used as a filter for the encoding section, where
'MSelectionCondition' defines the properties to use
when the selection occurs (the first list of properties)
and when it does not (the second list). This is used for
three different encodings:

 - 'color', where the selected star is labelled by its
   cluster color, and all the other are grey;

 - 'opacity', so that the selected star is fully opaque
   whereas un-selected stars are partially transparent;

 - and 'size', so that the selected star is much bigger
   than the others.

When no selection has been made - such as when the visualization
is first created - then all points are encoded with the
\&quot;selected\&quot; case (so colorful, fully opaque, and large in this
case).

-}</span><span>
</span><span id="line-3466"></span><span>
</span><span id="line-3467"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-type">selectionProperties</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3468"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-3469"></span><span>  </span><span class="hs-comment">-- ^ The selection name</span><span>
</span><span id="line-3470"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-3471"></span><span>  </span><span class="hs-comment">-- ^ The title for the plot</span><span>
</span><span id="line-3472"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#PropertySpec"><span class="hs-identifier hs-type">PropertySpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3473"></span><span id="selectionProperties"><span class="annot"><span class="annottext">selectionProperties :: Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var hs-var">selectionProperties</span></a></span></span><span> </span><span id="local-6989586621679117872"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117872"><span class="hs-identifier hs-var">selName</span></a></span></span><span> </span><span id="local-6989586621679117871"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117871"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3474"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117870"><span class="annot"><span class="annottext">posOpts :: Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117870"><span class="hs-identifier hs-var hs-var">posOpts</span></a></span></span><span> </span><span id="local-6989586621679117869"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117869"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117869"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-3475"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-3476"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3477"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-3478"></span><span>
</span><span id="line-3479"></span><span>      </span><span id="local-6989586621679117867"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117867"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3480"></span><span>               </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117870"><span class="hs-identifier hs-var">posOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3481"></span><span>               </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117870"><span class="hs-identifier hs-var">posOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3482"></span><span>
</span><span id="line-3483"></span><span>               </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117872"><span class="hs-identifier hs-var">selName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3484"></span><span>                           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3485"></span><span>                           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MString"><span class="hs-identifier hs-var">MString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grey&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3486"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-3487"></span><span>
</span><span id="line-3488"></span><span>               </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#opacity"><span class="hs-identifier hs-var">opacity</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117872"><span class="hs-identifier hs-var">selName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3489"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3490"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.3</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3491"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-3492"></span><span>
</span><span id="line-3493"></span><span>               </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117872"><span class="hs-identifier hs-var">selName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3494"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">40</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3495"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3496"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-3497"></span><span>
</span><span id="line-3498"></span><span>      </span><span id="local-6989586621679117860"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117860"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-3499"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FExpr"><span class="hs-identifier hs-var">FExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.DE_ICRS &lt; -20&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3500"></span><span>
</span><span id="line-3501"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-3502"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117860"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3503"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3504"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117867"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3505"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117871"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Side -&gt; TitleConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#TOrient"><span class="hs-identifier hs-var">TOrient</span></a></span><span> </span><span class="annot"><span class="annottext">Side
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SBottom"><span class="hs-identifier hs-var">SBottom</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3506"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-3507"></span><span>
</span><span id="line-3508"></span><span>
</span><span id="line-3509"></span><span class="hs-comment">{-|

The actual plot just requires the selection information to be
defined and then added to the plot properties:

&lt;&lt;images/vl/singleselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxB2QykOIFehy6AATwMVH0yBMwVGSkUBOl0D1+GI1H+ZlRIiokugYHgYCMJjMqigmFIyUtUEi6A86BwBo0CMQCXoOqOewS5EwEeOkGK8HIzE1qOCsCoqrhcYSiDD0tFpqxezINuVqIESeqXyLlglVClMv0BgVSqzJxg6pTUCmWBMicgRbxDkDce1AC8u8QE0muwBWV2QHN5xum+OJ5N0PlyBd1hsF34tqjKxQjvboAzwOJhTOr6cb-ByNgAZgXS7CK7AU-XXe6O5t9fzWVUWbRUj31MEoBRT8SA9cgyzOC5zCgElE0nSAJ1gdA6FQRNYgNKA1Q1fQAEdmCQI0mFIUolAgyAb2gks4KbAEkPFOJULlDCsPwHDyDwhdCK7SBSPIsJKOoodT0XRIyEuU0cUUIA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;picked&quot;
    sel = 'selection'
            . 'select' selLabel 'Single' []

in toVegaLite (sel [] : 'selectionProperties' selLabel &quot;Select a point&quot;)
@

The 'selection' function is used to define the selection, via one or
more applications of the 'select' function. The form of 'select' is
that the selection is named, in this case we use @\&quot;picked\&quot;@, and the
type is given (a 'Single' click), and then options, which in our case
there aren't any, so an empty list is used.

Note that @hvega@ does not track the selection names, and will allow
you to use a name that you have not defined.

-}</span><span>
</span><span id="line-3536"></span><span>
</span><span id="line-3537"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#singleSelection"><span class="hs-identifier hs-type">singleSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3538"></span><span id="singleSelection"><span class="annot"><span class="annottext">singleSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#singleSelection"><span class="hs-identifier hs-var hs-var">singleSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3539"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117855"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117855"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span>
</span><span id="line-3540"></span><span>
</span><span id="line-3541"></span><span>      </span><span id="local-6989586621679117854"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117854"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3542"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117855"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3543"></span><span>
</span><span id="line-3544"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117854"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117855"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select a point&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3545"></span><span>
</span><span id="line-3546"></span><span>
</span><span id="line-3547"></span><span class="hs-comment">{-|

The only change here is to add a property to the selection - that
is @'Nearest' True@ - which means that the nearest point to the
click will be highlighted.

&lt;&lt;images/vl/nearestselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxB2QykOIFehyxBzWBUap0ODMKiqKDQACeBio+mQJmCoyUigJ0uglvwxGo-zMqJEVEl0DAqu0Gs9RhMZj1kEwpGSLqgkXQHnQOGtGgRiAS9HNRz2CXImFTx0gxXg5B1+mC6oNcOzCUQyeloodWL2ZHdytRAnz1S+tcsEqoUpl+gMCqVpZOMCNJtRUywJjzkFreIccezZoAXqOwMRc-mVwBWIPlys9h05vMF-B8uRBzvd6u-ftUZWKed7dAGeBxMIlg-r49gORsADMO8SPcrzXI8V26c93S7KtZVRPtFVvK0wSgFFVxIUNyEbM4LnMKASTzFdiGXWB0DoVA81ia19RHfQAEdmCQW0mFIUolCQyB31Q+sMN7AEcPFOJ8LlIiSPwMjyAooNDWNWj6NMMImJY2cH0gcsyEuB0cUUIA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;picked&quot;
    sel = selection
            . select selLabel Single [ 'Nearest' True ]

in toVegaLite (sel [] : selectionProperties selLabel &quot;Select nearest point&quot;)
@

One consequence of this change is that once a point has been selected you
can not remove this (i.e. un-select the point). This is in contrast to
'singleSelection', where clicking on an area with no stars would remove the
previous selection. The 'Clear' property can be added to the list
to define a way to clear the selection.

-}</span><span>
</span><span id="line-3572"></span><span>
</span><span id="line-3573"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#nearestSelection"><span class="hs-identifier hs-type">nearestSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3574"></span><span id="nearestSelection"><span class="annot"><span class="annottext">nearestSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#nearestSelection"><span class="hs-identifier hs-var hs-var">nearestSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3575"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117850"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117850"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span>
</span><span id="line-3576"></span><span>
</span><span id="line-3577"></span><span>      </span><span id="local-6989586621679117849"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117849"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3578"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117850"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Nearest"><span class="hs-identifier hs-var">Nearest</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3579"></span><span>
</span><span id="line-3580"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117849"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117850"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select nearest point&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3581"></span><span>
</span><span id="line-3582"></span><span>
</span><span id="line-3583"></span><span class="hs-comment">{-|

The selection can easily be changed to allow multiple stars
to be selected, using shift-click, by swapping from 'Single' to 'Multi'.

&lt;&lt;images/vl/multiselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxB2GCuUjIMCKsCCmLQMDwMDkeC3Fz4YjQACeBio+iwzEopCUigJ0ugozl1H+ZlRIgVqA1cW5cR0YGg6DAEqoUrARhMy3MUEwpGSrqgkXQHnQOFtGgRiAS9BMlwNu0gCXImCOJ0gxXg5GYZtRwVgVCNcOOBcS2elorzPygZCo5Ho+gEleqXyxe2DUpl+nCKpVauqmu1up7jdLxtNVxTJgrkBHeIcaabyFIAC9q2B7KXy5XTwBWMF7BKIVsTg1litVuh8uSqKBjtuy1FTkqM7qvOOp6kouJ3pA6AGPAcRhA2HYXm+p5yGwADMd6WA+T7tmer5XnQ3TfuKPYhn+k4KkBSqzhqWpgUuu74vmKL4d2vb6Oc8CXCRJIVqexAnrA6B0KgFaxLaUCrqekAAI7MEg9pMKQpRKFBiFsbGHGosiUbinE-FykJIn4GJ5ASSR0n6PJilhMpqm7vuUAPmQuZnjiihAA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;this is just a label&quot;
    sel = selection
            . select selLabel 'Multi' []

in toVegaLite (sel [] : selectionProperties selLabel &quot;Shift click to select points&quot;)
@

-}</span><span>
</span><span id="line-3601"></span><span>
</span><span id="line-3602"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#multiSelection"><span class="hs-identifier hs-type">multiSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3603"></span><span id="multiSelection"><span class="annot"><span class="annottext">multiSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#multiSelection"><span class="hs-identifier hs-var hs-var">multiSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3604"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117847"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117847"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;this is just a label&quot;</span></span><span>
</span><span id="line-3605"></span><span>
</span><span id="line-3606"></span><span>      </span><span id="local-6989586621679117846"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117846"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3607"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117847"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Multi"><span class="hs-identifier hs-var">Multi</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3608"></span><span>
</span><span id="line-3609"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117846"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117847"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Shift click to select points&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3610"></span><span>
</span><span id="line-3611"></span><span>
</span><span id="line-3612"></span><span class="hs-comment">{-|

We can take advantage of browser event by using 'On' to define which
event to use, such as mouse movement over points:

&lt;&lt;images/vl/eventselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxB2QykOIFehy6AATwMVH0WGYlFI5igotRWCysXQpVoikUBOl0FGKqo-zMqIAsmaqGBwu6jCYah70GAJVQpWB4GBvaZ9ZBMKRkk6oJF0B50DgrRoEYgEvQTJd8PY9glyJgjidIMV4ORmJrUcFYFRVXDjpAEogs9LDWA8+CyFRyMrUQIK9Uvli9oGpTL9AYFUqGyW1RqrsmTOXICO8Q5U43kKQAF5Vjul8uVugAVlUUGbrYnucPFf3fLk5-FPaDbdlqKniqoystYINBngOIwnrG8yzvOg5DYABmJ9LzCa8DzA498G6J8xzfSdp2-JRNz2FED27Xt9HOeBLjQuJy33Yg91gdA6FQctYitKB533SAAEdmCQG0mFIUolD-SAQIImMiI-AFIxJSi5Rouj8AY8gmKfVj9E47iwl4-j11wptEjIHMOxxRQgA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;picked&quot;
    sel = selection
            . select selLabel Multi [ 'On' &quot;mouseover&quot; ]

in toVegaLite (sel [] : selectionProperties selLabel &quot;Move the pointer to select a point&quot;)
@

The supported list of events is described in the
&lt;https://vega.github.io/vega/docs/event-streams/#selector Vega Event-Stream Selectors&gt; documentation.

The addition of @Nearest True@ to the list of properties
sent to 'select' would avoid the flickering, as the mouse moves
between the stars.

-}</span><span>
</span><span id="line-3637"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#eventSelection"><span class="hs-identifier hs-type">eventSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3638"></span><span id="eventSelection"><span class="annot"><span class="annottext">eventSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#eventSelection"><span class="hs-identifier hs-var hs-var">eventSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3639"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117844"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117844"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span>
</span><span id="line-3640"></span><span>
</span><span id="line-3641"></span><span>      </span><span id="local-6989586621679117843"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117843"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3642"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117844"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Multi"><span class="hs-identifier hs-var">Multi</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#On"><span class="hs-identifier hs-var">On</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mouseover&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3643"></span><span>
</span><span id="line-3644"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117843"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117844"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Move the pointer to select a point&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3645"></span><span>
</span><span id="line-3646"></span><span>
</span><span id="line-3647"></span><span class="hs-comment">{-|

The final 'Selection' value is 'Interval',
which lets you drag a rectangle to select the interior points:

&lt;&lt;images/vl/intervalselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxB2NHwLAmYJgUjIMCubT0OXQACeBio+hMNWK8BcikUBOl0FG2qo-zMqI4CGV8DAsCoUqQwVGYGg6DAEo90DARiNyHMUEwpGSDqgkXQHnQOAtGgRiAS9CVRz2CXImGzx0gJvIzANqOC7p1cMLCUQmelovw9nhZCo5C1qIEJeqXyxe0DUplVwVSpVao1sC1YJOMD1ZagU0ViFNkD7eIcKcLyFIAC9583C8XS3QAKzTyy1+tDptF03H-B8uSqKADhuy1HLpfK1XqzVKXHTpA6AGPAcRhFWTZ9reJbznIbAAMznlAl5hNeYDEEe87dM+4ptkGaHyl+Y6-pO-7HJuewouhJDRu2+jnPAlw4SSpr7pAe6wOgdCoKasQWlAur6voACOzBIFaTCkKUSiARB1GtnRqLIhG4pxKxcocVx+A8eQfE4YJ86QKJ4lhJJ0nrhRkC1mQlxNjiihAA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;naming is hard&quot;
    sel = selection
            . select selLabel 'Interval' [ ]

in toVegaLite (sel [] : selectionProperties selLabel &quot;Drag a rectangle to select points&quot;)
@

-}</span><span>
</span><span id="line-3665"></span><span>
</span><span id="line-3666"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelection"><span class="hs-identifier hs-type">intervalSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3667"></span><span id="intervalSelection"><span class="annot"><span class="annottext">intervalSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelection"><span class="hs-identifier hs-var hs-var">intervalSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3668"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117841"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;naming is hard&quot;</span></span><span>
</span><span id="line-3669"></span><span>
</span><span id="line-3670"></span><span>      </span><span id="local-6989586621679117840"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117840"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3671"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3672"></span><span>
</span><span id="line-3673"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117840"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117841"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Drag a rectangle to select points&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3674"></span><span>
</span><span id="line-3675"></span><span>
</span><span id="line-3676"></span><span class="hs-comment">{-|

The default interval option is to select a rectangle, but it can be restricted -
such as to select all items within a range along a given axis
using 'Encodings':

&lt;&lt;images/vl/intervalselectiony.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxBHPaIeBYEzBMCkZBgaoUchgVzaeh2BGIBL0ZXIOgESAAT0gaig0EtBio+hMNWK8BceLAigJ0ugowN1H+ZlRHAQKug6A1VEl0DARhd6silrj2nd5HggNUUEwpGSwagkXQHnQOG9GkNxuVcssCXImGrezd5GYTtRwVgVGtYL2CUQJulovw9nhZGj+tRAmb1S+WL2EqoUplV0VytV6s15G1utg+u7xxgDtbUCmSoVLlnnvxu3FpAAXkfh-umy26ABWPdQXv9pdDyDPo98nIWbitGC4DrKqIKqeKpqhq0qbjqepKLi3aQOgBjwHEYTWkOs5-u6L74HIbAAMwfpAX5hD+YDEP+dDdMB86LoOx4rogMHrvBW5IZeXqoSiNEkLm5DjmcFzmFAJLug+kD3rA6B0Kg7qxN6dqHvoACOzBIL6TCkKUSioThgmjiJ+jIhJ4pxNJBpyQp+BKeQKnAfajqadpphhHpBmemWNaJGQlxDjiihAA Open this visualization in the Vega Editor&gt;

@
let selLabel = &quot;naming is still hard&quot;
    sel = selection
            . select selLabel Interval [ 'Encodings' [ 'ChY' ] ]

in toVegaLite (sel [] : selectionProperties selLabel &quot;Drag to select points by parallax&quot;)
@

We'll come back to further things to do with interval selections
when we get to interactive plots below (see 'bindScales').

-}</span><span>
</span><span id="line-3698"></span><span>
</span><span id="line-3699"></span><span>
</span><span id="line-3700"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelectionY"><span class="hs-identifier hs-type">intervalSelectionY</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3701"></span><span id="intervalSelectionY"><span class="annot"><span class="annottext">intervalSelectionY :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#intervalSelectionY"><span class="hs-identifier hs-var hs-var">intervalSelectionY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3702"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117838"><span class="annot"><span class="annottext">selLabel :: Text
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var hs-var">selLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;naming is still hard&quot;</span></span><span>
</span><span id="line-3703"></span><span>
</span><span id="line-3704"></span><span>      </span><span id="local-6989586621679117837"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117837"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3705"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Channel] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Encodings"><span class="hs-identifier hs-var">Encodings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChY"><span class="hs-identifier hs-var">ChY</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3706"></span><span>
</span><span id="line-3707"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117837"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117838"><span class="hs-identifier hs-var">selLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Drag to select points by parallax&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3708"></span><span>
</span><span id="line-3709"></span><span>
</span><span id="line-3710"></span><span class="hs-comment">-- $intro-selection-transforms</span><span>
</span><span id="line-3711"></span><span class="hs-comment">-- Simple selections as described above create sets of selected data marks</span><span>
</span><span id="line-3712"></span><span class="hs-comment">-- based directly on what was interacted with by the user. Selection</span><span>
</span><span id="line-3713"></span><span class="hs-comment">-- transformations allow us to /project/ that direct selection onto other</span><span>
</span><span id="line-3714"></span><span class="hs-comment">-- parts of our dataset.</span><span>
</span><span id="line-3715"></span><span>
</span><span id="line-3716"></span><span class="hs-comment">{-|

For example, we can adjust the visualization to select all stars in the
same cluster, which is useful in this case since the Blanco1 and
IC2391 clusters occupy the same space in the magnitude-parallax
plane.

This is invoked simply by adding the 'Fields' constructor to the select
parameters naming the fields onto which we wish to project our selection.
Additionally, we have set the default selection with 'Empty' so that if
nothing is selected, the selection is empty
(as we have previously seen, without this the default selection is the
entire encoded dataset).

&lt;&lt;images/vl/transformselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxBHPYGUhxPT4ewnNFzWBUap0ODMKhgvZULAGaAATyuiSocOOMFNBitqOQJmCo2tezIVHI9GQdAIkAE5BiNUgylxGkUBOl0FdKpgVH+ZlRIk9VClYHgYCMJmgqjAEtT0HTYDigeqXygmFIyUTUEi6A86BwEY0CMQCXozrllgS5EwXb2xXggYdUGCmvNBu7iQ70tFsY9Xv0AaD5fFKalMv0CqV5igZvtFqwJiHSlxBvFpAAXiPiIPh3QAKy5yAJRAzzexu96uh8uTP-MbnOvyKnoijNja6AGPAcRhOan5Dt++ByGwADMz6vu+QG3ghI7dP+66zrKqLbqB4F7CiYDEAu9D6Oc8CXP+cRDjekDXrA6B0KgQ6xBGe52iOkAAI7MEgUZMKQpRKOecGUSQVaLsRAK7uKTExrJbEcfgXHkDxz77gJwmiWE4mSXiYBkS+iRkJcKo4ooQA Open this visualization in the Vega Editor&gt;

@
let sel = selection
            . select &quot;pick&quot; Single [ 'Fields' [ \&quot;Cluster\&quot; ]
                                   , 'Empty'
                                   , Nearest True
                                   ]

in toVegaLite (sel [] : selectionProperties &quot;pick&quot; &quot;Select a point, select a cluster&quot;)
@

-}</span><span>
</span><span id="line-3745"></span><span>
</span><span id="line-3746"></span><span class="hs-comment">-- TODO: why did I call this transformSelection?</span><span>
</span><span id="line-3747"></span><span>
</span><span id="line-3748"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#transformSelection"><span class="hs-identifier hs-type">transformSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3749"></span><span id="transformSelection"><span class="annot"><span class="annottext">transformSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#transformSelection"><span class="hs-identifier hs-var hs-var">transformSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3750"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117835"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117835"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3751"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pick&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Fields"><span class="hs-identifier hs-var">Fields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3752"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3753"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Nearest"><span class="hs-identifier hs-var">Nearest</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3754"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-3755"></span><span>
</span><span id="line-3756"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117835"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pick&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select a point, select a cluster&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3757"></span><span>
</span><span id="line-3758"></span><span>
</span><span id="line-3759"></span><span class="hs-comment">-- TODO: can I think of anything to do with lookupSelection</span><span>
</span><span id="line-3760"></span><span>
</span><span id="line-3761"></span><span>
</span><span id="line-3762"></span><span class="hs-comment">-- $intro-selection-binding</span><span>
</span><span id="line-3763"></span><span class="hs-comment">-- Selection need not be limited to direct interaction with the</span><span>
</span><span id="line-3764"></span><span class="hs-comment">-- visualization marks. We can also /bind/ the selection to other</span><span>
</span><span id="line-3765"></span><span class="hs-comment">-- user-interface components.</span><span>
</span><span id="line-3766"></span><span>
</span><span id="line-3767"></span><span class="hs-comment">{-|

New in Vega Lite 4 is the ability to interact with the legend via
the 'BindLegend' option. In this case
selecting on a cluster in the legend will highlight that cluster in
the visualization (but not vice versa). Notice how the legend now
also follows the 'MSelectionCondition' rules (that is, the unselected
items in the image below are also drawn in grey and are partially
transparent).

&lt;&lt;images/vl/legendselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxBHPajYLJeh2SCREzK1EKpXmKDQACeBio+mQJmCox1JFIVHI9GQdAIkAE5BiNUgyjxYEUBOl0HN+GI1H+ZlRImtVClYHgYC1iHoYB5OFUUEwVtM+ki6A86BwXo0CMQCXoprllgS5EwJb2xXgzqNqOCsCoerhx0gCVjYRlldbZGtGqgTpdXyxewl4elos1ZW1YJOMANdagUywJhrkBHHvxu3FpAAXoviNXa3QAKxJtuJIsT2X+yBH5iLvlyc9jqVdqeK2NKXOt9AGeBxGEza3vei5yGwADM57tle75gIeNYPnQ3QvmGb6TlAMbKooP57Ci8GWn2+jnPAlwvnENYHpA+6wOgdCoDWsRerqC76AAjswSA+kwpClEos6QMBBG9ja+jIhaJKUSqNF0fgDHkEx576oa7GcaYYQ8XxHq4ReiBkJc-o4ooQA Open this visualization in the Vega Editor&gt;

@
let sel = selection
          . select &quot;pick&quot; Single [ 'BindLegend'
                                   ('BLField' \&quot;Cluster\&quot;)
                                 ]

in toVegaLite (sel [] : selectionProperties &quot;pick&quot; &quot;Select a legend item&quot;)
@

-}</span><span>
</span><span id="line-3791"></span><span>
</span><span id="line-3792"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#legendSelection"><span class="hs-identifier hs-type">legendSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3793"></span><span id="legendSelection"><span class="annot"><span class="annottext">legendSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#legendSelection"><span class="hs-identifier hs-var hs-var">legendSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3794"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117832"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117832"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3795"></span><span>            </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;legend&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BindLegendProperty -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BindLegend"><span class="hs-identifier hs-var">BindLegend</span></a></span><span>
</span><span id="line-3796"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BindLegendProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BLField"><span class="hs-identifier hs-var">BLField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3797"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-3798"></span><span>
</span><span id="line-3799"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117832"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;legend&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select a legend item&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3800"></span><span>
</span><span id="line-3801"></span><span>
</span><span id="line-3802"></span><span class="hs-comment">{-|

The Elm Vega-Lite walkthrough uses a dataset which has a
column for which a range-slider makes sense. The dataset I'm
using is less rich, and so I am going to use a HTML select
widget - a drop-down list of values - instead. This lets
the user select all stars from a given cluster, and is
introduced with the 'Bind' and 'ISelect' constructors.

The 'InOptions' list is given the values of the Cluster column that
can be selected: I start with a value not in the list (@none@) just to
indicate that no values are selected, and then the list of clusters in
this sub-sample (remembering that 'selectionProperties' applies a
declination cut off). Eagle-eyed readers will note that the cluster
names in this list (the @clusters@ variable) end in spaces: this is
because the input data file has the cluster names stored in an
eight-character field, even though it is a tab-separated file.
This surprised me when I first tried this visualization, and
using the value \&quot;Blanco1\&quot; did not select anything! Isn't working
with data so much fun!

&lt;&lt;images/vl/widgetselection.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoAY3SIyAczrEARvE0BrPbHTNE9OpCNVSeqkvURIWeLDP2ADuikiNCQ7gxM8IYaHsyw5PYAFtDQfsi4APTpCADubHqk0AnMRszINNrBVMFs2ljpHNZ6AEKxZlTpCQBuVHrw6V7I1LAd3b3pjNB9vaTwUvCzAGwAjAtzS3JSk0bkVEvwbIjoUglU8PQ0bNDInaHRUBjYTFEQL1B+3mXPry+QAOJeBnwkEQrEctDC3ygQgAgvxhCJ7CCsGDbpCPH5yAAPRGgmiotGQbhw0Q45F4iHfSBUHgY7FApEou4QRR3FnMsKQAAkyE0Jy8iWSqQy6VG+3yhWKbFI6HSPL5fVFUnIBXanQALGwAFbIHT4yBlHaaaDSxBfdGkcxUOz4UCQqlYPzQACeiJ0rgpHiMQWtYFtBIE5FKQzNBKCfmYISBBqoRvxaKg6EdJuQdAIwLdoSgTXISG0SygqigghkAGYAJz5gtFgQyBZyGQeQuQAByvxraoArPnIMomS82d9FB6oM6-K4o0E9Ds4z8yFRyPQU-g0wGg3je68B0ONDACtObTAqJjI1AAAo7eBlMDRo1geBgTSBwbkhOwUhVE8OdDJdA4bceKptHoScQ0gbRyEwEMPE6eBA3HKBLCoF1hzAnRgONXUbT7Dw5wXexV2fcFsKgG8MNNIE-AtNo7GHDxR3g9MsCCWDID7Ad2TufVSAAL3g4gYLgugOybCp0JNQxIAE5h4LVOQm1I8SKKoq0lH-H5E1MAoXQPKT4LkNgSxEtCCkU31JNg6S6CWeT5xjMj-GUuxFDUjw6TM3CfT+AFM31TRYL4yBeKsOhUFgsohxHJ0x3sABHZgkGNSZjW6NxOO09z3zwiisR8nl-IkoL0BCsKqAimAooYuKEoKJhSBSrcQEUIA Open this visualization in the Vega Editor&gt;

@
let picked = &quot;picked&quot;

    clusters = [ \&quot;none\&quot;, \&quot;Blanco1 \&quot;, \&quot;IC2391  \&quot;, \&quot;IC2602  \&quot;, \&quot;NGC2451 \&quot; ]
    sel = selection
            . select picked Single [ Fields [ \&quot;Cluster\&quot; ]
                                   , 'Bind' [ 'ISelect' \&quot;Cluster\&quot; [ 'InOptions' clusters ] ]
                                   , Empty
                                   ]

   conf = configure
            . configuration (BackgroundStyle &quot;beige&quot;)

in toVegaLite (conf [] :
               sel [] :
               selectionProperties picked \&quot;Please select a cluster\&quot;)
@

Originally this example had the selection working both ways - that is
the HTML widget can be used to select a cluster and clicking on a point on
the visualization updated the HTML widget. However, this no-longer happens
and I don't know whether it is a change in Vega-Lite or I changed
something in the visualization!

Unlike the other plots shown in the tutorial, this is a screen grab
rather than a PNG file created by Vega Embed. The background color was
changed - following the approach used in
'stripPlotWithBackground' - to show where the visualization &quot;ends&quot; and
the HTML select element starts. It also shows the Vega Embed &quot;drop-down&quot;
menu in the top-right corner, namely the three dots in a circle.

-}</span><span>
</span><span id="line-3859"></span><span>
</span><span id="line-3860"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#widgetSelection"><span class="hs-identifier hs-type">widgetSelection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3861"></span><span id="widgetSelection"><span class="annot"><span class="annottext">widgetSelection :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#widgetSelection"><span class="hs-identifier hs-var hs-var">widgetSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3862"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117829"><span class="annot"><span class="annottext">picked :: Text
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span>
</span><span id="line-3863"></span><span>
</span><span id="line-3864"></span><span>      </span><span id="local-6989586621679117828"><span class="annot"><span class="annottext">clusters :: [Text]
</span><a href="#local-6989586621679117828"><span class="hs-identifier hs-var hs-var">clusters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;none&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Blanco1 &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IC2391  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IC2602  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;NGC2451 &quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3865"></span><span>      </span><span id="local-6989586621679117827"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117827"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3866"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Fields"><span class="hs-identifier hs-var">Fields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3867"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Binding] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Bind"><span class="hs-identifier hs-var">Bind</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [InputProperty] -&gt; Binding
</span><a href="Graphics.Vega.VegaLite.Selection.html#ISelect"><span class="hs-identifier hs-var">ISelect</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; InputProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#InOptions"><span class="hs-identifier hs-var">InOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679117828"><span class="hs-identifier hs-var">clusters</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3868"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3869"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-3870"></span><span>
</span><span id="line-3871"></span><span>      </span><span id="local-6989586621679117823"><span class="annot"><span class="annottext">conf :: [ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117823"><span class="hs-identifier hs-var hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span>
</span><span id="line-3872"></span><span>               </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; BuildConfigureSpecs -&gt; [ConfigureSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#BackgroundStyle"><span class="hs-identifier hs-var">BackgroundStyle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;beige&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3873"></span><span>
</span><span id="line-3874"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117823"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-3875"></span><span>                 </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117827"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-3876"></span><span>                 </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117829"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Please select a cluster&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3877"></span><span>
</span><span id="line-3878"></span><span>
</span><span id="line-3879"></span><span>
</span><span id="line-3880"></span><span class="hs-comment">{-|

The selection can also be bound to an axis (or both axes, as in this
case), using 'BindScales' (applying it to the 'intervalSelectionY' plot).

&lt;&lt;images/vl/bindscales.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoARAUQH0BJAMIAlAMpgAPGAC0AJgAMkAL4BdADTgoWeLADWdSAAd0pRNEjqIkRtHh1QES81jl9AC2jQDyXAHofCAHc2AHNSaFdmACNmZBoAY3RTKlM2BKwfDnRmYIAhJx0qH1cANypg+B8tZGpYItLyn2sK8tJ4KXg2gDYARk727rkpG0jyKm74NkR0KVcqeHoaNmhkYvMNSwxsJjt1h0NtWJ2HY6gAcS1g-URWSJo1k72hAEF+YRErm7uLB6gDcgAPD5YW60b4PSDcV6iIEg+4-SBUHh-QH4SDXYF3XYQRS7HHY76QAAkyDisy0bg8Xl8PnqE1C4SibFI6B8JLJFVpUnIYUKxQALGwAFbIRJwyCxUZxaDMxBHPYGUhxAr0OyQSImFWoknwUbIcxQZIJegmYJ6-AESAAT31kEBaig0EtBio+hMNWKOqUGkUBOl0FGquo-zMqI4CGCYEwYAAXuh0FgwOEqGB4P8qHrVFBMKRkiGoJF0B540oCYb0MbEJd8PY9glyJg5cdIB7yMwXajgrAqNawbXEsbpaLq1i9mQqORNVABK3ql8R5YJVQpTL9AqlVQVb2m47nVd4yZPSO8Q4fbtxaRo+2wMQW226ABWTOQBKIAcr6vNnV3-B8uRPxfLkOvyKsqSink26AGPAcRhNaH63lechsAAzE+L5vkBN5fle3T-uOS6DrKqJrqBijgXsKLXiQOYTvo5zwJc-5xDqV7EJesDoHQqA6rEPoOk6V6QAAjswSB+kwpClCWZ5wVRY60cRAI2tqAYfuxnH4Nx5C8U+O6CSJYlhBJUnHuRz6JGQVbXjiihAA Open this visualization in the Vega Editor&gt;

@
let picked = &quot;picked&quot;

    sel = selection
            . select picked Interval [ Encodings [ 'ChX', ChY ], 'BindScales' ]

in toVegaLite (sel [] : selectionProperties picked &quot;Drag or zoom the axes&quot;)
@

The image here was created after panning and zooming into the data.

-}</span><span>
</span><span id="line-3901"></span><span>
</span><span id="line-3902"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#bindScales"><span class="hs-identifier hs-type">bindScales</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3903"></span><span id="bindScales"><span class="annot"><span class="annottext">bindScales :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#bindScales"><span class="hs-identifier hs-var hs-var">bindScales</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3904"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117822"><span class="annot"><span class="annottext">picked :: Text
</span><a href="#local-6989586621679117822"><span class="hs-identifier hs-var hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span>
</span><span id="line-3905"></span><span>
</span><span id="line-3906"></span><span>      </span><span id="local-6989586621679117821"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117821"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3907"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117822"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Channel] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Encodings"><span class="hs-identifier hs-var">Encodings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChY"><span class="hs-identifier hs-var">ChY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChX"><span class="hs-identifier hs-var">ChX</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BindScales"><span class="hs-identifier hs-var">BindScales</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3908"></span><span>
</span><span id="line-3909"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117821"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PropertySpec -&gt; [PropertySpec] -&gt; [PropertySpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [PropertySpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#selectionProperties"><span class="hs-identifier hs-var">selectionProperties</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117822"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Drag or zoom the axes&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3910"></span><span>
</span><span id="line-3911"></span><span>
</span><span id="line-3912"></span><span class="hs-comment">-- $intro-coordinated-views</span><span>
</span><span id="line-3913"></span><span class="hs-comment">-- One of the more powerful aspects of selection-based interaction is in</span><span>
</span><span id="line-3914"></span><span class="hs-comment">-- coordinating different views &#8211; a selection of a data subset is projected</span><span>
</span><span id="line-3915"></span><span class="hs-comment">-- onto all other views of the same data.</span><span>
</span><span id="line-3916"></span><span>
</span><span id="line-3917"></span><span class="hs-comment">{-|

The following plot doesn't contain anything new, but allows us to
select a rectangular-range on one plot, and see the same selection
automatically applied to the other plots. This is achieved by
combining the 'repeat' fuction with the 'selection'; this causes the
selection to be projected across all views as it is duplicated.

For this example we use all the clusters, rather than the subset of
Southern ones. One trick I use is to convert the Right Ascension
values (which have a domain of 0 to 360 degrees, and wrap around at
the 0\/360 mark), into their cosine values (remembering to convert to
radians first), and display that instead. This ensures the \&quot;Blanco1\&quot;
cluster members are spatially co-located on this axis - with values
close to 1 - rather than appearing near 0 and 360. This is more to
show things you /can/ do with Vega-Lite, rather than necesarily
things you __should__ do :-)

&lt;&lt;images/vl/coordinatedviews.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmAOsCGAXSAuMwYHsDuGYA2pAMY4DOASgIKQA0UAIgKID6AkgMJUDKkAXUZkcAGwCuAWwB2hEvFEAPBlADikpAHNBAX3rgoFRKUKgIESCmhJpFAGY5okuQfNZISCoRHU6w0kiipOKiqLDe5BQAFAAmqFIAdLScPLxgAFRgAAocYAD0YACMABwADACUkDquYEI1kBrQANYRAJbQpKLh+m6QcShIpjUW4tCi3gAWKCjwFOh5edZ4CZqtKBPiAEbiFLAdONIosIcJ5JJ5TDjimgBCo02weRMAbrCaSHkaFEfQT6-veX6H3erSQAFokOCAGyFKEQwqlMEDTZdQpIBLSHBgibIGJ7BIoCjPBjDKAOJyoIZuXrwJDQXZU6m9dRabzSKSbPYkpm9ZLcPhsjlcno8iwKZSYSDsySc6Dc0XMdj8-iS6Wy+WiyCwNjiwUyrmkiDVJnG8x6eq7LqkFCtA6mSDwVqkB4xe0oACeiG8rUOe2egSq5t6x3IMR92kwZmpIlEjkZTMg-ok4Ulmjg7o10fI0jDNrtkcN5kgdlasFErslXAk32FhYsltg1ttskljudsFdIs1Hq9qpwkh9AcLprcQejEvcJbLFfccEQlMl5AkMiqwh7KagAEdxDYbQMba9V6TIBnI8XS+X7XPkGhJdB8KuoOvvNvd2tUK1DyOwKax5AACQUKQOIaJM0yzPMeT-OiqzrFsCS2nkQEgR80FgqIayPM8AAsCQAFYUHaIoiNIJYRlg1Q6EAA Open this visualization in the Vega Editor&gt;

@
let enc = encoding
            . position X [ PRepeat Column, PmType Quantitative ]
            . position Y [ PRepeat Row, PmType Quantitative ]
            . color
                [ MSelectionCondition (SelectionName \&quot;picked\&quot;)
                  [ MName \&quot;Cluster\&quot;, MmType Nominal ]
                  [ MString \&quot;grey\&quot; ]
                ]

    sel = selection
            . select \&quot;picked\&quot; Interval [ ]

    trans = transform
            . calculateAs &quot;cos(datum.RA_ICRS * PI / 180)&quot; &quot;cosRA&quot;

    spec = asSpec
             [ gaiaData
             , trans []
             , mark Circle []
             , enc []
             , sel []
             ]

in toVegaLite
     [ repeat
       [ RowFields [ \&quot;cosRA\&quot;, \&quot;DE_ICRS\&quot; ]
       , ColumnFields [ \&quot;plx\&quot;, \&quot;Gmag\&quot; ]
       ]
     , specification spec
     ]
@

-}</span><span>
</span><span id="line-3973"></span><span>
</span><span id="line-3974"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews"><span class="hs-identifier hs-type">coordinatedViews</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-3975"></span><span id="coordinatedViews"><span class="annot"><span class="annottext">coordinatedViews :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews"><span class="hs-identifier hs-var hs-var">coordinatedViews</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3976"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117818"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117818"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-3977"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Column"><span class="hs-identifier hs-var">Column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3978"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Row"><span class="hs-identifier hs-var">Row</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3979"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span>
</span><span id="line-3980"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3981"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3982"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MString"><span class="hs-identifier hs-var">MString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grey&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3983"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-3984"></span><span>
</span><span id="line-3985"></span><span>      </span><span id="local-6989586621679117817"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117817"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-3986"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3987"></span><span>
</span><span id="line-3988"></span><span>      </span><span id="local-6989586621679117816"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117816"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-3989"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cos(datum.RA_ICRS * PI / 180)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cosRA&quot;</span></span><span>
</span><span id="line-3990"></span><span>
</span><span id="line-3991"></span><span>      </span><span id="local-6989586621679117815"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679117815"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span>
</span><span id="line-3992"></span><span>               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-3993"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117816"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3994"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3995"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117818"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3996"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117817"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3997"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-3998"></span><span>
</span><span id="line-3999"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4000"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span>
</span><span id="line-4001"></span><span>         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#RowFields"><span class="hs-identifier hs-var">RowFields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cosRA&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4002"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ColumnFields"><span class="hs-identifier hs-var">ColumnFields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4003"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-4004"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117815"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-4005"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-4006"></span><span>
</span><span id="line-4007"></span><span>
</span><span id="line-4008"></span><span class="hs-comment">{-|

If the interval selection is bound the the axes with 'BindScales'
then we can zoom and pan the related plots - i.e. changing the
range displayed in one plot will also change the two plots that
it shares an axis with in this two by two arrangement. The conditional
encoding of the 'color' channel has also been removed.

&lt;&lt;images/vl/coordinatedviews2.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmAOsCGAXSAuMwYHsDuGYA2pAMY4DOASgIKQA0UAIgKID6AkgMJUDKkAXUZkcAGwCuAWwB2hEvFEAPBlADikpAHNBAX3rgoFRKUKgIESCmhJpFAGY5okuQfNZISCoRHU6w0kiipOKiqLDe5BQAFAAmqFIAdLScPLxgAFRgAAocYAD0YACMABwADACUkDquYEI1kBrQANYRAJbQpKLh+m6QcShIpjUW4tCi3gAWKCjwFOh5edZ4CZqtKBPiAEbiFLAdONIosIcJ5JJ5TDjimgBCo02weRMAbrCaSHkaFEfQT6-veX6H3erSQAFokOCAGyFKEQwqlMEDTZdQpIBLSHBgibIGJ7BIoCjPBjDKAOJyoIZuXrwJDQXamSDqLTeaRSTZ7FSQBTKTCQNmSDnQLmwNg81nsznValgaXmPT1XZdUgoVoHRnwVqkB4xRkoACeiG8rUOe2egSqCt6x3IMRN2kwZmpIlEjipMqg5ok4T5mjg+pJHqg5GkdtV6sdpN6dlasFEur5XAk305PSDhjjsBVatkfM12tgurTQcshp9UExkhNFqjstJVudvPcMbjCfccEQlL55AkMiqwgNRr5AEdxDZVQNVa9+6TIAHHZAW-HGR3kGg+dB8P2oIPy5BR+O1qhWtO5RA5Q3IAASCikHEaSbTWbzPL-dGrdZbBJqvK3+8fN8wVENZHmeABmBIACsKHVNMRGkGMHSwaodCAA Open this visualization in the Vega Editor&gt;

The image was captured after panning and zooming in the
\&quot;parallax-RA_ICRS\&quot; plot.

@
let enc = encoding
            . position X [ PRepeat Column, PmType Quantitative ]
            . position Y [ PRepeat Row, PmType Quantitative ]
            . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    sel = selection
            . select \&quot;picked\&quot; Interval [ BindScales ]

    spec = asSpec
             [ gaiaData
             , mark Circle []
             , enc []
             , sel []
             ]

in toVegaLite
     [ repeat
       [ RowFields [ \&quot;RA_ICRS\&quot;, \&quot;DE_ICRS\&quot; ]
       , ColumnFields [ \&quot;plx\&quot;, \&quot;Gmag\&quot; ]
       ]
     , specification spec
     ]
@

The \&quot;cosine\&quot; transformation has been removed in comparison to
'coordinatedViews'.

-}</span><span>
</span><span id="line-4052"></span><span>
</span><span id="line-4053"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews2"><span class="hs-identifier hs-type">coordinatedViews2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4054"></span><span id="coordinatedViews2"><span class="annot"><span class="annottext">coordinatedViews2 :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#coordinatedViews2"><span class="hs-identifier hs-var hs-var">coordinatedViews2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4055"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117814"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117814"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4056"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Column"><span class="hs-identifier hs-var">Column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4057"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Row"><span class="hs-identifier hs-var">Row</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4058"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4059"></span><span>
</span><span id="line-4060"></span><span>      </span><span id="local-6989586621679117813"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117813"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-4061"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BindScales"><span class="hs-identifier hs-var">BindScales</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4062"></span><span>
</span><span id="line-4063"></span><span>      </span><span id="local-6989586621679117812"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679117812"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span>
</span><span id="line-4064"></span><span>               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4065"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4066"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117814"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4067"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117813"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4068"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-4069"></span><span>
</span><span id="line-4070"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4071"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span>
</span><span id="line-4072"></span><span>         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#RowFields"><span class="hs-identifier hs-var">RowFields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4073"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ColumnFields"><span class="hs-identifier hs-var">ColumnFields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4074"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-4075"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117812"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-4076"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-4077"></span><span>
</span><span id="line-4078"></span><span>
</span><span id="line-4079"></span><span class="hs-comment">{-|

The ability to determine the scale of a chart based on a selection is
useful in implementing a common visualization design pattern, that of
'context and focus' (or sometimes referred to as 'overview and detail
on demand'). We can achieve this by setting the scale of one view
based on the selection in another. The detail view is updated whenever
the selected region is changed through interaction:

&lt;&lt;images/vl/contextandfocus.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zULqiYkIIhADaHUKp2ibBYJEIAA5fO9TiYcBoGmQRGwJOtOgw2NBOIQACy+aH3SACYJCeBscQFSDcHB8IiUqSiaAolgUf6QACekAAuikoPB2WR+A0UeZdLACA83oSyfBgg1RvwSfAwLAwABNMD0MQsfhgeAiMAALxEIlkYBRYFaeBEDDRpwZIiZ2oqGygVzQ91OmTYiugDVqsHqMI2RJ+ctQwEghsEIkImXFAilrsw-MFDQAjlhYBIOAg2Po7q6kyHORGsj68H6DpdUnyBUKDpnszK8wWXlV269g0CMnCEdXkajg5gMVi6ag8QTZmdvo7mS6Q6JrWsy97fQ0hng+OZa5BUw2oBFZCjxZBi9P3T3p2vK-66naQxQwwfI9GcLHUPG8Inh519xmsxzRAyQLX9TlgBY2FZMsZXDMAmjwPBOw7MCoFLD1kygG8qygGtUMwJ9xRfGBTVgFFKWJfhSXJMQGmpWkz3PEN-0bQCWxAoVPUee5kPbHl0kgAASJ9ohMBoSHIKhaCsMJ2E4HgmHJagRP4ExqBkpw8A4bRdBxJgACsKApd5IC+b16gjJ4HiAA Open this visualization in the Vega Editor&gt;

@
let sel = selection . select \&quot;brush\&quot; Interval [ Encodings [ ChY ] ]

    encContext = encoding
                   . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, PScale [ SZero False ] ]
                   . position Y [ PName \&quot;plx\&quot;, PmType Quantitative ]

    specContext = asSpec [ width 400
                         , height 80
                         , sel []
                         , mark Point []
                         , encContext []
                         , title \&quot;Select a Y range to zoom in below\&quot; []
                         ]

    encDetail = encoding
                  . position X [ PName \&quot;Gmag\&quot;
                               , PmType Quantitative
                               , PScale [ SZero False ]
                               , PAxis [ 'AxNoTitle' ]
                               ]
                  . position Y [ PName \&quot;plx\&quot;
                               , PmType Quantitative
                                 -- prior to 0.11.0.0 this was 'SDomain'
                               , PScale [ 'SDomainOpt' ('DSelection' \&quot;brush\&quot;) ]
                               ]
                  . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

  specDetail =
      asSpec [ width 400, mark Point [], encDetail [] ]

in toVegaLite
     [ gaiaData
     , vConcat [ specContext, specDetail ]
     ]
@

Not shown here, but selecting a range of y-values in the top plot
(@specContext@) will cause the second plot (@specDetail@) to zoom
in on that range, as the selection is bound to the y axis of this
plot via 'DSelection'.

-}</span><span>
</span><span id="line-4135"></span><span>
</span><span id="line-4136"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#contextAndFocus"><span class="hs-identifier hs-type">contextAndFocus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4137"></span><span id="contextAndFocus"><span class="annot"><span class="annottext">contextAndFocus :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#contextAndFocus"><span class="hs-identifier hs-var hs-var">contextAndFocus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4138"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-4139"></span><span>    </span><span id="local-6989586621679117811"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117811"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4140"></span><span>        </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;brush&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Channel] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Encodings"><span class="hs-identifier hs-var">Encodings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChY"><span class="hs-identifier hs-var">ChY</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4141"></span><span>
</span><span id="line-4142"></span><span>    </span><span id="local-6989586621679117810"><span class="annot"><span class="annottext">encContext :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117810"><span class="hs-identifier hs-var hs-var">encContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4143"></span><span>        </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4144"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4145"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4146"></span><span>
</span><span id="line-4147"></span><span>    </span><span id="local-6989586621679117809"><span class="annot"><span class="annottext">specContext :: VLSpec
</span><a href="#local-6989586621679117809"><span class="hs-identifier hs-var hs-var">specContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4148"></span><span>        </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">80</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117811"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117810"><span class="hs-identifier hs-var">encContext</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4149"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select a Y range to zoom in below&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4150"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-4151"></span><span>
</span><span id="line-4152"></span><span>    </span><span id="local-6989586621679117808"><span class="annot"><span class="annottext">encDetail :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117808"><span class="hs-identifier hs-var hs-var">encDetail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4153"></span><span>        </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4154"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span>
</span><span id="line-4155"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4156"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4157"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4158"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxNoTitle"><span class="hs-identifier hs-var">AxNoTitle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4159"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4160"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-4161"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4162"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ScaleDomain -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomainOpt"><span class="hs-identifier hs-var">SDomainOpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ScaleDomain
</span><a href="Graphics.Vega.VegaLite.Scale.html#DSelection"><span class="hs-identifier hs-var">DSelection</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;brush&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4163"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-4164"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4165"></span><span>
</span><span id="line-4166"></span><span>    </span><span id="local-6989586621679117804"><span class="annot"><span class="annottext">specDetail :: VLSpec
</span><a href="#local-6989586621679117804"><span class="hs-identifier hs-var hs-var">specDetail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4167"></span><span>        </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117808"><span class="hs-identifier hs-var">encDetail</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4168"></span><span>
</span><span id="line-4169"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-4170"></span><span>    </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4171"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4172"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117809"><span class="hs-identifier hs-var">specContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117804"><span class="hs-identifier hs-var">specDetail</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4173"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-4174"></span><span>
</span><span id="line-4175"></span><span>
</span><span id="line-4176"></span><span class="hs-comment">-- $intro-crossfilter</span><span>
</span><span id="line-4177"></span><span class="hs-comment">-- The final example in this section brings together ideas of view</span><span>
</span><span id="line-4178"></span><span class="hs-comment">-- composition and interactive selection with data filtering by implementing</span><span>
</span><span id="line-4179"></span><span class="hs-comment">-- /cross-filtering/: the selection of a subset of the data in one</span><span>
</span><span id="line-4180"></span><span class="hs-comment">-- view then only displaying that data in the other views.</span><span>
</span><span id="line-4181"></span><span>
</span><span id="line-4182"></span><span class="hs-comment">{-|

Here we show distributions of the four main numeric quantities
in the dataset - position, magnitude, and prallax - using the
@totalEnc@ encoding, and add a second layer which repeats this
data but with a different color (@selectedEnc@), and that is tied to
the interval-selection along the x axis ('ChX').

&lt;&lt;images/vl/crossfilter.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEBOCmAOsCGAXSAuMxIGMD2ANgK4C2AdhmANqQBKAggPoCSAwrQMqQA0UAIgFEW7Lr0gBxEkgDmPKPAIAPSAF0Avt3BQAzohyVQECJAAmqJAa1GoRaAUqQAFihTxt6APQfoSAO4A6aQBLFEciACMibVhofDIUWHj-fBIPPjwiaQAhWwBrWA9HADdYaSQPKW0E6EKSso8zFHKyoKQAWiR2gDYARi6OnoAGNqbwglgepH8yPDbHZBMY-xRtIp4rI0gAMzxoKTRMQ2tN+CRoaMtj44kpWUxIMlJwmPWr6zomNk4HR5Jn6Feb2MCmU91+-0BQMggmE3zBTxemiBxlgjBBPwRAI21jU2LAuJxSM2BCQAE8XpgqHijldIFJoLkHOEzpDrol8CYgmQ7lg8e9QVhtkFYAQTAYYAhkAcoPhiORIBooChSYgHABHIhIeIhVBBEoKolQ0nimTSOBlBIOfBEeJySDK1X3DValA6136glvT2E6l8pU+MjaHZ7ShUbBbIIEari6LjHCuvAUe7haBRRwKtQqQ3XemM5Ms7PvWOweNBRPilNp8XsvCc7naUOQZRZpUq2AOLnVIpIexqDR+yA1us8mlvXCEXbi7vEdv3aSERZkaC1g1+4wC8PC0XiuCIVBWwikCiK+1t9Wa7VNd3t-vIqDGw6QU3m1CzmUZW1iB1vyDOy+6j0-W9IxgJULRbygAASbQcHmKQHGcVx3C8OopmCUIIn8MsPBguDylQtoCBCAoigAFn8AArbRyyJccyAjEdcTUIA Open this visualization in the Vega Editor&gt;

Selecting a small range of parallax values in the fourth plot
highlights the associated data in the other three plots.

@
let sel = selection . select &quot;brush&quot; Interval [ Encodings [ ChX ] ]

    filterTrans = transform . filter ('FSelection' &quot;brush&quot;)

    -- borrow a function from Elm
    pQuant = PmType Quantitative

    totalEnc = encoding
                . position X [ PRepeat Column, pQuant ]
                . position Y [ PAggregate Count, pQuant ]

    selectedEnc = totalEnc
                    . color [ MString &quot;goldenrod&quot; ]

in toVegaLite
     [ repeat [ ColumnFields [ \&quot;RA_ICRS\&quot;, \&quot;DE_ICRS\&quot;, \&quot;Gmag\&quot;, \&quot;plx\&quot; ] ]
     , specification $
         asSpec
           [ gaiaData
           , layer
             [ asSpec [ mark Bar [], totalEnc [] ]
             , asSpec [ sel [], filterTrans [], mark Bar [], selectedEnc [] ]
             ]
           ]
     ]
@

-}</span><span>
</span><span id="line-4226"></span><span>
</span><span id="line-4227"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#crossFilter"><span class="hs-identifier hs-type">crossFilter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4228"></span><span id="crossFilter"><span class="annot"><span class="annottext">crossFilter :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#crossFilter"><span class="hs-identifier hs-var hs-var">crossFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4229"></span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-4230"></span><span>    </span><span id="local-6989586621679117803"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117803"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4231"></span><span>        </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;brush&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Channel] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Encodings"><span class="hs-identifier hs-var">Encodings</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ChX"><span class="hs-identifier hs-var">ChX</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4232"></span><span>
</span><span id="line-4233"></span><span>    </span><span id="local-6989586621679117802"><span class="annot"><span class="annottext">filterTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117802"><span class="hs-identifier hs-var hs-var">filterTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4234"></span><span>        </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4235"></span><span>            </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FSelection"><span class="hs-identifier hs-var">FSelection</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;brush&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4236"></span><span>
</span><span id="line-4237"></span><span>    </span><span class="hs-comment">-- borrow a function from Elm</span><span>
</span><span id="line-4238"></span><span>    </span><span id="local-6989586621679117800"><span class="annot"><span class="annottext">pQuant :: PositionChannel
</span><a href="#local-6989586621679117800"><span class="hs-identifier hs-var hs-var">pQuant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4239"></span><span>
</span><span id="line-4240"></span><span>    </span><span id="local-6989586621679117799"><span class="annot"><span class="annottext">totalEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var hs-var">totalEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4241"></span><span>        </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4242"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Arrangement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PRepeat"><span class="hs-identifier hs-var">PRepeat</span></a></span><span> </span><span class="annot"><span class="annottext">Arrangement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Column"><span class="hs-identifier hs-var">Column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679117800"><span class="hs-identifier hs-var">pQuant</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4243"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679117800"><span class="hs-identifier hs-var">pQuant</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4244"></span><span>
</span><span id="line-4245"></span><span>    </span><span id="local-6989586621679117798"><span class="annot"><span class="annottext">selectedEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117798"><span class="hs-identifier hs-var hs-var">selectedEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4246"></span><span>        </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var">totalEnc</span></a></span><span>
</span><span id="line-4247"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MString"><span class="hs-identifier hs-var">MString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;goldenrod&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4248"></span><span>
</span><span id="line-4249"></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-4250"></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4251"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[RepeatFields] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RepeatFields
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ColumnFields"><span class="hs-identifier hs-var">ColumnFields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4252"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">(VLSpec -&gt; PropertySpec) -&gt; VLSpec -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4253"></span><span>        </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span>
</span><span id="line-4254"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4255"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span>
</span><span id="line-4256"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var">totalEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4257"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117803"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117802"><span class="hs-identifier hs-var">filterTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117798"><span class="hs-identifier hs-var">selectedEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4258"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4259"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4260"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-4261"></span><span>
</span><span id="line-4262"></span><span>
</span><span id="line-4263"></span><span class="hs-comment">-- $intro-smoothing</span><span>
</span><span id="line-4264"></span><span class="hs-comment">-- Vega Lite 4 introduces several ways to \&quot;smooth\&quot; or \&quot;fit\&quot; your</span><span>
</span><span id="line-4265"></span><span class="hs-comment">-- data. I've already played around with kernel-density estimation</span><span>
</span><span id="line-4266"></span><span class="hs-comment">-- - via the 'density' transform that was used in 'densityParallax' -</span><span>
</span><span id="line-4267"></span><span class="hs-comment">-- so now I get to try out 'loess' and 'regression'.</span><span>
</span><span id="line-4268"></span><span>
</span><span id="line-4269"></span><span class="hs-comment">{-|

The 'loess' transform will generate new coordinate pairs for the
independent and dependent values based on an existing pair.
The name stands for
&lt;https://vega.github.io/vega-lite/docs/loess.html locally-estimated scatterplot smoothing&gt;,
and here I use it to look for any possible relationship between the
magnitude and parallax of each star in a cluster. I don't expect
there to really be any (as we've seen before, the distribution
is pretty flat), but it's the data I have to play with in this
tutorial.

&lt;&lt;images/vl/loessexample.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4IgLgTghgdgzgMwPYQLYgFwG1QIJYA2YAphJiABQAmUYArqgHQAiAogPoCSAwgEoDKAAgB8AXkEAGAJSCAZIOq0GLDjwGCAPOIAs0kAF8AugBoQNMFEyg6EAuQAWYMAAc4GAPTvoAd0YBzPDB7OgAjOjhSAGMkGBJYxmjUd2YkOj8AIRsAa2J3ewA3Yj8od1QoOBIIPMLi93MS4rwoAFooFoA2AEZ21s6JZosQgmJOqEYYJGb7YigqUkYwOHyQU2Q0WisQZygICM2AcTK-chgGENIVkF4AQS4+fhOzi9NnAgAPR9RzslM2O4FPt9LsR2K8PhgQKcvhd9LDTHBnMRIptpng-I5MAAmACsElM3jwVCCWNxpgIUAAnhdsKAyhAsuRnEg8LFgTBolQWccMKBogQUJt8MQCFRyNwCOFKpdhn5iDBRRhTgQCPpTODcHhhQqQIcoMd4ZEoMNNgAvUhITAII0RVXgCmI8gARzosDAgVoeEKBlMFMFmpFjPelzghuNPJAZogFowVoINtMYHtxCdLti7rdXthqtAkFgiBQ6BpID8UbozhCvuwIHFkouJhA-OIcDggY+phi5F1xyMpjpDPDFSjOQA6oTiRhMfDIEgcuQhlBIgyE0nyAQWcnbXKOVzNuqQEKAxCu8HQ8nw5Ho7H43aHRDna7056Nz6-VrWyejWfQBfLdbiLbE1vEB7zTCwMw3WFDFtAASENpjKBwnFcDx3BqMYAiCUJGDwJB3Dg4gylQooWjXEhUO0RgACs4A7Uw+QYeAsVWBdiDAV9D2rCUKmeG8z0hJBUBZI0DH0IA Open this visualization in the Vega Editor&gt;

@
let simplify = transform
               . filter (FExpr \&quot;(datum.DE_ICRS &gt;= 0) &amp; (datum.DE_ICRS &lt;= 40)\&quot;)

    baseEnc = encoding
             . position X [ PName \&quot;Gmag\&quot;
                          , PmType Quantitative
                          , PScale [ SZero False ]
                          ]
             . position Y [ PName \&quot;plx\&quot;
                          , PmType Quantitative
                          , PScale [ SZero False ]
                          ]

    rawEnc = baseEnc
            . color [ MName \&quot;Cluster\&quot;
                    , MLegend []
                    ]

    rawLayer = asSpec [ rawEnc [], mark Point [] ]

    trans = transform
            . 'loess' \&quot;plx\&quot; \&quot;Gmag\&quot; [ 'LsGroupBy' [ \&quot;Cluster\&quot; ] ]

    trendLayer = asSpec [ trans []
                        , baseEnc []
                        , mark Line [ MStroke \&quot;black\&quot;
                                    , MStrokeWidth 2
                                    ]
                        ]

    frameSpec = asSpec [ width 250
                       , height 250
                       , layer [ rawLayer, trendLayer ] ]

in toVegaLite
     [ gaiaData
     , simplify []
     , columns 2
     , facetFlow [ FName \&quot;Cluster\&quot;, FmType Nominal ]
     , specification frameSpec
     ]
@

The data is filtered to select only four clusters, ensuring that
the two closest (i.e. they have the largest parallax values) are
included as they are likely to be the most-interesting to look
at (because of the spread of parallax values).

The 'LsGroupBy' option is used to ensure the calculation is done
per cluster, and then multiple layers are used to compare the
raw with the &quot;smoothed&quot; data in a faceted display.

-}</span><span>
</span><span id="line-4339"></span><span>
</span><span id="line-4340"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#loessExample"><span class="hs-identifier hs-type">loessExample</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4341"></span><span id="loessExample"><span class="annot"><span class="annottext">loessExample :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#loessExample"><span class="hs-identifier hs-var hs-var">loessExample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4342"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117797"><span class="annot"><span class="annottext">simplify :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117797"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4343"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FExpr"><span class="hs-identifier hs-var">FExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(datum.DE_ICRS &gt;= 0) &amp; (datum.DE_ICRS &lt;= 40)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4344"></span><span>
</span><span id="line-4345"></span><span>      </span><span id="local-6989586621679117796"><span class="annot"><span class="annottext">baseEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117796"><span class="hs-identifier hs-var hs-var">baseEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4346"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4347"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4348"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4349"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-4350"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-4351"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4352"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4353"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-4354"></span><span>
</span><span id="line-4355"></span><span>      </span><span id="local-6989586621679117795"><span class="annot"><span class="annottext">rawEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117795"><span class="hs-identifier hs-var hs-var">rawEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117796"><span class="hs-identifier hs-var">baseEnc</span></a></span><span>
</span><span id="line-4356"></span><span>               </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-4357"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4358"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-4359"></span><span>
</span><span id="line-4360"></span><span>      </span><span id="local-6989586621679117794"><span class="annot"><span class="annottext">rawLayer :: VLSpec
</span><a href="#local-6989586621679117794"><span class="hs-identifier hs-var hs-var">rawLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117795"><span class="hs-identifier hs-var">rawEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4361"></span><span>
</span><span id="line-4362"></span><span>      </span><span id="local-6989586621679117793"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117793"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4363"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Text -&gt; [LoessProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#loess"><span class="hs-identifier hs-var">loess</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; LoessProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#LsGroupBy"><span class="hs-identifier hs-var">LsGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4364"></span><span>
</span><span id="line-4365"></span><span>      </span><span id="local-6989586621679117790"><span class="annot"><span class="annottext">trendLayer :: VLSpec
</span><a href="#local-6989586621679117790"><span class="hs-identifier hs-var hs-var">trendLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117793"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4366"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117796"><span class="hs-identifier hs-var">baseEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4367"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-4368"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-4369"></span><span>                                      </span><span class="hs-special">]</span><span>
</span><span id="line-4370"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-4371"></span><span>
</span><span id="line-4372"></span><span>      </span><span id="local-6989586621679117789"><span class="annot"><span class="annottext">frameSpec :: VLSpec
</span><a href="#local-6989586621679117789"><span class="hs-identifier hs-var hs-var">frameSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">250</span></span><span>
</span><span id="line-4373"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">250</span></span><span>
</span><span id="line-4374"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117794"><span class="hs-identifier hs-var">rawLayer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117790"><span class="hs-identifier hs-var">trendLayer</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4375"></span><span>
</span><span id="line-4376"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4377"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4378"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117797"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4379"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#columns"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span>
</span><span id="line-4380"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#facetFlow"><span class="hs-identifier hs-var">facetFlow</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4381"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117789"><span class="hs-identifier hs-var">frameSpec</span></a></span><span>
</span><span id="line-4382"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-4383"></span><span>
</span><span id="line-4384"></span><span>
</span><span id="line-4385"></span><span class="hs-comment">{-|

This is the same data as 'loessExample', but using a linear
regression model to try and explain the data. Practically,
the only things that have changed are switching from
'loess' to 'regression', and displaying all the data in
a single visualization.

&lt;&lt;images/vl/regressionexample.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4IgLgTghgdgzgMwPYQLYgFwG1QIJYA2YAphJiABQAmUYArqgHQAiAogPoCSAwgEoDKAAgB8AXkEAGAJSCAZIOq0GLDjwGCAPOIAs0kAF8AugBoQAC2J4A5mbCYAzBImmaYKJlB0IBcrbAAHOAwAemDoAHdGKzwwMzoAIzo4UgBjJBgSDMY01GDmJDorACEvAGtiYLMAN2IrKGDUKDgSCEqauuDXerq8KABaKH6ANgBGIYGRiT63eIJiEahGGCQ+iygqUkYwOCqQU2Q0Wg8QfygIZOOAcUarchgGeNI9kF4AQS4+fjuHp9N-AgAHt9UI8yKY2B8BMDQc9iOx-kCMCB7iCnvp0aZwngqLEHE5TAASOApCyNXxgAJBULtRbRWIJRh4JDBYmk+o0voEGIVKraRgAKzg6WeBCgAE8nthQI0IKVyP4kHgMrCYGkqErbhhQGkCChjvhiAQqORuAQki0DKZEbg8IbjUjrlBbqZiVA5scAF6kJCYBBu5L6UxgMX+YjkACOdFgYBitDwNUtIDF+ttRvlgOervdWpAXogPowfoIAaDIbDSMj0djMYT6MDoEgsEQKHQUpAVnzdH88WT2BApvNTxMIAgtVHcDgTJg6aBpmFDpuBmHMrlOea+fKAHVsbiMAAmF2QJDlcizKApOWl0PkLkwMOBkDEVVIdUwTXapC6sg5g1ppED5o0StFM7XIR1nRALNy1APMCyLEtwDLCMowyat43vUxextUCkQRTMUjdaDc29X1-WIB9g2vCsUJjNwa3vdFDH0IA Open this visualization in the Vega Editor&gt;

@
let simplify = transform
               . filter (FExpr \&quot;(datum.DE_ICRS &gt;= 0) &amp; (datum.DE_ICRS &lt;= 40)\&quot;)

    axis pos lbl = position pos [ PName lbl
                                , PmType Quantitative
                                , PScale [ SZero False ]
                                ]
    enc = encoding
          . axis X \&quot;Gmag\&quot;
          . axis Y \&quot;plx\&quot;
          . color [ MName \&quot;Cluster\&quot; ]

    rawLayer = asSpec [ enc [], mark Point [] ]

    trans = transform
            . 'regression' \&quot;plx\&quot; \&quot;Gmag\&quot; [ 'RgGroupBy' [ \&quot;Cluster\&quot; ] ]

    trendLayer = asSpec [ trans []
                        , enc []
                        , mark Line [ MStroke \&quot;black\&quot;
                                    , MStrokeWidth 2
                                    ]
                        ]

in toVegaLite
     [ width 300
     , height 300
     , gaiaData
     , simplify []
     , layer [ rawLayer, trendLayer ]
     ]
@

In this example I used the default method - 'RgLinear' - but other
options are possible (set with the 'RgMethod' option).

-}</span><span>
</span><span id="line-4435"></span><span>
</span><span id="line-4436"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#regressionExample"><span class="hs-identifier hs-type">regressionExample</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4437"></span><span id="regressionExample"><span class="annot"><span class="annottext">regressionExample :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#regressionExample"><span class="hs-identifier hs-var hs-var">regressionExample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4438"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117788"><span class="annot"><span class="annottext">simplify :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117788"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4439"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FExpr"><span class="hs-identifier hs-var">FExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(datum.DE_ICRS &gt;= 0) &amp; (datum.DE_ICRS &lt;= 40)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4440"></span><span>
</span><span id="line-4441"></span><span>      </span><span id="local-6989586621679117787"><span class="annot"><span class="annottext">axis :: Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117787"><span class="hs-identifier hs-var hs-var">axis</span></a></span></span><span> </span><span id="local-6989586621679117786"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679117786"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679117785"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117785"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679117786"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117785"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-4442"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4443"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4444"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-4445"></span><span>      </span><span id="local-6989586621679117784"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117784"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4446"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117787"><span class="hs-identifier hs-var">axis</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4447"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117787"><span class="hs-identifier hs-var">axis</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-4448"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4449"></span><span>
</span><span id="line-4450"></span><span>      </span><span id="local-6989586621679117783"><span class="annot"><span class="annottext">rawLayer :: VLSpec
</span><a href="#local-6989586621679117783"><span class="hs-identifier hs-var hs-var">rawLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117784"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4451"></span><span>
</span><span id="line-4452"></span><span>      </span><span id="local-6989586621679117782"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117782"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4453"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Text
-&gt; [RegressionProperty]
-&gt; [TransformSpec]
-&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#regression"><span class="hs-identifier hs-var">regression</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; RegressionProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#RgGroupBy"><span class="hs-identifier hs-var">RgGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4454"></span><span>
</span><span id="line-4455"></span><span>      </span><span id="local-6989586621679117779"><span class="annot"><span class="annottext">trendLayer :: VLSpec
</span><a href="#local-6989586621679117779"><span class="hs-identifier hs-var hs-var">trendLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117782"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4456"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117784"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4457"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-4458"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-4459"></span><span>                                      </span><span class="hs-special">]</span><span>
</span><span id="line-4460"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-4461"></span><span>
</span><span id="line-4462"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4463"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4464"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4465"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4466"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117788"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4467"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117783"><span class="hs-identifier hs-var">rawLayer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117779"><span class="hs-identifier hs-var">trendLayer</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4468"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-4469"></span><span>
</span><span id="line-4470"></span><span>
</span><span id="line-4471"></span><span class="hs-comment">-- XXX TODO: add an example showing R2 in plot title</span><span>
</span><span id="line-4472"></span><span>
</span><span id="line-4473"></span><span>
</span><span id="line-4474"></span><span class="hs-comment">-- $intro-error</span><span>
</span><span id="line-4475"></span><span class="hs-comment">-- Here we dive into some of the ways for representing the spread</span><span>
</span><span id="line-4476"></span><span class="hs-comment">-- of a value, focussing on the \&quot;error\&quot; of a variable.</span><span>
</span><span id="line-4477"></span><span>
</span><span id="line-4478"></span><span class="hs-comment">{-|
We have already seen &quot;error bars&quot; in the 'layeredDiversion' plot, where
the 'Rule' type was used to draw a line between the 'Y' and 'Y2'
encodings. In that example the two positions were calculated \&quot;on the
fly\&quot; by Vega-Lite (using the 'Min' and 'Max' aggregation operations).
In this example I use the data to calculate the display range,
namely @plx - e_plx@ to @plx + e_plx@. These are mapped to the
'X' and 'X2' channels (not because it makes a better visualization,
but just to show you can create lines along the x axis), and a
small-multiples approach is used to separate out the clusters, but
only after a filter designed to select the two clusters - with the
\&quot;most interesting\&quot; data for this plot - has been applied.

&lt;&lt;images/vl/errormanual.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxhJUBLAG2gFNY8oATeaAVywDoBhKt5OrAIAGALpgAvBLABybjLAAfRWBbsuvfoJHipsgBIzIAXwA0xCGXjJGkAA5UAHgH0q6SKagBjeFS9sqVlpbNQ5OB0cwAFpVVjDaZwiTcxJSSGtbCOcACwoPb19-QLoQuK4IsABqWPVOBKTjYlEUqCx4WABrW1gA4JbINXhGUFTINlgqW2zoaDtkXAB6BYQAd04AcwpobLYAI356L3REOhPOI6wFgBF0NnWAIXGO2gXsgDdadfgFtoF6V4+XwWgwWXwo8Ci8AhADYAIzQyGw4RRaDwXZUWiw+CcRDoKLZWjwJj0TjQZBvDwWKAYbCsYZUiD2drIYL4EapEiQADibXWtkQHF29EpHM5ACUAILOACS3DFAGV+YLhS1RfYnEqsEKGKqOZArgBRGVyxX4SACrUqhmc+oas0W7WQa2NVIusBmYiQAAkyC8BLaUxmc0WC0B2M22z2nAo6AWvv93zDUSoWxebwALJwAFbIY4iqAsjFeaAxxDDewULzPJjl3YURA1s2+3y0GyeGAATzsrKg9cEb18Jg9jNoiCOTHrfLZVMgjgATOXKLQqI2oFlcskZ456WqlyvMk5XO5dYzmxjywAvejufCoXws4d66BdnuQACObCQJdRJY++dG8COBQNhsjAWznmadjtL4gSRAAFL8ACUJhUo+jJHHwWBlqBe6rpAmh-DqUDPt2-LoFg9aDmhUAdouFDLnhPLwHy7Yka+H5flsrAUH+bqPpARyIJQU6kI0xhAA Open this visualization in the Vega Editor&gt;

@
let trans = transform
              . filter (FExpr \&quot;datum.Cluster[0] == \'C\' || datum.Cluster[0] == \'H\'\&quot;)
              . calculateAs \&quot;datum.plx - datum.e_plx\&quot; \&quot;plx_lo\&quot;
              . calculateAs \&quot;datum.plx + datum.e_plx\&quot; \&quot;plx_hi\&quot;

    errorEnc = encoding
                 . position X [ PName \&quot;plx_lo\&quot;
                              , PmType Quantitative
                              , PScale [SZero False]
                              , PAxis [ AxTitle &quot;parallax (mas)&quot; ]
                              ]
                 . position 'X2' [ PName \&quot;plx_hi\&quot; ]
                 . position Y [ PName \&quot;Gmag\&quot;, PmType Quantitative ]
                 . column [ FName \&quot;Cluster\&quot;, FmType Nominal ]

    sel = selection
            . select &quot;picked&quot; Interval [ BindScales ]

in toVegaLite [ gaiaData
              , trans []
              , errorEnc []
              , mark Rule []
              , sel []
              ]
@

For the interested reader, it was the calculation of the @\&quot;plx_hi\&quot;@
column that lead me to the discovery that the columns were being
read in as a string, and the introduction of the 'Parse' option
to 'gaiaData'.

As can be seen, the @e_plx@ terms are generally very small. This is
good for anyone using the data, as we want precise measurements, but
makes it harder for me to come up with meaningful visualizations! I
have taken advantage of the 'BindScales' interaction to zoom in on
a subset of stars which show larger parallax errors:

&lt;&lt;images/vl/errormanual-zoomed.png&gt;&gt;

-}</span><span>
</span><span id="line-4536"></span><span>
</span><span id="line-4537"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorManual"><span class="hs-identifier hs-type">errorManual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4538"></span><span id="errorManual"><span class="annot"><span class="annottext">errorManual :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#errorManual"><span class="hs-identifier hs-var hs-var">errorManual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4539"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117778"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117778"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4540"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FExpr"><span class="hs-identifier hs-var">FExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.Cluster[0] == 'C' || datum.Cluster[0] == 'H'&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4541"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.plx - datum.e_plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_lo&quot;</span></span><span>
</span><span id="line-4542"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.plx + datum.e_plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_hi&quot;</span></span><span>
</span><span id="line-4543"></span><span>
</span><span id="line-4544"></span><span>      </span><span id="local-6989586621679117777"><span class="annot"><span class="annottext">errorEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117777"><span class="hs-identifier hs-var hs-var">errorEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4545"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_lo&quot;</span></span><span>
</span><span id="line-4546"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4547"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">]</span><span>
</span><span id="line-4548"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4549"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-4550"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X2"><span class="hs-identifier hs-var">X2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx_hi&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4551"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4552"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4553"></span><span>
</span><span id="line-4554"></span><span>      </span><span id="local-6989586621679117775"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117775"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-4555"></span><span>              </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;picked&quot;</span></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BindScales"><span class="hs-identifier hs-var">BindScales</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4556"></span><span>
</span><span id="line-4557"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4558"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117778"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4559"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117777"><span class="hs-identifier hs-var">errorEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4560"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4561"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117775"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4562"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4563"></span><span>
</span><span id="line-4564"></span><span class="hs-comment">{-|

Alternatively, I could have made life simpler for myself and used
the 'ErrorBar' (or 'ErrorBand') mark type, together with 'XError'
(or 'YError') to indicate that the channel gives the offset from
the central value. For this visualization I restrict to a single
cluster (since I now know there's only one in this sample which
begins with @C@), but retain the 'column' encoding as a means
to getting a useful title. I've also switched things so that the
errors are back along the y axis.

&lt;&lt;images/vl/errorauto.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJUBLAG2gFNY8oATeaAVywDoBhc55a2AgAwBdMAF5RYAOQdJkAL5CANOChZ4sANZ1INWJgBG6yMoiRG0eHVARTzWOW0ALaNAAOyXAHpPCAO5sAc1JoR2Z9HhoAY3REali2aKxPABF0ZgCAITsNKk9HADcqAPhPNV4aPMLiz3MS4tJ4AFp4JoA2AEZW5vaBRot9cip2+DZEdEbHKnh6GjZoZHzjFVMMbCYrZZtIV3VkKg2bQ6gAcTUA7URWfRolo62AJQBBAH0ASQ57gGULq5uTO6grnIAA8flhrrR-ndIMkAKJvD7ffCQS7gv6bQ46Z5A0HI1EQyAYsByTYkiByf6QAAkyEikzUThc7i8niqIyCITCbFI6E8tPpJTZjXIwVy+QALGwAFbIGK3KBURDReikRDnfDWLYAT1hsD0tA1JFIVHI9G0VGxIPkUKguLAxDIJrNyNO8HOiig0C1rn2yIAjswkNBgkxSIVrZtINFuFhEFYjU7tFweHxjJ7vb6oGMsKr4A4KZGtQcjgnTdocfLMbS85niAAvGjoOioPN7AvQr0+7QBoMh4Phm2meDA0jIePB6CDcvqPPkYdgAAUZQAlPJSSp21BoogyOr7SS5EA Open this visualization in the Vega Editor&gt;

@
let trans = transform
              . filter (FExpr \&quot;datum.Cluster[0] == \'C\'\&quot;)

    errorEnc = encoding
                . position Y [ PName \&quot;plx\&quot;
                             , PmType Quantitative
                             , PScale [SZero False]
                             , PAxis [ AxTitle \&quot;parallax (mas)\&quot; ]
                             ]
                . position 'YError' [ PName \&quot;e_plx\&quot; ]
                . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative ]
                . column [ FName \&quot;Cluster\&quot;, FmType Nominal ]

in toVegaLite [ gaiaData
              , trans []
              , errorEnc []
              , mark 'ErrorBar' []
              ]
@
-}</span><span>
</span><span id="line-4600"></span><span>
</span><span id="line-4601"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorAuto"><span class="hs-identifier hs-type">errorAuto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4602"></span><span id="errorAuto"><span class="annot"><span class="annottext">errorAuto :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#errorAuto"><span class="hs-identifier hs-var hs-var">errorAuto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4603"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117774"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117774"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-4604"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FExpr"><span class="hs-identifier hs-var">FExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.Cluster[0] == 'C'&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4605"></span><span>
</span><span id="line-4606"></span><span>      </span><span id="local-6989586621679117773"><span class="annot"><span class="annottext">errorEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117773"><span class="hs-identifier hs-var hs-var">errorEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4607"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-4608"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4609"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">]</span><span>
</span><span id="line-4610"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4611"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-4612"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#YError"><span class="hs-identifier hs-var">YError</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;e_plx&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4613"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4614"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#column"><span class="hs-identifier hs-var">column</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4615"></span><span>
</span><span id="line-4616"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4617"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117774"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4618"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117773"><span class="hs-identifier hs-var">errorEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4619"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#ErrorBar"><span class="hs-identifier hs-var">ErrorBar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4620"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4621"></span><span>
</span><span id="line-4622"></span><span>
</span><span id="line-4623"></span><span>
</span><span id="line-4624"></span><span class="hs-comment">{-|

In this plot the error range is calculated by Vega-Lite,
and is taken from the standard deviation of the @Gmag@ field
('StdDev'). The 'MTicks' and 'MRule' constructors are used to
color the different parts of the error bars. Since the error bar
does not reference the central value, a separate layer is used
to add a square symbol ('SymSquare') at the average ('Mean')
value of the distribution.

&lt;&lt;images/vl/errorbars.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFACYCGKpGYoEEkArgE4A2VMKKADgM7oD0fRqQDuAOkTwU0egCN63WIwDGAewB2KWBtGqAtnwAiK+ogBCTANaw+0AG6xEpPrtLdNjG-cd8yFPo-hSAFpSYIA2AEYwkIicIIoZZlgI0lE1FSC4UmJFURRuW0hCWigAMxVGFzRMGhKoTlJGBSpauqgAcRdENjV6XRlFIqI2yAAlAEEAfQBJAGFRgGUevoHGIba6TmYAD2X+weKNyAMAURn5pcxIXv21w5HYSa3dq5vVyGHaAF9Pn4gvw6QYTwYhSKi4AhESAAEm4SjgLjYqC4vAEXlSEikslE8BUfDhCKc6KCzEk1lsABZRAArbjqdZQZikACeg0wAG1Pq1aJAXIwLC1PiVIIx6EkWpBVMwKmxNKRWAChTzYNtNBo2G4coV7nVIChmZxYGxFIwKjJGgyRih4EoLNwJVKZVdOEwtka-nVFQ81KpiPA1N0akq6MyJaV4LBmMQ2J1SN18FA4fKjTVIAAvRQqKileUKAFQfWGtgAR3opA0knI8HskA9JTrYC9tG5dD5AtT3HgGaoACYCInoKQi1duKXGkaE3qDSn6ip-Wgm8KtL7-YHqMGoKHU+HI9GrrH41A44hGA5yDPebBy0UC9OS2WKxRrTWG-9fkQALqA5cqP0BiUvNQkA7lGbCzMw8juDeU7DlA6S6P68q1k2krqOGa7AD8XxAA Open this visualization in the Vega Editor&gt;

@
let cluster = position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]

    barOpts = [ 'MExtent' 'StdDev'
              , 'MTicks' [ 'MColor' \&quot;purple\&quot; ]
              , 'MRule' [ MColor \&quot;teal\&quot; ]
              ]
    range = [ mark ErrorBar barOpts
            , encoding
                . position Y [ PName \&quot;Gmag\&quot;
                             , PmType Quantitative
                             , PScale [ SZero False ]
                             ]
                $ []
            ]

    center = [ mark Point [ 'MShape' 'SymSquare', 'MSize' 20 ]
             , encoding
                 . position Y [ PName \&quot;Gmag\&quot;
                              , PmType Quantitative
                              , PmType 'Mean'
                              ]
                 $ []
             ]

in toVegaLite
      [ gaiaData
      , encoding (cluster [])
      , layer (map asSpec [ range, center ])
      , width 300
      , height 300
      ]
@

-}</span><span>
</span><span id="line-4673"></span><span>
</span><span id="line-4674"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBars"><span class="hs-identifier hs-type">errorBars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4675"></span><span id="errorBars"><span class="annot"><span class="annottext">errorBars :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBars"><span class="hs-identifier hs-var hs-var">errorBars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4676"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117770"><span class="annot"><span class="annottext">cluster :: BuildEncodingSpecs
</span><a href="#local-6989586621679117770"><span class="hs-identifier hs-var hs-var">cluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4677"></span><span>
</span><span id="line-4678"></span><span>      </span><span id="local-6989586621679117769"><span class="annot"><span class="annottext">barOpts :: [MarkProperty]
</span><a href="#local-6989586621679117769"><span class="hs-identifier hs-var hs-var">barOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MExtent"><span class="hs-identifier hs-var">MExtent</span></a></span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent
</span><a href="Graphics.Vega.VegaLite.Mark.html#StdDev"><span class="hs-identifier hs-var">StdDev</span></a></span><span>
</span><span id="line-4679"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MarkProperty] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MTicks"><span class="hs-identifier hs-var">MTicks</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;purple&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4680"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MarkProperty] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MRule"><span class="hs-identifier hs-var">MRule</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;teal&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4681"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4682"></span><span>      </span><span id="local-6989586621679117763"><span class="annot"><span class="annottext">range :: [PropertySpec]
</span><a href="#local-6989586621679117763"><span class="hs-identifier hs-var hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#ErrorBar"><span class="hs-identifier hs-var">ErrorBar</span></a></span><span> </span><span class="annot"><span class="annottext">[MarkProperty]
</span><a href="#local-6989586621679117769"><span class="hs-identifier hs-var">barOpts</span></a></span><span>
</span><span id="line-4683"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4684"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4685"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4686"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4687"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-4688"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4689"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-4690"></span><span>
</span><span id="line-4691"></span><span>      </span><span id="local-6989586621679117762"><span class="annot"><span class="annottext">point :: [PropertySpec]
</span><a href="#local-6989586621679117762"><span class="hs-identifier hs-var hs-var">point</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MShape"><span class="hs-identifier hs-var">MShape</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SymSquare"><span class="hs-identifier hs-var">SymSquare</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4692"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4693"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4694"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4695"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span>
</span><span id="line-4696"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-4697"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4698"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-4699"></span><span>
</span><span id="line-4700"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4701"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4702"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117770"><span class="hs-identifier hs-var">cluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4703"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117763"><span class="hs-identifier hs-var">range</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117762"><span class="hs-identifier hs-var">point</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4704"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4705"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4706"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-4707"></span><span>
</span><span id="line-4708"></span><span>
</span><span id="line-4709"></span><span class="hs-comment">{-|
The next plot shows the 'ErrorBand' mark, which fills the area between
the chosen range with a color, and optional borders. Here the
blue band shows the calculated standard deviation - as used in
'errorBars' - and the gray band with borders shows the inter-quartile
range. On top of these are drawn the median (blue) and median (green
dashed) lines.

&lt;&lt;images/vl/errorband.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFACYCGKpGYoEEkArgE4A2VMKKADgM7oD0fRqQDuAOkTwU0egCN63WIwDGAewB2KWBtGqAtnwAiK+ogBCTANaw+0AG6xEpPrtLdNjG-cd8yFPo-hSAFpSYIA2AEYwkIicIIoZZlgI0lE1FSC4UmJFURRuW0hCWigAMxVGFzRMGhKoTlJGBSpauqgAcRdENjV6XRlFIqI2yAAlAEEAfQBJAGFRgGUevoHGIba6TmYAD2X+weKNyAMAURn5pcxIXv21w5HYSa3dq5vVyGHaAF9Pn4gvw6QYTwYhSKi4AhESAAEm4SjgLjYqC4vAEXlSEikslE8BUfDhCKc6KCzEk1lsABZRAArbjqdZQFCSJJsWYqXQNRjwNSIMBCHmwbgMyDMUgAT0GmAA2p9WrRIC5GBYWpBYNtNBo2G4coV8IyxZxYGxFIwKjJSGpiJAAZ86FpVMRud0arb5WKVaV4LBmFarp1SN09ZA4aQWTVIAAvRQqKilUMKAH6w1sACO9AtTIoTPs1tdf2+92oroVjWVLo2UBkFRyTRVblNVgMrmgVClYT1ACYALo2iuQVTMCpsRBCd2Fkqq9VaapQeApu6uugoA1Gq4ms0Wq158dQe0qR08lqLqDu8Oe72+jpdIpQENh6iR6Ox+OwROQZfJq5pjOScjwHP5iUgFgL2tBynQipllApJqEaO6qmoDpOkefankWFZ0OePpsP6gbHnQd6rg+Uams+zAJjuE4BiODjkERCqwI6FoMn2H70d+Gi-tmRrHsB-y-IW4FQJBKoDkOVw0VoN7BigDawE23AttK7ZgB2eoUp2XZBmxbAwUaoETnuB7OuhRxoUJE5YZekC4SxRyESqJExpgcbka+lHytRjC0ZobC6LAzEeUuK6pumnFZv+PEVnxIG-EQWlQkZyHhi8D5WayzDyO40k6a87LcqG1qgf26ieiZwA-F8QA Open this visualization in the Vega Editor&gt;

@
let posY extra = position Y ([ PName \&quot;Gmag\&quot;
                             , PmType Quantitative
                             , PScale [ SZero False ]
                             ] ++ extra) []

    bands = [ [ encoding (posY [])
              , mark 'ErrorBand' [ MExtent StdDev ]
              ]
            , [ encoding (posY [])
              , mark ErrorBand [ MExtent 'Iqr'
                               , 'MBorders' [ 'MStrokeDash' [ 6, 2 ] ]
                               , MColor &quot;gray&quot;
                               ]
              ]
            , [ encoding (posY [ PAggregate Median ])
              , mark Line []
              ]
            , [ encoding (posY [ PAggregate Mean ])
              , mark Line [ MColor \&quot;green\&quot;
                          , MStrokeDash [ 6, 2, 4, 2 ]
                          ]
              ]
            ]

in toVegaLite
    [ gaiaData
    , encoding (position X [ PName \&quot;Cluster\&quot;, PmType Nominal ] [])
    , layer (map asSpec bands)
    , width 300
    , height 300
    , title &quot;Comparing ranges&quot; []
    ]
@

Note that I don't think this is a good visualization
for this /particular/ dataset, since it implies there's a
connection or correlation between clusters, as given by the
x-axis ordering, but the aim here is to show how to use @hvega@
rather than creating sensible plots!

-}</span><span>
</span><span id="line-4763"></span><span>
</span><span id="line-4764"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBand"><span class="hs-identifier hs-type">errorBand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4765"></span><span id="errorBand"><span class="annot"><span class="annottext">errorBand :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBand"><span class="hs-identifier hs-var hs-var">errorBand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4766"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117759"><span class="annot"><span class="annottext">posY :: [PositionChannel] -&gt; [EncodingSpec]
</span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var hs-var">posY</span></a></span></span><span> </span><span id="local-6989586621679117758"><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117758"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span>
</span><span id="line-4767"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4768"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SZero"><span class="hs-identifier hs-var">SZero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4769"></span><span>                               </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117758"><span class="hs-identifier hs-var">extra</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4770"></span><span>
</span><span id="line-4771"></span><span>      </span><span id="local-6989586621679117757"><span class="annot"><span class="annottext">bands :: [[PropertySpec]]
</span><a href="#local-6989586621679117757"><span class="hs-identifier hs-var hs-var">bands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [EncodingSpec]
</span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var">posY</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4772"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#ErrorBand"><span class="hs-identifier hs-var">ErrorBand</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MExtent"><span class="hs-identifier hs-var">MExtent</span></a></span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent
</span><a href="Graphics.Vega.VegaLite.Mark.html#StdDev"><span class="hs-identifier hs-var">StdDev</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4773"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4774"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [EncodingSpec]
</span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var">posY</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4775"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#ErrorBand"><span class="hs-identifier hs-var">ErrorBand</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MExtent"><span class="hs-identifier hs-var">MExtent</span></a></span><span> </span><span class="annot"><span class="annottext">MarkErrorExtent
</span><a href="Graphics.Vega.VegaLite.Mark.html#Iqr"><span class="hs-identifier hs-var">Iqr</span></a></span><span>
</span><span id="line-4776"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MarkProperty] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MBorders"><span class="hs-identifier hs-var">MBorders</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeDash"><span class="hs-identifier hs-var">MStrokeDash</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4777"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gray&quot;</span></span><span>
</span><span id="line-4778"></span><span>                                 </span><span class="hs-special">]</span><span>
</span><span id="line-4779"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4780"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [EncodingSpec]
</span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var">posY</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Median"><span class="hs-identifier hs-var">Median</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4781"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4782"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4783"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [EncodingSpec]
</span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var">posY</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4784"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;green&quot;</span></span><span>
</span><span id="line-4785"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeDash"><span class="hs-identifier hs-var">MStrokeDash</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4786"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-4787"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4788"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-4789"></span><span>
</span><span id="line-4790"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4791"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4792"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4793"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PropertySpec] -&gt; VLSpec) -&gt; [[PropertySpec]] -&gt; [VLSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[[PropertySpec]]
</span><a href="#local-6989586621679117757"><span class="hs-identifier hs-var">bands</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4794"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4795"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4796"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Comparing ranges&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4797"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-4798"></span><span>
</span><span id="line-4799"></span><span>
</span><span id="line-4800"></span><span class="hs-comment">{-|

An alternative visualization of a distribution is the \&quot;box and
whiskers\&quot; plot, which can be achieved in @hvega@ with the
'Boxplot' mark. The example below shows the default settings, but
the various components can be controlled with 'MBox', 'MMedian',
'MOutliers', and 'MTicks'.

&lt;&lt;images/vl/errorbox.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMBmADDgNOFALYCGATgNYZQBGA9gB4AOANvWoRJACakqkaoCNwCu5VjRgoUzAM7oA9IvKkA7gDpE8FNFG1Rc2OQDG9AHYpYljWeKKAIvVGIAQuMqxF0AG6xEpIpkclbk3n4BinwCigHwpAC0pIkAbACMKUlpOAkCtKywaaQa5vQJcKQ8xhoocj6QXCKQAGb05GRomMIi3MwURkJEPdwA4mSIUuaixLTGDUPDkABKAIIA+gCSAMJLAMqT07Pk88NNbIwHM3ONp5AOAKKbO-uYkFNXxzeLsGvnl0eQBYQAC+C1BIMakDU8B4uhouAIREgABI5CY4GQpKhZAplBFitpdPoNPB6Io0RjAviEqwdF4fAAWDQAKzkFhOUGsZh48HMEy6C0gFy6LXgsFYPCkW1YhlCDSgKAAnsxYJN6MReaRJMCvpBFUJReLJa8xqQJvgFcrVa8AI6iUiWHT8eB+SDgsA6pFmczNJBCUHAoA Open this visualization in the Vega Editor&gt;

@
toVegaLite
    [ gaiaData
    , encoding
        . position X [ PName \&quot;Cluster\&quot;, PmType Nominal ]
        . position Y [ PName \&quot;Gmag\&quot;, PmType Quantitative ]
        $ []
    , mark 'Boxplot' []
    , width 300
    , height 300
    ]
@

The 'Boxplot' option supports two different \&quot;ranges\&quot;:

 * the default is the Tukey Box plot, where the whiskers span
   a range @Q1 - k * IQR@ to @Q3 + k * IQR@, @IQR = Q3 - Q1@,
   @Q1@ and @Q3@ are the lower and upper inter-quartile values
   (so 25 and 75 per cent of the distribution), and @k@
   defaults to 1.5 but can be changed with 'IqrScale';

 * or 'ExRange', which uses the full range of the data (i.e.
   minimum to maximum values).

-}</span><span>
</span><span id="line-4837"></span><span>
</span><span id="line-4838"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBox"><span class="hs-identifier hs-type">errorBox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4839"></span><span id="errorBox"><span class="annot"><span class="annottext">errorBox :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#errorBox"><span class="hs-identifier hs-var hs-var">errorBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4840"></span><span>  </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4841"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4842"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4843"></span><span>          </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4844"></span><span>          </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4845"></span><span>          </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4846"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Boxplot"><span class="hs-identifier hs-var">Boxplot</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4847"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4848"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">300</span></span><span>
</span><span id="line-4849"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-4850"></span><span>
</span><span id="line-4851"></span><span>
</span><span id="line-4852"></span><span class="hs-comment">{-|

Here I combine 'errorBox' with 'smallMultiples2' so we can compare
the distribution (from the histogram) with that from the box plot.

&lt;&lt;images/vl/comparingerrors.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zUBRk-EIVp3iwAE82qgANr3QqzSAmHAaBrcUrrDZnMSiaBsMT1VAQpGiPA5ApZNj8PDQBpDPB8cypKDwAFfCYiWTo2AEFJQYIsKSk1BNPB4N73U5XNCE4ncqC1WD1NmQbjowjwHBYfgy2n0g4ARywsAkHAQbH0kAFGwyAN+JoyUpYOAMCH4DVEWAkiItNLp9s12t1iHgBvt71dkFgCzYFAJvvgwQaADkjjgwCJMmBRogykbBRgXhss0VjVVsadobCsRnMLJ+GidQTcfiDkFYEJYXmTbKRMLgJAzDgRFoGgwiBx7c2kcpI0S06hMiyBAGkWqPVBuG35iJ8hnh6cpKj0Zi0KWoDW1ljRSSyRSzNM3eqoBEmWIWdTIByuYRefzZ5D2yfxZBJdKrwukBajqEb6oaG6dGax66CyyqEAAHL4OZVMhrwdAAuukeaQAAJBQQjRCYDQkOQVC0FYYTsJwPBMGwIjUPhhFGBRTh4IO1C6AALEwABWFDiIikC4s0YhhqgADM7xZA2-D5MemREqeBzkpSl6QPODJ3g+2GiGICm7sATwPEAA Open this visualization in the Vega Editor&gt;

@
let histEnc = encoding
                . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative, PBin [] ]
                . position Y yAxis
                . color [ MName \&quot;Cluster\&quot;, MmType Nominal, MLegend [] ]

    errEnc = encoding
               . position X [ PName \&quot;Gmag\&quot;, PmType Quantitative ]
               . position Y [ 'PNumber' 80 ]
               . color [ MName \&quot;Cluster\&quot;, MmType Nominal, MLegend [] ]

    yAxis = [ PAggregate Count
            , PmType Quantitative
            , PAxis [ AxTitle \&quot;Number of Stars\&quot; ]
            ]

    boxOpts = [ 'MMedian' [ MColor \&quot;black\&quot; ]
              , 'MBox' [ MStroke \&quot;white\&quot; ]
              , 'MNoOutliers'
              ]

    histSpec = asSpec [ mark Bar [], histEnc [] ]
    errSpec = asSpec [ mark Boxplot boxOpts, errEnc [] ]

    combinedSpec = asSpec [ layer [ histSpec, errSpec ] ]

in toVegaLite
    [ gaiaData
    , columns 3
    , facetFlow [ FName \&quot;Cluster\&quot;, FmType Nominal ]
    , specification combinedSpec
    ]
@

The main additions here are the configuration of the box plot - with
'MMedian', 'MBox' (used to ensure the box is visually distinct from
the bar for the Pleiades cluster, where they overlap), and 'MNoOutliers'
(to turn off the display of the outliers) - and the use of 'PNumber'
to define the location on the y axis of the boxplot visualization.
Note that 'PNumber' is defined in pixel units, with 0 being the
top of the visualization and 80 was found by trial and error.

-}</span><span>
</span><span id="line-4904"></span><span>
</span><span id="line-4905"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#comparingErrors"><span class="hs-identifier hs-type">comparingErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-4906"></span><span id="comparingErrors"><span class="annot"><span class="annottext">comparingErrors :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#comparingErrors"><span class="hs-identifier hs-var hs-var">comparingErrors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4907"></span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117752"><span class="annot"><span class="annottext">histEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117752"><span class="hs-identifier hs-var hs-var">histEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4908"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4909"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117751"><span class="hs-identifier hs-var">yAxis</span></a></span><span>
</span><span id="line-4910"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4911"></span><span>
</span><span id="line-4912"></span><span>     </span><span id="local-6989586621679117750"><span class="annot"><span class="annottext">errEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var hs-var">errEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-4913"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4914"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PNumber"><span class="hs-identifier hs-var">PNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">80</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4915"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4916"></span><span>
</span><span id="line-4917"></span><span>     </span><span id="local-6989586621679117751"><span class="annot"><span class="annottext">yAxis :: [PositionChannel]
</span><a href="#local-6989586621679117751"><span class="hs-identifier hs-var hs-var">yAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span>
</span><span id="line-4918"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-4919"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of Stars&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4920"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-4921"></span><span>
</span><span id="line-4922"></span><span>     </span><span id="local-6989586621679117748"><span class="annot"><span class="annottext">boxOpts :: [MarkProperty]
</span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var hs-var">boxOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[MarkProperty] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MMedian"><span class="hs-identifier hs-var">MMedian</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4923"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MarkProperty] -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MBox"><span class="hs-identifier hs-var">MBox</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;white&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4924"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MNoOutliers"><span class="hs-identifier hs-var">MNoOutliers</span></a></span><span>
</span><span id="line-4925"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-4926"></span><span>
</span><span id="line-4927"></span><span>     </span><span id="local-6989586621679117744"><span class="annot"><span class="annottext">histSpec :: VLSpec
</span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var hs-var">histSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117752"><span class="hs-identifier hs-var">histEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4928"></span><span>     </span><span id="local-6989586621679117743"><span class="annot"><span class="annottext">errSpec :: VLSpec
</span><a href="#local-6989586621679117743"><span class="hs-identifier hs-var hs-var">errSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Boxplot"><span class="hs-identifier hs-var">Boxplot</span></a></span><span> </span><span class="annot"><span class="annottext">[MarkProperty]
</span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var">boxOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">errEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4929"></span><span>
</span><span id="line-4930"></span><span>     </span><span id="local-6989586621679117742"><span class="annot"><span class="annottext">combinedSpec :: VLSpec
</span><a href="#local-6989586621679117742"><span class="hs-identifier hs-var hs-var">combinedSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">histSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117743"><span class="hs-identifier hs-var">errSpec</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4931"></span><span>
</span><span id="line-4932"></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-4933"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-4934"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#columns"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-4935"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FacetChannel] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#facetFlow"><span class="hs-identifier hs-var">facetFlow</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FName"><span class="hs-identifier hs-var">FName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; FacetChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#FmType"><span class="hs-identifier hs-var">FmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4936"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#specification"><span class="hs-identifier hs-var">specification</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117742"><span class="hs-identifier hs-var">combinedSpec</span></a></span><span>
</span><span id="line-4937"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-4938"></span><span>
</span><span id="line-4939"></span><span>
</span><span id="line-4940"></span><span class="hs-comment">-- $intro-dashboard</span><span>
</span><span id="line-4941"></span><span class="hs-comment">-- In the following visualization I try to combine as many of the</span><span>
</span><span id="line-4942"></span><span class="hs-comment">-- concepts we have explored in this tutorial into one. There are</span><span>
</span><span id="line-4943"></span><span class="hs-comment">-- layers, combined visualizations, and a</span><span>
</span><span id="line-4944"></span><span class="hs-comment">-- selection that ties the different plots together! How much more</span><span>
</span><span id="line-4945"></span><span class="hs-comment">-- could you want?</span><span>
</span><span id="line-4946"></span><span>
</span><span id="line-4947"></span><span class="hs-comment">{-|

This is based on the
&lt;https://vega.github.io/vega-lite/examples/concat_marginal_histograms.html Marginal Histogram&gt;
example from the Vega-Lite
&lt;https://vega.github.io/vega-lite/examples/ Example Gallery&gt;.
There is very-little new in this plot, in that pretty-much everything
has been shown before. However, there are some interesting wrinkles,
such as

  * combining multiple plots, in this case the \&quot;top\&quot; area - which is
    a histogram on top of a plot which is itself a \&quot;map\&quot; and
    a histogram - and \&quot;bottom&quot; area - which is just a point plot -
    requires judicious use of 'asSpec';

  * selection works in __both__ the main plots - the \&quot;map\&quot; and \&quot;point\&quot;
    plots - to highlight all stars in the same cluster, and I was
    pleasantly surprised to find out I could just use the same selection
    specification (@selCluster@) in both (hopefully I am not just
    enjoying a hole in the Vega-Lite specification);

  * I have been perhaps too defensive in defining the Right Ascension
    and Declination axes in the relevant plots, as I want to make sure
    the histogram bins and plot axes are well aligned (that is the
    @'Nice' False@ statements may not be needed when defining the
    histogram axes);

  * I am not 100% sure I understand what is going on with the
    grid labels on the Declination axis, as I had thought I was
    asking for marks every 15 degrees, but the plot shows them
    every 30 degrees (however, if I change the @deTicks@ array then
    the marks change in ways I currently do not understand);

  * and I have decided to display Right Ascension in hours, rather than
    degrees, because why have one way to measure a value when you can
    have many!

&lt;&lt;images/vl/combinedplot.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1hJ5k8oAlAQUgBooBjeAGwYFdn5oBTcyAEy5ssAOmoB9AJIBhCgGUwAejABGAKyQAvgF1a4RukSoAlgHNyxAG7HuAdwuRkcdAGte+GAhQAHeLG6I0FqaehACXPAW+mFssMx8ABbQ0N7IuIqKCLYipsbQCWwARmzI3LAMhjyBIhVYigAi6GymAEKxbooJltym8IpYpDywnd29ioLQfb3G8AC08HMAbCqL8yoADLOThczcKvAiiOizCdzw-GUi0MiWdNFQGNhcURCvUL6wpS9vr5AA4gNzB5EMJCmU7j9fhIZPI+CCsGDYBDIe9mAAPOGg8GhFGQeoAUSksjkmIR2Pub0g3HE3nRpMRkApYE09xZEBC+kglgqiCYQXwBHuoEhXJ5fPIgpRYGFUqgpzMSXIG3WOKlkFsxn4+XIABZ1iqmZTOABPcECw0-GWy34DWAuBwVZiYPimBDGuhQaDG7zuKCFPxaVXWqABCr8YyIIHSi1qjH4K3BykmbjMfh8ajIxOUwoRhzcNFVfmEFVgABMOt0UCc3G85FL9EgiGMDF9qBYpQ5WZ+jkwRYE3GQLcQ4cjma7nu9vsgAEc2EhoHkuMZumOuyQ0cYyPgQcxmDGUZ3x5B3fH92rByxfcR+OgBrmBSWAMz69baQ-jqDwUyunpcKcVNhAlXLMYEnPhZ3nRcFxXIM13gDct2lGA8l2cgd2YNlx0wxNsNld9ZQTa1PCQNBMBwAViBMZghgcUpdgYBdDD4bxm3tTQdFg2VIFte0PH9JFOLVUN0BHKNCODSBHWdU8PzCSwWDYKcf3dQSJJ5cNGMQb5ZIeGxUz4aRmBKGjVMTRwU24BjjCYjwWIYe1TIkr0fThW8IxYRkdNwnDHJFONox0yBk30jwM183Ecy0+MqQLAIiwIEty0rRweFrfB6ygJsW3INtmA7cKRWQXs+AuQcAlE4CzOcqcIMCKDl14Aru3gzc0I4PcP3wsyTwC2THCYVDopvO8ouLehn31N8mspL8f16Hg+AAoDpt+arwLnOrJmgxqz1xFrEOIBdoEGsB0O84NzqlS6fmuiBtAtLrXnEykEjFZ5zUTZ7cXlUxFXwPUDTXHiHHQXwGDyHr1hENQGzWjxwfKVDHrVDUtQSXV9Sa8z6M0hw7N4pC4arCNTFQhtgv4RCCEgQzjPBN9kdxYSKpko8pKRVmPy5BSlP8FTdpFdS8ms0avrMimDKM6sBIF3E6Ms3HbNYyqQKJxs3MQDzZbeW6DxWyB-LFriJdCmgVrCC8TuvW94HvMaywrBsstbdtuEZoiitgPtSqHCrzYnFyPFqo6lxg7Xfn2hwjpOyAKAVaAwCoMqUBFsAAAoEiaT4AEotHD93cR6o21RNqACSJWF-f6y8HGG23RoIWYAE4Sxb5LnZy12C7VNXg-qsPAsjzm+vkoyBwlcPIWbwGdNeWYAHYYcnn5ZkWGfZ7AWYdSXjeIFmZ9-beWZ1EP1519nk-l7eA+r9ebfT4gNeH7ARfn5b2-dFv5DjqnepLOYdyml04XB-AOXOy9daQkga8aB3depmR+n9MAAMsao21PgZUWMTRmkIOHYuuJgbRXZi6N0HpQKBz9AGOBIpmYk20n1Q2t8LYDSvAIG2dsErjRfFNJhn5vz+Hmv+Joy1eHkJqhtEO20VZwQQlHFCvozq32oYXehgVS54kJDCEkz9ICRTzLFICApp70Dbg2asaVVAw0ys2F2eU3Y6N7hI-uO1d6flkdudqSiIH5xWvgkUcASKPHIoQSixhqI4OIPLKyNl3jK3Yp-QKhDKEy0CrQ0cw8ubEIySPHmJDuD81cZJQwGkRaqNnkFPSaYPC02ltIo8UTFaxPsnUtcasjhYHcvEXh0CrqnwNmUrmltWF1w4U+bhyi1SzQEX+RawiggOLAkHJxW0GotIkkPQm8i2q7h6XrL+RdRHqPLlotZRE9HRXzIWCUxiwCmKrKlJUVjGw2M7nYiZuJHGQRWQPXe65WoeN3F4ry+dZb3RwvuBJXFkBgzoelc+IpCjCMpnwVAUt0YPSZJCyk0L4Dg3SWWeFfokWISCmizyMCgziW4n4AmxBQa4ohuQKGTy1YIwYEjTi6pNToLAGoUshLsYK1KdFfGUdFnE0jGTXSKZkUChplLGiDNOVpLEhaIpToObwNxKPRSeSClcSFo0-BFSZWSzpikiSDThVNIcrtMRrkOmay6daa6jN+nZKTJU5idJHLVytvajwTpzBOxefgXK+V9wBqgH3b5LiuIbMOls2yfgWCcDROnDpu5jDzHKKUdSudXWqWPAM346iARfjqVGmcyzQ5xsme4zZP8+B-DAICJs0A2AXDzldJkuFMKQsgAAEkHKcAYiRkipHSIoUYBxcj5CKCIayigR3cAGNO38swAE8GnTqEQAArIqWkcTf39TwAszbbbwDABMK9qBYC3jAH4AAGsuXAKgAAc6xd3rCbo+ee76yFIAYJnTV3FNT8CRiATQQA Open this visualization in the Vega Editor (although the link is long, and may not work with Internet Explorer)&gt;

@
let trans = transform
              . calculateAs \&quot;datum.RA_ICRS / 15\&quot; \&quot;RA\&quot;

    quant n = [ PName n, PmType Quantitative ]

    big = 400
    small = 100
    wmain = width big
    hmain = height big
    wsub = width small
    hsub = height small
    noTitle = PAxis [ AxNoTitle ]

    raAxis = [ PScale [ SDomain (DNumbers [ 0, 24 ])
                      , SNice (IsNice False)
                      ]
             , PSort [ Descending ]
             , PAxis [ AxTitle \&quot;Right Ascension (hours)\&quot; ]
             ]

    deMin = -90
    deMax = 90
    deStep = 15

    -- we do not get ticks/grids at all these values, but it does
    -- something (e.g. if do not specify the axis ticks are different)
    --
    deTicks = Numbers [ deMin, deMin + deStep .. deMax ]
    deAxis = [ PScale [ SDomain (DNumbers [ deMin, deMax ])
                      , SNice (IsNice False)
                      ]
             , PAxis [ AxTitle \&quot;Declination (degrees)\&quot;
                     , AxValues deTicks
                     ]
             ]

    colorEnc = color [ MSelectionCondition (SelectionName \&quot;pick\&quot;)
                         [ MName \&quot;Cluster\&quot;, MmType Nominal ]
                         [ MString \&quot;grey\&quot; ]
                     ]
    mapEnc = encoding
               . position X (quant \&quot;RA\&quot; ++ raAxis)
               . position Y (quant \&quot;DE_ICRS\&quot; ++ deAxis)
               . colorEnc

    circleMark = mark Circle [ MOpacity 0.5 ]

    mapSpec = asSpec [ mapEnc []
                     , circleMark
                     , wmain
                     , hmain
                     , selCluster []
                     ]

    -- histogram of the RA values
    --
    raBinning = [ PBin [ 'Extent' 0 24
                       , Step 2
                       , Nice False
                       ]
                , PSort [ Descending ]
                , PAxis []
                ]

    -- histogram of the Declination values
    --
    deBinning = [ PBin [ Extent deMin deMax
                       , Step deStep
                       , Nice False
                       ]
                , PAxis []
                ]

    histAxis = [ PAggregate Count
               , PmType Quantitative
               , noTitle
               , PScale [ SDomain (DNumbers [ 0, 3000 ]) ]
               ]

    raEnc = encoding
              . position X (quant \&quot;RA\&quot; ++ raBinning)
              . position Y histAxis

    deEnc = encoding
              . position Y (quant \&quot;DE_ICRS\&quot; ++ deBinning)
              . position X histAxis

    allRA = [ raEnc []
            , mark Bar [ MColor \&quot;gray\&quot; ]
            ]
    filtRA = [ filterCluster []
             , raEnc
                 . colorEnc
                 $ []
             , mark Bar []
             ]

    allDE = [ deEnc []
            , mark Bar [ MColor \&quot;gray\&quot; ]
            ]
    filtDE = [ filterCluster []
             , deEnc
                 . colorEnc
                 $ []
             , mark Bar []
             ]

    raSpec = asSpec [ wmain, hsub, layer [ asSpec allRA, asSpec filtRA ] ]
    deSpec = asSpec [ hmain, wsub, layer [ asSpec allDE, asSpec filtDE ] ]

    borderSpacing = 20

    mapAndDecSpec = asSpec [ spacing borderSpacing
                           , 'bounds' 'Flush'
                           , hConcat [ mapSpec, deSpec ]
                           ]

    histSpecs = [ raSpec, mapAndDecSpec ]

    -- select the cluster which the star belongs to; do not use
    -- \&quot;nearest click\&quot; as that means a user can not cancel the
    -- selection.
    --
    pick = \&quot;pick\&quot;
    selCluster = selection
                   . select pick Single [ Fields [ \&quot;Cluster\&quot; ] ]

    filterCluster = transform
                      . filter (FSelection pick)

    plxOpts = [ PScale [ SType ScLog, SNice (IsNice False) ]
              , PAxis [ AxTitle \&quot;parallax (milli-arcsecond)\&quot; ]
              ]
    gmagOpts = [ PAxis [ AxTitle \&quot;G magnitude\&quot; ] ]

    encData = encoding
                . position X (quant \&quot;plx\&quot; ++ plxOpts)
                . position Y (quant \&quot;Gmag\&quot; ++ gmagOpts)

    parallaxSpec = asSpec [ width (big + borderSpacing + small)
                          , encData
                              . colorEnc
                              $ []
                          , circleMark
                          , selCluster []
                          ]

    allSpecs = [ asSpec [ spacing borderSpacing
                        , bounds Flush
                        , vConcat histSpecs
                        ]
               , parallaxSpec ]


in toVegaLite
   [ gaiaData
   , trans []
   , vConcat allSpecs
     -- remove the &quot;other&quot; axis (e.g. top of Y, right for X)
   , configure
       . configuration (ViewStyle [ 'ViewStroke' \&quot;transparent\&quot; ])
       $ []
   , title \&quot;Gaia data from arXiv:1804.09378\&quot; [ 'TAnchor' 'AMiddle' ]
   ]
@

Here is the visualization after selecting a star:

&lt;&lt;images/vl/combinedplot-selected.png&gt;&gt;

-}</span><span>
</span><span id="line-5160"></span><span>
</span><span id="line-5161"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#combinedPlot"><span class="hs-identifier hs-type">combinedPlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-5162"></span><span id="combinedPlot"><span class="annot"><span class="annottext">combinedPlot :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#combinedPlot"><span class="hs-identifier hs-var hs-var">combinedPlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5163"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117741"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117741"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5164"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.RA_ICRS / 15&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA&quot;</span></span><span>
</span><span id="line-5165"></span><span>
</span><span id="line-5166"></span><span>      </span><span id="local-6989586621679117740"><span class="annot"><span class="annottext">quant :: Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var hs-var">quant</span></a></span></span><span> </span><span id="local-6989586621679117739"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117739"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117739"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5167"></span><span>
</span><span id="line-5168"></span><span>      </span><span id="local-6989586621679117738"><span class="annot"><span class="annottext">big :: Double
</span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var hs-var">big</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">400</span></span><span>
</span><span id="line-5169"></span><span>      </span><span id="local-6989586621679117737"><span class="annot"><span class="annottext">small :: Double
</span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var hs-var">small</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">100</span></span><span>
</span><span id="line-5170"></span><span>      </span><span id="local-6989586621679117736"><span class="annot"><span class="annottext">wmain :: PropertySpec
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var hs-var">wmain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var">big</span></a></span><span>
</span><span id="line-5171"></span><span>      </span><span id="local-6989586621679117735"><span class="annot"><span class="annottext">hmain :: PropertySpec
</span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var hs-var">hmain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var">big</span></a></span><span>
</span><span id="line-5172"></span><span>      </span><span id="local-6989586621679117734"><span class="annot"><span class="annottext">wsub :: PropertySpec
</span><a href="#local-6989586621679117734"><span class="hs-identifier hs-var hs-var">wsub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var">small</span></a></span><span>
</span><span id="line-5173"></span><span>      </span><span id="local-6989586621679117733"><span class="annot"><span class="annottext">hsub :: PropertySpec
</span><a href="#local-6989586621679117733"><span class="hs-identifier hs-var hs-var">hsub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var">small</span></a></span><span>
</span><span id="line-5174"></span><span>      </span><span id="local-6989586621679117732"><span class="annot"><span class="annottext">noTitle :: PositionChannel
</span><a href="#local-6989586621679117732"><span class="hs-identifier hs-var hs-var">noTitle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxNoTitle"><span class="hs-identifier hs-var">AxNoTitle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5175"></span><span>
</span><span id="line-5176"></span><span>      </span><span id="local-6989586621679117731"><span class="annot"><span class="annottext">raAxis :: [PositionChannel]
</span><a href="#local-6989586621679117731"><span class="hs-identifier hs-var hs-var">raAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">24</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5177"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-5178"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-5179"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5180"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Right Ascension (hours)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5181"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-5182"></span><span>
</span><span id="line-5183"></span><span>      </span><span id="local-6989586621679117730"><span class="annot"><span class="annottext">deMin :: Double
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var hs-var">deMin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span>
</span><span id="line-5184"></span><span>      </span><span id="local-6989586621679117729"><span class="annot"><span class="annottext">deMax :: Double
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var hs-var">deMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span>
</span><span id="line-5185"></span><span>      </span><span id="local-6989586621679117728"><span class="annot"><span class="annottext">deStep :: Double
</span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var hs-var">deStep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">15</span></span><span>
</span><span id="line-5186"></span><span>
</span><span id="line-5187"></span><span>      </span><span class="hs-comment">-- we do not get ticks/grids at all these values, but it does</span><span>
</span><span id="line-5188"></span><span>      </span><span class="hs-comment">-- something (e.g. if do not specify the axis ticks are different)</span><span>
</span><span id="line-5189"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5190"></span><span>      </span><span id="local-6989586621679117727"><span class="annot"><span class="annottext">deTicks :: DataValues
</span><a href="#local-6989586621679117727"><span class="hs-identifier hs-var hs-var">deTicks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">deMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">deMin</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var">deStep</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">deMax</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5191"></span><span>      </span><span id="local-6989586621679117725"><span class="annot"><span class="annottext">deAxis :: [PositionChannel]
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var hs-var">deAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">deMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">deMax</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5192"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-5193"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-5194"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Declination (degrees)&quot;</span></span><span>
</span><span id="line-5195"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataValues -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxValues"><span class="hs-identifier hs-var">AxValues</span></a></span><span> </span><span class="annot"><span class="annottext">DataValues
</span><a href="#local-6989586621679117727"><span class="hs-identifier hs-var">deTicks</span></a></span><span>
</span><span id="line-5196"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-5197"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-5198"></span><span>
</span><span id="line-5199"></span><span>      </span><span id="local-6989586621679117724"><span class="annot"><span class="annottext">colorEnc :: BuildEncodingSpecs
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var hs-var">colorEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pick&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-5200"></span><span>                           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5201"></span><span>                           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MString"><span class="hs-identifier hs-var">MString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;grey&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5202"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-5203"></span><span>      </span><span id="local-6989586621679117723"><span class="annot"><span class="annottext">mapEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var hs-var">mapEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5204"></span><span>                 </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117731"><span class="hs-identifier hs-var">raAxis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5205"></span><span>                 </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">deAxis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5206"></span><span>                 </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">colorEnc</span></a></span><span>
</span><span id="line-5207"></span><span>
</span><span id="line-5208"></span><span>      </span><span id="local-6989586621679117722"><span class="annot"><span class="annottext">circleMark :: PropertySpec
</span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var hs-var">circleMark</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MOpacity"><span class="hs-identifier hs-var">MOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5209"></span><span>
</span><span id="line-5210"></span><span>      </span><span id="local-6989586621679117721"><span class="annot"><span class="annottext">mapSpec :: VLSpec
</span><a href="#local-6989586621679117721"><span class="hs-identifier hs-var hs-var">mapSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">mapEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5211"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">circleMark</span></a></span><span>
</span><span id="line-5212"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">wmain</span></a></span><span>
</span><span id="line-5213"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var">hmain</span></a></span><span>
</span><span id="line-5214"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">selCluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5215"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-5216"></span><span>
</span><span id="line-5217"></span><span>      </span><span class="hs-comment">-- histogram of the RA values</span><span>
</span><span id="line-5218"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5219"></span><span>      </span><span id="local-6989586621679117719"><span class="annot"><span class="annottext">raBinning :: [PositionChannel]
</span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var hs-var">raBinning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Extent"><span class="hs-identifier hs-var">Extent</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">24</span></span><span>
</span><span id="line-5220"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-5221"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Nice"><span class="hs-identifier hs-var">Nice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5222"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5223"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SortProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PSort"><span class="hs-identifier hs-var">PSort</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SortProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5224"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5225"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-5226"></span><span>
</span><span id="line-5227"></span><span>      </span><span class="hs-comment">-- histogram of the Declination values</span><span>
</span><span id="line-5228"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5229"></span><span>      </span><span id="local-6989586621679117716"><span class="annot"><span class="annottext">deBinning :: [PositionChannel]
</span><a href="#local-6989586621679117716"><span class="hs-identifier hs-var hs-var">deBinning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[BinProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PBin"><span class="hs-identifier hs-var">PBin</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Extent"><span class="hs-identifier hs-var">Extent</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">deMin</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">deMax</span></a></span><span>
</span><span id="line-5230"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var">deStep</span></a></span><span>
</span><span id="line-5231"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BinProperty
</span><a href="Graphics.Vega.VegaLite.Transform.html#Nice"><span class="hs-identifier hs-var">Nice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5232"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5233"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5234"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-5235"></span><span>
</span><span id="line-5236"></span><span>      </span><span id="local-6989586621679117715"><span class="annot"><span class="annottext">histAxis :: [PositionChannel]
</span><a href="#local-6989586621679117715"><span class="hs-identifier hs-var hs-var">histAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAggregate"><span class="hs-identifier hs-var">PAggregate</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span>
</span><span id="line-5237"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5238"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679117732"><span class="hs-identifier hs-var">noTitle</span></a></span><span>
</span><span id="line-5239"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3000</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5240"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-5241"></span><span>
</span><span id="line-5242"></span><span>      </span><span id="local-6989586621679117714"><span class="annot"><span class="annottext">raEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117714"><span class="hs-identifier hs-var hs-var">raEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5243"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">raBinning</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5244"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117715"><span class="hs-identifier hs-var">histAxis</span></a></span><span>
</span><span id="line-5245"></span><span>
</span><span id="line-5246"></span><span>      </span><span id="local-6989586621679117713"><span class="annot"><span class="annottext">deEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117713"><span class="hs-identifier hs-var hs-var">deEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5247"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117716"><span class="hs-identifier hs-var">deBinning</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5248"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117715"><span class="hs-identifier hs-var">histAxis</span></a></span><span>
</span><span id="line-5249"></span><span>
</span><span id="line-5250"></span><span>      </span><span id="local-6989586621679117712"><span class="annot"><span class="annottext">allRA :: [PropertySpec]
</span><a href="#local-6989586621679117712"><span class="hs-identifier hs-var hs-var">allRA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117714"><span class="hs-identifier hs-var">raEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5251"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gray&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5252"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-5253"></span><span>      </span><span id="local-6989586621679117711"><span class="annot"><span class="annottext">filtRA :: [PropertySpec]
</span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var hs-var">filtRA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">filterCluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5254"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117714"><span class="hs-identifier hs-var">raEnc</span></a></span><span>
</span><span id="line-5255"></span><span>                   </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">colorEnc</span></a></span><span>
</span><span id="line-5256"></span><span>                   </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5257"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5258"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-5259"></span><span>
</span><span id="line-5260"></span><span>      </span><span id="local-6989586621679117709"><span class="annot"><span class="annottext">allDE :: [PropertySpec]
</span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var hs-var">allDE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117713"><span class="hs-identifier hs-var">deEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5261"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MColor"><span class="hs-identifier hs-var">MColor</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;gray&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5262"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-5263"></span><span>      </span><span id="local-6989586621679117708"><span class="annot"><span class="annottext">filtDE :: [PropertySpec]
</span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var hs-var">filtDE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">filterCluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5264"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117713"><span class="hs-identifier hs-var">deEnc</span></a></span><span>
</span><span id="line-5265"></span><span>                   </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">colorEnc</span></a></span><span>
</span><span id="line-5266"></span><span>                   </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5267"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Bar"><span class="hs-identifier hs-var">Bar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5268"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-5269"></span><span>
</span><span id="line-5270"></span><span>      </span><span id="local-6989586621679117707"><span class="annot"><span class="annottext">raSpec :: VLSpec
</span><a href="#local-6989586621679117707"><span class="hs-identifier hs-var hs-var">raSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">wmain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117733"><span class="hs-identifier hs-var">hsub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117712"><span class="hs-identifier hs-var">allRA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">filtRA</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5271"></span><span>      </span><span id="local-6989586621679117706"><span class="annot"><span class="annottext">deSpec :: VLSpec
</span><a href="#local-6989586621679117706"><span class="hs-identifier hs-var hs-var">deSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var">hmain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117734"><span class="hs-identifier hs-var">wsub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">allDE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[PropertySpec]
</span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">filtDE</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5272"></span><span>
</span><span id="line-5273"></span><span>      </span><span id="local-6989586621679117705"><span class="annot"><span class="annottext">borderSpacing :: Double
</span><a href="#local-6989586621679117705"><span class="hs-identifier hs-var hs-var">borderSpacing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20</span></span><span>
</span><span id="line-5274"></span><span>
</span><span id="line-5275"></span><span>      </span><span id="local-6989586621679117704"><span class="annot"><span class="annottext">mapAndDecSpec :: VLSpec
</span><a href="#local-6989586621679117704"><span class="hs-identifier hs-var hs-var">mapAndDecSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#spacing"><span class="hs-identifier hs-var">spacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117705"><span class="hs-identifier hs-var">borderSpacing</span></a></span><span>
</span><span id="line-5276"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#bounds"><span class="hs-identifier hs-var">bounds</span></a></span><span> </span><span class="annot"><span class="annottext">Bounds
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Flush"><span class="hs-identifier hs-var">Flush</span></a></span><span>
</span><span id="line-5277"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#hConcat"><span class="hs-identifier hs-var">hConcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117721"><span class="hs-identifier hs-var">mapSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117706"><span class="hs-identifier hs-var">deSpec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5278"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-5279"></span><span>
</span><span id="line-5280"></span><span>      </span><span id="local-6989586621679117701"><span class="annot"><span class="annottext">histSpecs :: [VLSpec]
</span><a href="#local-6989586621679117701"><span class="hs-identifier hs-var hs-var">histSpecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117707"><span class="hs-identifier hs-var">raSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117704"><span class="hs-identifier hs-var">mapAndDecSpec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5281"></span><span>
</span><span id="line-5282"></span><span>      </span><span class="hs-comment">-- select the cluster which the star belongs to; do not use</span><span>
</span><span id="line-5283"></span><span>      </span><span class="hs-comment">-- &quot;nearest click&quot; as that means a user can not cancel the</span><span>
</span><span id="line-5284"></span><span>      </span><span class="hs-comment">-- selection.</span><span>
</span><span id="line-5285"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5286"></span><span>      </span><span id="local-6989586621679117700"><span class="annot"><span class="annottext">pick :: Text
</span><a href="#local-6989586621679117700"><span class="hs-identifier hs-var hs-var">pick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pick&quot;</span></span><span>
</span><span id="line-5287"></span><span>      </span><span id="local-6989586621679117720"><span class="annot"><span class="annottext">selCluster :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var hs-var">selCluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-5288"></span><span>                     </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117700"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#Fields"><span class="hs-identifier hs-var">Fields</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5289"></span><span>
</span><span id="line-5290"></span><span>      </span><span id="local-6989586621679117710"><span class="annot"><span class="annottext">filterCluster :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var hs-var">filterCluster</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5291"></span><span>                        </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Filter -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Filter
</span><a href="Graphics.Vega.VegaLite.Core.html#FSelection"><span class="hs-identifier hs-var">FSelection</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117700"><span class="hs-identifier hs-var">pick</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5292"></span><span>
</span><span id="line-5293"></span><span>      </span><span id="local-6989586621679117699"><span class="annot"><span class="annottext">plxOpts :: [PositionChannel]
</span><a href="#local-6989586621679117699"><span class="hs-identifier hs-var hs-var">plxOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5294"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;parallax (milli-arcsecond)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5295"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5296"></span><span>      </span><span id="local-6989586621679117698"><span class="annot"><span class="annottext">gmagOpts :: [PositionChannel]
</span><a href="#local-6989586621679117698"><span class="hs-identifier hs-var hs-var">gmagOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;G magnitude&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5297"></span><span>
</span><span id="line-5298"></span><span>      </span><span id="local-6989586621679117697"><span class="annot"><span class="annottext">encData :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var hs-var">encData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5299"></span><span>                  </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117699"><span class="hs-identifier hs-var">plxOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5300"></span><span>                  </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [PositionChannel]
</span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">quant</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gmag&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel] -&gt; [PositionChannel] -&gt; [PositionChannel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PositionChannel]
</span><a href="#local-6989586621679117698"><span class="hs-identifier hs-var">gmagOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5301"></span><span>
</span><span id="line-5302"></span><span>      </span><span id="local-6989586621679117696"><span class="annot"><span class="annottext">parallaxSpec :: VLSpec
</span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var hs-var">parallaxSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var">big</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117705"><span class="hs-identifier hs-var">borderSpacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var">small</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5303"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">encData</span></a></span><span>
</span><span id="line-5304"></span><span>                                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildEncodingSpecs
</span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">colorEnc</span></a></span><span>
</span><span id="line-5305"></span><span>                                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec) -&gt; [EncodingSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5306"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">circleMark</span></a></span><span>
</span><span id="line-5307"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">selCluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5308"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-5309"></span><span>
</span><span id="line-5310"></span><span>      </span><span id="local-6989586621679117695"><span class="annot"><span class="annottext">allSpecs :: [VLSpec]
</span><a href="#local-6989586621679117695"><span class="hs-identifier hs-var hs-var">allSpecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#spacing"><span class="hs-identifier hs-var">spacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117705"><span class="hs-identifier hs-var">borderSpacing</span></a></span><span>
</span><span id="line-5311"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#bounds"><span class="hs-identifier hs-var">bounds</span></a></span><span> </span><span class="annot"><span class="annottext">Bounds
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Flush"><span class="hs-identifier hs-var">Flush</span></a></span><span>
</span><span id="line-5312"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="#local-6989586621679117701"><span class="hs-identifier hs-var">histSpecs</span></a></span><span>
</span><span id="line-5313"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-5314"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var">parallaxSpec</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5315"></span><span>
</span><span id="line-5316"></span><span>
</span><span id="line-5317"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-5318"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-5319"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117741"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5320"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="#local-6989586621679117695"><span class="hs-identifier hs-var">allSpecs</span></a></span><span>
</span><span id="line-5321"></span><span>     </span><span class="hs-comment">-- remove the &quot;other&quot; axis (e.g. top of Y, right for X)</span><span>
</span><span id="line-5322"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span>
</span><span id="line-5323"></span><span>         </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; BuildConfigureSpecs -&gt; [ConfigureSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ViewConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStyle"><span class="hs-identifier hs-var">ViewStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ViewConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStroke"><span class="hs-identifier hs-var">ViewStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;transparent&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5324"></span><span>         </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; [ConfigureSpec] -&gt; PropertySpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5325"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [TitleConfig] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Configuration.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Gaia data from arXiv:1804.09378&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">APosition -&gt; TitleConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#TAnchor"><span class="hs-identifier hs-var">TAnchor</span></a></span><span> </span><span class="annot"><span class="annottext">APosition
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AMiddle"><span class="hs-identifier hs-var">AMiddle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5326"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-5327"></span><span>
</span><span id="line-5328"></span><span>
</span><span id="line-5329"></span><span class="hs-comment">-- $otherstuff</span><span>
</span><span id="line-5330"></span><span class="hs-comment">-- The tutorial ends not with a bang, but a few random visualizations</span><span>
</span><span id="line-5331"></span><span class="hs-comment">-- I thought of and couldn't find a better place to put them!</span><span>
</span><span id="line-5332"></span><span>
</span><span id="line-5333"></span><span class="hs-comment">{-|

This visualization started out when I asked myself if I could
repeat the X axis at the top of the plot. I started off by
trying to use 'configuration' with the 'AxisTop' constructor,
but this didn't work (perhaps I didn't turn on the necessary
option), so I ended up with the following. It does show off
the use of 'AxLabelExpr' and 'AxDataCondition', but is not
perhaps the most-digestible visualization one could create!

As I could not work out how to duplicate the X axis with only
a single layer, I got creative and duplicated the data and
in the second layer moved the X axis to the top of the plot
with 'AxOrient', and ensured the data would not be displayed
(by setting the 'Text' value to the empty string).

The axis labels and the tick marks for the two X axes make
use of the @datum.index@ field, which is in the range 0 to 1 inclusive,
which I multiply by 8 (one less than the total number of clusters) and
check if the result is odd or even (ignoring the possibility
of floating-point inaccuracies in the conversion). The odd values are displayed
on the bottom axis and the even values on the top (the first
cluster, in this case @Blanco1@, has an index value of 0,
so is displayed on the top axis). The 'AxLabelExpr' option
is used to determine the label contents (if the condition
holds then it uses a trimmed and truncated version of the
default label, otherwise it is blank), and
'AxDataCondition' is used to control the opacity of the
tick marks. I had hoped to show some of the label-overlap
strategies in play here - controlled by 'AxLabelOverlap' - but
they didn't work well with the data and visualization size,
and I realised I could play with the new-to-Vega-Lite-4
'AxLabelExpr' and 'AxDataCondition' capabilities.

Normally a grid is not drawn for 'Nominal' axes, but I turn
it on (for the first layer) with 'AxGrid' just to help guide
the eye.

&lt;&lt;images/vl/duplicateaxis.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAuBOCGA7AzgMwPawLaQFxgG1wIxhIBzWdAVwAcAjATz0MgGEAba5aAU1kgBdADRR45Sr3Lw+LAmXS0WkAMY1E0SKMjxkyxNSz1+kAL6DTxEcUgATGfBagSUarA7KAFtGi1kuAHoAhAB3ADpyAEtoT2p6bn41DV4NMLUsAIARGnIAITcAa14AzwA3KXgArF0+WBLy6QD7aErpSPgAWnhOgDYARh6uvoAGDpb6Dl4++DDEdA7PXnhbfjDoZFKtYghIDGwZJ22SSFp4WGReQ5cXSABxavJ9Q2MBYSObgCUAQQB9AEk2B8AMpPIwmN7XY60DgAD1BLy2kJ2mQAov9ASD8JADGDXu9jrwftC4VicQj8ZYXJSwKYIVAACTIFSLapeHx+QIBBozKIxOJhSLoAJMlmVbkdDjRYqlAAsYQAVsh0IhEVAOPBGCZ8EQXM5rpBqrACsoVJFYCpJqqbik1LZIohHvg9ZDICTSPibqhIrwOLZlJxuLUrUiYIxaJdSegsPb4B46UixDDInonR79erjBwvg7LfhhvGE1BMN6NMp6OgfFHgwnIBmfSiYbQBFjIqgABRt5qGAWIFYwsAAKjAAA4AJRgACkYAATGAALxzvqiODURAqGS8NtwSJYTsybt1jij0QAVmPYAA5BfR9WQ9BIioCgB5U6m6DMVOF-WlWPUCNgfM0xdJI7XvZUnEgH8uH-JcoD4HhlD3aBu3tPtBxHccp1nBc+jMICSFpfCdkoSI-XwFdeALGt72gXMoADHgTHw6lIUImsP3dL9dm9X14XBfDQ3DZQAEdqCQGiZEicpbxueAkxTUgYGiOjIAAOWefgwHQVAwB4M49BY65DIgQy2JIZ1jkNY0nRgXgYU0LEtDgsN-1s+yzCoqAbXQO0HSuEM3Qsl0vR9Mj6K4Ri8S498hMjaNEFjGTjjk5N-K4w9s3IOjAK-HZixSBy4MUJKbkPBsm2UVsOy7LAezQocx0nGd5znfMwBXNcNy3WAdyQg94Ezc8z1EK8b08l170fF94DfDigsLSDf3-HLcp2EDokFFUbKgv8WFg2yEKxPratQuz0MarCWuGPDVrMriSLC1BYwucb9RouiDA4DhmLTO79TmgSQt40kNKihaYtc0TxOiSTpNenYUoUsh3v-T6OGMgiKSOalrDW5UvUdUhLFMIA Open this visualization in the Vega Editor&gt;

@
let trans = transform
            . aggregate [ opAs Count \&quot;\&quot; \&quot;number\&quot; ]
                        [ \&quot;Cluster\&quot; ]

    xAxis f = position X [ PName \&quot;Cluster\&quot;
                         , PmType Nominal
                         , PAxis [ 'AxLabelAngle' 0
                                 , 'AxOrient' (if f then SBottom else STop)
                                 , if f
                                   then AxTitle \&quot;Cluster\&quot;
                                   else AxNoTitle
                                 , 'AxLabelExpr' (xlabels f)
                                 , 'AxDataCondition'
                                   (Expr (xticks f))
                                   ('CAxTickOpacity' 1 0)
                                 , 'AxGrid' f
                                 ]
                         ]

    xlabels f =
      let v = if f then \&quot;1\&quot; else \&quot;0\&quot;
      in \&quot;if((datum.index * 8) % 2 ==\&quot; &lt;&gt; v &lt;&gt; \&quot;, truncate(trim(datum.label), 5), '')\&quot;

    xticks f =
      let v = if f then \&quot;1\&quot; else \&quot;0\&quot;
      in \&quot;(datum.index * 8) % 2 ==\&quot; &lt;&gt; v

    yAxis f = position Y [ PName \&quot;number\&quot;
                         , PmType Quantitative
                         , PAxis [ if f
                                   then AxTitle \&quot;Number of stars\&quot;
                                   else AxNoTitle ]
                         ]

    -- f is True indicates first Layer (bottom X axis, should display
    -- the Y axis).
    enc f = encoding
            . xAxis f
            . yAxis f

    dataLayer = asSpec [ enc True []
                       , mark Circle []
                       ]

    axLayer = asSpec [ enc False []
                     , mark Text [ MText \&quot;\&quot; ]
                     ]

in toVegaLite [ gaiaData
              , trans []
              , layer [ dataLayer, axLayer ]
              ]
@

If anyone can come up with a simpler way to duplicate the X axis I'm all
ears!

-}</span><span>
</span><span id="line-5434"></span><span>
</span><span id="line-5435"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#duplicateAxis"><span class="hs-identifier hs-type">duplicateAxis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-5436"></span><span id="duplicateAxis"><span class="annot"><span class="annottext">duplicateAxis :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#duplicateAxis"><span class="hs-identifier hs-var hs-var">duplicateAxis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5437"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117691"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117691"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5438"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5439"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5440"></span><span>
</span><span id="line-5441"></span><span>      </span><span class="hs-comment">-- Encode the X axis, where True indicates the lower axis</span><span>
</span><span id="line-5442"></span><span>      </span><span class="hs-comment">-- and False the upper axis.</span><span>
</span><span id="line-5443"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5444"></span><span>      </span><span id="local-6989586621679117690"><span class="annot"><span class="annottext">xAxis :: Bool -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117690"><span class="hs-identifier hs-var hs-var">xAxis</span></a></span></span><span> </span><span id="local-6989586621679117689"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-5445"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-5446"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxLabelAngle"><span class="hs-identifier hs-var">AxLabelAngle</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-5447"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Side -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxOrient"><span class="hs-identifier hs-var">AxOrient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Side
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SBottom"><span class="hs-identifier hs-var">SBottom</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Side
</span><a href="Graphics.Vega.VegaLite.Foundation.html#STop"><span class="hs-identifier hs-var">STop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5448"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-5449"></span><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-5450"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxNoTitle"><span class="hs-identifier hs-var">AxNoTitle</span></a></span><span>
</span><span id="line-5451"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxLabelExpr"><span class="hs-identifier hs-var">AxLabelExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a
</span><a href="#local-6989586621679117684"><span class="hs-identifier hs-var">xlabels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5452"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; ConditionalAxisProperty -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxDataCondition"><span class="hs-identifier hs-var">AxDataCondition</span></a></span><span>
</span><span id="line-5453"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#Expr"><span class="hs-identifier hs-var">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a
</span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">xticks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-5454"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; ConditionalAxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#CAxTickOpacity"><span class="hs-identifier hs-var">CAxTickOpacity</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-5455"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxGrid"><span class="hs-identifier hs-var">AxGrid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-5456"></span><span>                                   </span><span class="hs-special">]</span><span>
</span><span id="line-5457"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-5458"></span><span>
</span><span id="line-5459"></span><span>      </span><span class="hs-comment">-- For the bottom want every &quot;odd&quot; value, top every &quot;even&quot; value,</span><span>
</span><span id="line-5460"></span><span>      </span><span class="hs-comment">-- so that the are alternated, but how do we encode this with the</span><span>
</span><span id="line-5461"></span><span>      </span><span class="hs-comment">-- Vega expression syntax? There is a datum.index which is 0 to 1</span><span>
</span><span id="line-5462"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5463"></span><span>      </span><span class="hs-comment">-- How about just subsetting the strings for now</span><span>
</span><span id="line-5464"></span><span>      </span><span id="local-6989586621679117684"><span class="annot"><span class="annottext">xlabels :: Bool -&gt; a
</span><a href="#local-6989586621679117684"><span class="hs-identifier hs-var hs-var">xlabels</span></a></span></span><span> </span><span id="local-6989586621679117678"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5465"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117677"><span class="annot"><span class="annottext">v :: a
</span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;1&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-5466"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;if((datum.index * 8) % 2 ==&quot;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;, truncate(trim(datum.label), 5), '')&quot;</span></span><span>
</span><span id="line-5467"></span><span>
</span><span id="line-5468"></span><span>      </span><span class="hs-comment">-- had hoped could use datum.label but there's no obvious guarantee</span><span>
</span><span id="line-5469"></span><span>      </span><span class="hs-comment">-- of ordering of operations (or when the AxLabelExpr expression is</span><span>
</span><span id="line-5470"></span><span>      </span><span class="hs-comment">-- evaluated), so repeat the logic.</span><span>
</span><span id="line-5471"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-5472"></span><span>      </span><span id="local-6989586621679117681"><span class="annot"><span class="annottext">xticks :: Bool -&gt; a
</span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var hs-var">xticks</span></a></span></span><span> </span><span id="local-6989586621679117676"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5473"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117675"><span class="annot"><span class="annottext">v :: a
</span><a href="#local-6989586621679117675"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;1&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-5474"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;(datum.index * 8) % 2 ==&quot;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679117675"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-5475"></span><span>
</span><span id="line-5476"></span><span>      </span><span id="local-6989586621679117674"><span class="annot"><span class="annottext">yAxis :: Bool -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117674"><span class="hs-identifier hs-var hs-var">yAxis</span></a></span></span><span> </span><span id="local-6989586621679117673"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117673"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;number&quot;</span></span><span>
</span><span id="line-5477"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5478"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117673"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-5479"></span><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Number of stars&quot;</span></span><span>
</span><span id="line-5480"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxNoTitle"><span class="hs-identifier hs-var">AxNoTitle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5481"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-5482"></span><span>
</span><span id="line-5483"></span><span>      </span><span id="local-6989586621679117672"><span class="annot"><span class="annottext">enc :: Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117672"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span id="local-6989586621679117671"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117671"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5484"></span><span>              </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117690"><span class="hs-identifier hs-var">xAxis</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117671"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-5485"></span><span>              </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117674"><span class="hs-identifier hs-var">yAxis</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679117671"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-5486"></span><span>
</span><span id="line-5487"></span><span>      </span><span id="local-6989586621679117670"><span class="annot"><span class="annottext">dataLayer :: VLSpec
</span><a href="#local-6989586621679117670"><span class="hs-identifier hs-var hs-var">dataLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117672"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5488"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5489"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5490"></span><span>
</span><span id="line-5491"></span><span>      </span><span id="local-6989586621679117669"><span class="annot"><span class="annottext">axLayer :: VLSpec
</span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var hs-var">axLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117672"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5492"></span><span>                       </span><span class="hs-comment">-- create an &quot;invisible&quot; mark</span><span>
</span><span id="line-5493"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MText"><span class="hs-identifier hs-var">MText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5494"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-5495"></span><span>
</span><span id="line-5496"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-5497"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117691"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5498"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117670"><span class="hs-identifier hs-var">dataLayer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var">axLayer</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5499"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5500"></span><span>
</span><span id="line-5501"></span><span>
</span><span id="line-5502"></span><span class="hs-comment">{-|

Way back in the tutorial I noted - in 'densityParallaxGrouped' - that
setting the 'density' option 'DnCounts' to @True@ resulted in
counts that were too high. This is because the values need to be
divided by the bin width, as shown in this visualization, where I:

- use an explicit grid for the density calculation, choosing the
  'DnExtent' and 'DnSteps' parameters to create a bin width of
  0.1 in parallax;

- sum up the resulting KDE (the @\&quot;ykde\&quot;@ field) to create @\&quot;ycounts\&quot;@;

- normalize the counts by the bin with using 'calculateAs' to
  create the @\&quot;count\&quot;@ field;

- which is plotted as a diamond, on top of a line showing the
  actual counts (calculated following 'starCount').

&lt;&lt;images/vl/comparecounts.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zUAAkFELRJg0k5CotCsYXYnB4TDYImo31+RhBTjwHG0ugALEwAFYUcTrKB4WAATzaqAA2h1Cqd4PQxBRsrlCGSNmhICwcMoyNwCQzIEM8HxzJAALopKCwFisgwIfgM4CQERkBqiLASVKiiiK5Qqh6Cl5VYX3SAmHAaBpIsTS96nKSiaBsMT1VAUzpXZmZNj8PDQBq8-nTKDwAlkaXXESyO2wAhve6YLmO6MZN0er0HJUqy0bSABoMNACOWFgEg4CDY+lxTMgsAWbHVjszHGC3s1iUgutmrYw7ajRSdmCpBdpOVkDPjPc6rPZnO5PrMbX1TMwpm5Cw0cVVkAJK+lc-nkFTzdQVKw-HTszOC0kKtJAGYRVffNvyzPKIQAEwAdl8J86cRpHFjUEuO4mS7DZR1OccsA5f8SR5PkZzWB8MzFCVDEkGU5QVA4KGaNdFwOAk93VEUsndT0Gg3VdtXjEDZllPCoD3NchAjIQsHxNCDlsZomAIpsKDAagwD8Ft7kQzAjRNONHzYAAvYMwBfXxP3jSAzDZLQGiCWAhBNL9MAoIhYGzTjHFkcQvT0-1A3kyAyBEO18nuGiMmtERbXtCpyxdWVEzIg5pwFYisxsiIwzECMW0s9dPJ3XzkwYpsywzYLc3zQtEHgEsLXjBcqxrZlMvgBt-L4kTgKc550m3XdxDdB00CeB4gA Open this visualization in the Vega Editor&gt;

@
let densTrans = transform
            . density \&quot;plx\&quot; [ DnAs \&quot;xkde\&quot; \&quot;ykde\&quot;
                            , DnGroupBy [ \&quot;Cluster\&quot; ]
                            , DnCounts True
                            , DnExtent 3 30
                            , 'DnSteps' 270
                            ]
            . aggregate [ opAs Sum \&quot;ykde\&quot; \&quot;ycounts\&quot; ]
                        [ \&quot;Cluster\&quot; ]
            . calculateAs \&quot;datum.ycounts / 10\&quot; \&quot;count\&quot;

    enc = encoding
          . position X [ PName \&quot;Cluster\&quot;
                       , PmType Nominal
                       ]
          . position Y [ PName \&quot;count\&quot;
                       , PmType Quantitative
                       , PAxis [ AxTitle \&quot;Counts\&quot; ]
                       ]

    densLayer = asSpec [ densTrans []
                       , enc []
                       , mark Point [ MShape 'SymDiamond'
                                    , MStroke \&quot;black\&quot;
                                    , MSize 200
                                    ]
                       ]

    countTrans = transform
                 . aggregate [ opAs Count \&quot;\&quot; \&quot;count\&quot; ] [ \&quot;Cluster\&quot; ]

    countLayer = asSpec [ countTrans [], enc [], mark Line [] ]

in toVegaLite
     [ gaiaData
     , layer [ countLayer, densLayer ]
     ]
@

Note that the same encoding specification is used on both layers,
since I arranged the data transforms to create two columns -
@\&quot;Cluster\&quot;@ and @\&quot;count\&quot;@ - in both cases.

-}</span><span>
</span><span id="line-5570"></span><span>
</span><span id="line-5571"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#compareCounts"><span class="hs-identifier hs-type">compareCounts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-5572"></span><span id="compareCounts"><span class="annot"><span class="annottext">compareCounts :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#compareCounts"><span class="hs-identifier hs-var hs-var">compareCounts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5573"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117667"><span class="annot"><span class="annottext">densTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var hs-var">densTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5574"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [DensityProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#density"><span class="hs-identifier hs-var">density</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnAs"><span class="hs-identifier hs-var">DnAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xkde&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span>
</span><span id="line-5575"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnGroupBy"><span class="hs-identifier hs-var">DnGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5576"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnCounts"><span class="hs-identifier hs-var">DnCounts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-5577"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnExtent"><span class="hs-identifier hs-var">DnExtent</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30</span></span><span>
</span><span id="line-5578"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnSteps"><span class="hs-identifier hs-var">DnSteps</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">270</span></span><span>
</span><span id="line-5579"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-5580"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ykde&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ycounts&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5581"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5582"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.ycounts / 10&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span>
</span><span id="line-5583"></span><span>
</span><span id="line-5584"></span><span>      </span><span id="local-6989586621679117664"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117664"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5585"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-5586"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-5587"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5588"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span>
</span><span id="line-5589"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5590"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Counts&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5591"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5592"></span><span>
</span><span id="line-5593"></span><span>      </span><span id="local-6989586621679117663"><span class="annot"><span class="annottext">densLayer :: VLSpec
</span><a href="#local-6989586621679117663"><span class="hs-identifier hs-var hs-var">densLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">densTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5594"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117664"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5595"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Point"><span class="hs-identifier hs-var">Point</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MShape"><span class="hs-identifier hs-var">MShape</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="Graphics.Vega.VegaLite.Foundation.html#SymDiamond"><span class="hs-identifier hs-var">SymDiamond</span></a></span><span>
</span><span id="line-5596"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span>
</span><span id="line-5597"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">200</span></span><span>
</span><span id="line-5598"></span><span>                                      </span><span class="hs-special">]</span><span>
</span><span id="line-5599"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5600"></span><span>
</span><span id="line-5601"></span><span>      </span><span id="local-6989586621679117661"><span class="annot"><span class="annottext">countTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117661"><span class="hs-identifier hs-var hs-var">countTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5602"></span><span>                   </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Count"><span class="hs-identifier hs-var">Count</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5603"></span><span>
</span><span id="line-5604"></span><span>      </span><span id="local-6989586621679117660"><span class="annot"><span class="annottext">countLayer :: VLSpec
</span><a href="#local-6989586621679117660"><span class="hs-identifier hs-var hs-var">countLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117661"><span class="hs-identifier hs-var">countTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117664"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5605"></span><span>
</span><span id="line-5606"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-5607"></span><span>       </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-5608"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117660"><span class="hs-identifier hs-var">countLayer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117663"><span class="hs-identifier hs-var">densLayer</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5609"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-5610"></span><span>
</span><span id="line-5611"></span><span>
</span><span id="line-5612"></span><span class="hs-comment">{-|

In this example I compare the parallax values

- as the raw distribution, using the ticks display we saw in
  the very first plot, 'stripPlot', (although with a few
  adjustments)

- against a smoothed version of the distribution, calculated using
  the 'regression' transform (e.g. 'densityParallax').

The only new things here are configuration options
for the X axis - that is, the use of 'AxLabels', along with
'AxNoTitle', to ensure the X axis of the density plot only has
grid lines - and the legend options were set to
center the title.

&lt;&lt;images/vl/parallaxview.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAmCGAutIC4yghSBXATgGxSgAt54AHAZ2QHpqdYB3AOgHMBLeIrAIywoFMcAYwD2AO3j8JTUQFtqAERFYWAIVwBrftSIA3fi1jVZsCpJw79h6nETVDbWAFpYzgGwBGNy48AGJ4jcePwesExiIk5E-LDQgkzwFLqQADTgGJAAZiI4JvCE6BiYZLA4AgXpRZgA4iYshJBiWLLcgqmVVZAASgCCAPoAkgDCXQDKDU0tbWlVGWR4AB4Tza047bOYCgCigyPjqI0r0x1FkPx980sHk6uQJ2AAvh1PEA8zULqiYkIIhADaHUKp3g9DEFGyuX+9wgwEgLBwyjI3AAnv9IEM8HxzJAALopKCmNG6WCY-ipKBxMEcVF4ilSCjUhqXSAvKp4+6QEw4DQNPBsMRk96nBhsaCcQhuXy+IUZATBITwNjiCobKDBFhSaAFSDcflag7qzXkyDwZFkMkHBliFjBY2ZNj8PDQChojFYto41lFN4cqSiaD8+qoIGdUR4HIq1VQe2O-VQN1mY5RqAUH624OQVPRWQWqA-SQsHLIvwsmWzE1m3ONESyfkk9ZRyCGsRxkOqyA5B0SBrcESkGsN5MmjjpqCjR38BVgWBgISYxNrMsbYfwYI9b5ECMHWvQaC26EYL1VH3tkQlISM4MHzDE0mEXxMADMS9OXwDiuVGdvWFzHnxmYnBUlTEXkDCNI9vRfKArjQa9owdJ0Gm-QU4MzNNc1haAa1gfl-mfMBH18WkK3NXkRHqf8xDYIRc0yEkBBPRtTVIg4AEcsFgCQOAQNh9EHZdYAWNgXQzPBYFaPARLAOjJP4f9FVXXMmjwPAIMPKDIFRK8hxjRCDkpBlTX48tmKrdjOIUni+KgzBBOE7UFNHSAFHpRk1Nee4j0YmEOS5HkDkVIQeSXSARTFIgJSlEK-REANrUjcswy3NAsgQuN0XnbF5MrCYazrAh-2bONlNUjSz1gC8jO0xtkPvJhfAAVhsvNxHfYDtVq1AH3wgD5Q-ECDTAlsWQPbzOhgttOl09LmWatCSQwmBsNw1A-nwwjiNMsiKKgKiaMIGSGLmra2I4rjEEVazULsqTYUcqsAAVShJMSFjAAAKEwKAAShG1U1K89J2UwAASLN+BMBoSHIKhaCsMJ2E4HgmCVahwZMah4acPlJExgAWJgACsKGVd5M3PQN7zJ3ssBbKSsnnCKya+e0gzQJ4HiAA Open this visualization in the Vega Editor&gt;

@
let plxScale = PScale [ SType ScLog
                      , SNice (IsNice False)
                      , SDomain (DNumbers [3, 30])
                      ]

    opacityEnc ounsel osel =
      opacity [ MSelectionCondition (SelectionName selName)
                [ MNumber osel ]
                [ MNumber ounsel ]
              ]

    tickEnc = encoding
              . position X [ PName \&quot;plx\&quot;
                           , PmType Quantitative
                           , plxScale
                           , PAxis [ AxTitle \&quot;Parallax (mas)\&quot; ]
                           ]
              . color [ MName \&quot;Cluster\&quot;
                      , MmType Nominal
                      , MLegend []
                      ]
              . opacityEnc 0.05 0.3

    plotWidth = width 600

    tickLayer = asSpec [ plotWidth
                       , tickEnc []
                       , mark Tick [ ] ]

    densTrans = transform
                . density \&quot;plx\&quot; [ DnGroupBy [ \&quot;Cluster\&quot; ]
                                  , DnAs &quot;value&quot; &quot;density&quot;
                                  ]
    densEnc = encoding
              . position X [ PName \&quot;value\&quot;
                           , PmType Quantitative
                           , plxScale
                           , PAxis [ AxNoTitle
                                   , 'AxLabels' False
                                   ]
                           ]
              . position Y [ PName \&quot;density\&quot;
                           , PmType Quantitative
                           , PAxis [ AxTitle \&quot;Density\&quot; ]
                           ]
              . color [ MName \&quot;Cluster\&quot;
                      , MmType Nominal
                      , MLegend [ LOrient LOBottom
                                , 'LTitleAnchor' AMiddle
                                , LTitle \&quot;Select a cluster\&quot;
                                ]
                      , MScale [ SScheme &quot;category10&quot; [] ]
                      ]
              . opacityEnc 0.3 1

    densLayer = asSpec [ plotWidth
                       , densTrans []
                       , densEnc []
                       , sel []
                       , mark Line [ ]
                       ]

    selName = \&quot;legend\&quot;
    sel = selection
          . select selName Single [ BindLegend (BLField \&quot;Cluster\&quot;) ]

in toVegaLite
    [ gaiaData
    , spacing 0
    , bounds Flush
    , vConcat [ densLayer, tickLayer ]
    ]
@

I have also changed the color scheme to @\&quot;category10\&quot;@, which isn't
necessarily any better than the default (@\&quot;tableau10\&quot;@), but is at least
different (I was hoping to get a better separation in color space for
the IC2391 and IC2602 clusters, but quickly gave up after
&lt;https://vega.github.io/vega/docs/schemes/index.html#categorical trying out a few options&gt;).

Here is the visualization after selecting the label \&quot;@NGC2451@\&quot;
in the legend:

&lt;&lt;images/vl/parallaxview-selected.png&gt;&gt;

-}</span><span>
</span><span id="line-5720"></span><span>
</span><span id="line-5721"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxView"><span class="hs-identifier hs-type">parallaxView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-5722"></span><span id="parallaxView"><span class="annot"><span class="annottext">parallaxView :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#parallaxView"><span class="hs-identifier hs-var hs-var">parallaxView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5723"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117659"><span class="annot"><span class="annottext">plxScale :: PositionChannel
</span><a href="#local-6989586621679117659"><span class="hs-identifier hs-var hs-var">plxScale</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Scale -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Scale
</span><a href="Graphics.Vega.VegaLite.Foundation.html#ScLog"><span class="hs-identifier hs-var">ScLog</span></a></span><span>
</span><span id="line-5724"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-5725"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DomainLimits -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SDomain"><span class="hs-identifier hs-var">SDomain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DomainLimits
</span><a href="Graphics.Vega.VegaLite.Scale.html#DNumbers"><span class="hs-identifier hs-var">DNumbers</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5726"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-5727"></span><span>
</span><span id="line-5728"></span><span>      </span><span id="local-6989586621679117658"><span class="annot"><span class="annottext">opacityEnc :: Double -&gt; Double -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117658"><span class="hs-identifier hs-var hs-var">opacityEnc</span></a></span></span><span> </span><span id="local-6989586621679117657"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117657"><span class="hs-identifier hs-var">ounsel</span></a></span></span><span> </span><span id="local-6989586621679117656"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117656"><span class="hs-identifier hs-var">osel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5729"></span><span>        </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#opacity"><span class="hs-identifier hs-var">opacity</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BooleanOp -&gt; [MarkChannel] -&gt; [MarkChannel] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MSelectionCondition"><span class="hs-identifier hs-var">MSelectionCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BooleanOp
</span><a href="Graphics.Vega.VegaLite.Core.html#SelectionName"><span class="hs-identifier hs-var">SelectionName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117655"><span class="hs-identifier hs-var">selName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5730"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117656"><span class="hs-identifier hs-var">osel</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5731"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MNumber"><span class="hs-identifier hs-var">MNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117657"><span class="hs-identifier hs-var">ounsel</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5732"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-5733"></span><span>
</span><span id="line-5734"></span><span>      </span><span id="local-6989586621679117654"><span class="annot"><span class="annottext">tickEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117654"><span class="hs-identifier hs-var hs-var">tickEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5735"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span>
</span><span id="line-5736"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5737"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679117659"><span class="hs-identifier hs-var">plxScale</span></a></span><span>
</span><span id="line-5738"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Parallax (mas)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5739"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-5740"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-5741"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-5742"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5743"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-5744"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117658"><span class="hs-identifier hs-var">opacityEnc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.05</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.3</span></span><span>
</span><span id="line-5745"></span><span>
</span><span id="line-5746"></span><span>      </span><span id="local-6989586621679117653"><span class="annot"><span class="annottext">plotWidth :: PropertySpec
</span><a href="#local-6989586621679117653"><span class="hs-identifier hs-var hs-var">plotWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">600</span></span><span>
</span><span id="line-5747"></span><span>
</span><span id="line-5748"></span><span>      </span><span id="local-6989586621679117652"><span class="annot"><span class="annottext">tickLayer :: VLSpec
</span><a href="#local-6989586621679117652"><span class="hs-identifier hs-var hs-var">tickLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117653"><span class="hs-identifier hs-var">plotWidth</span></a></span><span>
</span><span id="line-5749"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117654"><span class="hs-identifier hs-var">tickEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5750"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5751"></span><span>
</span><span id="line-5752"></span><span>      </span><span id="local-6989586621679117651"><span class="annot"><span class="annottext">densTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117651"><span class="hs-identifier hs-var hs-var">densTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5753"></span><span>                  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [DensityProperty] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#density"><span class="hs-identifier hs-var">density</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;plx&quot;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnGroupBy"><span class="hs-identifier hs-var">DnGroupBy</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5754"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DensityProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#DnAs"><span class="hs-identifier hs-var">DnAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;density&quot;</span></span><span>
</span><span id="line-5755"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-5756"></span><span>      </span><span id="local-6989586621679117650"><span class="annot"><span class="annottext">densEnc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117650"><span class="hs-identifier hs-var hs-var">densEnc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5757"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;value&quot;</span></span><span>
</span><span id="line-5758"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5759"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PositionChannel
</span><a href="#local-6989586621679117659"><span class="hs-identifier hs-var">plxScale</span></a></span><span>
</span><span id="line-5760"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxNoTitle"><span class="hs-identifier hs-var">AxNoTitle</span></a></span><span>
</span><span id="line-5761"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxLabels"><span class="hs-identifier hs-var">AxLabels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5762"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-5763"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-5764"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;density&quot;</span></span><span>
</span><span id="line-5765"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-5766"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AxisProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#AxTitle"><span class="hs-identifier hs-var">AxTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Density&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5767"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-5768"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span>
</span><span id="line-5769"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-5770"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">LegendOrientation -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOrient"><span class="hs-identifier hs-var">LOrient</span></a></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOBottom"><span class="hs-identifier hs-var">LOBottom</span></a></span><span>
</span><span id="line-5771"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">APosition -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitleAnchor"><span class="hs-identifier hs-var">LTitleAnchor</span></a></span><span> </span><span class="annot"><span class="annottext">APosition
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AMiddle"><span class="hs-identifier hs-var">AMiddle</span></a></span><span>
</span><span id="line-5772"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendProperty
</span><a href="Graphics.Vega.VegaLite.Legend.html#LTitle"><span class="hs-identifier hs-var">LTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Select a cluster&quot;</span></span><span>
</span><span id="line-5773"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-5774"></span><span>                          </span><span class="hs-comment">-- fortunately setting the color scheme</span><span>
</span><span id="line-5775"></span><span>                          </span><span class="hs-comment">-- here applies it to the tick encoding too</span><span>
</span><span id="line-5776"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MScale"><span class="hs-identifier hs-var">MScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Double] -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SScheme"><span class="hs-identifier hs-var">SScheme</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;category10&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5777"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-5778"></span><span>                </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117658"><span class="hs-identifier hs-var">opacityEnc</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.3</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-5779"></span><span>
</span><span id="line-5780"></span><span>      </span><span id="local-6989586621679117647"><span class="annot"><span class="annottext">densLayer :: VLSpec
</span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var hs-var">densLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="#local-6989586621679117653"><span class="hs-identifier hs-var">plotWidth</span></a></span><span>
</span><span id="line-5781"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117651"><span class="hs-identifier hs-var">densTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5782"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117650"><span class="hs-identifier hs-var">densEnc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5783"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117646"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5784"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5785"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-5786"></span><span>
</span><span id="line-5787"></span><span>      </span><span id="local-6989586621679117655"><span class="annot"><span class="annottext">selName :: Text
</span><a href="#local-6989586621679117655"><span class="hs-identifier hs-var hs-var">selName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;legend&quot;</span></span><span>
</span><span id="line-5788"></span><span>      </span><span id="local-6989586621679117646"><span class="annot"><span class="annottext">sel :: [SelectSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117646"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SelectSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Selection.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span>
</span><span id="line-5789"></span><span>            </span><span class="annot"><span class="annottext">([SelectSpec] -&gt; PropertySpec)
-&gt; ([SelectSpec] -&gt; [SelectSpec]) -&gt; [SelectSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Selection -&gt; [SelectionProperty] -&gt; [SelectSpec] -&gt; [SelectSpec]
</span><a href="Graphics.Vega.VegaLite.Selection.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117655"><span class="hs-identifier hs-var">selName</span></a></span><span> </span><span class="annot"><span class="annottext">Selection
</span><a href="Graphics.Vega.VegaLite.Selection.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BindLegendProperty -&gt; SelectionProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BindLegend"><span class="hs-identifier hs-var">BindLegend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; BindLegendProperty
</span><a href="Graphics.Vega.VegaLite.Selection.html#BLField"><span class="hs-identifier hs-var">BLField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5790"></span><span>
</span><span id="line-5791"></span><span>      </span><span class="hs-comment">-- TODO: select the lines as well (and ticks?), not sure</span><span>
</span><span id="line-5792"></span><span>      </span><span class="hs-comment">-- how as VL docs suggest both On and Clear need to be set</span><span>
</span><span id="line-5793"></span><span>      </span><span class="hs-comment">-- but I couldn't quickly get it to work</span><span>
</span><span id="line-5794"></span><span>
</span><span id="line-5795"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>
</span><span id="line-5796"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-5797"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#spacing"><span class="hs-identifier hs-var">spacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-5798"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bounds -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#bounds"><span class="hs-identifier hs-var">bounds</span></a></span><span> </span><span class="annot"><span class="annottext">Bounds
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Flush"><span class="hs-identifier hs-var">Flush</span></a></span><span>
</span><span id="line-5799"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#vConcat"><span class="hs-identifier hs-var">vConcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">densLayer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117652"><span class="hs-identifier hs-var">tickLayer</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5800"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-5801"></span><span>
</span><span id="line-5802"></span><span class="hs-comment">{-
See https://github.com/DougBurke/hvega/issues/88
-}</span><span>
</span><span id="line-5805"></span><span>
</span><span id="line-5806"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-type">aitoffTrans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Foundation.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Foundation.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#BuildTransformSpecs"><span class="hs-identifier hs-type">BuildTransformSpecs</span></a></span><span>
</span><span id="line-5807"></span><span id="aitoffTrans"><span class="annot"><span class="annottext">aitoffTrans :: Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-var hs-var">aitoffTrans</span></a></span></span><span> </span><span id="local-6989586621679117642"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">lng</span></a></span></span><span> </span><span id="local-6989586621679117641"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117641"><span class="hs-identifier hs-var">lat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5808"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">lng</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt;180?(&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">lng</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-360)*PI/-180 : &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">lng</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*PI/-180&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lambda&quot;</span></span><span>
</span><span id="line-5809"></span><span>  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117641"><span class="hs-identifier hs-var">lat</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*PI/180&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;phi&quot;</span></span><span>
</span><span id="line-5810"></span><span>  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;acos(cos(datum.phi)*cos(datum.lambda/2))&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alpha&quot;</span></span><span>
</span><span id="line-5811"></span><span>  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.alpha == 0 ? 1 : sin(datum.alpha) / datum.alpha&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sincAlpha&quot;</span></span><span>
</span><span id="line-5812"></span><span>  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;360*cos(datum.phi)*sin(datum.lambda/2)/(PI*datum.sincAlpha)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-5813"></span><span>  </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;180*sin(datum.phi)/(PI*datum.sincAlpha)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span>
</span><span id="line-5814"></span><span>
</span><span id="line-5815"></span><span>
</span><span id="line-5816"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleData"><span class="hs-identifier hs-type">graticuleData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Graphics.Vega.VegaLite.Input.html#DataColumn"><span class="hs-identifier hs-type">DataColumn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Input.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span>
</span><span id="line-5817"></span><span id="graticuleData"><span class="annot"><span class="annottext">graticuleData :: Double -&gt; Double -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleData"><span class="hs-identifier hs-var hs-var">graticuleData</span></a></span></span><span> </span><span id="local-6989586621679117639"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117639"><span class="hs-identifier hs-var">lngStep</span></a></span></span><span> </span><span id="local-6989586621679117638"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117638"><span class="hs-identifier hs-var">latStep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5818"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117637"><span class="annot"><span class="annottext">lngVals :: [Double]
</span><a href="#local-6989586621679117637"><span class="hs-identifier hs-var hs-var">lngVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">180</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117639"><span class="hs-identifier hs-var">lngStep</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">180</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">180</span></span><span class="hs-special">]</span><span>
</span><span id="line-5819"></span><span>      </span><span id="local-6989586621679117636"><span class="annot"><span class="annottext">latVals :: [Double]
</span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var hs-var">latVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117638"><span class="hs-identifier hs-var">latStep</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span class="hs-special">]</span><span>
</span><span id="line-5820"></span><span>
</span><span id="line-5821"></span><span>      </span><span id="local-6989586621679117635"><span class="annot"><span class="annottext">nlng :: Int
</span><a href="#local-6989586621679117635"><span class="hs-identifier hs-var hs-var">nlng</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117637"><span class="hs-identifier hs-var">lngVals</span></a></span><span>
</span><span id="line-5822"></span><span>      </span><span id="local-6989586621679117633"><span class="annot"><span class="annottext">nlat :: Int
</span><a href="#local-6989586621679117633"><span class="hs-identifier hs-var hs-var">nlat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var">latVals</span></a></span><span>
</span><span id="line-5823"></span><span>
</span><span id="line-5824"></span><span>      </span><span id="local-6989586621679117632"><span class="annot"><span class="annottext">lng :: [Double]
</span><a href="#local-6989586621679117632"><span class="hs-identifier hs-var hs-var">lng</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Double]] -&gt; [Double]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Double] -&gt; [[Double]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117633"><span class="hs-identifier hs-var">nlat</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117637"><span class="hs-identifier hs-var">lngVals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5825"></span><span>      </span><span id="local-6989586621679117629"><span class="annot"><span class="annottext">lat :: [Double]
</span><a href="#local-6989586621679117629"><span class="hs-identifier hs-var hs-var">lat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; [Double]) -&gt; [Double] -&gt; [Double]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; [Double]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679117635"><span class="hs-identifier hs-var">nlng</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var">latVals</span></a></span><span>
</span><span id="line-5826"></span><span>
</span><span id="line-5827"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Format] -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Input.html#dataFromColumns"><span class="hs-identifier hs-var">dataFromColumns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5828"></span><span>     </span><span class="annot"><span class="annottext">([DataColumn] -&gt; PropertySpec)
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lng&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117632"><span class="hs-identifier hs-var">lng</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5829"></span><span>     </span><span class="annot"><span class="annottext">([DataColumn] -&gt; [DataColumn])
-&gt; ([DataColumn] -&gt; [DataColumn]) -&gt; [DataColumn] -&gt; [DataColumn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DataValues -&gt; [DataColumn] -&gt; [DataColumn]
</span><a href="Graphics.Vega.VegaLite.Input.html#dataColumn"><span class="hs-identifier hs-var">dataColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lat&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; DataValues
</span><a href="Graphics.Vega.VegaLite.Data.html#Numbers"><span class="hs-identifier hs-var">Numbers</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679117629"><span class="hs-identifier hs-var">lat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5830"></span><span>
</span><span id="line-5831"></span><span>
</span><span id="line-5832"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleSpec"><span class="hs-identifier hs-type">graticuleSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VLSpec"><span class="hs-identifier hs-type">VLSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-5833"></span><span id="graticuleSpec"><span class="annot"><span class="annottext">graticuleSpec :: [VLSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleSpec"><span class="hs-identifier hs-var hs-var">graticuleSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5834"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117626"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117626"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-5835"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-var">aitoffTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.lng&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.lat&quot;</span></span><span>
</span><span id="line-5836"></span><span>
</span><span id="line-5837"></span><span>      </span><span id="local-6989586621679117625"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117625"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-5838"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5839"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AxisProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PAxis"><span class="hs-identifier hs-var">PAxis</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5840"></span><span>
</span><span id="line-5841"></span><span>      </span><span id="local-6989586621679117624"><span class="annot"><span class="annottext">encParallel :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117624"><span class="hs-identifier hs-var hs-var">encParallel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117625"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-5842"></span><span>                    </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[DetailChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#detail"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; DetailChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#DName"><span class="hs-identifier hs-var">DName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lat&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; DetailChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#DmType"><span class="hs-identifier hs-var">DmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5843"></span><span>      </span><span id="local-6989586621679117620"><span class="annot"><span class="annottext">encMeridian :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117620"><span class="hs-identifier hs-var hs-var">encMeridian</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117625"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-5844"></span><span>                    </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[DetailChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#detail"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; DetailChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#DName"><span class="hs-identifier hs-var">DName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lng&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; DetailChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#DmType"><span class="hs-identifier hs-var">DmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5845"></span><span>                    </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[OrderChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#order"><span class="hs-identifier hs-var">order</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OrderChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#OName"><span class="hs-identifier hs-var">OName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lat&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; OrderChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#OmType"><span class="hs-identifier hs-var">OmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5846"></span><span>
</span><span id="line-5847"></span><span>      </span><span id="local-6989586621679117616"><span class="annot"><span class="annottext">spec :: Double -&gt; Double -&gt; ([a] -&gt; PropertySpec) -&gt; VLSpec
</span><a href="#local-6989586621679117616"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span id="local-6989586621679117615"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117615"><span class="hs-identifier hs-var">lngStep</span></a></span></span><span> </span><span id="local-6989586621679117614"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117614"><span class="hs-identifier hs-var">latStep</span></a></span></span><span> </span><span id="local-6989586621679117613"><span class="annot"><span class="annottext">[a] -&gt; PropertySpec
</span><a href="#local-6989586621679117613"><span class="hs-identifier hs-var">encs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5848"></span><span>        </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; [DataColumn] -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleData"><span class="hs-identifier hs-var">graticuleData</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117615"><span class="hs-identifier hs-var">lngStep</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679117614"><span class="hs-identifier hs-var">latStep</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5849"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117626"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5850"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; PropertySpec
</span><a href="#local-6989586621679117613"><span class="hs-identifier hs-var">encs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-5851"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Line"><span class="hs-identifier hs-var">Line</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStrokeWidth"><span class="hs-identifier hs-var">MStrokeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MStroke"><span class="hs-identifier hs-var">MStroke</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;black&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5852"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-5853"></span><span>
</span><span id="line-5854"></span><span>      </span><span id="local-6989586621679117612"><span class="annot"><span class="annottext">specParallel :: VLSpec
</span><a href="#local-6989586621679117612"><span class="hs-identifier hs-var hs-var">specParallel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; ([EncodingSpec] -&gt; PropertySpec) -&gt; VLSpec
forall a. Double -&gt; Double -&gt; ([a] -&gt; PropertySpec) -&gt; VLSpec
</span><a href="#local-6989586621679117616"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117624"><span class="hs-identifier hs-var">encParallel</span></a></span><span>
</span><span id="line-5855"></span><span>      </span><span id="local-6989586621679117611"><span class="annot"><span class="annottext">specMeridian :: VLSpec
</span><a href="#local-6989586621679117611"><span class="hs-identifier hs-var hs-var">specMeridian</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; ([EncodingSpec] -&gt; PropertySpec) -&gt; VLSpec
forall a. Double -&gt; Double -&gt; ([a] -&gt; PropertySpec) -&gt; VLSpec
</span><a href="#local-6989586621679117616"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117620"><span class="hs-identifier hs-var">encMeridian</span></a></span><span>
</span><span id="line-5856"></span><span>
</span><span id="line-5857"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117612"><span class="hs-identifier hs-var">specParallel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117611"><span class="hs-identifier hs-var">specMeridian</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-5858"></span><span>
</span><span id="line-5859"></span><span>
</span><span id="line-5860"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffConfig"><span class="hs-identifier hs-type">aitoffConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#ConfigureSpec"><span class="hs-identifier hs-type">ConfigureSpec</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#PropertySpec"><span class="hs-identifier hs-type">PropertySpec</span></a></span><span>
</span><span id="line-5861"></span><span id="aitoffConfig"><span class="annot"><span class="annottext">aitoffConfig :: [ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffConfig"><span class="hs-identifier hs-var hs-var">aitoffConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-5862"></span><span>  </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#configure"><span class="hs-identifier hs-var">configure</span></a></span><span>
</span><span id="line-5863"></span><span>  </span><span class="annot"><span class="annottext">([ConfigureSpec] -&gt; PropertySpec)
-&gt; BuildConfigureSpecs -&gt; [ConfigureSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ViewConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewStyle"><span class="hs-identifier hs-var">ViewStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ViewConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#ViewNoStroke"><span class="hs-identifier hs-var">ViewNoStroke</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5864"></span><span>  </span><span class="annot"><span class="annottext">BuildConfigureSpecs -&gt; BuildConfigureSpecs -&gt; BuildConfigureSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CompositionConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#FacetStyle"><span class="hs-identifier hs-var">FacetStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; CompositionConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#CompSpacing"><span class="hs-identifier hs-var">CompSpacing</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5865"></span><span>  </span><span class="annot"><span class="annottext">BuildConfigureSpecs -&gt; BuildConfigureSpecs -&gt; BuildConfigureSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HeaderProperty] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#HeaderStyle"><span class="hs-identifier hs-var">HeaderStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; HeaderProperty
</span><a href="Graphics.Vega.VegaLite.Foundation.html#HLabelAngle"><span class="hs-identifier hs-var">HLabelAngle</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5866"></span><span>  </span><span class="annot"><span class="annottext">BuildConfigureSpecs -&gt; BuildConfigureSpecs -&gt; BuildConfigureSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LegendConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#LegendStyle"><span class="hs-identifier hs-var">LegendStyle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">LegendOrientation -&gt; LegendConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#LeOrient"><span class="hs-identifier hs-var">LeOrient</span></a></span><span> </span><span class="annot"><span class="annottext">LegendOrientation
</span><a href="Graphics.Vega.VegaLite.Legend.html#LOBottom"><span class="hs-identifier hs-var">LOBottom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LegendConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#LeNoTitle"><span class="hs-identifier hs-var">LeNoTitle</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5867"></span><span>  </span><span class="annot"><span class="annottext">BuildConfigureSpecs -&gt; BuildConfigureSpecs -&gt; BuildConfigureSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigurationProperty -&gt; BuildConfigureSpecs
</span><a href="Graphics.Vega.VegaLite.Configuration.html#configuration"><span class="hs-identifier hs-var">configuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AxisConfig] -&gt; ConfigurationProperty
</span><a href="Graphics.Vega.VegaLite.Configuration.html#Axis"><span class="hs-identifier hs-var">Axis</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#Domain"><span class="hs-identifier hs-var">Domain</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5868"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#Grid"><span class="hs-identifier hs-var">Grid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5869"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#Labels"><span class="hs-identifier hs-var">Labels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5870"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; AxisConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#Ticks"><span class="hs-identifier hs-var">Ticks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-5871"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AxisConfig
</span><a href="Graphics.Vega.VegaLite.Configuration.html#NoTitle"><span class="hs-identifier hs-var">NoTitle</span></a></span><span>
</span><span id="line-5872"></span><span>                        </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-5873"></span><span>
</span><span id="line-5874"></span><span>
</span><span id="line-5875"></span><span>
</span><span id="line-5876"></span><span class="hs-comment">-- $aitoff</span><span>
</span><span id="line-5877"></span><span class="hs-comment">--</span><span>
</span><span id="line-5878"></span><span class="hs-comment">-- Thanks to Jo Wood for</span><span>
</span><span id="line-5879"></span><span class="hs-comment">-- &lt;https://github.com/gicentre/litvis/blob/master/examples/gaia.md coming up with these examples&gt;.</span><span>
</span><span id="line-5880"></span><span class="hs-comment">-- They are similar to 'skyPlot', but instead of using one of the pre-defined</span><span>
</span><span id="line-5881"></span><span class="hs-comment">-- projections, they creates their own: the</span><span>
</span><span id="line-5882"></span><span class="hs-comment">-- &lt;https://en.wikipedia.org/wiki/Aitoff_projection Aitoff projection&gt;.</span><span>
</span><span id="line-5883"></span><span class="hs-comment">--</span><span>
</span><span id="line-5884"></span><span class="hs-comment">--  I follow Jo's example and break out four helper routines:</span><span>
</span><span id="line-5885"></span><span class="hs-comment">--</span><span>
</span><span id="line-5886"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5887"></span><span class="hs-comment">--  aitoffTrans :: 'FieldName' -&gt; 'FieldName' -&gt; 'BuildTransformSpecs'</span><span>
</span><span id="line-5888"></span><span class="hs-comment">--  aitoffTrans ra dec =</span><span>
</span><span id="line-5889"></span><span class="hs-comment">--    calculateAs (ra &lt;&gt; \&quot;&gt;180?(\&quot; &lt;&gt; ra &lt;&gt; \&quot;-360)*PI/-180 : \&quot; &lt;&gt; ra &lt;&gt; \&quot;*PI/-180\&quot;) \&quot;lambda\&quot;</span><span>
</span><span id="line-5890"></span><span class="hs-comment">--    . calculateAs (dec &lt;&gt; \&quot;*PI/180\&quot;) \&quot;phi\&quot;</span><span>
</span><span id="line-5891"></span><span class="hs-comment">--    . calculateAs \&quot;acos(cos(datum.phi)*cos(datum.lambda/2))\&quot; \&quot;alpha\&quot;</span><span>
</span><span id="line-5892"></span><span class="hs-comment">--    . calculateAs \&quot;datum.alpha == 0 ? 1 : sin(datum.alpha) / datum.alpha\&quot; \&quot;sincAlpha\&quot;</span><span>
</span><span id="line-5893"></span><span class="hs-comment">--    . calculateAs \&quot;360*cos(datum.phi)*sin(datum.lambda/2)/(PI*datum.sincAlpha)\&quot; \&quot;x\&quot;</span><span>
</span><span id="line-5894"></span><span class="hs-comment">--    . calculateAs \&quot;180*sin(datum.phi)/(PI*datum.sincAlpha)\&quot; \&quot;y\&quot;</span><span>
</span><span id="line-5895"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5896"></span><span class="hs-comment">--</span><span>
</span><span id="line-5897"></span><span class="hs-comment">--  This is used to convert position values to diplay coordinates.</span><span>
</span><span id="line-5898"></span><span class="hs-comment">--  The first two calculations convert the angles into radians, first ensuring right</span><span>
</span><span id="line-5899"></span><span class="hs-comment">--  ascension is scaled between -180 and 180 degrees rather than 0 to 360 degrees</span><span>
</span><span id="line-5900"></span><span class="hs-comment">--  and flipped so we are looking \'out\' from the centre the sphere not \'in\' from outside</span><span>
</span><span id="line-5901"></span><span class="hs-comment">--  (we've seen this before, but not in such a condensed form).</span><span>
</span><span id="line-5902"></span><span class="hs-comment">--  The next two calculate the intermediate alpha value and its cardinal sine.</span><span>
</span><span id="line-5903"></span><span class="hs-comment">--  The final pair use lambda, phi and alpha to calculate the projected x and y coordinates.</span><span>
</span><span id="line-5904"></span><span class="hs-comment">--</span><span>
</span><span id="line-5905"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5906"></span><span class="hs-comment">--  graticuleData :: Double -&gt; Double -&gt; ['DataColumn'] -&gt; 'Data'</span><span>
</span><span id="line-5907"></span><span class="hs-comment">--  graticuleData lngStep latStep =</span><span>
</span><span id="line-5908"></span><span class="hs-comment">--    let lngVals = [-180, lngStep - 180 .. 180]</span><span>
</span><span id="line-5909"></span><span class="hs-comment">--        latVals = [-90, latStep - 90 .. 90]</span><span>
</span><span id="line-5910"></span><span class="hs-comment">--</span><span>
</span><span id="line-5911"></span><span class="hs-comment">--        nlng = length lngVals</span><span>
</span><span id="line-5912"></span><span class="hs-comment">--        nlat = length latVals</span><span>
</span><span id="line-5913"></span><span class="hs-comment">--</span><span>
</span><span id="line-5914"></span><span class="hs-comment">--        lng = concat (replicate nlat lngVals)</span><span>
</span><span id="line-5915"></span><span class="hs-comment">--        lat = concatMap (replicate nlng) latVals</span><span>
</span><span id="line-5916"></span><span class="hs-comment">--</span><span>
</span><span id="line-5917"></span><span class="hs-comment">--    in dataFromColumns []</span><span>
</span><span id="line-5918"></span><span class="hs-comment">--       . dataColumn \&quot;lng\&quot; (Numbers lng)</span><span>
</span><span id="line-5919"></span><span class="hs-comment">--       . dataColumn \&quot;lat\&quot; (Numbers lat)</span><span>
</span><span id="line-5920"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5921"></span><span class="hs-comment">--</span><span>
</span><span id="line-5922"></span><span class="hs-comment">--  This routine just sets up a bunch of points which indicite the grid lines,</span><span>
</span><span id="line-5923"></span><span class="hs-comment">--  and is used in the following function.</span><span>
</span><span id="line-5924"></span><span class="hs-comment">--</span><span>
</span><span id="line-5925"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5926"></span><span class="hs-comment">--  graticuleSpec :: ['VLSpec']</span><span>
</span><span id="line-5927"></span><span class="hs-comment">--  graticuleSpec =</span><span>
</span><span id="line-5928"></span><span class="hs-comment">--    let trans = transform</span><span>
</span><span id="line-5929"></span><span class="hs-comment">--                . aitoffTrans \&quot;datum.lng\&quot; \&quot;datum.lat\&quot;</span><span>
</span><span id="line-5930"></span><span class="hs-comment">--</span><span>
</span><span id="line-5931"></span><span class="hs-comment">--        enc = encoding</span><span>
</span><span id="line-5932"></span><span class="hs-comment">--              . position X [ PName \&quot;x\&quot;, PmType Quantitative, PAxis [] ]</span><span>
</span><span id="line-5933"></span><span class="hs-comment">--              . position Y [ PName \&quot;y\&quot;, PmType Quantitative, PAxis [] ]</span><span>
</span><span id="line-5934"></span><span class="hs-comment">--</span><span>
</span><span id="line-5935"></span><span class="hs-comment">--        encParallel = enc</span><span>
</span><span id="line-5936"></span><span class="hs-comment">--                      . 'detail' [ 'DName' \&quot;lat\&quot;, 'DmType' Nominal ]</span><span>
</span><span id="line-5937"></span><span class="hs-comment">--        encMeridian = enc</span><span>
</span><span id="line-5938"></span><span class="hs-comment">--                      . detail [ DName \&quot;lng\&quot;, DmType Nominal ]</span><span>
</span><span id="line-5939"></span><span class="hs-comment">--                      . 'order' [ 'OName' \&quot;lat\&quot;, 'OmType' Quantitative ]</span><span>
</span><span id="line-5940"></span><span class="hs-comment">--</span><span>
</span><span id="line-5941"></span><span class="hs-comment">--        spec lngStep latStep encs =</span><span>
</span><span id="line-5942"></span><span class="hs-comment">--          asSpec [ graticuleData lngStep latStep []</span><span>
</span><span id="line-5943"></span><span class="hs-comment">--                 , trans []</span><span>
</span><span id="line-5944"></span><span class="hs-comment">--                 , encs []</span><span>
</span><span id="line-5945"></span><span class="hs-comment">--                 , mark Line [ MStrokeWidth 0.1, MStroke \&quot;black\&quot; ]</span><span>
</span><span id="line-5946"></span><span class="hs-comment">--                 ]</span><span>
</span><span id="line-5947"></span><span class="hs-comment">--</span><span>
</span><span id="line-5948"></span><span class="hs-comment">--        specParallel = spec 30 10 encParallel</span><span>
</span><span id="line-5949"></span><span class="hs-comment">--        specMeridian = spec 10 2 encMeridian</span><span>
</span><span id="line-5950"></span><span class="hs-comment">--</span><span>
</span><span id="line-5951"></span><span class="hs-comment">--    in [ specParallel, specMeridian ]</span><span>
</span><span id="line-5952"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5953"></span><span class="hs-comment">--</span><span>
</span><span id="line-5954"></span><span class="hs-comment">--  We then project the lines of longitude and latitude using our Aitoff transformation</span><span>
</span><span id="line-5955"></span><span class="hs-comment">--  and combine them as two layers. Note the use of the 'detail' channel to separate the</span><span>
</span><span id="line-5956"></span><span class="hs-comment">--  coordinates that make up each line of constant longitude (meridian) and</span><span>
</span><span id="line-5957"></span><span class="hs-comment">--  latitude (parallel) and the 'order' channel to sequence the coordinates</span><span>
</span><span id="line-5958"></span><span class="hs-comment">--  of each meridian line in latitude order.</span><span>
</span><span id="line-5959"></span><span class="hs-comment">--</span><span>
</span><span id="line-5960"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5961"></span><span class="hs-comment">--  aitoffConfig :: ['ConfigureSpec'] -&gt; 'PropertySpec'</span><span>
</span><span id="line-5962"></span><span class="hs-comment">--  aitoffConfig =</span><span>
</span><span id="line-5963"></span><span class="hs-comment">--    configure</span><span>
</span><span id="line-5964"></span><span class="hs-comment">--    . configuration (ViewStyle [ ViewNoStroke ])</span><span>
</span><span id="line-5965"></span><span class="hs-comment">--    . configuration ('FacetStyle' [ 'CompSpacing' 0 ])</span><span>
</span><span id="line-5966"></span><span class="hs-comment">--    . configuration ('HeaderStyle' [ 'HLabelAngle' 0 ])</span><span>
</span><span id="line-5967"></span><span class="hs-comment">--    . configuration ('LegendStyle' [ 'LeOrient' LOBottom, 'LeNoTitle' ])</span><span>
</span><span id="line-5968"></span><span class="hs-comment">--    . configuration ('Axis' [ 'Domain' False</span><span>
</span><span id="line-5969"></span><span class="hs-comment">--                          , 'Grid' False</span><span>
</span><span id="line-5970"></span><span class="hs-comment">--                          , 'Labels' False</span><span>
</span><span id="line-5971"></span><span class="hs-comment">--                          , 'Ticks' False</span><span>
</span><span id="line-5972"></span><span class="hs-comment">--                          , 'NoTitle'</span><span>
</span><span id="line-5973"></span><span class="hs-comment">--                          ])</span><span>
</span><span id="line-5974"></span><span class="hs-comment">--  @</span><span>
</span><span id="line-5975"></span><span class="hs-comment">--</span><span>
</span><span id="line-5976"></span><span class="hs-comment">--  The configuration hides the border line and tweaks a number of settings,</span><span>
</span><span id="line-5977"></span><span class="hs-comment">--  some of which we have seen applied directly to the marks themselves.</span><span>
</span><span id="line-5978"></span><span>
</span><span id="line-5979"></span><span class="hs-comment">{-|

With the helper routines, the actual plot is not very different to other
plots (but note that unlike 'skyPlot' we __do not__ use 'projection' since
we are doing it all ourselves).

&lt;&lt;images/vl/skyplotaitoff.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMAmAHAVgBpwoBjAewDsAzJDMUCCGWAQwBNYAnO4SAGxYAjWHwCCFRH1h0ADAF8ijKADd4sAO49IAZxScyAa2mYKAVz58FxJlRYlYaTL20AHO-AmyrSyCwAe8No81oyQbGQAtiwedLZ82rCKSlACwvGxLPGJIUyInPBsGVlJPijwKFJ0ZhYloWUkBkGYcQkh3qFSiLAUhU6QZPndjlCCZCgokZAEUGUVxmDVlsTtYSwoLME+ppx8dDDjLtroAPTHnCzqAHSI5dCmgqYJnOQUKEOX5BHHACJkpogAIW2RmO0GUsEQLGOUV0XFB4MhxzYayhkPgLAAtCxMQA2ACMOKxeJkGPWgikeJYlwoZAxcHYXEuKG0yimIUgVAGUWGDGSkDcnASm2STAA4lFEHszBFhNxaj4AEqiAD6AEkAMIKgDKUtMMq4bJFTBcfD8uv1cpyoW+AFE1ZqdZhINLZYajZBYMqTWanS6DVa5G1lklIOoCihoHQ8AB2GQhgAk2hIcCie1QKEOJ2OCKpNwj90u8DIxyTKahOYxfHKsGzABZLgArbSUN38FgATwNmAA2iFeaVzhRtJzOBE6L2jfQrT4WE0UiwZci3ZPICRMiRzGt5qsUHrLkr7dqAHx4nAyAD8AApkbuIvuVRrtRiAMw4mQASgAVAAFVXHDGnjIYCYDee4Ho+Wo-n+AFnpA05gO0Iq8LOewuNA8BTKQ66bm8eygXetqHpBv7HIBkCIck-buihTqZGhGzynya58BuAi4bR5DaJenHXmse5ofAX48fhlwCIuUJYO+75wZOFFKFRIq+HOOgeCQoh8PRy7usxrFbnhfF3nR0AsGAAC8plgEB55gHiwFgNoHi8belxGSw75gMcYAia5MlGnJjAKXyNFQGajE+DpOHbq+MifsJBmXAJX4ORQTl7mJgjIscknHJev6fiJyVqRpxnSfB-kQMhyntphq7YWx26AZ+yWpXeiU5XlBWqep9HSYGIoALqMZAUScAYWgOQAXvMACc0yQCg7YuNuJDwM8lT+R6FDkGwHiSk48GrmQfADFoNAiL0UDqnwjxvHKMyLduNIRB4mTkWFIWnWofAXZAoVQEmmTzLwFDwPYRQJAo91LXsACOpgsK85RrPA4JvQd1V9Gd317NVc0A5UfQg2DzSZBDc0LdDTpwwjszI6jfXJAzEAUYF82DsOXLjvBgUzsp6VLu9TARfV+nOXwEgnmeV4ieLiAvm+X4kTBQEgfFstQf+ZFle9lWoehNXC3pToy2sGtkeVU6TkwwW+MVDHwULdVG1AdhkFxcXOYlsVuy1okLhlElSb5IoWzzoQ24V3XGVpimG+xUDeXbZkWVZNl2c1ic9R5XnxT52vcw7LvKaFhe1SxkV7NF3tcSJXsZ2r-uZdluWqvl8WR3bpWyTrSk4wbTvx5AjX1576Hvu1redVtUdueRVqDVaw0sKN416IYsAAOrhpGmAyJceJ42vRh7OSdhjeTD17FWFDSBtN4bPtK7KJkpiwHOE5W7wbF0Bi01xiknhMDKwthVNswxf7-34IAsAAE8DyEFvQMBP8-5zVlj-PEWB4GFy-msZBkC0FAL-iAxB39CH4OgRiN8xCcHgJQQAvaMDnxYKtiQ3BZDUHQOYZ-JB7D6F0CYdQnhMC6FQIYVQhBNC8EcIYUQiRQiIHSLoBgrhk5JG8NEUouBgjSHCPIQwwC2i2EwLPIooBBi5E6IxCYvhZitEWKMVYvR6DMGGPAdYjRZDXE-3cQQmB4jsHyJ8RQgR9i3FON3l4oBQSGEhICZY6JdB-EsLUcY8JYBZFxIcQkzAyjImpNMTZOxmSwkFPMcUn+sYCnANCRUtJsCVFGhSRiSpNiYG5JqUAlpHjdF5OaXUpJ3DLFdN8S+BpSF5HDM4b0yZMSxmUQmWkgZqiFkFIycklZrT2nlM6WkvERT1lDN2WeXpb4qllIOQ405rT6knLqVsi54CrndIgbcqpSzGnyKeSM2JDyf5fKmR0vxaSfmDMuYsuZ8lPlpLWaCx5uyXGAsobs-ZsK-lHIhQFeRcCznHMRdi65eyMWgMsfi559zUVANJSMmFyySX9KJaw8BVLgkMqacyhhrKsXAs5XSgp7zxm8taTSj5grunktpQ49lmieWSvRb02sdzcXbJgQqs5KKJXgNVQShFyqMRauecKgVDj9UjP5fMyxJqWXyrSTKzV3LrV8ttT-S1MinVAJdUonVvz3XIrdSquViKmE4r9aMtVIag3avDXUw15qHERueWayFlj43fKjQUtNrSQUap-im6BibMXJuhRmsVXqKWMN9b03N+ilXepgZg4NvT60EvVSKhxTayWluzUA9t1KQ09oofm4lba6lZtbeA-tHLG32sRROxJfai1TtKZ2sdP9Z05JbUa8dAbdXEgbYi3dzaQ0Ho7Ue6Np63nnuuaOzd6CbW9OPb469sbwEPrzZe7pMak0ONffo5dN6zEVv3du2tiq-V3I3c+2QZy-2Qd3lUz9BajH0rySOsD6aUMFKfV+4Y4KMNCrQ5smD2GoObIg8RuDmya1lp-egqjXabLgb9TRsxRHEPDGYz0wFHGkV5O41htjSi71cencqjjg7GWCdWUx+F0nSlkYEzk4DZa11tLoyuzAKmbmAs0+K9T2Az15M0+JlJmn+NDuGCpv1KmzMSY07h7TC6HNLqs4B5VKnzllqrbRv1XnbE+buax8z-CDOAt80CvJYXRkRaE8qsLNmUlheM0IsLCGguYDC7p-9YAMvybS9lpT9GPVmLU1lorbTcu2bAGVgCgXKvVdS3V5DgLqvxaEWVv1ZXWs6LK0l7rjnlVlcy7Bqrrna2DZK8NqVxW-VTfKzNgL834OLeub1oxs2ouAtm8t7pXW1v2eVbNhrKTZtDfI2AE7FXjsFb0-8hh1TlW3fQZdoRj2WN+te5xh7TWvtVN28MD772RO1o+6t-7-XgcybyR9wlUPrtZZmd5vJCO-NI4W6jpb6OVt+uR+WzH3TsdA7LTj0HdAcdHaETj07CmwCU+ezoynE2zvZNU365nWnlVs6p3ltn5OdFs5J5gNnf26DM9Z4T+jzOBdgGZ7zoxzOueVfl3TuXcPhsiJGR5+j6uKEw8Bdru7CuUn67wXk43QCpdm9x3rmLtbLfC8wJbi34Oy2W8N0I13yvhiu+OfBfqAYhrdG2rtYUikfSIKxj9P681L5U3hojdYZRUZzX8IEKo5hLDvTCA4aIuxMZfR+t-C+lMoBPRersC2kAMbh-z33Iv25qbx7ptIZPAQ5yLCZowDvLNF56ARhzUcXNVGlxtvze2LCy66UHjLCWgFpZqwkPLD8GtlZ2Wn4gZfWtu7c17k6AS-dy4i2Ng3FAZtYKh2H8pHyCCJ8Vw4j7D2-Ex7V19qPrKQd85D-HxHLqdsY5MQHtuJnMZMnJZGANZLZJgCPHuK5O5J5EARsB-o0hfnsCXOPnHFFG+M-rXE-lAXeK-s3B1O3D-j1MHIzD3DbLjFhAfs7EPGeE1I5NgYJBPG3M5B3CQR3hAAvIpCNGNH0LoPoEYFvGwBGLIPvIfAIduKfA0DVBTNuNfLfENPfCHnyM-NdG-IPmWgogSoztTloWSrGL0pbgBFLnoRrp7lIgSgqoYXcvbrotBiGkYXiMSNYWcjIA4SFrqkYToXlqYRQgYYikYSYUYeYeoiMlYQEahi4dcrVk0o4e4ehhEaUvEa0jEfInbskd0uEZ4WkiEXYa0kEWkv4dkQUt4ZVr4a6lEWKm4ZUb4k4RkbUakZYq7rYeUUolkbWq0euvUdAgSN0fokUR0d7iGjgDgHurqiMWcgMZoRMQSiYTMWSrkVYqMZYcMcsWSi0fMRro0VkmsRrs4YipsTrtUQcbsRQrLm4qcXdqUU0ocXdlMfRksRer0rcT-IsS8T6s8ZcTmqsVUtsRca4Z8QkeMV8YpoCSkT8ZmhCZkVCb4m8SCWAHMfCfcXpo8a0tcYEvCecd4vCcSDCT0fscCc5mCWKhsTie0dMTiXCaUoiaUsiVlqiWKuifEjiGMR0TgCyQSnScNlYhyWSnMbyWYcMQKTruSQ8eyWchscKQbn8d4lKeggSWyXKQBkKRjgcUqaks8eqX0pqU8WqVUm8VqaKSieKVeiqdEWaWShab4laT0TaQwjKVEuqZKQUkafSSad0gaY6jqa0lyWdjySUXaXQFiY6UkYGTkgqdMeqW7syaUs6Zsq6dye6bUZ6ZsvybSWGTZEyVkrWKydMTmZycMfmXyYWWGs8UWRrgmX6TgOWTrhsTWdKSWQShGWKfWbeo2Qau2SMlmW4q2TsmWbqeMb2TAm8UOXqp2VagcaOQ6cYqOc2caUOeOfoouXQNOVYkOXWS6cuZgCOV6ZOQUr6bodWQGf2fhieVUVuTZHOW6UOdGdmbGReXiJWYeTeTuamQ+QeT4UeZRsMVgLmWKb+QWc8QBcWUBaWQccBRWT+RKVBZGqBU2TBZaQhb2nBc8t2d4hBX4UhQOlhXdm8RhXdk+Z+fhd8ShSMquTgMRQBqRQCuMZRQxtRfaThcFgxXQIRWURRQUnhbubRfuUxYLnxekgJbiSxeGUJeRXRXiBsRJWxTcRJVxW+SJTZB+exRJWhVEqBs8XcspTcXcnMYxppWcjJYEjYcMWjgcXcleYmXcsceMR4WyXUmpfktctpcZQOfZfqaZVUkZfEpEeZb8Z5QSgFfjgZZskFb4uReLsaWkt5VkjkWFW+iFd0i5T5ceX5aeWleeYlbUZZVWZDhlbURsbsjFSUqRvFfonpemVlT0Y5c0vCfdh0dGHVXiMlQ4o1WciYW1YetMk1cVRUk1S0Z1Set1WcjlboYNRrjZQ1XVcGTAuNRQjVXNXcSGotWisNdcosStR8YiptVbrqjtRiKuftaNT4TtctTiWdQUodfCQNfCb1Z0vCRtfCR1UiRdWia9R+u9bUZNZoTtXUWtSWp9T0TdaUndbNZSYDeVRDUoi1eAr9QtVqZriidGAjTDRUgjR1QjRtQjaDc0gjQNQjYdQjcdWUcja4ctVqTNbjVUvDVUqjZ0lqRjR5dMoaeTb9qzeaczQCdteqezVUZzeCfzTtrzb4jjaTa0ljdxQ1eqXTbNeqTTelXtVGd9Q8WLWKsTU0qrQ0cLUDdrfoqLVGRLQpdzZVcbd+dMrOQtbOTLc0rOR1bORtbOaLbOQNbOYdbOerRMrOcrUjaOZTdGKOZbbTctaOXbUzdtaOU7Wzebf5dHYFbHcFeHUkfHeFcHZhqna0pHeLend0qHT6dnb4oHQrQ1Ted7fSf7aUh7UMjeW7fecnT0ZnWKg7dSfnT0dbeXWbdtXRfVT9V3c1ctb3R1b3Rtb3aLb3QNb3Ydb3ZXa1b3aXdydGF3X7V3QtV3W3V3YPWHXtV3aPVHZ3THXvXHQfQnVvUnUfSndMnRePZuRfZxf3ZLT3bxTfW9U-R9S-V9XfZstPbDRJZPbXWffXR-Y3YA7URvZsmvaUgtRpdtVpctbpbA2BXtXcqLSZdMmZYgyNfA4FZgx2ag9TdgyMm3d9g1XUhtXUsg7vegxzdA1zZQ8fcQ6fbQ+fdQ5Cbgxnfg9AqQ-fSrYUewwwpA1Jqw5lcw2rbw56qIzkgNUVeI4UtI70YI7UYQxAyGjiE1TVSo5Mco01SYeo11Yijo2Sjjfoxri0UYzrquaYwbl-X8k1XPX6RYybno3VWo3VdbfY+bpo5vR0W4-6icnVSY3VeYzY740CV4+dcEwLY42neE9CdE7CR4-kfE0lYkwXck9ApTd48JZE5-ak7+jk0ov4yDXk10bEz0dozia4ziWowjVUxoycujco5jQ04ZU0wSiYwTS02SlY+bgjbY7oTiBTR012YM5hXU25Zof054+MyzaM6aTM88uYz03M9aUs7aSs4xWs8xXo+qYY+qYsRMwkxs5gK43LcMxUVs6GYc5eac2I5c5Jdczkjs3JvczZNo1Gcc0oychbco1bd8+1b87o7qjiI7f8+sSC1sWCzrl034l7RC3dukwHbC7Up82Mw8UC5M6ixHYi0AiY1OVi20ni3i1C5QkOeY+uXi4Y0OXs0Odo0Oa40OWo0OfCxc3ozeUS2i4RoSzi4U8i6VTy2KjSybYCzeWo73SK7U3owPco0PVK80ycmPTK7BRKxg3K2TSq9cuk8vQq88q4+vVqyMns9vXqxOYC13eY7PWq3Q+MxJUa+s0qyw3azEw63Exa74to3RTq6lSawI067aTa0omyz-X6xI0GzZIY3JSG3Iz6-0RG2o1A4CzA68rMco-pXo0g8m9BYm0Nam8q9m1g5m8hbm6hem85cWwmqW-q+WxQoY75fG-vbW4ffW5a6i7spW7a424+q26xZ29ud2wib2642krG96+276-m-ib27eXCn-SO3rRO3s7sto7sgOx83iqoyGngE1dbRu3870tuwCx0XuwY+u-1ce-Ybu01US4exNae+qze0W+e0HQ+1jk+88osVe1W3e6mi+2RZ+0cd+zRQe2E6u5db+7Mv+wwjje+wwm+09aB6TnB-xeB0GQhwxih39cBxy0h8G1h6G2hzB83Th33YRzVXgNU+uyjeRzu3io07u9jZR60-R1m7qqRzm8xz04xwW2x3g7R4+9RyiyiSx+tRxx+zx7M3x1Q1xw2wezzaJ3zeJ90quYJ0LbJyLcJ9B2p3Oip9Aluyc1p2c5J0IwZ9lRpzkop1GS0Up7UZBwbSZy87Z0R-J7USR187uz8651R8x-beu8C+5wx750xwe+7d56q3ir7cF9cs57x55-x-SXgKOW+5i-51+6F3W4FzQ2l60uF3J9FxEzl8pyl2w0lxw1l66yV9p2V3wxV8h0V0uVV6JTVzcwVySXV7hw18U01yAy1w53l05+u6K31+K8x5K7u9KyN7K3ivK2N4q0N6xwe7PQN7e1N-exN1F3NzF9yXgF3W+4a0t8lzNxJ2t1J5oZtyE8d9a7t9Aop5fQt46-tx6Td6Vxdwwlu3RSR3RZTSd6FQ9+O09413dwVd97O79+1-96U4D9DeDzkiR3Gwewm3inA7uym8x2m4jxm-D2e+j-Baj3m5jzg7j0M9j9q+u0Q8dyQ8T15eT2J8j6l6T+l7T5l4T19Yz5d5T-l9T4V-j8V8z2Iqz74lu4O7z2k4L7V9z-68L397D9O5L-GeLyD9L-y7L0pYr4jfSbWGu-KpuyGmrx5x0dr-u5oXr0exr2j7qob+C8b1j4imb0cVr9Nbb9x1by4-b8+47+iyidbwRc788i0R76ul7xNRb02+70B6b-Caub7+lv79AjjRH+dlHzz4H3z-HyLsnw7qn6h4nz9675h9n815n0D7n8men5G6H4K7r5U1r2R-KhR9XzrwbzR1b3R7X3543xj6b0TZXyF+36qd3xF53yW832W4PxW8PyJ631T7r1qeH4s+P0H6r0raP225P1E7P6p4v1GP3znZv0n+v4h6v0L7vxn-v-okS7WFGdP1L-X9y8f9KofyX8v2A9v9VVry51b252-3Xw8bWF5-Kj5x-y36b1dov9ZuBvGFr-x7668EW4Agfv-yH6wCR+8AsfoAIoaQCaeX-L2tALn7clv+DDVAblzwFs8CBa-RAep0wGPcSB8HMgdAhqo4Ci6oA5lsgOyZUDcmzA-JsAJl6sC5e9Ao2owLFTW1aBjJLXv13lS91+Bw3K3qNwkHjdTek3KQdN115T0hBXfBQRAIN6asRBq3NQetz9K1gtuSg65DHy7o+9TW+gy0hoIZ5yDsuKg-AVoPtYyDr6lg51o4ISrODnupglJuYNfquDBM7grPvYJz7+C8+3gh5r4P0SLFdBBHYIUr08G9cHU2hLXnD1N4I8reSPXXijxSEm80hbfLIZbySHKCDedlAoQ7zyEwCShcAsoQgIqFICch3vBIWgPd7WU4hWAnQS2yaFMMqhYHDIRzw6Eb82hLgnoUczqHP0uhXggYUfzGHocJh4fXZD7ykZ9CwhQwhXvMIh7LCoe4adXoGk16VotG6whBh0WfA9VdhAA-YU1VXIHCQBDxc4Tj11RXC8eNwpxkcKJ7bDtBuhW4ZUJOEU9nhE-TQm8IoRnCgmmw07pcJD4fCbBwIlfvcIcGQis6XwrfrCJ36Ajhh0I0YaCMM6ojjO8Inov8Mv7giOBiIoBpiMhqEiVh+I2IYGir7kjBu+w+ppWgb43Cm+lI44T8Paa0iLhKJV8PkMuEDNWRffHkU8MZHlDqRbvekhyIMHhotSLRUUfM3FF08uRQI9kQvwFHtChRdglUbdzVFOD6RXDBUY-SVHUCZRdAuUV9z5EYi9RLAs0WwJNEAMrRCwm0UohMJSiFGBowQZWlf43D3+7oz-uyJ-6Bo-+nopkZcKAGui2RIosAb6NUGBjih+w0ctbWfAh1w08XBMZ8PDHfDIxB3H4RgJTHNDXhJdYMWCO9EQjoxUIosTCKzHkD-RSTPMd0hqpxjh2JYtERmIrpJiAh9YgHlWKs7NiCRZYsHu2NbqdiyRNw4QYGlEHhpxBg4vYT8JHqjjMhk47IbONyH7D5ulaRetON5HDjNBlw3VsuOFHclnwO3dcamPZEmDtxR3TcfKJFHncDxCnVcYQPnHqi7xmoxcdqIvG6jxxSIp8YaKPEMCPxIjE8QDT-FtirxHYgCT0UWJ7jIhb4vgTeIHH7CYePwxIbBK9EijUh8E6QYhIDHsi0G6EzpsWmvaVpChlwhyrhJGaBoSehEncX6Uiw41IskoupGcMaGkTzxu41oYxPzHITCxqE7odhMfGcS4RrEysfxI8GCSD+wkkXqJLF74SiS4k7DtJNa6yTdcNwhdsROjaSSO6uqXAH+RRIaTAKM6HYY2iaqLFtJRvXSTOIeJGTzeJkhcZoXMk299JEYrSQ8LsmlCOiNku7CYVcmvE+0dVHGh5OxZeT6h9JXyfiycnZifCQUolkFNXJBSWiQUnyQ9X8kHNLJAk9SfCRqpBTKa4U3pmFJxIRScSUUnEjFLJIJSuxKUiCS5PKbFSYJ1kikepJr4zoaR9UicWZIZG1TTJWklkY1KsnNTOR7U+yYFK1JpStS1tLAAzT7RalDJ0zTqbUMbRT8xpso3qRYNamhUZpIHFaaqOqnFiNppYpaXxJ2kIi9p+otaSiK2kNjupTAqaVrSOmASDpBfG6bfwuk9iHpKkp6UojSluiXJHoj6UhO5JYAfR6kv0V9IwmBSgxM6ILo2jDH-S+pP0qAaDI3FaT4x4MiiboV+nJjIZh44GQFOhnzSMZi0wGVYOskks+0ZLRGVxIJm30SZu0vGftKpmHTYZn4nGadPhlNiKZl0umUELRliofJL5ImWVLJmP8WZz-RtEOPUkjihZ30v0lgEkEiy0J1k2QdLPkGyyQxP0pcTOhXFiy1x8s-kZrNNR9o9B6s55D5KMG6zMZEs81qrKYmmzcBisticrI4lmS6Khs8mebMSnazyu+soSa7P04uTrWxs86Z7Il7Wz2Z3s6-v7K4H2zeZ4c-mc7JdEzo4JZkhCdZOSHqSUJ8cmWanKBk-SsJicpWRLOsrzooZucqMdnOcnFzBRpc94eXOqGVy7sMUuifnNPFaSbc1cwTIuhtmFz1p6c+8Z3J4ndz+hLknhq3OrH1zjpvcsScnOZmxypJ48zZLXJDn9ynmg8zrovL7HLzq0R6DYTui2H7o9J28pqSiVPBpz95J7e9KcPXk5zdCB864R0Uvl3Dr5jk3eSXIeI3ydZJ8pGT4WflVyn5fjM+emK-nYzuSH8ydA-Pxl-y25F866j-K7lHynZm858QApeqvz3xmhQBdV2AXv1EFv4tBViMgXXS75c85BeDQwVLysFz02BWpOvk1SKFVI5BQ1J3R0iqFKxe9HjSPQdS6F589+exyYUFyL5A0lhXDPpIEgXhHCt+WUUEViiuF6MgBbNIkVmD90MnORVbKfnqlVyYi28Uos2nqLtpDCymTQtfHaKPZ+ikSWwuNEKK-Zhi80cYqDm6K8RliovjIuIW2KV5pimOTunenILPp7i8WRfL+nXyAZnijOX6UfJzin5YM-dBDN8XcL35MM1xfwoAUIywlIippEEvEUJLJFgS3FvekzExLcZ-ikBfvMJmZK7Z+SjRcUq0W5LyxESvOoUqQUhK6x5S0dqkswXZL-xjS3BfUtumVKSpnShxd0qcXNKqpT84WdfNFn7oxxwyveQIqnH3o5Z4yhWYMvYWiKVZO6NWaMqLnzLH5+8rcasqE7TLUZsy6adsulG7KG5kyi2RfMvHLLVphyjtscqgWnKyl6ynRY8upnILXuR6d7u8u-GvKJ5lylsd8pnmfKbF+yuxdcsem-KoJtygZfvLjnQrqFT8pOdfJTmwrGFQGNqQIqznwqFlSSvOfegInIrluO6OpNbW4wmFuMixbjDjT4zvof2uK-+YEqbmYrlpqKsBe-MiroqSl7Kh5fioqXIKB5zKoebSvpkAKW21KvwYiqnniqAVgqzmaKttH8qelvKsvoqvIXTFNJbpOFcaS8WfkJliZQ+eqoCWHlglmqrqcasQrPFIl7FNZaaoIbDEhFlqnZQcT2Wqq0lhq3+dar-aOqclYpRRe6qX7Oq1Fvqrtuaq5X6qnlgawYcGoFWeqR54a8YWyR+Xxq-l3qqVdGuAmprQJtqngYmohXpq15JyNVdyTqmAstVZReheMz1WFq0VlauZSiQ775qr55axbnoytX0khpyjO1U0nGntqUlxal1T4WkXNqTl1a0KaWp9WtqrlvagNeOtJmosYFXjOBXYz0WNqo1k63xOky+WzqzFy61maup1r1qZV+6kFbuqJGDqc1x616VrwLU6CNVqvEtU0h8UG8K116g1T4RBmm8sV8icJY+qbXvqNZuvWJc+rLlf9Eln6p1cBr7VlEMlVvOlboQXLyox12Aidf+o7nu8OViGkNehrDW3qql0GmpahqFWAb0FuGppchpaW-qrF4Gg9cRqPWkaFVlGp0fBpVVmSr1yMm9T9LvXyIpZLkp9axpfVlEJ6faD9ZYiWXcaf1omgleJptWNoO1nGkDcJrA1aSUB1kk2bxtkXqSzlYUhDRLKQ3KaUNgUtDdpow2GasN7GnDeprw36aCNqmojeZpI26ayNkmvdTOnwXMbeWzmrNfZoY3uaXFIGFjXlgTn0YEVZaJFVlnSHKoUGgKDFXpgsoEYzVkWi1SkiIl4YtZvml3uFrk1IYFNoWpTYFpU3+aYN+Wr1dFq03U40k05NlcNmiqxae5xWl2aluSn1aDFwWupblpMXpat1rWhzc1pTXtaqNvWmjd1qWHxao5-WwWdpj82VYRlbmDjToi43KYeNeWGZfNprVZZFBhmHqatoS1CJ1B42jZZtrS21o9Zu2g2VZhy16Zjxx2gPpdoA7La8l+268etr03DYHZp2ozdTjopS53Wr2ldYdpa3naN1-2jrYDq630YJKthaSt9oG2g6I5wOrzdNqY16Y3FhWNjWdltodYdVqOhbXVirWY6Vtw2UJQNg2346tt3WFtcTr23k6gNiOjLcMES7NYztpWPLdjqHW46R1KSXMfTpZXM6p1lO4gYTre15ZqW6OszWNk9ai6rNgugHYzqB3S6Qd1OnreLr62K6od8uobfzrPXK6xtD2CbSkiLXA4ZtRiMtfRhan66+Nuuo1VljrWApOF1uknYbrJ1nY21UOGTToi7XO6e1pug5drrdWW6CtlWeRd7ru3DZlF72Ipb7pnU3Y51ZadUlLmlqh6LNwev7eHsZnJ7TRgendZ7raXG6XNketzenrBWZ6+lhevNYCg3m1ot5HOA3cMAMms4sdKSY+aXot3DYL2tehtRLjt3V6Hd1OJ3nkjqpS46quRbya3q93l6md9ev3ePqK1ZYQRZaMPsPpuWN6I90+qPe3rq2z6l1q+n7evol2K4pdzehNdvrl3L6Fdh+tNZXrz2j6PNm+uHZfp83UYYVWWbjN11rRP6pcT+3Ik-tBpP7bCT+6ck-qhZP6splWbjDNW4yOVuMMtElbJgdWiYyG0BkfffrH1CJADvGBlXpg4wAGyt8BhfbAYM3U4OMH+-bC-r5W4GE9Z2DjKAZFWoGD99GDA3-pmHYHrRwmBecwav3oGl2jBkvaJiGXUYptL+sZbwYx34GplXGJbbQYE28Y1tohoneQZWXcGu9eWDBABuEMu6jEShmA-way3DZ1DCB8Q0gZ0Q6Grt8hqfdoYuWaGudKSQw9Ah-0vbJDK+9Ax9qYxfa7DZBlQzvssM+yXDdmvQ0mocM4i-DQKwQxfqCNq7zDGukI1Csf1I70DHi2g2jt4wPq4jde5A87SYxvqX9BOjIzIfwNhcEjCh4AzGLSOqH2MiYvIx7uoyjkf9UG0TFkqyMmHyDHOmozpqSNPaGjeBxQ5SyKNr6WjDWio2Lr6PuGUje+tozLu0PV0ujFGmIznqiMsGmjbBmYyNrqN37aDlC6jHrrWNV77RQhxQybo2Nm7kDrCl-VbtEw26TjHerY3+r2MparjL8rjG7ruNaHyDEopjAOrOMs78DAeo4yVp2PNH0DTpF4+0eAO7MAT3Rv4xvrBOuGfjgxgw0rRBPeGITR+7Q+ZzhNn6vjwRlYzDsf1vMUTWul-WXuowV68TmxqHtseAOHDeMDe0TKfIpNCa1DNjJjHbxpOXHaDPerjH3oZM07Xpjx-A9-KZNHK2TE+5A-CQ5NMqqTvxx-RAr5N86iTAuskwup5PgmJT-Rlk0nu0PnURT8JpU74a1OTGdTqJgk7MZlOhGDTixk08sfO0P7ntAWi08Sf0ykmTMYWw7RFrcxRbVtMWwzDiqcxiblMSWr09cdB1kSbTGhn09ycW01snT+hoxDphcwabJtLEl0+KatNh6kzS+lM-dw9PymwziptM01oDOqmzs7mIAw6ZoNBnETBZhgxmcCN5n0TpZujbWaL0hmEdq2ng6Dr4PKYBDrZ+09tpENuYxD52iQ9pikO9nsji2uQ4dp23DmKdBZrZZOdfZWZ9xs5vbuOcjMWYzZi5m7Z2dFPLmLD3Z5M9OcBMmY6KuRSWZmcm3OHBzyp-s-mfe2eGLzox-c9qee1g75z0xp84afbOYm3zppzc+adW3RG-zKO97fEe0yJHztfi0HakcMzpHlMmRmCyOcm25GQL+RkzIUagvFGVypRpC+UYgsM7nt1Rw7bUbgv1GgL3xhC4mYLPEysLdyvC-YYAugm6LvRnC5CbIvQmozJdKzKyw4sSqiLupmi1WbAvvmmLxpoSzfp4uRHntqx0Hesaku2mRpXZ2bbsZkv7GFLTegs8ccO2nGNL5xjTLwsMxO7tMo0vS5yZ0uhnJtzxoyz7okuCmVLxFxbYqLcwh6LLPOtSwee23AmnLPKpS4xfO26cDL15uy8Mfe1RkoWclx8y5ZP1eX9TkVjNR5YL3KZsTsVrg4dvxOg7CTymHeW5hr2GZyT2mSk8ldUvvaW92V+CyZkZO5XkL221k5lfQsaYB9VmIfcVYg2lWVzK5AEdVdsuTaZ9qV8i4Vb3O9XUzBZ+KY1ZM2DXszo15i81dYsWZ1Tw1tPflbCv9XeL41pXelcEvnacSn2iqbNdxOeZLTZ2SLM-t2u2mDruRA66DQOu2EDr05A61CwOtFnkseKrLJFkcqRYZakWKXJFlOtwHosuF-a3XJ+vvG8sYWfzKRYSxYGAbzl6nGFnOtxUIbnlvTGFjesC84bRi2tBlnus6IMst1vKrFgrOhY5h+Nta09aUko3SFaN1XPtZbMI22z9GcCUmwixzbabPZtG32aesDnYsQ5lmyVeSxjnPME5rm1OahszmBbc5hm6ZYSxGyxbllym9ZaMR022dPN0G4rZ3OY3ruUt6izLdlMS3Tz2tkXXzcvNs3-LlWeWzZpFtzX9bC1oG8+fVtRXqbRN4bCbbitM2lVztpsw7f-Pu3ALQN4C7FlAtPXwLCNyC6Fmgu03YLod7m5jcQu+2Krkd5Q97ZqvZZML0d7C4Hd+tQ38LnmQi+HY6sJZGjaNgpcHb6vx2Br6d2i57fovl3vL-tg25XbXU+Z2LEWTi43e4vZ2lrpd-i9XZrOd3hLqd7873d-MO3JLCN6S8PeOtG7R7KK2LMwoiyHHPM6luexHblvcjQsulle3HeNuGW17wZ2m5NKntp2gbrxtGzPz3s53ks9lo+z1YPtF2N7rlzG+5a3sjWobcemezXf2vqkZqjohpSfc1OD2W7E9tu1fY7u-2u7wDnu09YSsP3xL+1lKwjbSu02MraNrK6FhyuxY8rnmak8g9pPDBfhBuDG3LbKuoOY7+D9ewlnZMRY6r5D8W8ll5OYPpbUNtq4g9jOkOlbmNufZQ9aP0Pb7xDrW9Q51u8O9b8D1+5w6mv8IZrtDn+9A7-tPWCpPmIqew66XoPPzkjvu9I5XYDY9r1OarIdcKxBadH8loxFo9BpaPbCWj6clo6hZaO8HtOx6-jt9PqOSHbWQM6VjJ55JqsRj8M2WmqxmOGJ9j0+31hYcGPwbzWCrajqq2uPYbwTvh-44EeI7kbkTkR5gEGxWOu2JZ5x1I9sf+G0nQD0J-bZyfzGMnKjgpwPdR1U3SsNNxHR2Yqf6PadzNzx6zfx3s2xsnNup4vZqfaWqs-Nlp4LcF3C2unot5rAuaaf726sF2gbGuaGd+ODHZhvp8qJmfWGOsthgZ2XZKdROpnY1zR28tccfKtngVnp6k4afpOVnEVqp9k42e5Ozn+To5+EcKyqUOsHt1HbEcR0+2xsft-HQHdKxB2BsIdp51g9YpfrCsUdl50Q9p2oXms8Sr58Zaqx06IXTVtrBnYBey2QXTDuFwE6Rcq2DHlFmFxrc0edHXHQuvF+s8F30s7nRt9nQ3bBf7OHnhznF5k7eevmqXIDhl2A7peFOmXUDzR0PdKwj2uXtps-tU9YqKXEd095rLPcKzz2xXrTgV+075fMmhXDj7rJvYGz3GlXVDhV8M-Z2H3PHx9sbJ8a1eoupX6L2nf8dcfbMOs99lVxXdR3P2RXQjwXe-bNe7O6swVh15bade0urX9Ljl+c7tdKOvXrLv18U80cwPSscDxHQg88dIOBsKDsbGg8KwYOo3vzxJ-SdccEOY3wL1ilVbTcHaI3kL2PmORTfqu2sATDrAw5zeTPadXVsN5fbqySnmst1Et8s6DerOK3hLmt7a7bcJOqsYjhN-eabeuv2dMjgt6c8F2EK63vrkdy7ardu2zs62FXpNmtNZZZ3UuWd7kVneg1Z3thWd9OVndQtZ3yTntu0-WyOV1sMtdbMu5cebZvrl7wtzonWzbufHtaLbHkhOzbZZn9GWbJu7CfXueHt7og2Wlmynu4nB2Z3O+6oPfuJH1OE7Pe-deQeCbwH715VhOznvJ3i7im5B9KeTZyni7yp9h-5fblan77+pzO8af-vmnhHyV-h8PedPyP3TxD705o-9ODsgz0jze7WyjPH34zlj+W6jDTOGPb7vTJ90ht5ZBP0prj+mc2yOHn355pj+2+OzbOJPjruT5S-Q-UvhP1thT8O7o8IelPlzlT-67U9qPH39zyD488XfPP-3rzmd+88myfOjPBV4T2HYE--OnPh76JXZ9o-HZwX7nxj957CIzZKj-nlq9uSzsufuPwX-V+F8NdRhMXvn6PoF5-drZ8Xm2WlvF633vvGWqX02xZ+U8OfVPiHm8pu5vLrvuZz7m8su5vKnvhWM2Tl5Nm5e1fbTlnHXKu8FeLvhXB2UVwJ-FedeKP52Ze+1-Tfbl9L-X7N+++VePvd7431j8MEa93Zt32r-97q9G8Rfev1b47Ma82ymvn35ryb5a8g-WvhvaX7r525m8+CtvOXxD+f2q8wfhPUZddzZzO+6ebvKH+r9O8g-BvJsobxd+G-feRvH30b-97G4E-xu-vib87Mm82ypuAfA3sH-K7WxkOIfkLqDs6hmw0ODsxb596W5+-Ivb3lbr76t6ERI-I+GPrh9N6GsI-dvwnhBeT8O94-jv3bkH728p95fjsg76n7bdp8KOsfj3xD1tbZ87XjdGjvLB9gAgy1hf9-aPSFuD2OmJfOO6nGL+nJi+oWYv-d323afC-HKwv0X046l+QvhfoNYX7YWF8K+H3MvsL6r63Om+Ht1ukJ3L6-c-YEvYOZt3Olbe66gPEOUly9jA-2+IPQvnG+7+OeW64P-vznzdhJvW-nvjutD0L4w+O6sPwenD-H7w8IkCPN2Ij3L5I-G6yPqfnrziF5uZ-ofuf2H-9no-Z-t7pfk7VDklvW72P0ezj-n7N+F+Lf9fq3w9jVvV+SfiSI8+9kk-t+YnluzZ735jX9-FPL2CSkr8DaV-rv-uiHZP8Zfp-x30-iP-P9e9C-jPq-r2-7vM-G7LPcv6z47ts-R7vnluxz8f5z+AvD-Bf0Fw9i88X+y-p-lO-f90M3Z4Xz-xF4kjg3W687t-lv8Dhi-f-RP2-o27r+FPpv4u+L2MS5Q4GXpAEj+ruk3af+zPuAFT+uukV7vYJXvAHc+yAUv7ABgbkL41ejunV74BtpvswLE72C17B6bXsDgdelul17UBOfn16UBBfkN4MBI3jdhje0ehN7sBU3okiauxuvN68B2Pobrn2nAVF6YAxATgbMB2LrgFAB-ujHqkBYAa7q+WD2Pa5Q4sJioHneuupd5qBAfuQGeuUgXP56BzLoQH6eMgYZ7R673o7qfewet943Yv3mYHJGruoD6W6wPnYEmqTgTn6Q+xuvfIPYmbi4FU6bgXf5WBqrobqo+wOOj7W6mPjYECB-2Lj6BBIgQiS1u3gR36iBZPokEgBuulT6pBNPrEFD+2QVl6eB6gS9h5S72Kz6ZB7PrkExW4QQv7pBWAf7oV8eOBriOUOOCL4E4tpk0EKStaG0Gg0bQbYRtB05G0FQsbQSr5NBM1E0GNBRKi0EsB8OBe7KoTQV0EeO9GE0F9BJvgsFoGUwct444SwdfYpIOOHMHSB2wX+4rB8gUYg44YwR7704Xvh0G7IAwX75E4eNjMFB+twdp4U4YfvcE1B+waYELBMftTgL0G-tsEJ+Z2D8H68nwfYHHBafnliAhAXEThZ+8OCJpQh7ThCEE8gKAiEkSMwSX4whkLsiGe8SOFX6ohQXjTh1+emJiFeASIbx6EhdFH0Ft+uISXbghXftiFO+RzNJ4dBA-lSE5BAIbeYsh5tsCH9uFOOp4chTBnyFyqAofaLY4ElDLREhawkjhr+lWO3T6E2OFv6EhO-uCF7+3wQf4LBR-sNgyhexHKE9emoWcTahsrvDhX+HQTf5qhGIdC7GhXAUcwv+hoW-5WhUQaThf+poXEG6hnQjMFDkXQbi5IhSXm6FHBwwC6Ep8koWcHHB5Lj6GM+0oeMaBh2gQCEoBkYSH42hGARTgVe+oTgHSheAd8EEB6Ya0Hj28OGQEAhFAUThUBGoTQFFhOofQEFh0PprQohHQYq7VhGIRwELB5lkiE8BhIXwEth9oUcxCBDYfj70463jMGbeTYXsEU4sgUjj7etYRNZDhQYX6GqBA4WGHbBmgTOEAOqYboFLh+gSuGGBmYcYFzhHwYSHmB3wZYEAh1gfDi2BCwf94nhsvuCHOBZ4a4Eah4PjMEeBO4RWE+BV4X4E3hGIQ1ZIhIQUThhBd4baE04wpkjgxBB4d2HHBCQR0H1uAEYOH04sHBBF9+r4eOFQRk4aTj0+X4QUEIR3IWhGLh2wXI4fhTwRhF1mR4W8EU4dQaXqC+iuAu7N6ujnpic4g+tL4S4zpuXqumFEaD6c4Kvjzhi40Pmzgy0-OOxEBBTOFe4c48wVRH-WJEb+Gi4vevGYMRwEdXo2+3OHb6SRDvinz0h0uCQbyRWQXxGIR-FDAEq4qEdpHoRukZhFCI8uKDRK4PEeuGyRhEXzhR+iuF8Hc4cfkzj-B3eozZURKftPpgh1kfZ7uR14fZE9eHFN6YS41Hs5FF+IuGiHN6R2hzjMe-kZaHS4NfpFGA2nkQrZ84pIa5FSRwUVsGGRizuFGQRcuD36ZRsEd5HwR2URpHRRWkdXpj+rOBP6l6vIeXoz+lUbhGFRCYYlEWR9USmH16Uoa1G-BhkfKHT6ioYrjKh3OKqFUR6oUzgn+zes57dR7Tl+QSas+kaHTRCdpNEVyEuOaGzRsLnzjWho0aJEf+HOI6GDRKUYLh-+i0UkHS4noVtFKR80W7Kl6EARdFFRZ0WPLl6cASdF6R1egV6s4MYVdGrh7UQ1Fy4SYb3pVevemmHc4GYQDG2mSZE16s4uYd3r5hEuIWFM4xYTDE+RZYVDEcRTAbPo1hKMZC4gxWIaXqNhHOM2HT6rYXjHth0uJ2FURjlljFpRfOP2E4xWUdXrDhZMXlEQxsnoZHKBdMSnrN6zrn9EIBFMUgFMxy4fXr3eLMfhFsxTUTTHbh0+ruHc4+4d3qHhzeseFURp4XLHnhiuJeEKxXkVLE+R94WLEcRT4SrEvhTOBQ6l674RzifhEuN+Hl6EQZrFm+7xPRQGxu0dLigRs+uBE2xCkYLjQRTsVXYyxjMXziYkrOMhEmxOkdXpFBveiUFmxvMYZGjuRsVUFhxwsSLjERyqI4SOUjhDLSOETuEn6OEoNI4S2EjhNOSOEULHER+oRhDNReE+ceMGm42vmdjBExcUEFe4gkVlhGE2ccsF6YluJXFN+jcUE5xxMkZViW46cRE7txSkZbhJxbvi7ggercSVHIc-sWPGPRE8QZE6IruN3F1R1cZHEzxHBqXEfMvuP7iLwgeGQA7Q0CGHC-Qn0OdAoEMhDHhQADeLTCJ4zeC7Ct4aeBYAV4AwBwDcAeeAfFOgheFDD14ceGfEowChAdAcA6wPAC541eE-F8IdeFKCRAZeGjArgVeLwAR4teK-Gww78UjDnxNUCnht46eBwQIQQYJwQgAcgEAA Open this visualization in the Vega Editor (although the link is long, and may not work with Internet Explorer)&gt;

@
let trans = transform
            . aitoffTrans \&quot;datum.RA_ICRS\&quot; \&quot;datum.DE_ICRS\&quot;

    enc = encoding
          . position X [ PName \&quot;x\&quot;, PmType Quantitative, PScale [ SNice (IsNice False) ] ]
          . position Y [ PName \&quot;y\&quot;, PmType Quantitative, PScale [ SNice (IsNice False) ] ]
          . color [ MName \&quot;Cluster\&quot;, MmType Nominal ]

    spec = asSpec [ trans [], enc [], mark Circle [ MSize 9 ] ]

in toVegaLite [ aitoffConfig []
              , width 570
              , height 285
              , gaiaData
              , layer (spec : graticuleSpec)
              ]
@

Since we &lt;https://sciencefictional.net/2018/04/23/we-will-control-the-horizontal-we-will-control-the-vertical/ control the hotizontal and the vertical&gt;,
it is possible to \&quot;rotate\&quot; the data to move a different location to the
center of the plot (this version has Right Ascension of 0 at the middle).
I leave that addition for your entertainment!

-}</span><span>
</span><span id="line-6014"></span><span>
</span><span id="line-6015"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotAitoff"><span class="hs-identifier hs-type">skyPlotAitoff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-6016"></span><span id="skyPlotAitoff"><span class="annot"><span class="annottext">skyPlotAitoff :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#skyPlotAitoff"><span class="hs-identifier hs-var hs-var">skyPlotAitoff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-6017"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117596"><span class="annot"><span class="annottext">trans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117596"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-6018"></span><span>              </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-var">aitoffTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.RA_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.DE_ICRS&quot;</span></span><span>
</span><span id="line-6019"></span><span>
</span><span id="line-6020"></span><span>      </span><span id="local-6989586621679117595"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117595"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-6021"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6022"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6023"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6024"></span><span>
</span><span id="line-6025"></span><span>      </span><span id="local-6989586621679117594"><span class="annot"><span class="annottext">spec :: VLSpec
</span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117596"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117595"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">9</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6026"></span><span>
</span><span id="line-6027"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffConfig"><span class="hs-identifier hs-var">aitoffConfig</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-6028"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">570</span></span><span>
</span><span id="line-6029"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">285</span></span><span>
</span><span id="line-6030"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-6031"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; [VLSpec] -&gt; [VLSpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleSpec"><span class="hs-identifier hs-var">graticuleSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6032"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-6033"></span><span>
</span><span id="line-6034"></span><span>
</span><span id="line-6035"></span><span class="hs-comment">{-|

If we want, we can treat each cluster as a point, and calculate an \&quot;average\&quot; location.
The following visualization presents the average location of each cluster, where we
calculate the &lt;https://en.wikipedia.org/wiki/Mean_of_circular_quantities circular mean&gt;
of the Right Ascension values (to account for possible wrapping around 0/360 degrees).
To see the effect of this correction, we
overlay the simple average as unfilled circles: for all clusters except Blanco1, which
spans 0 degree meridian, the two match.

&lt;&lt;images/vl/clustercenters.png&gt;&gt;

&lt;https://vega.github.io/editor/#/url/vega-lite/N4KABGBEAWCmCWBzaAXSAuMAmAHAVgBpwoBjAewDsAzJDMUCCGWAQwBNYAnO4SAGxYAjWHwCCFRH1h0ADAF8ijKADd4sAO49IAZxScyAa2mYKAVz58FxJlRYlYaTL20AHO-AmyrSyCwAe8No81oyQbGQAtiwedLZ82rCKSlACwvGxLPGJIUyInPBsGVlJPijwKFJ0ZhYloWUkBkGYcQkh3qFSiLAUhU6QZPndjlCCZCgokZAEUGUVxmDVlsTtYSwoLME+ppx8dDDjLtroAPTHnCzqAHSI5dCmgqYJnOQUKEOX5BHHACJkpogAIW2RmO0GUsEQLGOUV0XFB4MhxzYayhkPgLAAtCxMQA2ACMOKxeJkGPWgikeJYlwoZAxcHYXEuKG0yimIUgVAGUWGDGSkDcnASm2STAA4lFEHszBFhNxaj4AEqiAD6AEkAMIKgDKUtMMq4bJFTBcfD8uv1cpyoW+AFE1ZqdZhINLZYajZBYMqTWanS6DVa5G1lklIOoCihoHQ8AB2GQhgAk2hIcCie1QKEOJ2OCKpNwj90u8DIxyTKahOYxfHKsGzABZLgArbSUN38FgATwNmAA2iFeaVzhRtJzOBE6L2jfRfE1SGRtEqpqRMiRzGt5pByNoABTIlB6y5K+3asAAKjAAAVVWBjmA8TgZABKSDtEW8FgznQeBfTDfL1dvPZtA8Hc1n3Q8NWPM9L2vW97yfF9kn7d08j+FxBHbcdIHVPhHjebgAF15T5FhEDyCE13HK1X36Fw9giVgKEXac9k3JUZCYmgRF6Wd51EZ8iOoshaKdeiWEYn930Ar9RHYn9OL4bjPwoBcEMnXghLohimMkp11H0CRlXOWSoHkxTwIdfiqMQmjNLE7SPw4EhjI5NQFL2W0jx1QNJwgfCrNUxgkJFZinSMt1J1-PgVwEACnRRCgsBAvcIkuIDlJkghd33ViZIfU9YJkS4ZBgy9IH8gT6CspgdJSFgZWRcL3RIP8YvXLKUqMgA+O8ZAAfiS-cjIxABmHFHxPS9jgxHqwEwdrLiMibVSmnqysnAKIDfD8XGgeAmOaqL-za0CUscmQluOVaNsqnyoBq3w+B2jYKqYA7ooouLNy3L75p2+AHxPH6TsuAR6qhLAHyfcqrKC4iPzSkhREe6BnqqpdDtavZ5syJ6wAAXjxsBit629ZrANKBpSnGUbym9seRjZobUtGQqgM0XvR97YqgUbzqB5LLj+gGKfm0HBGRY4IeOLdLxPeaEaRp6ofWiqtr2DCfzeo69h6k8ReBoXpdl+WPERhn4KtQirUgKJOAMLQgIAL3mABOOMZnbFx1xIeBnkqAKPQocg2A8SUnCsjcyD4AYtFMvZsNwg0fxQT31xpCIPEyJjOm6bjFmuyAfSnOOnXZqAk0yeZeAoeB7CKBIFA9r29gAR1MMTZjWeBwUsiKML6EuoA18uDqr51a-mFpYEbyAU+bp02478ou577zkjXiAENh2fB2HLlKLU1nI94-aWo+njKYPFUIK1fLoJvHr4NVo+0u-TntadfWBfMyCLyvB+4K9yNLDHwKFTBoX7mAbsWEcKwgIhzXwpFODkW5hOW6U4NIiS0hJD8OVnKD2PipDmm0bJYLsjgqS6V8GuUUq-Pi10lDqWElAUS4k7ofj0pQRAhkWDUK4nsH+XliEYOYTbbB7CsawCchxGh7k7Q32fGjPyKsYYs3umFBBWtMZxXWAlS+dC4zzTwXlM8PUiolVVGtI010QGhHumLBqmiz7c1WALThBkuo9X6vNdx3Chq8wBpNaa94yY+P0n43hF1gnsSZsAo+f1T4Y3Pq4-cZ0LpXVVmoj81NUa3Uilzdcdg5zfWKb9XaAN+b7gceDSGViRQ2KyZQs2T1GrBS0ck+muMCZEzACTPEZMv77hybTMAnSUZ1PXpkvJ912Ys3aS43mgNSkG3KXrYCos6rixqUbVUctgYK3NhMpQNij7D3yR-KAutBkpUNjLXZJsg6KxpookUVtgq23tn0J28wsAyHdrPVOLFfYkEqHJeAFhYDcSngHbowdQ7CjaVHGOA9ZFOgTnApic806REzrsH8OcehVHMJYCqhdY6orZkxCulQ+g1zrs0TIDdk6AoXu3V4y8yir1JZA3gBCznUrHnSyejLp7MvnlARe7L1icukBvRgcqt7Wz0GJPeo4D5xPujlRJBSWLLO-tfB0d9-4FSfjDF+0ltUXKUpfQRRqYKPyAa+FmYCIGYXRXhSAbyfKILIpCVBaMSGYJYeIo+eCZH8KdFqhhgVSHBvIRIz+0k+FuUTelR1PkmG2TYUfXxPDk1mQNdqdNh8g1iPjUfM64aU1QA8gouVrzYlOumR+DRcznGFN0YlB5bFMrA2MflMxxUbylUbYhRpTpqmtL5PM46AtPH3m8cDfxY1AnLWiaEpdkSgmrVHYw+Ju1LXaKgPNNJk0MmqObXsHJU6fAzqvV9SpNzVmPpBpsiWENlbWKmd6+6ByWlOKSS4sZLB8aE2JqTTA1zLjDJgsBo58rv0RRmTe0Id6nSLJfULNZFBL7VMlg+HZeyBZ-uebumN90zlocufebDl9bnG32abJ5LALavKIjbFgdstBsCLjgCSVZECMQnbAKgaAxXrjeH4NAMKg5kBDp4cOEVyDR24CiiNUB3VJybtijOFAs74ohLnIlFgC6SZ5C5dTMDE5ym01KHFendgFyLryilZKfwCq0EK+uorbOsqXtK7usruXkss-y0enmJ7eZnli1ubLO4ypeevNotRt7KqHCOMcPYL0-o-JOgDOqnSiwkN1BduGJAjRXVEmac1gZ8AkFV+88HN7P3ugkzW7asa1bWOkxrDTL1xQZih16HXPrFMw8+vVVS301M-fUxD7pf1McG-lq1wHQM9L6QM9ZwMYN0x24Nsjm1x2UpW0eyAGHJtPv+rRjZYN8OEYec00jKjD4UcPckq522Bb0fuYxx5hz61gC9T4D5Ds9CGFgAAdXDJGTAhU8TufB0YPY5I7D23E3sKsFAgvW13BsRT7plCZFMLAGcaDD4xToBiN2+KFNgGidG3glPMDU-+XVsO9O8R4HkBzJnawqc05SHT6avzGdtmGKz2nHPWdi+Z-TwX-BhdjVl-zlnCv2dU+GjztGfOJfq7p9r26uuBds7p1rlXevTcc+V7z8XJupd0Ddhb+3QuOd4lF7buXkvXd0C54bjNdu1dW99-eZ3LP7wO5Zz1MP9OI8+6j9zmPGI4+K+l+7-3FPVex+D0HpPKeNcs5tzrwP2fI-0-N57rPyec9EzzzXivxevf57p0Xo3Jfq9l6d5XiXze3ce8b1X3vvvE-d6p0PzA0fR8s9jGXhnU-6cz-j5zkfA+JeL9T1T9PSf18F-lxnuJXud9K-39RQ-NeRon+smfsvl+93X6Xw3tv9+N+YFbwH5-u+u+r6p0fvvt+Y0f505+7b416T7f6F7n5gFP5V5jSz7AHz4YiwFL4i7-4kJe5IEv575J4YG76IGoFTjoHn6P7v4wE174HG4QFl7EGZ4S44Et7kHt50Ec5f7QG0GgH96sFU5MHD4MGEFl5QEkES7c5wGh4IHCHIHwHgH07iGYEoFJ4yG4EsGCFU4KHH7yFEG8FV6qEc6aFCH166EqE15v40GGGd4GEs7aG+4cHKEWGgEr6cG2H8GiFSEYi1iQHOEOH05uFwH2E2FeGQHWEmEs7eHIFKFBH+Gz7GEH5V4hGyHUHRES6xG77mEREP4pGuFGHpFJF05hEJFU7ZF-5J4FE8FFGgEeF+EX4iHpFa4+HVEBF1Gz65Gn5V41HIFRHNES6tFxENFL49GYHxEdGa6ZFJ5dGf59G75b4IGjFAG+HhGVFL4CFzG-JVFJ7LESGzF5Es5rGyGTEuHbGKHpH7FqEIFHHS4DFX5V6nFeAnH6GrHDE3FmF3H8GBGbH05XET4bGDFbFlHpHEgrEIF-HrG-H1FJ6AmyFNEXES5gm4HtGQmb4aGglkGIlUHAll6wl35V7Qk5GokLEvFfGc52E4mYGLGvHuEpGQGfFwlw5wF4lUlEyNHkmRGMnIHnEYnDBInz63GclonMmYEQlsmyDPG8kTGUkCnUkLHlHhFYlp6SmvHSmb6ikAFZ7ylR60lim3jn78lKnDAqn07onam+4Inz66kpG6mskGkT73FSG6laloHKnsGmmEkx66kkn4nvGc6ylukUkpHulyHz6+m2kEFZ6+n6l2nDC+nmlhl0Duk+lclSHumhlBnhk16BkUHYAOkx7umSGeFZmel0nTEykpEFkKlFkgnz7Fm57lnn6JlpkVnl6lk34x51mRlJl0B1k1kl51mpmdkZlVn8GKlRmYB1mul0nFFR55nqljnL4pFTl+lSGzndly6zkdlLlGnzkcnrkokx5TkrlZ5TmLl7m9mbkLEDmtmYBTkjnqmWHjkpHXnTkx53lzmeGPkHnDCPm7lvlrnPkbnflbnz53kflRgpm3lHm-knkgVOEpHcE3kx7QX3nz5wVPl+GIWvl0CIWAWv5fnIU-nYV-lSFwUYVgBwWoWYVCmwVOkIU-Ex6-6b4TkWlgA0UJ4pGMWc5qn0UsUy7z4cWEUcUtlpksXMVxmeEsU8XAXUWgV+EsXZmSVUXz7j4ekpHyXTSnlplKW7GeFKUkVgBKWEVKV8Ul7yWKVCV+HyW6ViVyUSXhHyXSVWWyVSH66Fkx4OUllOVln2WakpHOUQGuWz76Vy5eW17z4BV+VZ4BWEUBVaUBXqV+FRUqUl5RWh5WTKKTLWywpybwoE7BTOYWbVpua+YSpxYcqBbaQBAzj5ykocDrDgoha5WU4Y6+j2ZZwFw8o5WKRnIxZ+ZSorzSASSlXGZLD1LJZ9hKq7wZbqpNo5aY7TZDbvxnZFaIAlZ9RlaIAVbjTbohI1YCzs4NYxIvYarbQHrtaAazpTYoA9bsR9aTUDb-ptrHX3pjaXaCwTbbi3ZbL4azYpXMz9blxLY3V5JUYpJUwMzrbgb9KQZfZDLmywb7YtKHY3RXUna3UFY8xjRLIvUrLXZQZ4ZSx3JEb7gkYsZNZgAnJvZHXI2QCfY4ZlL-QPZ-ZPaE2A7A6hCg5fJI5Q4w6yCXAI7lxs0o4CANCYosopAeA47BR44Ip8hE44Sk7jWvHe47F0WDl75wGxhJ4BXTSEXy24E2Vy3q14huFq2QEhWW40npF63EiG1wF-KW2hFm3n6K1nnK3IGq0IHq2a3q1xVe7q0G2u1YVzHq1sVK1a3C4W2+2Nlh0LF21l6B2O3B0c7G0u6YE+0uEBWe1V5hVR1L4u0p014O1plx2O6Z3EnW0R3Emh051kWl0TEJ1B78HJ2eEF0fFF0THu2gHZ0N0JXpE4B8YSF53t7d0q1d0907Ga0D1Al57D3a310VFj07E12x6T0h0x352z3a3l0N2r0h0l0uGb3S5aXJ6L3S591N6H0-5D1MkT2z5p096n3BHn0sn32yHL39230EmX29Hv3F2f277P0n14Ub2v3T1zG71AXf30FgMc7t0z2v3H2D6v370gOWmP0THr3QOV072v14jz0H113IMzF4Nu6j2YNQPAOYOwM944j-E72UMSEkNy04A0Mj1d2MPa3X1j4sMh1AP0McNp7YMMOm1548Ob6oPANCNR7b0b1iNYEIH8PIHkPsOz50P4nJ5SN4GCNX3MOz5cPKOyPdHqPIG-2D6qMiPcPh3UP8GaNL6GMUP-0z1SPaN0kqNl5sPh5SOj1SNKOOO6O77yOuOPEyNSPEiWNl3BMTHWMKMLF8OBMOPqlOPgX6PEnuP8GeOxPeNAG+Ox61hUMb1ZO0Nd25NMN54FOsP5NwExP0XJ7FMh18NVNp7hPh61PCOlMSESMz2NOVk73tPZ5FOKPNOyGj1dMYguOZNaN9O4E1Oz71MjMtM9Mf0yNdMmM6NdNTOVO2PANdPlNB04BdPDOrNL4DNl4pMVPbNl4ZN7N8ljNAGtPrP8GLNeMLMrMnOROXNu6bOx1PPEm7MfMt0vO+5HNbMLNnM4BYDZMz0gt5N57guFMyNQslOQtlNd2wvVOIsCMwtwF3OpNItp7XP0NYsm7wtyMovO1Ev9Mku4FfN4t30Et6NosGNktb3UvJGMtXPMsc6POUtgB8MctvMr0csUs8mst0D-PvMctAscsIMctBOCsT4YvHOSvsv8Fcu4PSu3j8sLGj2SvCu8uQV16gvAOQFav92QGj3em6sSE8tGtwF8NuUb2QGytbOQE4s6MeVmuyFAvn6GtN7Vld3n5fPn4Wteu+U+uTPBszMyM4X6sWOus-2hv9Gxu74BuD415+sCvhuHPxt07uv+M72gFOteOgH2vvOWX0OgHWvKtpvxMVuJMZtu6etJs6sIHRiv1z4uFNuD3b7NsEjpFtvj2NuduJtr6dvYM9s7ErMjtr3dudt5uxPjvC772ztH2Tu9MdsX19saMrvIEDs-7NvDvNtjtTsbuYFLuR2Hsxuntm7HtJ2Xu767MLtoXXt051uDunMPvMGvuGnvsyufu3j7uKvfv63-u3uYOa13sT5PvbsNutvGNnPRjGPgfT7GMgfGO3vGNbsIdWvdvGNjvGOFv52wdW2YcMnb6qMweqPwcL6qNIfruNuqNocUdBvEchuMdhtQdmMN34cns0fR2EdpHMdXt8c3s8eYFUdZ1Cc+NifYkCdXMSdu64ft4cfEnYd-tSevMyclFcfqtqdgdacFTb6DOXkVPRj6fkcYhGdwEgf6e3v6d0emf6fDv6djv6dyeH76fTuGeDPzuDMweDMmdmdtHduDNWejN6cMeNuDOOdW0hdzOtsLMBfcdRdxsJcJtxdL5Bf7MpeYG+ddPefZvsexcZcoMFdAERfPNJdAE2d+efNFeEPVd-O1cT4wccstvsdNd4i+etcgete3utcVetfDutdjutfOdV7RitdudB2jdEeNtNeNfLvTeruttNfdfBfzcP3b5NeDeRerdHvrdRvbdnv7cXu7dL69fOPdscudfpvHeYGzdL7zuSvjex2TcLHDdr7yvnfKeHeqfXcikfeac-dAHteQfsdkkgHtuNvGvdumsQ8Itg8SHDs2sVEcV4ivdn0Edw-glQ+z4wcetY-+cY-kt4+yEVd+1y0cVjuOsE8G5U9u5E8HetvGVzEsUk9nc0-3ts+YC+e510+Scw+R08+ycC9WFC8T4I-lsM-9ki+3ggdt1S8GdB04idtnOK-g8uEq8SGa3q87G7Na9T3pG6-IvYGdsrMG9p6o+F5Tv6-Nv72m9j5W9zdq-Nua-Ns6-Ns2e28s7YMe9vH28scN3e++9f0IHe8m+v1e+AOB+CdG+puO9XfB8wOR+8+x-8-R8veJ+FHx+ffJ-Enu+YOu-8HO-JPp8h76-Qel+q-++Ifl+9tq+ofV9z31-a0m84eN9b2t973t92-YFked-eXB+qM6+0e9-1nd9Mf99be19scVE4iBPD-N9rNy0z9l7u9SOD8x+V9x+T9L7K9SM2+z-D8o8H-z+lfj8LEr+S+j--en-EkmdL8Sn6-6fK-GcP-mcv81-+-Wdv8N-YEOdf8Ts--o9g+HnP-sLif4O8P+C3CAcgR16DN3egzL3uFxAHYsAB0XKAUHzV7LMkBbZLAeeRwFgAYB6-afl01v7Zc8BNvfLigJCaUCwmeArBrQLgEX8gBBfWgSQOB7T9WuyvVrrfw6768uuvA2HsHz678CJCJvIbsIJ2KPd86OIJrjbxm7iDcC3AyAewOo5q8mu7vJrl7w27yCGWggqfnMWkF7dVB8XXQbxxMH8czBUfCweAysGQNtBHOTgbl2UEp8bBvuc3nqXe7YFJWmg8Xv70lY69JWmvTVnYJL7YFQewfA1vr0h6hDai0Q81pEIw6xDR28QiQm4LwKAC1eLrcIdj2SGyFb+3rRIYTwKHC53epPZRohRN6U8shqA6frmyKFsschu+L3jXhKGs8qhwnBoY+w6H2CuhhdOoR+z6FfsBhP7HoaLxGG3gWhlbDIcwKGFtcxh8vWOngCV7pFFhFfCoisI17LDO2uzdYTsRs47Dta2DfYUvU2HosThLTM4Zj3kLNszmRw6XCZ1uFcELhhQsQm7yeHC5Dhe7N4cgJeF6C5aDwy0lcOMEuF-hnLL4XQD2Gv1thr9TWiCPuEJ9ARd3MEUgwRFUCfhuJJEbeA+E+C1hefDEV2xRETE4RbAuYngDL7yE4OywqvuSJiFiE6+1I+HpSNRbAiW+9IiQYyNtqsjcCNwnvpyOOLMiVBDdUkSt35FrdaRY-EURIN5E6EpRhpGUZgBWZCjTBEo5LnKPwHsj2hqo+4VI25GOCSR+-VUYfwNEKjAmhw6JuqN+4GiYRgTLUcSL+GP9lhz-eQvpxhGWcHRAg4EXZzdEiCvROxVIXgFc4+iDiTo7IcGOJahjSW4Y54R6OFGCj4BgY4XAqNc6RjqeYhWLsmPqHpjsBmY3AdmLVG5iXRm-WMS+1zH71-RFjeMYL1zHRUSRCzQ4Qsz2ELNthCzAsQsXuGAtlhHAjsasJJE8D5CfAvse6MFFCCBx3okcb6K7HnCxxQYsQnIKnHC57hTXGEUtwnHE8Vx4zNcQmI3HfDgRHLLcbKJnFAihxC-ZRngG5Z7jMA2wi7ueIYrXibh4ra8VKwPFp85xGfHcVnyPFn8Hxl46YU+Jv4PibhYQ4EREPUKv8QJ7-NYZAT2FG1lhiPEkXaxgnpDBRmQoCSGLEK48wJEYtCQKIgkxicJoolCXSwwna0EJ1QuCYYKQmHi8JiXLCSdxImYFthVpCiaJyImZs6JYxFibTzYlAE-RxbE8aWy4nfcaJVXDib7hhGy8RJDXLIksKKKdsTOtYTtprXkk0iXCSkuITJISEIFVJSQ9SSkKkmISKiWk6cSpOuF6Swxmkp3qZNkK7NDJxQyyeuJ0lP07JOg4yb8OUY2TaeDk+ng3XclZjzJy-JyRzmsnQiApQrEKZgDOY+TMA+9SKRqTCm3hUhMU6sXLUSnYNEpNnRKUFJ-EuTWxcU+YfnVrBkjNJFIoolSKKnKTvJdIsqQyJKlMiKppwmqZOKqmXCmpXIrIjyJal8i6p0AtqbhLmIFTQuKk1Ris36l+8DJUjHqZx0GmUS+pUjVKfYwmn0SFpu+RSR4yWmsSGpFzDaRMUkHt4RpqIqaeiK2lAE5p2ImaYwIOnVsjptbNaW7gin2iiijozSc6KyKuiHpg4gyZ6Lemjinp9Un6Y1JUnACvpbrF6eAI+lKC+pgXEGZuyhk0sAZ4o7yUmL+k7ckZ20oGV5LBlKiEZ-ktGXTmsldNFJxAmGeJxxlvsSZ-QlGdxKJnFcqZbuVKfWJpnqc4ZV-JmX+LJmSSiinYjmd2OSm9jNJ-Yvme9L6nDiBZ30lSWIK5n-TvJMgrIrOJFm5CZZ4MnmdhKFm9SlZ+EqWfDIMljcJZyMsWeRK1nTS1Z1EvWbRJ1mWCTZGouWbvjkmisFZiIs2dJwdmVirZ1Mp2b7lSmSt0pfgu2ZdJdnXS3Z7MzSYBO8nASg5oEsOeBL6mQSsi0E0orVIMnwS45kshOVNxUn20Y5oMqOYrLcm+sM50MpObDJDmays5o0kubrKLmTSK5mBYaYz2SnNC85i0guctIbnWyW560iOZtI7nbS25zstOegyrnV0e5vudKRRT7nMyB5gPIeYHJcLDRpJUxWSdUQUmLzypFRWeYLLlprzqp88+OXMU3njiRilvA+anIbp7zWpR8syTPIsnnyrJy8-OdvPVmrzPh184ic-JTGXz9Zu81+is1PlHd755g9+al1vmWyAFmXIBcTL-nsSIFjsqBb3JPmYNv5mDbBj-MEkgKLRMC0SWAsnmvzbp1RQqTPOKlTFSp+ClebvMqnEKt55C7SYQt+mULiJuC4+avJI70KL5J8yjswpvkjEh+nCgaawuLkbzjG7CpltQsrmMLDZyjUaMeMcYSLTZwixubIubncLmJ8i9ubQqT68LnBqi2BaIsOnKLaZgi8rvordy7NpFvszRXV0UXEkzmw0e6VMUekzznpIxV6bYvXniLPpzi0WSfKc7VEAxjihhbvK87eLM5G8wZprWsXKzglqs1xTwtXmIDfFpciJaRISXoDPFYiqRV0yQUbNAlgCuJcApSVKL7FxY9xZ3IKUaK8l+0spTQJyWDyqlBimpUYqyWmKKlWCopRMSsWcypiXA6orzJnn8yelLiqRcLL6UeLV54sjpfpN3nSyRissoZfLKmXZyBl4S8RWoK6XRKJlfCpZRPxPm7i5lIitZVYxWWYyRl2MsZdkpOW5Kjl+SrZYUpmWQKbl0Cu5Vor2WKcDlxJJBZ7JeVoKHlGCnZazLOWtLxiIdKxaHJnlRCpi0PEFf0tiZ1lpoSC2CRvMTlgrxl8KvxcisJYjF0JiK-Hpio4XYrcCNnaFbCvWVSLKhEKxJeItqG4q6c382ueSuOWkq5F9KhRZStsHorrlJ88yoyvuXsrbmAK18dypP6cqUF-K4Scyu+WirtOrK+-qsTnl7EF50q8ObKpIVy1cAkKipiqooUN11VVCxVbpPlXJyli1vQ4iZL1WzKTiV8s1YsscZaq8VRq1ZcqqfkWr4lyja1W-M1WYNbV+yk1Y0I9X-y3VrQnVecoNWFiKiLq7oV6rUUhr3VPqwruGr5WRr3x8az8bGsZl+rx5ia35QGv+WrE8FmqghXsSIW5qlVzqshYWo1UhqsOhxFkScQEWVqUVxa1CfmqCX1qsVja7qdmsiVWrVG2DLAENNrVOrO1rkgdbsuVVSMVmPayRbE3HUyLW1DK0tYGpHXBqli2ovtcUrnXdz21z46tf3PLUJql1p0hdZMLXVAFNaU6jNUepwWrEbFexOxZqocUnEnF161VUHSwBuLH1wypYl4svVIrnVgM+9Q2tvVNqrVISw4pDK-V3y31hckNbEr-X9rJ1XTEDR-OVWYCwNxsgDdOrQ2zqoNhAj9YuqQ1sqsN9smDcXQQ2bqINlSojdUoo21KqN9SlDT8zo3NKyN6TQ4u0r2KdLVi3SzVb0q41PrY6WAQZTxvfXKrRlbG79VasmUnFplgm01aJpbXSaox8m2yRxrtXOqtBym2DWqu2WSbENqm1JZOo5bdqzx6mzDUsSvHGbW55mlRYptJnabSlIayVqkP43brTNu64Tfut02Hr7NWU6zeYts2WLDiwckNcCs1Wgq9i4KkLbxvzq+k6BTxITc6oRVhaxNk65CRFrRUPEWFQW+ZclstXZbwNqWyDUsXPxjqSV+WoRYluHXxa9NaqmlVavrmxaTNyqxiZlsuXNabuAW3UY1vLH1aY16W55d1uOntak1vWz5aVuPWDaz1rWrNQCRlUN07w3M5RnNo2Ggkthvxftqto0kuFFt2q2bZ21SFba6Fy2utY4322gD1tGWuYidulya1LthhQ7XloqI3bPeZ2xyXdslHTbB1sTR7RqVe3oyLtYfZ7SqPe2nLNtwUn7Z0LB1hqgdq6h7VGoh2uCAdrsqHZRpB3ubjtuIuHRPmu3EMEdF6gEjmoe15rZtBagnUWuO0lqSdZai7RWtBJVrNtNamnUds+1MKGd52uWgSCy0VN2dbavHR2qZ0qaydRKvnRpqDpc7y5FO5JeLt+1s7ZpvxeaSzoa0La3Gsu3DYrvw1U6OtquuzertI1E7nN0u1zZrpz7K7PN2uxpZLsY266pVAJK9bNpvUPa71m2h9bbsi3t59aG253XFuO2frrdSWznb+sd3-r7dgGz7cBtBKgafd92i7XGLD2C6-dmyoPWSq906ak9nqiPahoT2+qM95sj3fOoW2EyY92-X4l033pu6tdbOhZntoeZF6DdKeo3QXpFUB601UeovvXqm2bbWNs29jQCU40PbuNvel3V7ndzu7+9nuz7SJs72+6RdEm9vYHou1NcTOQ+uTSPpxUz7I9bOjQb8TU3d749c+j7Zzoe6gkOWKzRfent33obl92ei-dYNX2gLD9au9fRruO0PdN9PKu-Topv3I6J9Q2j-fgzf1m6z9E2gA23tm2BaLtwWh7aFpAOk7Pt0c5EpTrZ1wqFtCWqA-qoQOM7Od6cuAzJpQOYTNtucrAzaoIPvCiSuBY-SVogN76RdFKvA1VqoMTqMDdKnA5frAPYa0DLWlg4XqIM2aaDZepA6-oBK8Tjt-Erg8PJIO-6BD3migzlJEPTyN6erehvNq8YKq5DkchQ2pJkbD7gGO8tQ-vI0OoGdG6BrZrPp0MKCu6HOow9zp3q87jm-O1JrHosNvarDieuwxVqUOp6nDp+kw3Ths6QizD6XPPCrrcNtaAjhGjw+ur0PlKZ6eugwwKpUN16IjI2qI03q8P+yEjzG7AvIbKGKHYmxO-QdAYqbk68j8BrI6PoKM0L-ek+2Oqoxt7GGSj2B6fuYaqM5ayja+uo-ZOD72Gmjwuro2LqKMS6+jUuto7-LV6MGGjwOio-4Y6PsHF+9+oY9wYmPEaMjOusY31qmOvL9eqOnI+dIWP0a1jhIjY1bpUmZHHGduvqcoYMn5Gg6n-IopoeSnaG3J5Ri4-oZOOGHY6ASm46zoeNL6zjlh7ydYauO2GKm0Go490fymUG3jye2Jshs0n0GAT5+n4wrpeOTGQTt+mE5wbRPQ6ET4RlEz1pxOI68Teij4-EYJMpqnj-+u49IYxPAGQ1xxyddkbVXnGlilxvjQPsuK3HnV9xq1Y8aZPPG6THIk4rUa5OfGhTuBzVc0efX-GWTD8nky9oFOgn28WmvYpCYZPuGxThymU4DqVPjGaTyJtU6ia1PBG5TmJ5VV1qNO4m9T5Gg05-p1PEmLT4hq02NtWIt6zT6R7kr3WFIh1yOkBvwuFp9Osn2S7JukogaDPcnSSlRtMilr9NpapCGKmM40YjPinHa-rD02cRTNU4pm5B8IhGzDOuH1SNeDM7CaTOjGsz-qzwk1pLPTH8S3PGPByrLOmm4zyxis6sYbPrGazmx+iqPLrPJGqzzpls9SfCId6-CXe+MoydeJ96Bz-p6MoGfVIDcfSoZt0uGZLzT6cygpmc8HvoqLi5zvxoc5KbTIb7MynRvczvrHPgmjzuZjc7QcdoGatzmeic9qbvO566SHLcjrbIPOhGVzvBp8-wZHPv6PzrZ-0u2aVrey3z5Jhc5SZ-P+btytJ+iqcdeIO7PCTuvwtcfnyvqELnJycvOdHKLmlyrxtMu8ZQvrmlaoegi9ufCKwCZygJoi4eZLyIz5yp5mi8qaouqmkLhZvC8WbgulmWLupri-qbQvom6L75ni9ib4uRGyL0RrC7EaEvUaBLDekS7sZkv7GoLhxzwvjvCKE7kKo5-EshygqTnX805+itToQqYX1S9Ooy-yfwqrmDLhFx2mwtgqJm0yXCsywVteK9q7L8puXONLcv9GXLl5hy6xZLxy6nLzBny9xbUuBGTLsxukrvx0ufmIrjZkK82ZUs164rtpjSyboSvyWkr4FrK5BbkrQWlacqvK0tqKva9FKul7SvpYKvoX6Ku2sq7yZqu4WDKllqq8KfVLmqpCLvOq6uJjw7surpBvq85I0r0W5c7qnq75aavqnXiEfMa-eamusH8Sr9cjvCJKu3KhrsVhq-FYWviW2ryVja6lasrbGTKkhg69laOvKW-CupZrhdfANSlvTt15k2mUusAdnSsc40sGfVJPW3BT1naXLkutaVLrGTS6+R0uuEVLrwzS63R0uvz1LrUzb6y9eGv2lGLjtXUrDZq0fW6tb1zi-ddCtyka8wN6s5jcEvY3FjhN0S7je2v0UXS0N0ApDc7PXXjr5N068Tf7NylBzUpYc54RP3a1Qb451m+Va5uG9jSs550uPoutjdTSy5sW81eRvz6Jb8ZkvALelzg3llItyizLeou-XtZQthGzqQP3a3mL7N-y5rfYv4lFboDfW4+Y+vPm5b-Fzm-eNVvrWlaZtwYRbctN23drTt95Q7dktS3uzdJZ27eGBuStAbNui67BdNvwWw7D1hW8hetKoWo7pRp297rjvYXlS-uzm-hZTutXKbxFrOyvozu7mY7atx68CYLvuW07Ot4eUjZLvjXfr6S00pkudI7MG781-2-nuNKkCm7j+j6xQI7vfmy7iVhO-+bzsTFIbjYlu37Z7u9mB7LN026pblLqWpSuRhe9Hd+uFGV7xR-24ZetK07Obplne41bXvS3Hr7Ug+98Y3v52Lrjls+85bnsa3lSAi50p5eNKz8n7tdh+0bY-vwmL7wVu+zjb-u8Wr7kVj69FbfuO3kbgTL64E1hsmjTSZosBz7aXsM2AHill+7aNNszaLrhV60kvOdIra8H-NodqaWN7EPjLlNw+caUNUEPoznN5tsDfau0P7LCt14dQ9vv+2HVOD48xg8rsNdq7zD9+zqX+2sPNTjD2a9w--vsPwr5D4B9I6JtylYdlD-u1g4ptO3EFpD7-aI8QfyPkHkjpm9o-OsDnQDY5m68Y80tPnfThj8q9FvnrRapm0WtwdFp+vBlIzljmh0OdjM5l8h-pfA948Lty4IysZe+8mS4fmOeH6ZPh-4-zOBPJrXpE26E7EfxPLbG5vG9E8NPxlaz7j+s546UeuPB7uT60-k+kvZP0rsTye8k+nuZODHY5tm9U-pNAWe9A53m26R64+kBNQ54W-6VFuNPU74ZSW907cf9P6jgzmEq06Yf+OVbnT4u0ua33xktbszsJ05vPP1OBH0Za85mSM2TOEnM5szZs8AfDOrN7T7uxuef3rOcntT384c8kv7OhVlzrR8050fbOKn1zkIf6VDsDnw7T5yO+89XvBlY7OZeO988TtXnk7-znp9GXTtDnM7oL7O0BdzvQvL7gL7q686mf+PS7kLkJzOfg2Zk0xyLg22OfrvYu4nmLrG-i9bvEvKznzmR7C6OfUvwHe5ivT6Sr2EurnpLjR+i5KeUuyntLwA6y9yvxl57bpRe2OeXuCufn4Zde6K83sznt7OZXe0Of3uyvD7wZZnf6VPuKvz7krhF8K78fKuUXurwiaq4xcbnn7-LiJ-q+rk+kZdmZQK6a62fGuyX9ril9K6pdXnQHhrul0ucgeWuVHrrj2767ZcDnAmwzU9ZlfldPPtXVTt0pg4HPYOcyuD-0vg4TdWOiHmZEh6m7IdAWKH8ZKh0m4Gdjm6HPpBh0Oc6vpvWjT53q6W9lPZujXmbhZ6NdzcWvK33qpt94cLckuo3Dr2t0643PLXq3cjjtx6-8eYMHH8Cttyy4Hf7X83h1mNw857fhuJ3s9-MkY-xLQrZhTZO668VXfDNV3dHVd-PVXdTNV3bg1d04+GDQqtK0KjJtCvI7QrCK0K7d8mfXd6uz3RWhsuXZfdhPhyb7xt32RidLuiX9FOsg+87eO06yN7gm1IS7LfvhLfhYcse8EPqlhy+7mm9B-tOeFhyd78Sb+75foeanK7jm7B4aebumn+ZFp02TafhFhoHTyD10+I9guhyfTuj3m-w-WXaym58j2M6zxUedXZ7-c+WRme4ea3oHxU4J6WfCeVnDHz+7x4A9K1uPdr2Tzs5o9SOFPLrtjzS-E+DuuPDmosh4P49+u1PAbpj3c9I+zuVPejlj5G-zJvPN3HzxD185s9iu2yfz2DwC4c9AvayILlz-R85YQvKPULrzzC9A9wuAvWrld+RabLR7yyaLvz0J48+fucXkH6E4l6k9OeZPQX9t1Z5A9xfu3snzu1F-U-ZeSbyXza5l4ucxfx3pXyd2F+ndufQLlX1B8V5w+weBX+ZIVyu5FetfHPQ5CV516leAeZXzXjN6B4VeDfzL6HlV5B7VejfRT03hTbN6U3lku1RZVy4t9i+dkTX43s12e9HXLeUv3XtL7WVX67eJHiH1aU2WXXneCv63rJ-N8eWbvoHx34e5t8M-teavr3rl8N-ne9emvlH6N5u9jewf43kHxN8D-KvILN8+7tN+WVqtNks36HnN6D+Y-5kC3sP+W3LnB+2FUfZbxDxW+h9BO2yB7PH84cA-1vEfP7sn826J+3n-vGXnH1l87KLWiyvb+H1d-R8KOKflMrH3k5p8Ve6fL35H294F8ffay2Orn4u8nLLvRyJj-ErOXxEoWLHcF2A-L8quO1ZfUzWX24Nl+nvwRLjxX8fZoseOkLXj48qF6l88edfz7i3wa5N8vzlfxPoi9QYQtRPtyaNmCxjZt+4yZy5ZvXzl9V8QenfrPw8jd7IsFsvfPrvC8Ibt9VezfHLiX6Z799fe4-lnycnh9HIEeyLRHmXyR5T-lXawFHuC9R4Qu0es-3nvP0q+GBl+kfOfwL3hfY8oXlx25CZ-OT4-N-8f55OZ0X7CeV-vLJfvF7388P9+RHSFvljOUU+d-fftf1TzRftv1-g-Bfs54P-xPj+nvw-wC6r+Auz-hf0-xPzBeDszlrPMv2zzBfs+H+uvYAWsM57IuufT-7nmi556v+l-fPcF-zw-5r93+0fe5cPfOXC8oXIv3-tv+f60WCFli6-+W3uCJJewAXt6ABB3u-7yeqvvjL7+ynvAFT+S5MXqIBmnhX4Mu25Ey6gBvPsf5r+eFuPbYB8foQE7+RFu2LbkLXpORteo5B17UBZ-ntJ68lASr54WA3mRZyu7AaX7VGM5BN4IWU3pwEautAZx4V+19nwGW+55Ct7zkj9ihYbeSFq-YyBEnuf5WuCgd-Yy+R3swEneMFmd4qBaTmIH9uQgRgHgiXrhoHc+agfp40W8DjoGJGAgXV70B5ngYE-ecFn94y+APmRZA+CFiD4eBufim4oWUPvOQw+vgaX4I+XgVX4wWKPoEGCBk5CW4RBSLv4HiB5-hw4hBjhkkFlaKQSywxBgxqORCOGQa27bkvhnkH0+S5Iz4FBttkhbwMM5Oz5pBd3i4Hh+NFmo4lB0flEGC+TQVv5FBZAar5kMEFO6YPk0vnSSPkcvlIT9BwzP0F0c-QfPT9BUzP0FuC-Qdr4XiuvviSPkGTI+Tkc75F0Gm+V5I+7-kpQn0GvuPQWt5y4d5GsGoyWwYoF3k4we75gUiJhsGFBWeHeQrB-vn4R3kWlHeSPigwaH57BZXq8QvB5wQQEl4LwcMGgEhFC8H3B6Dn0Gp+V5On5fBmfmCFn+p4uVZwhfXkrQIh22o8HF+MIfVZIhjHgsFSaqIax5-BdfoMEN+-5E37PkLfqSEAByIbb6EhYTpSHpB1IX37ohA-oyFD+4RLSGBSt5GP64hE-viEoBtwTP70hRXuSEleEIbUEHBXghyG-BYoc0H0UbIWKoChDXkKGOBCwQf59BR-kiEn+qobCGX+Xwdf6aht-gcH3+Ood55liY3o8Ev+RoW-4GhH-m+Rf+z5D-6DBf-naEUhQAWaE0hCXk6EMhV5AS7-kjdj6G0+MoQgEPk7dg6G8hNoYH5hhhgReJYBfoZ8HKh5gVaH8+XodKHqhJAX8ELMKwRQH-kVATKE0BV5HQE5hsIT155hLAX8FsBXwRwHlhxodwEPkvAY8H8BlYZEEFhpFg2GxBz5Et41hFIdIGDBsgayHyB3YacHKB-YaoF9B6gVmE3Bb5NoFDhugXWHhhUYPqJjhwoU2GmBI4fGG3BlgVOHWBLYaG69h7QWmSKiSoX0HOBh4XU6O0IIhrS3kngY8FraD5D4GDBfgc+QBBd4caHBBV4fr4HB4QU+GNhSIdEGfhrYa+HSmXwYkH-hyQcBGpBoEXSEPhpwdkG-hLIYBH+h34eOFRgxQf+TM+4EfMZoR5MjBGc+KEaKG3B9QThGJhMoejoERtgURG7hfwZ0HkU+VjZa9BJlhu5aWCvgxHlWiFDFqUU1VkrQsRbgixGzBRFPMFRWmBmxGWhWeOhRQUPjvhSbB4kfEHlCokfsHCR2ZkxFieDls76CRTIXREwBHlsmwyRmgRxEpOVEaUFqWGTgZFz+CkWTYmRbtrhR4BOkZKFyRyYTRGphGkeREORyfgZbghLkSeEOW0ISZbZ+bkeob4U+flpaF+yFGiFeR3ngYKmhaljiERReIR5YEhKlkSF+R5vq-hkhQUQAFhRIEVFH2+NlnrYJRnoT5GqReUbBEBR8EVlGIRSUUgEeRoYWhT8hcUcZFRW2nrBS6eOUSv4ZRjQQVFoeKUa0HCRQQg1GghJliqF9R7kQFYahA0aoZaW2oWNElhHlr-ywUhoRNEYhNlk-5zRwMjNHRRwkcF5qWtochT2hKlo6FbRqUS6EbRYTjiDuhe0blEcR3ofhS+hl0cVEOWgYQhTBhO0ZVGv4aAStGRhRFNGHXRsYVFa1iUFPTKvRxniNGkR50Y5FrRvUQZbZhHEbmHgxZjiZbaWsFEWHQxiITZZlhWlhWGoxoUdWEIUtYWpb1h6MV+HIxwgWhSiByFO2FYxqUV2EqWPYS5Z9hlMYoF38+UZDHqRwkaOH4USuvDHlRAVhd5kx+gbDG1RvMYuGMxX0fzHNR1MdZHDA9MZuF4xQMQTH2BwseL4GWR4SZauBLlu4HIUl4WpbXhCFLeEqW94WrFDeDlnD56x4USrFvhwkR+E6x1oWhQ-hFsdj4KxUkUBEaxskeLGv0UFKT42x5Pu7GU++FNNZaxN0QFag6vsdyEeWqEY7E8xdsW9He8hooHHLhSsauHOxYsVbG2RBsfZFmxIMfHHORStMjwZMyPORzI8olGf7I8dHMjzz0yPFMzI8bgsjw8RHFFpQcU2cYb7hE3FIJSExnPBJHCU2weqTk8Tce+6hSYTlJRdxHsTJRQBzPP3G-2dJCJQjx4OlxQPBDcYZGvEfcRPHVBY8Qh7sUkflIRSURcXTYzxKccMBSUucXZTCUrkZnGQh+JM9zQsa8d5FHx5VqfEHCzFIFENxwUexTi21FFiFjxkUXPGy2z8ZbGc88UQfGJRDFMlH3xAAdfGDWklCJ6gJYAd-GKBwCfHS3xTMTvEj+n8dpGO00CaFKIJ04YAlhxl8W9EoJLtufG4R8CXHFCsXtlxQb+eCZ1EEJssY-Fgxmcf1HsUaocgnDRdCQXHjRY8bqEdx00VxSzRrCd56VcRksJTmhJ8T5zMU60XPGbRDcdtGSUu0eIlAJB0aIm9xJ0dIlnRDCUPFXR-CX7Fy4vCdfpqJQcVniaJkOmvEvRnCXzFMJAscolCxJiSLGCJCcZzxEBRieQlCs6YcInUJyCRDEuJg0Ron5hmcXDFcUCMV4mTRuiSjFjxaMUEk8JmMWvHYxc8bjEhJ+MfxQD8zFMTENxpMeElAJFMZJRUxJ8TTFpJUCYOHCUNrrknqJASaVEMUk4fkn6RkSbOGc884ckmmJsSfglCssDtRTrhpSQDHsUgTDxTWi8Sc4n8UisexTKxJ8arENx6sXPGaxa8drGSUusYMn6xJeKBwEkzFC+GTJoQZnHmx4yV-EMU1sSsm2xSyfEEzJGIGXGE+oyb3FuxGyQPELJDMcgk+xByXAHdJRSTMm5xIccMkVJaycYlbJNSdMmju1FPhGXJrUS8ktJPyduEPJlCX8mumHVpL5tWtETVb0RdJGpTDMalHRxqU89GpRTMalG4JqUPEZpRGUpscMBKUS1sb4aUYkXil-xelBinW+BKd3HhS8kVCmO+JlMpEgpUAfJRwpmkT1be+C1rpEWUT0dpSzxLKc8mO01lCinLxBVqvGkp3yTymbxU1oCHEpPLlykZxPKYfEyp7iVnjAsMMTVYXxcqb5EaU-kVCl3xU1g-EFWT8XJQvxbVm-ELWH8fqmrJiqc2HGphKQAnapAAeanpRNqZlGqU2UeqmKBdqV7Eupw4YakFJWKZyFWU1tj1avmpqZgmqpgoSZT1RQaTHHKphCeFLEJHVqQkep0sU6lpxdAG6nApGlLQkFW9CapSMJmaWf7fMnDIpRsJNVhwkdWXCW1Y+KclItFQpAidWmrRWKSIkLWYiVNYSJVlFInNptqbImNpYTvmkeSlaa6kXR6aXAkppzdj1Z3RpaRzEjWeXuOnBp2adymzpryZOl1J4Uj9Gjp1idpS2J06YmkGUjiaunSpqlK4n7p8qVimeJPKd4kdWviaen+Jx6exGXpuqnJQjeVlGEkaUESQtZRJbVrZb3pzcdpQJJU1kknPptqakmPp3aZklAZSiYel-u76UOnhSLMf+lIJ4GXs6-p7KWkzoRoGaGmoZ5piZQPePVg0mfphEQVZBuilG0mEZyadBldJBlD0kFWfSVCkDJU1kMkLWIyRpRjJVlBMm0ZUySNaGxzGeX4ppxqnJTLJnGTEnkZX6Ygz+EPVrj4dWDsaxlkp2lC7GiZECdJmup0EYxlQZ8mVcmCZcGWpkIZ9GUhnlBsmW9HCZUceJlLpKmZYnUZa6fpkwpwHIpSi+vGWRn+UoKfRR605HHrThUjEXSR60dHHrTz0etFMzm0nlI6x+ZXGVFICR7lHWmF0qyR7QBZmyY7Tq0XmbsFBUmZq8QBUkWT35uZNKZ4TBUyWYVGpZ3qWFnqZdmROmhU08Ylmcp2WW9FRUbglFQ+ZgqTFQoePlLH4OZ4qXVmSppWZBZJUAYOxhpU8mBzi2IZKGpi5UZcACjiokAJKjxYxVL1SBA-VAXADAHAKpjFwrmHVT5Uw2YVQBYXKBHCVU0QLsB9ZikBrj1UUAOnC4oxaKEAtUfKILRDZI2UVQ9w42WVTEogOAqjEAfkHIBAAA Open this visualization in the Vega Editor (although the link is long, and may not work with Internet Explorer)&gt;

@
let aggTrans = transform
               . calculateAs \&quot;cos(datum.RA_ICRS * PI / 180)\&quot; \&quot;cosRA\&quot;
               . calculateAs \&quot;sin(datum.RA_ICRS * PI / 180)\&quot; \&quot;sinRA\&quot;
               . aggregate
                   [ opAs Mean \&quot;cosRA\&quot; \&quot;cosRA0\&quot;
                   , opAs Mean \&quot;sinRA\&quot; \&quot;sinRA0\&quot;
                   , opAs Mean \&quot;RA_ICRS\&quot; \&quot;wrong_ra0\&quot;
                   , opAs Mean \&quot;DE_ICRS\&quot; \&quot;dec0\&quot;
                   ]
                   [ \&quot;Cluster\&quot; ]
              . calculateAs \&quot;atan2(datum.sinRA0,datum.cosRA0) * 180.0 / PI\&quot; \&quot;ra0\&quot;

    clusterTrans = aggTrans
                   . aitoffTrans \&quot;datum.ra0\&quot; \&quot;datum.dec0\&quot;

    pos ax field = position ax [ PName field
                               , PmType Quantitative
                               , PScale [SNice (IsNice False)]
                               ]
    enc = encoding
          . pos X \&quot;x\&quot;
          . pos Y \&quot;y\&quot;
          . color [ MName \&quot;Cluster\&quot;, MmType Nominal, MLegend [] ]
    encText = enc
              . text [ TName \&quot;Cluster\&quot;, TmType Nominal ]

    clusterSpec =
        asSpec [ clusterTrans [], enc [], mark Circle [ MSize 90 ] ]

    clusterLabelSpec =
        asSpec [ clusterTrans [], encText [], mark Text [ MAlign 'AlignLeft'
                                                        , MdX 8 ] ]

    uncorrectedTrans = aggTrans
                       . aitoffTrans \&quot;datum.wrong_ra0\&quot; \&quot;datum.dec0\&quot;

    uncorrectedSpec =
        asSpec [ uncorrectedTrans [], enc [], mark Circle [ MSize 200, MFilled False ] ]

in toVegaLite  [ aitoffConfig []
               , width 570
               , height 285
               , gaiaData
               , layer (clusterSpec : uncorrectedSpec : clusterLabelSpec : graticuleSpec)
               ]
@

-}</span><span>
</span><span id="line-6098"></span><span>
</span><span id="line-6099"></span><span class="annot"><a href="Graphics.Vega.Tutorials.VegaLite.html#clusterCenters"><span class="hs-identifier hs-type">clusterCenters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Graphics.Vega.VegaLite.Specification.html#VegaLite"><span class="hs-identifier hs-type">VegaLite</span></a></span><span>
</span><span id="line-6100"></span><span id="clusterCenters"><span class="annot"><span class="annottext">clusterCenters :: VegaLite
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#clusterCenters"><span class="hs-identifier hs-var hs-var">clusterCenters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-6101"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679117593"><span class="annot"><span class="annottext">aggTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117593"><span class="hs-identifier hs-var hs-var">aggTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#transform"><span class="hs-identifier hs-var">transform</span></a></span><span>
</span><span id="line-6102"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cos(datum.RA_ICRS * PI / 180)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cosRA&quot;</span></span><span>
</span><span id="line-6103"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sin(datum.RA_ICRS * PI / 180)&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sinRA&quot;</span></span><span>
</span><span id="line-6104"></span><span>                 </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; [Text] -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#aggregate"><span class="hs-identifier hs-var">aggregate</span></a></span><span>
</span><span id="line-6105"></span><span>                     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cosRA&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cosRA0&quot;</span></span><span>
</span><span id="line-6106"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sinRA&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sinRA0&quot;</span></span><span>
</span><span id="line-6107"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RA_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wrong_ra0&quot;</span></span><span>
</span><span id="line-6108"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operation -&gt; Text -&gt; Text -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Core.html#opAs"><span class="hs-identifier hs-var">opAs</span></a></span><span> </span><span class="annot"><span class="annottext">Operation
</span><a href="Graphics.Vega.VegaLite.Transform.html#Mean"><span class="hs-identifier hs-var">Mean</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DE_ICRS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;dec0&quot;</span></span><span>
</span><span id="line-6109"></span><span>                     </span><span class="hs-special">]</span><span>
</span><span id="line-6110"></span><span>                     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6111"></span><span>                </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; [TransformSpec])
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; [TransformSpec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.VegaLite.Core.html#calculateAs"><span class="hs-identifier hs-var">calculateAs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;atan2(datum.sinRA0,datum.cosRA0) * 180.0 / PI&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ra0&quot;</span></span><span>
</span><span id="line-6112"></span><span>
</span><span id="line-6113"></span><span>      </span><span id="local-6989586621679117592"><span class="annot"><span class="annottext">clusterTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117592"><span class="hs-identifier hs-var hs-var">clusterTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117593"><span class="hs-identifier hs-var">aggTrans</span></a></span><span>
</span><span id="line-6114"></span><span>                     </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-var">aitoffTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.ra0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.dec0&quot;</span></span><span>
</span><span id="line-6115"></span><span>
</span><span id="line-6116"></span><span>      </span><span id="local-6989586621679117591"><span class="annot"><span class="annottext">pos :: Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117591"><span class="hs-identifier hs-var hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679117590"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679117590"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621679117589"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117589"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Position -&gt; [PositionChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#position"><span class="hs-identifier hs-var">position</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679117590"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PName"><span class="hs-identifier hs-var">PName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679117589"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-6117"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PmType"><span class="hs-identifier hs-var">PmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Quantitative"><span class="hs-identifier hs-var">Quantitative</span></a></span><span>
</span><span id="line-6118"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ScaleProperty] -&gt; PositionChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#PScale"><span class="hs-identifier hs-var">PScale</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScaleNice -&gt; ScaleProperty
</span><a href="Graphics.Vega.VegaLite.Core.html#SNice"><span class="hs-identifier hs-var">SNice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; ScaleNice
</span><a href="Graphics.Vega.VegaLite.Scale.html#IsNice"><span class="hs-identifier hs-var">IsNice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-6119"></span><span>                                 </span><span class="hs-special">]</span><span>
</span><span id="line-6120"></span><span>      </span><span id="local-6989586621679117588"><span class="annot"><span class="annottext">enc :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117588"><span class="hs-identifier hs-var hs-var">enc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#encoding"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-6121"></span><span>            </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117591"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#X"><span class="hs-identifier hs-var">X</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-6122"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Position -&gt; Text -&gt; BuildEncodingSpecs
</span><a href="#local-6989586621679117591"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Y"><span class="hs-identifier hs-var">Y</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;y&quot;</span></span><span>
</span><span id="line-6123"></span><span>            </span><span class="annot"><span class="annottext">BuildEncodingSpecs -&gt; BuildEncodingSpecs -&gt; BuildEncodingSpecs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[MarkChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#color"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MName"><span class="hs-identifier hs-var">MName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MmType"><span class="hs-identifier hs-var">MmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LegendProperty] -&gt; MarkChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#MLegend"><span class="hs-identifier hs-var">MLegend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6124"></span><span>      </span><span id="local-6989586621679117587"><span class="annot"><span class="annottext">encText :: [EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117587"><span class="hs-identifier hs-var hs-var">encText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117588"><span class="hs-identifier hs-var">enc</span></a></span><span>
</span><span id="line-6125"></span><span>                </span><span class="annot"><span class="annottext">([EncodingSpec] -&gt; PropertySpec)
-&gt; BuildEncodingSpecs -&gt; [EncodingSpec] -&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TextChannel] -&gt; BuildEncodingSpecs
</span><a href="Graphics.Vega.VegaLite.Core.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TName"><span class="hs-identifier hs-var">TName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cluster&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Measurement -&gt; TextChannel
</span><a href="Graphics.Vega.VegaLite.Core.html#TmType"><span class="hs-identifier hs-var">TmType</span></a></span><span> </span><span class="annot"><span class="annottext">Measurement
</span><a href="Graphics.Vega.VegaLite.Foundation.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6126"></span><span>
</span><span id="line-6127"></span><span>      </span><span id="local-6989586621679117586"><span class="annot"><span class="annottext">clusterSpec :: VLSpec
</span><a href="#local-6989586621679117586"><span class="hs-identifier hs-var hs-var">clusterSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-6128"></span><span>          </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117592"><span class="hs-identifier hs-var">clusterTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117588"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">90</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6129"></span><span>
</span><span id="line-6130"></span><span>      </span><span id="local-6989586621679117585"><span class="annot"><span class="annottext">clusterLabelSpec :: VLSpec
</span><a href="#local-6989586621679117585"><span class="hs-identifier hs-var hs-var">clusterLabelSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-6131"></span><span>          </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117592"><span class="hs-identifier hs-var">clusterTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117587"><span class="hs-identifier hs-var">encText</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Text"><span class="hs-identifier hs-var">Text</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HAlign -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MAlign"><span class="hs-identifier hs-var">MAlign</span></a></span><span> </span><span class="annot"><span class="annottext">HAlign
</span><a href="Graphics.Vega.VegaLite.Foundation.html#AlignLeft"><span class="hs-identifier hs-var">AlignLeft</span></a></span><span>
</span><span id="line-6132"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MdX"><span class="hs-identifier hs-var">MdX</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">8</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6133"></span><span>
</span><span id="line-6134"></span><span>      </span><span id="local-6989586621679117583"><span class="annot"><span class="annottext">uncorrectedTrans :: [TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117583"><span class="hs-identifier hs-var hs-var">uncorrectedTrans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117593"><span class="hs-identifier hs-var">aggTrans</span></a></span><span>
</span><span id="line-6135"></span><span>                         </span><span class="annot"><span class="annottext">([TransformSpec] -&gt; PropertySpec)
-&gt; ([TransformSpec] -&gt; [TransformSpec])
-&gt; [TransformSpec]
-&gt; PropertySpec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [TransformSpec] -&gt; [TransformSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffTrans"><span class="hs-identifier hs-var">aitoffTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.wrong_ra0&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum.dec0&quot;</span></span><span>
</span><span id="line-6136"></span><span>
</span><span id="line-6137"></span><span>      </span><span id="local-6989586621679117582"><span class="annot"><span class="annottext">uncorrectedSpec :: VLSpec
</span><a href="#local-6989586621679117582"><span class="hs-identifier hs-var hs-var">uncorrectedSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-6138"></span><span>          </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VLSpec
</span><a href="Graphics.Vega.VegaLite.Specification.html#asSpec"><span class="hs-identifier hs-var">asSpec</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TransformSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117583"><span class="hs-identifier hs-var">uncorrectedTrans</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EncodingSpec] -&gt; PropertySpec
</span><a href="#local-6989586621679117588"><span class="hs-identifier hs-var">enc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mark -&gt; [MarkProperty] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#mark"><span class="hs-identifier hs-var">mark</span></a></span><span> </span><span class="annot"><span class="annottext">Mark
</span><a href="Graphics.Vega.VegaLite.Mark.html#Circle"><span class="hs-identifier hs-var">Circle</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Double -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MSize"><span class="hs-identifier hs-var">MSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">200</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; MarkProperty
</span><a href="Graphics.Vega.VegaLite.Mark.html#MFilled"><span class="hs-identifier hs-var">MFilled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-6139"></span><span>
</span><span id="line-6140"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[PropertySpec] -&gt; VegaLite
</span><a href="Graphics.Vega.VegaLite.Specification.html#toVegaLite"><span class="hs-identifier hs-var">toVegaLite</span></a></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[ConfigureSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#aitoffConfig"><span class="hs-identifier hs-var">aitoffConfig</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-6141"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#width"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">570</span></span><span>
</span><span id="line-6142"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#height"><span class="hs-identifier hs-var">height</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">285</span></span><span>
</span><span id="line-6143"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PropertySpec
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#gaiaData"><span class="hs-identifier hs-var">gaiaData</span></a></span><span>
</span><span id="line-6144"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VLSpec] -&gt; PropertySpec
</span><a href="Graphics.Vega.VegaLite.Core.html#layer"><span class="hs-identifier hs-var">layer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117586"><span class="hs-identifier hs-var">clusterSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; [VLSpec] -&gt; [VLSpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117582"><span class="hs-identifier hs-var">uncorrectedSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; [VLSpec] -&gt; [VLSpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">VLSpec
</span><a href="#local-6989586621679117585"><span class="hs-identifier hs-var">clusterLabelSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VLSpec -&gt; [VLSpec] -&gt; [VLSpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[VLSpec]
</span><a href="Graphics.Vega.Tutorials.VegaLite.html#graticuleSpec"><span class="hs-identifier hs-var">graticuleSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6145"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-6146"></span><span>
</span><span id="line-6147"></span><span class="hs-comment">{-

Other things to do:

 - add some description of magnitude / parallax meanings
   (since talk about astronomy being awkward)

 - tooltips (show multiple fields)

 - for errors section, could look at quantile plots?

-}</span><span>
</span><span id="line-6159"></span></pre></body></html>