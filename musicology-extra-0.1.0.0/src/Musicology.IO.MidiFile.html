<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Musicology.IO.MidiFile</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pitch</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Musicology.Internal.Helpers.html"><span class="hs-identifier">Musicology.Internal.Helpers</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Midi</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">channel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Channel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Velocity</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ratio</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Frames</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">:&amp;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Frames.InCore</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">VectorFor</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Frames.TH</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">declareColumn</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vinyl.Core</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Rec</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-27"></span><span class="hs-comment">-- import Pipes</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">takeExtension</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeBaseName</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">listDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- import qualified Data.Machine as MC</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">data</span><span> </span><span id="MidiNote"><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-var">MidiNote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MidiNote"><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-var">MidiNote</span></a></span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_onsetTicks"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_onsetTicks"><span class="hs-identifier hs-var hs-var">_onsetTicks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_offsetTicks"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_offsetTicks"><span class="hs-identifier hs-var hs-var">_offsetTicks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_onsetWholes"><span class="annot"><span class="annottext">MidiNote -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#_onsetWholes"><span class="hs-identifier hs-var hs-var">_onsetWholes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_offsetWholes"><span class="annot"><span class="annottext">MidiNote -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#_offsetWholes"><span class="hs-identifier hs-var hs-var">_offsetWholes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_onsetSecs"><span class="annot"><span class="annottext">MidiNote -&gt; Double
</span><a href="Musicology.IO.MidiFile.html#_onsetSecs"><span class="hs-identifier hs-var hs-var">_onsetSecs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_offsetSecs"><span class="annot"><span class="annottext">MidiNote -&gt; Double
</span><a href="Musicology.IO.MidiFile.html#_offsetSecs"><span class="hs-identifier hs-var hs-var">_offsetSecs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_pitch"><span class="annot"><span class="annottext">MidiNote -&gt; MidiPitch
</span><a href="Musicology.IO.MidiFile.html#_pitch"><span class="hs-identifier hs-var hs-var">_pitch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MidiPitch</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_velocity"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_velocity"><span class="hs-identifier hs-var hs-var">_velocity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_trackNum"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_trackNum"><span class="hs-identifier hs-var hs-var">_trackNum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_channel"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_channel"><span class="hs-identifier hs-var hs-var">_channel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_keySharps"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_keySharps"><span class="hs-identifier hs-var hs-var">_keySharps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_keyMajor"><span class="annot"><span class="annottext">MidiNote -&gt; Bool
</span><a href="Musicology.IO.MidiFile.html#_keyMajor"><span class="hs-identifier hs-var hs-var">_keyMajor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_bar"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_bar"><span class="hs-identifier hs-var hs-var">_bar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_beat"><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_beat"><span class="hs-identifier hs-var hs-var">_beat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_subbeat"><span class="annot"><span class="annottext">MidiNote -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#_subbeat"><span class="hs-identifier hs-var hs-var">_subbeat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118393"><span id="local-6989586621679118413"><span class="annot"><span class="annottext">MidiNote -&gt; MidiNote -&gt; Bool
(MidiNote -&gt; MidiNote -&gt; Bool)
-&gt; (MidiNote -&gt; MidiNote -&gt; Bool) -&gt; Eq MidiNote
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MidiNote -&gt; MidiNote -&gt; Bool
== :: MidiNote -&gt; MidiNote -&gt; Bool
$c/= :: MidiNote -&gt; MidiNote -&gt; Bool
/= :: MidiNote -&gt; MidiNote -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118418"><span id="local-6989586621679118437"><span id="local-6989586621679118441"><span class="annot"><span class="annottext">Int -&gt; MidiNote -&gt; ShowS
[MidiNote] -&gt; ShowS
MidiNote -&gt; String
(Int -&gt; MidiNote -&gt; ShowS)
-&gt; (MidiNote -&gt; String) -&gt; ([MidiNote] -&gt; ShowS) -&gt; Show MidiNote
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MidiNote -&gt; ShowS
showsPrec :: Int -&gt; MidiNote -&gt; ShowS
$cshow :: MidiNote -&gt; String
show :: MidiNote -&gt; String
$cshowList :: [MidiNote] -&gt; ShowS
showList :: [MidiNote] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118445"><span id="local-6989586621679118447"><span class="annot"><span class="annottext">(forall x. MidiNote -&gt; Rep MidiNote x)
-&gt; (forall x. Rep MidiNote x -&gt; MidiNote) -&gt; Generic MidiNote
forall x. Rep MidiNote x -&gt; MidiNote
forall x. MidiNote -&gt; Rep MidiNote x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. MidiNote -&gt; Rep MidiNote x
from :: forall x. MidiNote -&gt; Rep MidiNote x
$cto :: forall x. Rep MidiNote x -&gt; MidiNote
to :: forall x. Rep MidiNote x -&gt; MidiNote
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#asTicks"><span class="hs-identifier hs-type">asTicks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MidiInterval</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-57"></span><span id="asTicks"><span class="annot"><span class="annottext">asTicks :: MidiNote -&gt; Note Int Int
</span><a href="Musicology.IO.MidiFile.html#asTicks"><span class="hs-identifier hs-var hs-var">asTicks</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span id="local-6989586621679118452"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118452"><span class="hs-identifier hs-var">on</span></a></span></span><span> </span><span id="local-6989586621679118453"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118453"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679118454"><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118454"><span class="hs-identifier hs-var">pitch</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MidiPitch -&gt; Int -&gt; Int -&gt; Note Int Int
forall p t. Pitch p -&gt; t -&gt; t -&gt; Note p t
</span><span class="hs-identifier hs-var">Note</span></span><span> </span><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118454"><span class="hs-identifier hs-var">pitch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118452"><span class="hs-identifier hs-var">on</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118453"><span class="hs-identifier hs-var">off</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#asWholes"><span class="hs-identifier hs-type">asWholes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MidiInterval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span id="asWholes"><span class="annot"><span class="annottext">asWholes :: MidiNote -&gt; Note Int (Ratio Int)
</span><a href="Musicology.IO.MidiFile.html#asWholes"><span class="hs-identifier hs-var hs-var">asWholes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679118457"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118457"><span class="hs-identifier hs-var">on</span></a></span></span><span> </span><span id="local-6989586621679118458"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118458"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679118459"><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118459"><span class="hs-identifier hs-var">pitch</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MidiPitch -&gt; Ratio Int -&gt; Ratio Int -&gt; Note Int (Ratio Int)
forall p t. Pitch p -&gt; t -&gt; t -&gt; Note p t
</span><span class="hs-identifier hs-var">Note</span></span><span> </span><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118459"><span class="hs-identifier hs-var">pitch</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118457"><span class="hs-identifier hs-var">on</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118458"><span class="hs-identifier hs-var">off</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#asSecs"><span class="hs-identifier hs-type">asSecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MidiInterval</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-63"></span><span id="asSecs"><span class="annot"><span class="annottext">asSecs :: MidiNote -&gt; Note Int Double
</span><a href="Musicology.IO.MidiFile.html#asSecs"><span class="hs-identifier hs-var hs-var">asSecs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679118461"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118461"><span class="hs-identifier hs-var">on</span></a></span></span><span> </span><span id="local-6989586621679118462"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118462"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679118463"><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118463"><span class="hs-identifier hs-var">pitch</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MidiPitch -&gt; Double -&gt; Double -&gt; Note Int Double
forall p t. Pitch p -&gt; t -&gt; t -&gt; Note p t
</span><span class="hs-identifier hs-var">Note</span></span><span> </span><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118463"><span class="hs-identifier hs-var">pitch</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118461"><span class="hs-identifier hs-var">on</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118462"><span class="hs-identifier hs-var">off</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679118465"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="VectorFor"><span class="annot"><span class="hs-identifier hs-var">VectorFor</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">type</span><span> </span><span id="MidiRecord"><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiRecord"><span class="hs-identifier hs-var">MidiRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Record</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;onsetTicks&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;offsetTicks&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-70"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;onsetWholes&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;offsetWholes&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-71"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;onsetSecs&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;offsetSecs&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-72"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;pitch&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;velocity&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;trackNum&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-73"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;channel&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;keySharps&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;keyMajor&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-74"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;bar&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;beat&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;subbeat&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-75"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-76"></span><span class="hs-keyword">type</span><span> </span><span id="RatioInt"><span class="annot"><a href="Musicology.IO.MidiFile.html#RatioInt"><span class="hs-identifier hs-var">RatioInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span id="local-6989586621679117855"><span id="local-6989586621679117856"><span id="local-6989586621679117860"><span id="local-6989586621679117861"><span id="local-6989586621679117862"><span id="OnsetTicks"><span id="onsetTicks"><span id="onsetTicks%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;onsetTicks&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-79"></span><span id="local-6989586621679117893"><span id="local-6989586621679117894"><span id="local-6989586621679117895"><span id="local-6989586621679117896"><span id="local-6989586621679117897"><span id="OffsetTicks"><span id="offsetTicks"><span id="offsetTicks%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;offsetTicks&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-80"></span><span id="local-6989586621679117903"><span id="local-6989586621679117904"><span id="local-6989586621679117905"><span id="local-6989586621679117906"><span id="local-6989586621679117907"><span id="OnsetWholes"><span id="onsetWholes"><span id="onsetWholes%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;onsetWholes&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RatioInt</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-81"></span><span id="local-6989586621679117913"><span id="local-6989586621679117914"><span id="local-6989586621679117915"><span id="local-6989586621679117916"><span id="local-6989586621679117917"><span id="OffsetWholes"><span id="offsetWholes"><span id="offsetWholes%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;offsetWholes&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RatioInt</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-82"></span><span id="local-6989586621679117923"><span id="OnsetSecs"><span id="local-6989586621679117925"><span id="local-6989586621679117926"><span id="local-6989586621679117927"><span id="local-6989586621679117928"><span id="onsetSecs"><span id="onsetSecs%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;onsetSecs&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-83"></span><span id="local-6989586621679117934"><span id="OffsetSecs"><span id="local-6989586621679117936"><span id="local-6989586621679117937"><span id="local-6989586621679117938"><span id="local-6989586621679117939"><span id="offsetSecs"><span id="offsetSecs%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;offsetSecs&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-84"></span><span id="local-6989586621679117945"><span id="local-6989586621679117946"><span id="local-6989586621679117947"><span id="local-6989586621679117948"><span id="local-6989586621679117949"><span id="Pitch"><span id="pitch"><span id="pitch%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;pitch&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-85"></span><span id="local-6989586621679117955"><span id="local-6989586621679117956"><span id="local-6989586621679117957"><span id="local-6989586621679117958"><span id="local-6989586621679117959"><span id="Velocity"><span id="velocity"><span id="velocity%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;velocity&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-86"></span><span id="local-6989586621679117965"><span id="local-6989586621679117966"><span id="local-6989586621679117967"><span id="local-6989586621679117968"><span id="local-6989586621679117969"><span id="TrackNum"><span id="trackNum"><span id="trackNum%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;trackNum&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-87"></span><span id="local-6989586621679117975"><span id="local-6989586621679117976"><span id="local-6989586621679117977"><span id="local-6989586621679117978"><span id="local-6989586621679117979"><span id="Channel"><span id="channel"><span id="channel%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;channel&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-88"></span><span id="local-6989586621679117985"><span id="local-6989586621679117986"><span id="local-6989586621679117987"><span id="local-6989586621679117988"><span id="local-6989586621679117989"><span id="KeySharps"><span id="keySharps"><span id="keySharps%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;keySharps&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-89"></span><span id="local-6989586621679117995"><span id="local-6989586621679117996"><span id="local-6989586621679117997"><span id="local-6989586621679117998"><span id="local-6989586621679117999"><span id="KeyMajor"><span id="keyMajor"><span id="keyMajor%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;keyMajor&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Bool</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-90"></span><span id="local-6989586621679118005"><span id="local-6989586621679118006"><span id="local-6989586621679118007"><span id="local-6989586621679118008"><span id="local-6989586621679118009"><span id="Bar"><span id="bar"><span id="bar%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;bar&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-91"></span><span id="local-6989586621679118015"><span id="local-6989586621679118016"><span id="local-6989586621679118017"><span id="local-6989586621679118018"><span id="local-6989586621679118019"><span id="Beat"><span id="beat"><span id="beat%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;beat&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-92"></span><span id="local-6989586621679118025"><span id="local-6989586621679118026"><span id="local-6989586621679118027"><span id="local-6989586621679118028"><span id="local-6989586621679118029"><span id="Subbeat"><span id="subbeat"><span id="subbeat%27"><span class="hs-identifier">declareColumn</span><span> </span><span class="hs-string">&quot;subbeat&quot;</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RatioInt</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#midiNoteToRecord"><span class="hs-identifier hs-type">midiNoteToRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiRecord"><span class="hs-identifier hs-type">MidiRecord</span></a></span><span>
</span><span id="line-95"></span><span id="midiNoteToRecord"><span class="annot"><span class="annottext">midiNoteToRecord :: MidiNote -&gt; MidiRecord
</span><a href="Musicology.IO.MidiFile.html#midiNoteToRecord"><span class="hs-identifier hs-var hs-var">midiNoteToRecord</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span id="local-6989586621679118764"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118764"><span class="hs-identifier hs-var">ont</span></a></span></span><span> </span><span id="local-6989586621679118765"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118765"><span class="hs-identifier hs-var">oft</span></a></span></span><span> </span><span id="local-6989586621679118766"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118766"><span class="hs-identifier hs-var">onw</span></a></span></span><span> </span><span id="local-6989586621679118767"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118767"><span class="hs-identifier hs-var">ofw</span></a></span></span><span> </span><span id="local-6989586621679118768"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118768"><span class="hs-identifier hs-var">ons</span></a></span></span><span> </span><span id="local-6989586621679118769"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118769"><span class="hs-identifier hs-var">ofs</span></a></span></span><span> </span><span id="local-6989586621679118770"><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118770"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679118771"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118771"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679118772"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118772"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679118773"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118773"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679118774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118774"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679118775"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118775"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679118776"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118776"><span class="hs-identifier hs-var">bar</span></a></span></span><span> </span><span id="local-6989586621679118777"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118777"><span class="hs-identifier hs-var">beat</span></a></span></span><span> </span><span id="local-6989586621679118778"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118778"><span class="hs-identifier hs-var">sub</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118764"><span class="hs-identifier hs-var">ont</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;offsetTicks&quot; :-&gt; Int, &quot;onsetWholes&quot; :-&gt; Ratio Int,
       &quot;offsetWholes&quot; :-&gt; Ratio Int, &quot;onsetSecs&quot; :-&gt; Double,
       &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; MidiRecord
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118765"><span class="hs-identifier hs-var">oft</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;onsetWholes&quot; :-&gt; Ratio Int, &quot;offsetWholes&quot; :-&gt; Ratio Int,
       &quot;onsetSecs&quot; :-&gt; Double, &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int,
       &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;offsetTicks&quot; :-&gt; Int, &quot;onsetWholes&quot; :-&gt; Ratio Int,
       &quot;offsetWholes&quot; :-&gt; Ratio Int, &quot;onsetSecs&quot; :-&gt; Double,
       &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118766"><span class="hs-identifier hs-var">onw</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
-&gt; Record
     '[&quot;offsetWholes&quot; :-&gt; Ratio Int, &quot;onsetSecs&quot; :-&gt; Double,
       &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;onsetWholes&quot; :-&gt; Ratio Int, &quot;offsetWholes&quot; :-&gt; Ratio Int,
       &quot;onsetSecs&quot; :-&gt; Double, &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int,
       &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118767"><span class="hs-identifier hs-var">ofw</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
-&gt; Record
     '[&quot;onsetSecs&quot; :-&gt; Double, &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int,
       &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;offsetWholes&quot; :-&gt; Ratio Int, &quot;onsetSecs&quot; :-&gt; Double,
       &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118768"><span class="hs-identifier hs-var">ons</span></a></span><span> </span><span class="annot"><span class="annottext">Double
-&gt; Record
     '[&quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;onsetSecs&quot; :-&gt; Double, &quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int,
       &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118769"><span class="hs-identifier hs-var">ofs</span></a></span><span> </span><span class="annot"><span class="annottext">Double
-&gt; Record
     '[&quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int,
       &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool,
       &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;offsetSecs&quot; :-&gt; Double, &quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int,
       &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">MidiPitch -&gt; Int
forall {a}. Pitch a -&gt; a
</span><span class="hs-identifier hs-var">toInterval</span></span><span> </span><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118770"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;pitch&quot; :-&gt; Int, &quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int,
       &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool,
       &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118771"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;velocity&quot; :-&gt; Int, &quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int,
       &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118772"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool,
       &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;trackNum&quot; :-&gt; Int, &quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int,
       &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118773"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;channel&quot; :-&gt; Int, &quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool,
       &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118774"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record
     '[&quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;keySharps&quot; :-&gt; Int, &quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int,
       &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118775"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Record '[&quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record
     '[&quot;keyMajor&quot; :-&gt; Bool, &quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int,
       &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118776"><span class="hs-identifier hs-var">bar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record '[&quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record '[&quot;bar&quot; :-&gt; Int, &quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118777"><span class="hs-identifier hs-var">beat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Record '[&quot;subbeat&quot; :-&gt; Ratio Int]
-&gt; Record '[&quot;beat&quot; :-&gt; Int, &quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118778"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Record '[] -&gt; Record '[&quot;subbeat&quot; :-&gt; Ratio Int]
forall (s :: Symbol) a (rs :: [(Symbol, *)]).
KnownSymbol s =&gt;
a -&gt; Record rs -&gt; Record ((s :-&gt; a) : rs)
</span><span class="hs-operator hs-var">&amp;:</span></span><span> </span><span class="annot"><span class="annottext">Record '[]
forall {u} (a :: u -&gt; *). Rec a '[]
</span><span class="hs-identifier hs-var">RNil</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#printNote"><span class="hs-identifier hs-type">printNote</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span id="printNote"><span class="annot"><span class="annottext">printNote :: MidiNote -&gt; IO ()
</span><a href="Musicology.IO.MidiFile.html#printNote"><span class="hs-identifier hs-var hs-var">printNote</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span> </span><span id="local-6989586621679118783"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118783"><span class="hs-identifier hs-var">ont</span></a></span></span><span> </span><span id="local-6989586621679118784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118784"><span class="hs-identifier hs-var">offt</span></a></span></span><span> </span><span id="local-6989586621679118785"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118785"><span class="hs-identifier hs-var">onw</span></a></span></span><span> </span><span id="local-6989586621679118786"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118786"><span class="hs-identifier hs-var">offw</span></a></span></span><span> </span><span id="local-6989586621679118787"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118787"><span class="hs-identifier hs-var">ons</span></a></span></span><span> </span><span id="local-6989586621679118788"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118788"><span class="hs-identifier hs-var">offs</span></a></span></span><span> </span><span id="local-6989586621679118789"><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118789"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679118790"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118790"><span class="hs-identifier hs-var">vel</span></a></span></span><span> </span><span id="local-6989586621679118791"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118791"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621679118792"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118792"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679118793"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118793"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679118794"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679118794"><span class="hs-identifier hs-var">maj</span></a></span></span><span> </span><span id="local-6989586621679118795"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118795"><span class="hs-identifier hs-var">bar</span></a></span></span><span> </span><span id="local-6989586621679118796"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118796"><span class="hs-identifier hs-var">beat</span></a></span></span><span> </span><span id="local-6989586621679118797"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118797"><span class="hs-identifier hs-var">subb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118783"><span class="hs-identifier hs-var">ont</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118784"><span class="hs-identifier hs-var">offt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Ratio Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118785"><span class="hs-identifier hs-var">onw</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118786"><span class="hs-identifier hs-var">offw</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118787"><span class="hs-identifier hs-var">ons</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118788"><span class="hs-identifier hs-var">offs</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">MidiPitch -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">MidiPitch
</span><a href="#local-6989586621679118789"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118790"><span class="hs-identifier hs-var">vel</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118791"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-105"></span><span class="hs-comment">--  show ch ++ &quot;\t&quot; ++ show sh ++ &quot;\t&quot; ++ show maj ++ &quot;\t&quot; ++</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118795"><span class="hs-identifier hs-var">bar</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118796"><span class="hs-identifier hs-var">beat</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118797"><span class="hs-identifier hs-var">subb</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">type</span><span> </span><span id="PrepEv"><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-var">PrepEv</span></a></span></span><span> </span><span id="local-6989586621679118800"><span class="annot"><a href="#local-6989586621679118800"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679118800"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621679118046"><span class="annot"><a href="Musicology.IO.MidiFile.html#prepareTrack"><span class="hs-identifier hs-type">prepareTrack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Track</span></span><span> </span><span class="annot"><a href="#local-6989586621679118046"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118046"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-111"></span><span id="prepareTrack"><span class="annot"><span class="annottext">prepareTrack :: forall a. Track a -&gt; Int -&gt; [PrepEv a]
</span><a href="Musicology.IO.MidiFile.html#prepareTrack"><span class="hs-identifier hs-var hs-var">prepareTrack</span></a></span></span><span> </span><span id="local-6989586621679118803"><span class="annot"><span class="annottext">Track a
</span><a href="#local-6989586621679118803"><span class="hs-identifier hs-var">trk</span></a></span></span><span> </span><span id="local-6989586621679118804"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118804"><span class="hs-identifier hs-var">trkNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (PrepEv a)] -&gt; [PrepEv a]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (PrepEv a)] -&gt; [PrepEv a])
-&gt; [Maybe (PrepEv a)] -&gt; [PrepEv a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Message, [Maybe (PrepEv a)]) -&gt; [Maybe (PrepEv a)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Message, [Maybe (PrepEv a)]) -&gt; [Maybe (PrepEv a)])
-&gt; (Message, [Maybe (PrepEv a)]) -&gt; [Maybe (PrepEv a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; (a, Message) -&gt; (Message, Maybe (PrepEv a)))
-&gt; Message -&gt; Track a -&gt; (Message, [Maybe (PrepEv a)])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">Message -&gt; (a, Message) -&gt; (Message, Maybe (PrepEv a))
forall a. Message -&gt; (a, Message) -&gt; (Message, Maybe (PrepEv a))
</span><a href="#local-6989586621679118806"><span class="hs-identifier hs-var">nextEv</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118807"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">Track a
</span><a href="#local-6989586621679118803"><span class="hs-identifier hs-var">trk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118807"><span class="annot"><span class="annottext">init :: Message
</span><a href="#local-6989586621679118807"><span class="hs-identifier hs-var hs-var">init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Message
</span><span class="hs-identifier hs-var">KeySignature</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621679118058"><span class="annot"><a href="#local-6989586621679118806"><span class="hs-identifier hs-type">nextEv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679118058"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118058"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621679118806"><span class="annot"><span class="annottext">nextEv :: forall a. Message -&gt; (a, Message) -&gt; (Message, Maybe (PrepEv a))
</span><a href="#local-6989586621679118806"><span class="hs-identifier hs-var hs-var">nextEv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118809"><span class="annot"><span class="annottext">ks :: Message
</span><a href="#local-6989586621679118809"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeySignature</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118809"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (PrepEv a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="#local-6989586621679118806"><span class="hs-identifier hs-var">nextEv</span></a></span><span> </span><span id="local-6989586621679118810"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118810"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span id="local-6989586621679118811"><span class="annot"><span class="annottext">(a, Message)
</span><a href="#local-6989586621679118811"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118810"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrepEv a -&gt; Maybe (PrepEv a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118804"><span class="hs-identifier hs-var">trkNum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118810"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, Message)
</span><a href="#local-6989586621679118811"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span id="local-6989586621679118060"><span class="annot"><a href="Musicology.IO.MidiFile.html#mergeTracks"><span class="hs-identifier hs-type">mergeTracks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679118060"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118060"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118060"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118060"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-118"></span><span id="mergeTracks"><span class="annot"><span class="annottext">mergeTracks :: forall a. Ord a =&gt; [PrepEv a] -&gt; [PrepEv a] -&gt; [PrepEv a]
</span><a href="Musicology.IO.MidiFile.html#mergeTracks"><span class="hs-identifier hs-var hs-var">mergeTracks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrepEv a -&gt; PrepEv a -&gt; Ordering)
-&gt; [PrepEv a] -&gt; [PrepEv a] -&gt; [PrepEv a]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="Musicology.Internal.Helpers.html#mergeBy"><span class="hs-identifier hs-var">mergeBy</span></a></span><span> </span><span class="annot"><span class="annottext">((PrepEv a -&gt; PrepEv a -&gt; Ordering)
 -&gt; [PrepEv a] -&gt; [PrepEv a] -&gt; [PrepEv a])
-&gt; (PrepEv a -&gt; PrepEv a -&gt; Ordering)
-&gt; [PrepEv a]
-&gt; [PrepEv a]
-&gt; [PrepEv a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PrepEv a -&gt; a) -&gt; PrepEv a -&gt; PrepEv a -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">PrepEv a -&gt; a
forall {a} {b} {a} {b}. (a, b, (a, b)) -&gt; a
</span><a href="#local-6989586621679118816"><span class="hs-identifier hs-var">getTime</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118816"><span class="annot"><span class="annottext">getTime :: (a, b, (a, b)) -&gt; a
</span><a href="#local-6989586621679118816"><span class="hs-identifier hs-var hs-var">getTime</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118817"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118817"><span class="hs-identifier hs-var">time</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118817"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#midiEvents"><span class="hs-identifier hs-type">midiEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Midi</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ticks</span></span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span id="midiEvents"><span class="annot"><span class="annottext">midiEvents :: Midi -&gt; [PrepEv Int]
</span><a href="Musicology.IO.MidiFile.html#midiEvents"><span class="hs-identifier hs-var hs-var">midiEvents</span></a></span></span><span> </span><span id="local-6989586621679118820"><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679118820"><span class="hs-identifier hs-var">midi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PrepEv Int] -&gt; [PrepEv Int] -&gt; [PrepEv Int])
-&gt; [PrepEv Int] -&gt; [[PrepEv Int]] -&gt; [PrepEv Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">[PrepEv Int] -&gt; [PrepEv Int] -&gt; [PrepEv Int]
forall a. Ord a =&gt; [PrepEv a] -&gt; [PrepEv a] -&gt; [PrepEv a]
</span><a href="Musicology.IO.MidiFile.html#mergeTracks"><span class="hs-identifier hs-var">mergeTracks</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[[PrepEv Int]]
</span><a href="#local-6989586621679118822"><span class="hs-identifier hs-var">prepared</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118825"><span class="annot"><span class="annottext">prep :: Track a -&gt; Int -&gt; [PrepEv a]
</span><a href="#local-6989586621679118825"><span class="hs-identifier hs-var hs-var">prep</span></a></span></span><span> </span><span id="local-6989586621679118826"><span class="annot"><span class="annottext">Track a
</span><a href="#local-6989586621679118826"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Track a -&gt; Int -&gt; [PrepEv a]
forall a. Track a -&gt; Int -&gt; [PrepEv a]
</span><a href="Musicology.IO.MidiFile.html#prepareTrack"><span class="hs-identifier hs-var">prepareTrack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Track a -&gt; Track a
forall a. Num a =&gt; Track a -&gt; Track a
</span><span class="hs-identifier hs-var">toAbsTime</span></span><span> </span><span class="annot"><span class="annottext">Track a
</span><a href="#local-6989586621679118826"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621679118822"><span class="annot"><span class="annottext">prepared :: [[PrepEv Int]]
</span><a href="#local-6989586621679118822"><span class="hs-identifier hs-var hs-var">prepared</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Track Int -&gt; Int -&gt; [PrepEv Int])
-&gt; [Track Int] -&gt; [Int] -&gt; [[PrepEv Int]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Track Int -&gt; Int -&gt; [PrepEv Int]
forall {a}. Num a =&gt; Track a -&gt; Int -&gt; [PrepEv a]
</span><a href="#local-6989586621679118825"><span class="hs-identifier hs-var">prep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; [Track Int]
</span><span class="hs-identifier hs-var">tracks</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679118820"><span class="hs-identifier hs-var">midi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- produceEvents :: Monad m =&gt; Midi -&gt; Producer (PrepEv Ticks) m ()</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- produceEvents = each . midiEvents</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#timeRatios"><span class="hs-identifier hs-type">timeRatios</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeDiv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span id="timeRatios"><span class="annot"><span class="annottext">timeRatios :: TimeDiv -&gt; Int -&gt; (Ratio Int, Double)
</span><a href="Musicology.IO.MidiFile.html#timeRatios"><span class="hs-identifier hs-var hs-var">timeRatios</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TicksPerBeat</span></span><span> </span><span id="local-6989586621679118832"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118832"><span class="hs-identifier hs-var">ppq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679118833"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118833"><span class="hs-identifier hs-var">mspq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118832"><span class="hs-identifier hs-var">ppq</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118833"><span class="hs-identifier hs-var">mspq</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000000.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118832"><span class="hs-identifier hs-var">ppq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#timeRatios"><span class="hs-identifier hs-var">timeRatios</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TicksPerSecond</span></span><span> </span><span id="local-6989586621679118838"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118838"><span class="hs-identifier hs-var">tpf</span></a></span></span><span> </span><span id="local-6989586621679118839"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118839"><span class="hs-identifier hs-var">fps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679118840"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118840"><span class="hs-identifier hs-var">mspq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">250000</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118841"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118840"><span class="hs-identifier hs-var">mspq</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118840"><span class="hs-identifier hs-var">mspq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118841"><span class="annot"><span class="annottext">tps :: Int
</span><a href="#local-6989586621679118841"><span class="hs-identifier hs-var hs-var">tps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118838"><span class="hs-identifier hs-var">tpf</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118839"><span class="hs-identifier hs-var">fps</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">type</span><span> </span><span id="Resolver"><span class="annot"><a href="Musicology.IO.MidiFile.html#Resolver"><span class="hs-identifier hs-var">Resolver</span></a></span></span><span> </span><span id="local-6989586621679118842"><span class="annot"><a href="#local-6989586621679118842"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679118842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679118842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679118842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="local-6989586621679118843"><span class="annot"><a href="Musicology.IO.MidiFile.html#queue"><span class="hs-identifier hs-type">queue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Resolver"><span class="hs-identifier hs-type">Resolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118843"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-139"></span><span id="queue"><span class="annot"><span class="annottext">queue :: forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Musicology.IO.MidiFile.html#queue"><span class="hs-identifier hs-var hs-var">queue</span></a></span></span><span> </span><span id="local-6989586621679118845"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118845"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679118846"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118846"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118845"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118846"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621679118847"><span class="annot"><a href="Musicology.IO.MidiFile.html#stack"><span class="hs-identifier hs-type">stack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Resolver"><span class="hs-identifier hs-type">Resolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118847"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-142"></span><span id="stack"><span class="annot"><span class="annottext">stack :: forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Musicology.IO.MidiFile.html#stack"><span class="hs-identifier hs-var hs-var">stack</span></a></span></span><span> </span><span id="local-6989586621679118849"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118849"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679118850"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118850"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118850"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679118849"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">data</span><span> </span><span id="OnVal"><span class="annot"><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-var">OnVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OnVal"><span class="annot"><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-var">OnVal</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ovNowT"><span class="annot"><span class="annottext">OnVal -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#ovNowT"><span class="hs-identifier hs-var hs-var">ovNowT</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovNowW"><span class="annot"><span class="annottext">OnVal -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#ovNowW"><span class="hs-identifier hs-var hs-var">ovNowW</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovNowS"><span class="annot"><span class="annottext">OnVal -&gt; Double
</span><a href="Musicology.IO.MidiFile.html#ovNowS"><span class="hs-identifier hs-var hs-var">ovNowS</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovVel"><span class="annot"><span class="annottext">OnVal -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#ovVel"><span class="hs-identifier hs-var hs-var">ovVel</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovKeySig"><span class="annot"><span class="annottext">OnVal -&gt; Message
</span><a href="Musicology.IO.MidiFile.html#ovKeySig"><span class="hs-identifier hs-var hs-var">ovKeySig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovBar"><span class="annot"><span class="annottext">OnVal -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#ovBar"><span class="hs-identifier hs-var hs-var">ovBar</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovBeat"><span class="annot"><span class="annottext">OnVal -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#ovBeat"><span class="hs-identifier hs-var hs-var">ovBeat</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ovSubbeat"><span class="annot"><span class="annottext">OnVal -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#ovSubbeat"><span class="hs-identifier hs-var hs-var">ovSubbeat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span class="hs-keyword">type</span><span> </span><span id="Ons"><span class="annot"><a href="Musicology.IO.MidiFile.html#Ons"><span class="hs-identifier hs-var">Ons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-type">OnVal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span class="hs-keyword">type</span><span> </span><span id="Coeffs"><span class="annot"><a href="Musicology.IO.MidiFile.html#Coeffs"><span class="hs-identifier hs-var">Coeffs</span></a></span></span><span> </span><span id="local-6989586621679118860"><span class="annot"><a href="#local-6989586621679118860"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679118860"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679118860"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">data</span><span> </span><span id="MidiState"><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-var">MidiState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MidiState"><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-var">MidiState</span></a></span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="msOns"><span class="annot"><span class="annottext">MidiState -&gt; Ons
</span><a href="Musicology.IO.MidiFile.html#msOns"><span class="hs-identifier hs-var hs-var">msOns</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Ons"><span class="hs-identifier hs-type">Ons</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msWCoeffs"><span class="annot"><span class="annottext">MidiState -&gt; Coeffs (Ratio Int)
</span><a href="Musicology.IO.MidiFile.html#msWCoeffs"><span class="hs-identifier hs-var hs-var">msWCoeffs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Coeffs"><span class="hs-identifier hs-type">Coeffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msSCoeffs"><span class="annot"><span class="annottext">MidiState -&gt; Coeffs Double
</span><a href="Musicology.IO.MidiFile.html#msSCoeffs"><span class="hs-identifier hs-var hs-var">msSCoeffs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Coeffs"><span class="hs-identifier hs-type">Coeffs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msBarOff"><span class="annot"><span class="annottext">MidiState -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#msBarOff"><span class="hs-identifier hs-var hs-var">msBarOff</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msBarRef"><span class="annot"><span class="annottext">MidiState -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#msBarRef"><span class="hs-identifier hs-var hs-var">msBarRef</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msBarLen"><span class="annot"><span class="annottext">MidiState -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#msBarLen"><span class="hs-identifier hs-var hs-var">msBarLen</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="msBeatLen"><span class="annot"><span class="annottext">MidiState -&gt; Ratio Int
</span><a href="Musicology.IO.MidiFile.html#msBeatLen"><span class="hs-identifier hs-var hs-var">msBeatLen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ratio</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#eventsToNotes"><span class="hs-identifier hs-type">eventsToNotes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ticks</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeDiv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#Resolver"><span class="hs-identifier hs-type">Resolver</span></a></span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-type">OnVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span id="eventsToNotes"><span class="annot"><span class="annottext">eventsToNotes :: [PrepEv Int] -&gt; TimeDiv -&gt; Resolver OnVal -&gt; [MidiNote]
</span><a href="Musicology.IO.MidiFile.html#eventsToNotes"><span class="hs-identifier hs-var hs-var">eventsToNotes</span></a></span></span><span> </span><span id="local-6989586621679118870"><span class="annot"><span class="annottext">[PrepEv Int]
</span><a href="#local-6989586621679118870"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679118871"><span class="annot"><span class="annottext">TimeDiv
</span><a href="#local-6989586621679118871"><span class="hs-identifier hs-var">tdiv</span></a></span></span><span> </span><span id="local-6989586621679118872"><span class="annot"><span class="annottext">Resolver OnVal
</span><a href="#local-6989586621679118872"><span class="hs-identifier hs-var">insNote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MidiNote -&gt; (Int, Int, Int)) -&gt; [MidiNote] -&gt; [MidiNote]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">MidiNote -&gt; (Int, Int, Int)
</span><a href="#local-6989586621679118873"><span class="hs-identifier hs-var">sorting</span></a></span><span> </span><span class="annot"><span class="annottext">[MidiNote]
</span><a href="#local-6989586621679118874"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118874"><span class="annot"><span class="annottext">notes :: [MidiNote]
</span><a href="#local-6989586621679118874"><span class="hs-identifier hs-var hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe MidiNote] -&gt; [MidiNote]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe MidiNote] -&gt; [MidiNote]) -&gt; [Maybe MidiNote] -&gt; [MidiNote]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MidiState, [Maybe MidiNote]) -&gt; [Maybe MidiNote]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((MidiState, [Maybe MidiNote]) -&gt; [Maybe MidiNote])
-&gt; (MidiState, [Maybe MidiNote]) -&gt; [Maybe MidiNote]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MidiState -&gt; PrepEv Int -&gt; (MidiState, Maybe MidiNote))
-&gt; MidiState -&gt; [PrepEv Int] -&gt; (MidiState, [Maybe MidiNote])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">MidiState -&gt; PrepEv Int -&gt; (MidiState, Maybe MidiNote)
</span><a href="#local-6989586621679118875"><span class="hs-identifier hs-var">nextEv</span></a></span><span> </span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118876"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[PrepEv Int]
</span><a href="#local-6989586621679118870"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621679118873"><span class="annot"><span class="annottext">sorting :: MidiNote -&gt; (Int, Int, Int)
</span><a href="#local-6989586621679118873"><span class="hs-identifier hs-var hs-var">sorting</span></a></span></span><span> </span><span id="local-6989586621679118877"><span class="annot"><span class="annottext">MidiNote
</span><a href="#local-6989586621679118877"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_onsetTicks"><span class="hs-identifier hs-var">_onsetTicks</span></a></span><span> </span><span class="annot"><span class="annottext">MidiNote
</span><a href="#local-6989586621679118877"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_trackNum"><span class="hs-identifier hs-var">_trackNum</span></a></span><span> </span><span class="annot"><span class="annottext">MidiNote
</span><a href="#local-6989586621679118877"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MidiNote -&gt; Int
</span><a href="Musicology.IO.MidiFile.html#_channel"><span class="hs-identifier hs-var">_channel</span></a></span><span> </span><span class="annot"><span class="annottext">MidiNote
</span><a href="#local-6989586621679118877"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679118899"><span class="annot"><span class="annottext">toTime :: a -&gt; (b, b) -&gt; b
</span><a href="#local-6989586621679118899"><span class="hs-identifier hs-var hs-var">toTime</span></a></span></span><span> </span><span id="local-6989586621679118900"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118900"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679118901"><span class="annot"><span class="annottext">(b, b)
</span><a href="#local-6989586621679118901"><span class="hs-identifier hs-var">coeffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118900"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(b, b)
</span><a href="#local-6989586621679118901"><span class="hs-identifier hs-var">coeffs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b, b) -&gt; b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(b, b)
</span><a href="#local-6989586621679118901"><span class="hs-identifier hs-var">coeffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>        </span><span id="local-6989586621679118920"><span class="annot"><span class="annottext">newCoeffs :: a -&gt; b -&gt; b -&gt; (b, b)
</span><a href="#local-6989586621679118920"><span class="hs-identifier hs-var hs-var">newCoeffs</span></a></span></span><span> </span><span id="local-6989586621679118921"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118921"><span class="hs-identifier hs-var">tks</span></a></span></span><span> </span><span id="local-6989586621679118922"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679118922"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span id="local-6989586621679118923"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679118923"><span class="hs-identifier hs-var">ratio</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679118922"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679118923"><span class="hs-identifier hs-var">ratio</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679118921"><span class="hs-identifier hs-var">tks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679118923"><span class="hs-identifier hs-var">ratio</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621679118924"><span class="annot"><span class="annottext">initRatios :: (Ratio Int, Double)
</span><a href="#local-6989586621679118924"><span class="hs-identifier hs-var hs-var">initRatios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeDiv -&gt; Int -&gt; (Ratio Int, Double)
</span><a href="Musicology.IO.MidiFile.html#timeRatios"><span class="hs-identifier hs-var">timeRatios</span></a></span><span> </span><span class="annot"><span class="annottext">TimeDiv
</span><a href="#local-6989586621679118871"><span class="hs-identifier hs-var">tdiv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500000</span></span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621679118876"><span class="annot"><span class="annottext">init :: MidiState
</span><a href="#local-6989586621679118876"><span class="hs-identifier hs-var hs-var">init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ons
-&gt; Coeffs (Ratio Int)
-&gt; Coeffs Double
-&gt; Ratio Int
-&gt; Int
-&gt; Ratio Int
-&gt; Ratio Int
-&gt; MidiState
</span><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-var">MidiState</span></a></span><span> </span><span class="annot"><span class="annottext">Ons
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">M.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Ratio Int, Double) -&gt; Ratio Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int, Double)
</span><a href="#local-6989586621679118924"><span class="hs-identifier hs-var">initRatios</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Ratio Int, Double) -&gt; Double
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int, Double)
</span><a href="#local-6989586621679118924"><span class="hs-identifier hs-var">initRatios</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><a href="#local-6989586621679118875"><span class="hs-identifier hs-type">nextEv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-type">MidiState</span></a></span><span>
</span><span id="line-176"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#PrepEv"><span class="hs-identifier hs-type">PrepEv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ticks</span></span><span>
</span><span id="line-177"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-type">MidiState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621679118875"><span class="annot"><span class="annottext">nextEv :: MidiState -&gt; PrepEv Int -&gt; (MidiState, Maybe MidiNote)
</span><a href="#local-6989586621679118875"><span class="hs-identifier hs-var hs-var">nextEv</span></a></span></span><span>
</span><span id="line-179"></span><span>          </span><span id="local-6989586621679118926"><span class="annot"><span class="annottext">st :: MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-type">MidiState</span></a></span><span> </span><span id="local-6989586621679118927"><span class="annot"><span class="annottext">Ons
</span><a href="#local-6989586621679118927"><span class="hs-identifier hs-var">ons</span></a></span></span><span> </span><span id="local-6989586621679118928"><span class="annot"><span class="annottext">Coeffs (Ratio Int)
</span><a href="#local-6989586621679118928"><span class="hs-identifier hs-var">wcoeffs</span></a></span></span><span> </span><span id="local-6989586621679118929"><span class="annot"><span class="annottext">Coeffs Double
</span><a href="#local-6989586621679118929"><span class="hs-identifier hs-var">scoeffs</span></a></span></span><span> </span><span id="local-6989586621679118930"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118930"><span class="hs-identifier hs-var">baroff</span></a></span></span><span> </span><span id="local-6989586621679118931"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118931"><span class="hs-identifier hs-var">barref</span></a></span></span><span> </span><span id="local-6989586621679118932"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118932"><span class="hs-identifier hs-var">barlen</span></a></span></span><span> </span><span id="local-6989586621679118933"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118933"><span class="hs-identifier hs-var">beatlen</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679118934"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118934"><span class="hs-identifier hs-var">trackid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118935"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118935"><span class="hs-identifier hs-var">keysig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679118936"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118936"><span class="hs-identifier hs-var">nowt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118937"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118937"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; (MidiState, Maybe MidiNote)
</span><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118937"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-182"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118939"><span class="annot"><span class="annottext">noww :: Ratio Int
</span><a href="#local-6989586621679118939"><span class="hs-identifier hs-var hs-var">noww</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Coeffs (Ratio Int) -&gt; Ratio Int
forall {a} {b}. (Integral a, Num b) =&gt; a -&gt; (b, b) -&gt; b
</span><a href="#local-6989586621679118899"><span class="hs-identifier hs-var">toTime</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118936"><span class="hs-identifier hs-var">nowt</span></a></span><span> </span><span class="annot"><span class="annottext">Coeffs (Ratio Int)
</span><a href="#local-6989586621679118928"><span class="hs-identifier hs-var">wcoeffs</span></a></span><span>
</span><span id="line-183"></span><span>                </span><span id="local-6989586621679118940"><span class="annot"><span class="annottext">nows :: Double
</span><a href="#local-6989586621679118940"><span class="hs-identifier hs-var hs-var">nows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Coeffs Double -&gt; Double
forall {a} {b}. (Integral a, Num b) =&gt; a -&gt; (b, b) -&gt; b
</span><a href="#local-6989586621679118899"><span class="hs-identifier hs-var">toTime</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118936"><span class="hs-identifier hs-var">nowt</span></a></span><span> </span><span class="annot"><span class="annottext">Coeffs Double
</span><a href="#local-6989586621679118929"><span class="hs-identifier hs-var">scoeffs</span></a></span><span>
</span><span id="line-184"></span><span>                </span><span id="local-6989586621679118941"><span class="annot"><span class="annottext">relbar :: Ratio Int
</span><a href="#local-6989586621679118941"><span class="hs-identifier hs-var hs-var">relbar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118939"><span class="hs-identifier hs-var">noww</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Ratio Int -&gt; Ratio Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118930"><span class="hs-identifier hs-var">baroff</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Ratio Int -&gt; Ratio Int
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118932"><span class="hs-identifier hs-var">barlen</span></a></span><span>
</span><span id="line-185"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679118942"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118942"><span class="hs-identifier hs-var">rawbar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118943"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118943"><span class="hs-identifier hs-var">inbar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; (Int, Ratio Int)
forall b. Integral b =&gt; Ratio Int -&gt; (b, Ratio Int)
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; (b, a)
</span><span class="hs-identifier hs-var">properFraction</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118941"><span class="hs-identifier hs-var">relbar</span></a></span><span>
</span><span id="line-186"></span><span>                </span><span id="local-6989586621679118945"><span class="annot"><span class="annottext">nowbar :: Int
</span><a href="#local-6989586621679118945"><span class="hs-identifier hs-var hs-var">nowbar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118931"><span class="hs-identifier hs-var">barref</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118942"><span class="hs-identifier hs-var">rawbar</span></a></span><span>
</span><span id="line-187"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679118946"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118946"><span class="hs-identifier hs-var">nowbeat</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679118947"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118947"><span class="hs-identifier hs-var">nowsubb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; (Int, Ratio Int)
forall b. Integral b =&gt; Ratio Int -&gt; (b, Ratio Int)
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; (b, a)
</span><span class="hs-identifier hs-var">properFraction</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int -&gt; (Int, Ratio Int)) -&gt; Ratio Int -&gt; (Int, Ratio Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118943"><span class="hs-identifier hs-var">inbar</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Ratio Int -&gt; Ratio Int
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118933"><span class="hs-identifier hs-var">beatlen</span></a></span><span>
</span><span id="line-188"></span><span>                </span><span>
</span><span id="line-189"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-type">processMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiState"><span class="hs-identifier hs-type">MidiState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>                </span><span id="local-6989586621679118938"><span class="annot"><span class="annottext">processMsg :: Message -&gt; (MidiState, Maybe MidiNote)
</span><a href="#local-6989586621679118938"><span class="hs-identifier hs-var hs-var">processMsg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TempoChange</span></span><span> </span><span id="local-6989586621679118949"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118949"><span class="hs-identifier hs-var">tempo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118950"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118951"><span class="annot"><span class="annottext">ratios :: (Ratio Int, Double)
</span><a href="#local-6989586621679118951"><span class="hs-identifier hs-var hs-var">ratios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeDiv -&gt; Int -&gt; (Ratio Int, Double)
</span><a href="Musicology.IO.MidiFile.html#timeRatios"><span class="hs-identifier hs-var">timeRatios</span></a></span><span> </span><span class="annot"><span class="annottext">TimeDiv
</span><a href="#local-6989586621679118871"><span class="hs-identifier hs-var">tdiv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118949"><span class="hs-identifier hs-var">tempo</span></a></span><span>
</span><span id="line-193"></span><span>                        </span><span id="local-6989586621679118950"><span class="annot"><span class="annottext">st' :: MidiState
</span><a href="#local-6989586621679118950"><span class="hs-identifier hs-var hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msWCoeffs"><span class="hs-identifier hs-var">msWCoeffs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118920"><span class="hs-identifier hs-type">newCoeffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118936"><span class="hs-identifier hs-type">nowt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118939"><span class="hs-identifier hs-type">noww</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621679118951"><span class="hs-identifier hs-type">ratios</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msSCoeffs"><span class="hs-identifier hs-var">msSCoeffs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118920"><span class="hs-identifier hs-type">newCoeffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118936"><span class="hs-identifier hs-type">nowt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679118940"><span class="hs-identifier hs-type">nows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><a href="#local-6989586621679118951"><span class="hs-identifier hs-type">ratios</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TimeSignature</span></span><span> </span><span id="local-6989586621679118953"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118953"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span id="local-6989586621679118954"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118954"><span class="hs-identifier hs-var">den</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118955"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118956"><span class="annot"><span class="annottext">ref' :: Int
</span><a href="#local-6989586621679118956"><span class="hs-identifier hs-var hs-var">ref'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118943"><span class="hs-identifier hs-var">inbar</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Ratio Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118945"><span class="hs-identifier hs-var">nowbar</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118945"><span class="hs-identifier hs-var">nowbar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-198"></span><span>                        </span><span id="local-6989586621679118957"><span class="annot"><span class="annottext">denom :: Int
</span><a href="#local-6989586621679118957"><span class="hs-identifier hs-var hs-var">denom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118954"><span class="hs-identifier hs-var">den</span></a></span><span> </span><span class="hs-comment">-- by MIDI standard, denom is encoded as exponent of 2</span><span>
</span><span id="line-199"></span><span>                        </span><span id="local-6989586621679118955"><span class="annot"><span class="annottext">st' :: MidiState
</span><a href="#local-6989586621679118955"><span class="hs-identifier hs-var hs-var">st'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msBarOff"><span class="hs-identifier hs-var">msBarOff</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118939"><span class="hs-identifier hs-type">noww</span></a></span><span>
</span><span id="line-200"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msBarRef"><span class="hs-identifier hs-var">msBarRef</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118956"><span class="hs-identifier hs-type">ref'</span></a></span><span>
</span><span id="line-201"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msBarLen"><span class="hs-identifier hs-var">msBarLen</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118953"><span class="hs-identifier hs-type">num</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><a href="#local-6989586621679118957"><span class="hs-identifier hs-type">denom</span></a></span><span>
</span><span id="line-202"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msBeatLen"><span class="hs-identifier hs-var">msBeatLen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><a href="#local-6989586621679118957"><span class="hs-identifier hs-type">denom</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoteOn</span></span><span> </span><span id="local-6989586621679118960"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118960"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679118961"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118961"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; (MidiState, Maybe MidiNote)
</span><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; (MidiState, Maybe MidiNote))
-&gt; Message -&gt; (MidiState, Maybe MidiNote)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Message
</span><span class="hs-identifier hs-var">NoteOff</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118960"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118961"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoteOn</span></span><span> </span><span id="local-6989586621679118963"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118963"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679118964"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118964"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679118965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118965"><span class="hs-identifier hs-var">vel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msOns"><span class="hs-identifier hs-var">msOns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118966"><span class="hs-identifier hs-type">ons'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118967"><span class="annot"><span class="annottext">nKey :: (Int, Int, Int)
</span><a href="#local-6989586621679118967"><span class="hs-identifier hs-var hs-var">nKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118934"><span class="hs-identifier hs-var">trackid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118963"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118964"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                        </span><span id="local-6989586621679118968"><span class="annot"><span class="annottext">nVal :: OnVal
</span><a href="#local-6989586621679118968"><span class="hs-identifier hs-var hs-var">nVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Ratio Int
-&gt; Double
-&gt; Int
-&gt; Message
-&gt; Int
-&gt; Int
-&gt; Ratio Int
-&gt; OnVal
</span><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-var">OnVal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118936"><span class="hs-identifier hs-var">nowt</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118939"><span class="hs-identifier hs-var">noww</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118940"><span class="hs-identifier hs-var">nows</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118965"><span class="hs-identifier hs-var">vel</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679118935"><span class="hs-identifier hs-var">keysig</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118945"><span class="hs-identifier hs-var">nowbar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118946"><span class="hs-identifier hs-var">nowbeat</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118947"><span class="hs-identifier hs-var">nowsubb</span></a></span><span>
</span><span id="line-209"></span><span>                        </span><span id="local-6989586621679118966"><span class="annot"><span class="annottext">ons' :: Ons
</span><a href="#local-6989586621679118966"><span class="hs-identifier hs-var hs-var">ons'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Resolver OnVal -&gt; (Int, Int, Int) -&gt; [OnVal] -&gt; Ons -&gt; Ons
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Resolver OnVal
</span><a href="#local-6989586621679118872"><span class="hs-identifier hs-var">insNote</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679118967"><span class="hs-identifier hs-var">nKey</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OnVal
</span><a href="#local-6989586621679118968"><span class="hs-identifier hs-var">nVal</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Ons
</span><a href="#local-6989586621679118927"><span class="hs-identifier hs-var">ons</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoteOff</span></span><span> </span><span id="local-6989586621679118970"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118970"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679118971"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118971"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679118972"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118972"><span class="hs-identifier hs-var">vel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#msOns"><span class="hs-identifier hs-var">msOns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679118973"><span class="hs-identifier hs-type">ons'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
</span><a href="#local-6989586621679118974"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679118975"><span class="annot"><span class="annottext">nKey :: (Int, Int, Int)
</span><a href="#local-6989586621679118975"><span class="hs-identifier hs-var hs-var">nKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118934"><span class="hs-identifier hs-var">trackid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118970"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118971"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>                        </span><span id="local-6989586621679118976"><span class="annot"><span class="annottext">open :: [OnVal]
</span><a href="#local-6989586621679118976"><span class="hs-identifier hs-var hs-var">open</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OnVal] -&gt; (Int, Int, Int) -&gt; Ons -&gt; [OnVal]
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">M.lookupDefault</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679118975"><span class="hs-identifier hs-var">nKey</span></a></span><span> </span><span class="annot"><span class="annottext">Ons
</span><a href="#local-6989586621679118927"><span class="hs-identifier hs-var">ons</span></a></span><span>
</span><span id="line-214"></span><span>                        </span><span id="local-6989586621679118974"><span class="annot"><span class="annottext">note :: Maybe MidiNote
</span><a href="#local-6989586621679118974"><span class="hs-identifier hs-var hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[OnVal]
</span><a href="#local-6989586621679118976"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>                                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-216"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><a href="Musicology.IO.MidiFile.html#OnVal"><span class="hs-identifier hs-type">OnVal</span></a></span><span> </span><span id="local-6989586621679118978"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118978"><span class="hs-identifier hs-var">ont</span></a></span></span><span> </span><span id="local-6989586621679118979"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118979"><span class="hs-identifier hs-var">onw</span></a></span></span><span> </span><span id="local-6989586621679118980"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118980"><span class="hs-identifier hs-var">ons</span></a></span></span><span> </span><span id="local-6989586621679118981"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118981"><span class="hs-identifier hs-var">onvel</span></a></span></span><span>
</span><span id="line-217"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeySignature</span></span><span> </span><span id="local-6989586621679118982"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118982"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621679118983"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118983"><span class="hs-identifier hs-var">mode</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679118984"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118984"><span class="hs-identifier hs-var">bar</span></a></span></span><span> </span><span id="local-6989586621679118985"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118985"><span class="hs-identifier hs-var">beat</span></a></span></span><span> </span><span id="local-6989586621679118986"><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118986"><span class="hs-identifier hs-var">subb</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[OnVal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>                                   </span><span class="annot"><span class="annottext">MidiNote -&gt; Maybe MidiNote
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MidiNote -&gt; Maybe MidiNote) -&gt; MidiNote -&gt; Maybe MidiNote
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Ratio Int
-&gt; Ratio Int
-&gt; Double
-&gt; Double
-&gt; MidiPitch
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Bool
-&gt; Int
-&gt; Int
-&gt; Ratio Int
-&gt; MidiNote
</span><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-var">MidiNote</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118978"><span class="hs-identifier hs-var">ont</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118936"><span class="hs-identifier hs-var">nowt</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118979"><span class="hs-identifier hs-var">onw</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118939"><span class="hs-identifier hs-var">noww</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118980"><span class="hs-identifier hs-var">ons</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679118940"><span class="hs-identifier hs-var">nows</span></a></span><span>
</span><span id="line-219"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; MidiPitch
forall {a}. a -&gt; Pitch a
</span><span class="hs-identifier hs-var">toPitch</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118971"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118981"><span class="hs-identifier hs-var">onvel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118934"><span class="hs-identifier hs-var">trackid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118970"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118982"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118983"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118984"><span class="hs-identifier hs-var">bar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679118985"><span class="hs-identifier hs-var">beat</span></a></span><span> </span><span class="annot"><span class="annottext">Ratio Int
</span><a href="#local-6989586621679118986"><span class="hs-identifier hs-var">subb</span></a></span><span>
</span><span id="line-220"></span><span>                        </span><span id="local-6989586621679118973"><span class="annot"><span class="annottext">ons' :: Ons
</span><a href="#local-6989586621679118973"><span class="hs-identifier hs-var hs-var">ons'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[OnVal]
</span><a href="#local-6989586621679118976"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-221"></span><span>                                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ons
</span><a href="#local-6989586621679118927"><span class="hs-identifier hs-var">ons</span></a></span><span>
</span><span id="line-222"></span><span>                                 </span><span class="annot"><span class="annottext">OnVal
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679118988"><span class="annot"><span class="annottext">[OnVal]
</span><a href="#local-6989586621679118988"><span class="hs-identifier hs-var">rst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; [OnVal] -&gt; Ons -&gt; Ons
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int)
</span><a href="#local-6989586621679118975"><span class="hs-identifier hs-var">nKey</span></a></span><span> </span><span class="annot"><span class="annottext">[OnVal]
</span><a href="#local-6989586621679118988"><span class="hs-identifier hs-var">rst</span></a></span><span> </span><span class="annot"><span class="annottext">Ons
</span><a href="#local-6989586621679118927"><span class="hs-identifier hs-var">ons</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>                </span><span class="annot"><a href="#local-6989586621679118938"><span class="hs-identifier hs-var">processMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MidiState
</span><a href="#local-6989586621679118926"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MidiNote
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- processNotes :: Monad m =&gt; TimeDiv -&gt; Resolver OnVal -&gt; Pipe (PrepEv Ticks) MidiNote m ()</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- processNotes = undefined</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#notesToFrame"><span class="hs-identifier hs-type">notesToFrame</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiNote"><span class="hs-identifier hs-type">MidiNote</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Frame</span></span><span> </span><span class="annot"><a href="Musicology.IO.MidiFile.html#MidiRecord"><span class="hs-identifier hs-type">MidiRecord</span></a></span><span>
</span><span id="line-230"></span><span id="notesToFrame"><span class="annot"><span class="annottext">notesToFrame :: [MidiNote] -&gt; Frame MidiRecord
</span><a href="Musicology.IO.MidiFile.html#notesToFrame"><span class="hs-identifier hs-var hs-var">notesToFrame</span></a></span></span><span> </span><span id="local-6989586621679118991"><span class="annot"><span class="annottext">[MidiNote]
</span><a href="#local-6989586621679118991"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MidiRecord] -&gt; Frame MidiRecord
forall (f :: * -&gt; *) (rs :: [(Symbol, *)]).
(Foldable f, RecVec rs) =&gt;
f (Record rs) -&gt; Frame (Record rs)
</span><span class="hs-identifier hs-var">toFrame</span></span><span> </span><span class="annot"><span class="annottext">([MidiRecord] -&gt; Frame MidiRecord)
-&gt; [MidiRecord] -&gt; Frame MidiRecord
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MidiNote -&gt; MidiRecord) -&gt; [MidiNote] -&gt; [MidiRecord]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MidiNote -&gt; MidiRecord
</span><a href="Musicology.IO.MidiFile.html#midiNoteToRecord"><span class="hs-identifier hs-var">midiNoteToRecord</span></a></span><span> </span><span class="annot"><span class="annottext">[MidiNote]
</span><a href="#local-6989586621679118991"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#midiTracks"><span class="hs-identifier hs-type">midiTracks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Track</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ticks</span></span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span id="midiTracks"><span class="annot"><span class="annottext">midiTracks :: String -&gt; IO [Track Int]
</span><a href="Musicology.IO.MidiFile.html#midiTracks"><span class="hs-identifier hs-var hs-var">midiTracks</span></a></span></span><span> </span><span id="local-6989586621679118995"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679118995"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621679118996"><span class="annot"><span class="annottext">Either String Midi
</span><a href="#local-6989586621679118996"><span class="hs-identifier hs-var">midi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Either String Midi)
</span><span class="hs-identifier hs-var">importFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679118995"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either String Midi
</span><a href="#local-6989586621679118996"><span class="hs-identifier hs-var">midi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Track Int] -&gt; IO [Track Int]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679118998"><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679118998"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Track Int] -&gt; IO [Track Int]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([Track Int] -&gt; IO [Track Int]) -&gt; [Track Int] -&gt; IO [Track Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Midi -&gt; [Track Int]
</span><span class="hs-identifier hs-var">tracks</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679118998"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span id="midiLoadEvs"><span class="annot"><span class="annottext">midiLoadEvs :: String -&gt; IO [PrepEv Int]
</span><a href="Musicology.IO.MidiFile.html#midiLoadEvs"><span class="hs-identifier hs-var hs-var">midiLoadEvs</span></a></span></span><span> </span><span id="local-6989586621679119002"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119002"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO (Either String Midi)
</span><span class="hs-identifier hs-var">importFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119002"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either String Midi)
-&gt; (Either String Midi -&gt; IO [PrepEv Int]) -&gt; IO [PrepEv Int]
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[PrepEv Int] -&gt; IO [PrepEv Int]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([PrepEv Int] -&gt; IO [PrepEv Int])
-&gt; (Either String Midi -&gt; [PrepEv Int])
-&gt; Either String Midi
-&gt; IO [PrepEv Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [PrepEv Int])
-&gt; (Midi -&gt; [PrepEv Int]) -&gt; Either String Midi -&gt; [PrepEv Int]
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PrepEv Int] -&gt; String -&gt; [PrepEv Int]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Midi -&gt; [PrepEv Int]
</span><a href="Musicology.IO.MidiFile.html#midiEvents"><span class="hs-identifier hs-var">midiEvents</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span id="midiLoadNotes"><span class="annot"><span class="annottext">midiLoadNotes :: String -&gt; IO [MidiNote]
</span><a href="Musicology.IO.MidiFile.html#midiLoadNotes"><span class="hs-identifier hs-var hs-var">midiLoadNotes</span></a></span></span><span> </span><span id="local-6989586621679119008"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119008"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO (Either String Midi)
</span><span class="hs-identifier hs-var">importFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119008"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either String Midi)
-&gt; (Either String Midi -&gt; IO [MidiNote]) -&gt; IO [MidiNote]
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[MidiNote] -&gt; IO [MidiNote]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([MidiNote] -&gt; IO [MidiNote])
-&gt; (Either String Midi -&gt; [MidiNote])
-&gt; Either String Midi
-&gt; IO [MidiNote]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [MidiNote])
-&gt; (Midi -&gt; [MidiNote]) -&gt; Either String Midi -&gt; [MidiNote]
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MidiNote] -&gt; String -&gt; [MidiNote]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Midi -&gt; [MidiNote]
</span><a href="#local-6989586621679119009"><span class="hs-identifier hs-var">loadNotes</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679119009"><span class="annot"><span class="annottext">loadNotes :: Midi -&gt; [MidiNote]
</span><a href="#local-6989586621679119009"><span class="hs-identifier hs-var hs-var">loadNotes</span></a></span></span><span> </span><span id="local-6989586621679119010"><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119010"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">[PrepEv Int] -&gt; TimeDiv -&gt; Resolver OnVal -&gt; [MidiNote]
</span><a href="Musicology.IO.MidiFile.html#eventsToNotes"><span class="hs-identifier hs-var">eventsToNotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; [PrepEv Int]
</span><a href="Musicology.IO.MidiFile.html#midiEvents"><span class="hs-identifier hs-var">midiEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119010"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; TimeDiv
</span><span class="hs-identifier hs-var">timeDiv</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119010"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Resolver OnVal
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Musicology.IO.MidiFile.html#queue"><span class="hs-identifier hs-var">queue</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span id="pieceBarlen"><span class="annot"><span class="annottext">pieceBarlen :: String -&gt; IO (Ratio Int)
</span><a href="Musicology.IO.MidiFile.html#pieceBarlen"><span class="hs-identifier hs-var hs-var">pieceBarlen</span></a></span></span><span> </span><span id="local-6989586621679119018"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119018"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO (Either String Midi)
</span><span class="hs-identifier hs-var">importFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119018"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either String Midi)
-&gt; (Either String Midi -&gt; IO (Ratio Int)) -&gt; IO (Ratio Int)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; IO (Ratio Int)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int -&gt; IO (Ratio Int))
-&gt; (Either String Midi -&gt; Ratio Int)
-&gt; Either String Midi
-&gt; IO (Ratio Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Ratio Int)
-&gt; (Midi -&gt; Ratio Int) -&gt; Either String Midi -&gt; Ratio Int
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ratio Int -&gt; String -&gt; Ratio Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int -&gt; String -&gt; Ratio Int)
-&gt; Ratio Int -&gt; String -&gt; Ratio Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Midi -&gt; Ratio Int
</span><a href="#local-6989586621679119019"><span class="hs-identifier hs-var">barlen</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679119019"><span class="annot"><span class="annottext">barlen :: Midi -&gt; Ratio Int
</span><a href="#local-6989586621679119019"><span class="hs-identifier hs-var hs-var">barlen</span></a></span></span><span> </span><span id="local-6989586621679119025"><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119025"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio Int
-&gt; (Ratio Int -&gt; Ratio Int) -&gt; Maybe (Ratio Int) -&gt; Ratio Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Ratio Int
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Track Int] -&gt; Maybe (Track Int)
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; [Track Int]
</span><span class="hs-identifier hs-var">tracks</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119025"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Track Int)
-&gt; (Track Int -&gt; Maybe (Ratio Int)) -&gt; Maybe (Ratio Int)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Track Int -&gt; Maybe (Ratio Int)
forall {a}. [(a, Message)] -&gt; Maybe (Ratio Int)
</span><a href="#local-6989586621679119028"><span class="hs-identifier hs-var">findTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679119028"><span class="annot"><span class="annottext">findTime :: [(a, Message)] -&gt; Maybe (Ratio Int)
</span><a href="#local-6989586621679119028"><span class="hs-identifier hs-var hs-var">findTime</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TimeSignature</span></span><span> </span><span id="local-6989586621679119033"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119033"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span id="local-6989586621679119034"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119034"><span class="hs-identifier hs-var">den</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(a, Message)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio Int -&gt; Maybe (Ratio Int)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Ratio Int -&gt; Maybe (Ratio Int)) -&gt; Ratio Int -&gt; Maybe (Ratio Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119033"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ratio Int
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119034"><span class="hs-identifier hs-var">den</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><a href="#local-6989586621679119028"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679119035"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679119035"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679119036"><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679119036"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Message)] -&gt; Maybe (Ratio Int)
</span><a href="#local-6989586621679119028"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679119036"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-252"></span><span>                </span><span class="annot"><a href="#local-6989586621679119028"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Message)]
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Ratio Int)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="pieceBeatlen"><span class="annot"><span class="annottext">pieceBeatlen :: String -&gt; IO (Ratio a)
</span><a href="Musicology.IO.MidiFile.html#pieceBeatlen"><span class="hs-identifier hs-var hs-var">pieceBeatlen</span></a></span></span><span> </span><span id="local-6989586621679119055"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119055"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO (Either String Midi)
</span><span class="hs-identifier hs-var">importFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119055"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either String Midi)
-&gt; (Either String Midi -&gt; IO (Ratio a)) -&gt; IO (Ratio a)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Ratio a -&gt; IO (Ratio a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Ratio a -&gt; IO (Ratio a))
-&gt; (Either String Midi -&gt; Ratio a)
-&gt; Either String Midi
-&gt; IO (Ratio a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Ratio a)
-&gt; (Midi -&gt; Ratio a) -&gt; Either String Midi -&gt; Ratio a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ratio a -&gt; String -&gt; Ratio a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Ratio a -&gt; String -&gt; Ratio a) -&gt; Ratio a -&gt; String -&gt; Ratio a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ratio a
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">a
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Midi -&gt; Ratio a
forall {a}. Integral a =&gt; Midi -&gt; Ratio a
</span><a href="#local-6989586621679119056"><span class="hs-identifier hs-var">barlen</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679119056"><span class="annot"><span class="annottext">barlen :: Midi -&gt; Ratio a
</span><a href="#local-6989586621679119056"><span class="hs-identifier hs-var hs-var">barlen</span></a></span></span><span> </span><span id="local-6989586621679119073"><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119073"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio a -&gt; (Ratio a -&gt; Ratio a) -&gt; Maybe (Ratio a) -&gt; Ratio a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ratio a
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span class="annot"><span class="annottext">a
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ratio a -&gt; Ratio a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Track Int] -&gt; Maybe (Track Int)
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; [Track Int]
</span><span class="hs-identifier hs-var">tracks</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679119073"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Track Int)
-&gt; (Track Int -&gt; Maybe (Ratio a)) -&gt; Maybe (Ratio a)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Track Int -&gt; Maybe (Ratio a)
forall {a} {a}. Integral a =&gt; [(a, Message)] -&gt; Maybe (Ratio a)
</span><a href="#local-6989586621679119074"><span class="hs-identifier hs-var">findTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679119074"><span class="annot"><span class="annottext">findTime :: [(a, Message)] -&gt; Maybe (Ratio a)
</span><a href="#local-6989586621679119074"><span class="hs-identifier hs-var hs-var">findTime</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TimeSignature</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679119091"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119091"><span class="hs-identifier hs-var">den</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(a, Message)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ratio a -&gt; Maybe (Ratio a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Ratio a -&gt; Maybe (Ratio a)) -&gt; Ratio a -&gt; Maybe (Ratio a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ratio a
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679119091"><span class="hs-identifier hs-var">den</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                </span><span class="annot"><a href="#local-6989586621679119074"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679119092"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679119092"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679119093"><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679119093"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Message)] -&gt; Maybe (Ratio a)
</span><a href="#local-6989586621679119074"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679119093"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-259"></span><span>                </span><span class="annot"><a href="#local-6989586621679119074"><span class="hs-identifier hs-var">findTime</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Message)]
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Ratio a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Musicology.IO.MidiFile.html#dirMidiPieces"><span class="hs-identifier hs-type">dirMidiPieces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span id="dirMidiPieces"><span class="annot"><span class="annottext">dirMidiPieces :: String -&gt; IO [String]
</span><a href="Musicology.IO.MidiFile.html#dirMidiPieces"><span class="hs-identifier hs-var hs-var">dirMidiPieces</span></a></span></span><span> </span><span id="local-6989586621679119095"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119095"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621679119096"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679119096"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [String]
</span><span class="hs-identifier hs-var">listDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679119095"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; IO [String]) -&gt; [String] -&gt; IO [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeBaseName</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; [String] -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; [String]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.mid&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; ShowS -&gt; String -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeExtension</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679119096"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-265"></span></pre></body></html>