<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, DataKinds, DeriveLift, FlexibleContexts, FlexibleInstances, GADTs,
             LambdaCase, OverloadedStrings, RankNTypes,
             ScopedTypeVariables, TemplateHaskell, TypeApplications,
             TypeOperators #-}</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Infer row types from comma-separated values (CSV) data and read</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- that data from files. Template Haskell is used to generate the</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- necessary types so that you can write type safe programs referring</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- to those types.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Frames.CSV</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IOException</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 808
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vinyl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">recordToList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Rec</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ElField</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RecordToList</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vinyl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RecMapMethod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rmapMethod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RMap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rmap</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vinyl.Class.Method</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PayloadType</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vinyl.Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Const</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Compose</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Frames.Col.html"><span class="hs-identifier">Frames.Col</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Frames.ColumnTypeable.html"><span class="hs-identifier">Frames.ColumnTypeable</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Frames.Rec.html"><span class="hs-identifier">Frames.Rec</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Frames.RecF.html"><span class="hs-identifier">Frames.RecF</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Frames.ShowCSV.html"><span class="hs-identifier">Frames.ShowCSV</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KnownSymbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pipes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&gt;-&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Parse</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Safe</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Safe.Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Safe</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IOMode</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReadMode</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">WriteMode</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- * Parsing</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">type</span><span> </span><span id="Separator"><span class="annot"><a href="Frames.CSV.html#Separator"><span class="hs-identifier hs-var">Separator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span id="QuoteChar"><span class="annot"><a href="Frames.CSV.html#QuoteChar"><span class="hs-identifier hs-var">QuoteChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="QuotingMode"><span class="annot"><a href="Frames.CSV.html#QuotingMode"><span class="hs-identifier hs-var">QuotingMode</span></a></span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">-- | No quoting enabled. The separator may not appear in values</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoQuoting"><span class="annot"><a href="Frames.CSV.html#NoQuoting"><span class="hs-identifier hs-var">NoQuoting</span></a></span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-comment">-- | Quoted values with the given quoting character. Quotes are escaped by doubling them.</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- Mostly RFC4180 compliant, except doesn't support newlines in values</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RFC4180Quoting"><span class="annot"><a href="Frames.CSV.html#RFC4180Quoting"><span class="hs-identifier hs-var">RFC4180Quoting</span></a></span></span><span> </span><span class="annot"><a href="Frames.CSV.html#QuoteChar"><span class="hs-identifier hs-type">QuoteChar</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679157582"><span id="local-6989586621679157584"><span class="annot"><span class="annottext">QuotingMode -&gt; QuotingMode -&gt; Bool
(QuotingMode -&gt; QuotingMode -&gt; Bool)
-&gt; (QuotingMode -&gt; QuotingMode -&gt; Bool) -&gt; Eq QuotingMode
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: QuotingMode -&gt; QuotingMode -&gt; Bool
$c/= :: QuotingMode -&gt; QuotingMode -&gt; Bool
== :: QuotingMode -&gt; QuotingMode -&gt; Bool
$c== :: QuotingMode -&gt; QuotingMode -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679157575"><span id="local-6989586621679157577"><span id="local-6989586621679157579"><span class="annot"><span class="annottext">Int -&gt; QuotingMode -&gt; ShowS
[QuotingMode] -&gt; ShowS
QuotingMode -&gt; String
(Int -&gt; QuotingMode -&gt; ShowS)
-&gt; (QuotingMode -&gt; String)
-&gt; ([QuotingMode] -&gt; ShowS)
-&gt; Show QuotingMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [QuotingMode] -&gt; ShowS
$cshowList :: [QuotingMode] -&gt; ShowS
show :: QuotingMode -&gt; String
$cshow :: QuotingMode -&gt; String
showsPrec :: Int -&gt; QuotingMode -&gt; ShowS
$cshowsPrec :: Int -&gt; QuotingMode -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679157570"><span id="local-6989586621679157572"><span class="annot"><span class="annottext">QuotingMode -&gt; Q Exp
QuotingMode -&gt; Q (TExp QuotingMode)
(QuotingMode -&gt; Q Exp)
-&gt; (QuotingMode -&gt; Q (TExp QuotingMode)) -&gt; Lift QuotingMode
forall t. (t -&gt; Q Exp) -&gt; (t -&gt; Q (TExp t)) -&gt; Lift t
liftTyped :: QuotingMode -&gt; Q (TExp QuotingMode)
$cliftTyped :: QuotingMode -&gt; Q (TExp QuotingMode)
lift :: QuotingMode -&gt; Q Exp
$clift :: QuotingMode -&gt; Q Exp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Lift</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">data</span><span> </span><span id="ParserOptions"><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-var">ParserOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ParserOptions"><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-var">ParserOptions</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="headerOverride"><span class="annot"><span class="annottext">ParserOptions -&gt; Maybe [Text]
</span><a href="Frames.CSV.html#headerOverride"><span class="hs-identifier hs-var hs-var">headerOverride</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span id="columnSeparator"><span class="annot"><span class="annottext">ParserOptions -&gt; Text
</span><a href="Frames.CSV.html#columnSeparator"><span class="hs-identifier hs-var hs-var">columnSeparator</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#Separator"><span class="hs-identifier hs-type">Separator</span></a></span><span>
</span><span id="line-59"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span id="quotingMode"><span class="annot"><span class="annottext">ParserOptions -&gt; QuotingMode
</span><a href="Frames.CSV.html#quotingMode"><span class="hs-identifier hs-var hs-var">quotingMode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#QuotingMode"><span class="hs-identifier hs-type">QuotingMode</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679157561"><span id="local-6989586621679157563"><span class="annot"><span class="annottext">ParserOptions -&gt; ParserOptions -&gt; Bool
(ParserOptions -&gt; ParserOptions -&gt; Bool)
-&gt; (ParserOptions -&gt; ParserOptions -&gt; Bool) -&gt; Eq ParserOptions
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ParserOptions -&gt; ParserOptions -&gt; Bool
$c/= :: ParserOptions -&gt; ParserOptions -&gt; Bool
== :: ParserOptions -&gt; ParserOptions -&gt; Bool
$c== :: ParserOptions -&gt; ParserOptions -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679157555"><span id="local-6989586621679157557"><span id="local-6989586621679157559"><span class="annot"><span class="annottext">Int -&gt; ParserOptions -&gt; ShowS
[ParserOptions] -&gt; ShowS
ParserOptions -&gt; String
(Int -&gt; ParserOptions -&gt; ShowS)
-&gt; (ParserOptions -&gt; String)
-&gt; ([ParserOptions] -&gt; ShowS)
-&gt; Show ParserOptions
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ParserOptions] -&gt; ShowS
$cshowList :: [ParserOptions] -&gt; ShowS
show :: ParserOptions -&gt; String
$cshow :: ParserOptions -&gt; String
showsPrec :: Int -&gt; ParserOptions -&gt; ShowS
$cshowsPrec :: Int -&gt; ParserOptions -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lift</span></span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621679157552"><span class="annot"><span class="annottext">lift :: ParserOptions -&gt; Q Exp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679157551"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157551"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span id="local-6989586621679157550"><span class="annot"><span class="annottext">QuotingMode
</span><a href="#local-6989586621679157550"><span class="hs-identifier hs-var">quoting</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">ParserOptions</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="">$sep'</span><span> </span><span class="">$quoting'</span><span class="hs-special">|]</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157549"><span class="annot"><span class="annottext">sep' :: Q Exp
</span><a href="#local-6989586621679157549"><span class="hs-identifier hs-var hs-var">sep'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">T.pack</span><span> </span><span class="hs-special">$(</span><span class="hs-identifier">stringE</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">T.unpack</span><span> </span><span class="hs-identifier">sep</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-65"></span><span>          </span><span id="local-6989586621679157548"><span class="annot"><span class="annottext">quoting' :: Q Exp
</span><a href="#local-6989586621679157548"><span class="hs-identifier hs-var hs-var">quoting'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QuotingMode -&gt; Q Exp
forall t. Lift t =&gt; t -&gt; Q Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">QuotingMode
</span><a href="#local-6989586621679157550"><span class="hs-identifier hs-var">quoting</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679157547"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157547"><span class="hs-identifier hs-var">hs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679157546"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157546"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span id="local-6989586621679157545"><span class="annot"><span class="annottext">QuotingMode
</span><a href="#local-6989586621679157545"><span class="hs-identifier hs-var">quoting</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">ParserOptions</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="">$hs'</span><span class="hs-special">)</span><span> </span><span class="">$sep'</span><span> </span><span class="">$quoting'</span><span class="hs-special">|]</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157544"><span class="annot"><span class="annottext">sep' :: Q Exp
</span><a href="#local-6989586621679157544"><span class="hs-identifier hs-var hs-var">sep'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">T.pack</span><span> </span><span class="hs-special">$(</span><span class="hs-identifier">stringE</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">T.unpack</span><span> </span><span class="hs-identifier">sep</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-68"></span><span>          </span><span id="local-6989586621679157543"><span class="annot"><span class="annottext">hs' :: Q Exp
</span><a href="#local-6989586621679157543"><span class="hs-identifier hs-var hs-var">hs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">T.pack</span><span> </span><span class="hs-special">$(</span><span class="hs-identifier">listE</span><span> </span><span class="hs-operator">$</span><span>  </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stringE</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">T.unpack</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">hs</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-69"></span><span>          </span><span id="local-6989586621679157542"><span class="annot"><span class="annottext">quoting' :: Q Exp
</span><a href="#local-6989586621679157542"><span class="hs-identifier hs-var hs-var">quoting'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QuotingMode -&gt; Q Exp
forall t. Lift t =&gt; t -&gt; Q Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">QuotingMode
</span><a href="#local-6989586621679157545"><span class="hs-identifier hs-var">quoting</span></a></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,16,0)
</span><span>  </span><span id="local-6989586621679157541"><span class="annot"><span class="annottext">liftTyped :: ParserOptions -&gt; Q (TExp ParserOptions)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">liftTyped</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q Exp -&gt; Q (TExp ParserOptions)
forall a. Q Exp -&gt; Q (TExp a)
</span><span class="hs-identifier hs-var">unsafeTExpCoerce</span></span><span> </span><span class="annot"><span class="annottext">(Q Exp -&gt; Q (TExp ParserOptions))
-&gt; (ParserOptions -&gt; Q Exp)
-&gt; ParserOptions
-&gt; Q (TExp ParserOptions)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Q Exp
forall t. Lift t =&gt; t -&gt; Q Exp
</span><span class="hs-identifier hs-var">lift</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Default 'ParseOptions' get column names from a header line, and</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- use commas to separate columns.</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-type">defaultParser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span>
</span><span id="line-77"></span><span id="defaultParser"><span class="annot"><span class="annottext">defaultParser :: ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var hs-var">defaultParser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Text] -&gt; Text -&gt; QuotingMode -&gt; ParserOptions
</span><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-var">ParserOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Frames.CSV.html#defaultSep"><span class="hs-identifier hs-var">defaultSep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteChar -&gt; QuotingMode
</span><a href="Frames.CSV.html#RFC4180Quoting"><span class="hs-identifier hs-var">RFC4180Quoting</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteChar
</span><span class="hs-char">'\&quot;'</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Default separator string.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Frames.CSV.html#defaultSep"><span class="hs-identifier hs-type">defaultSep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#Separator"><span class="hs-identifier hs-type">Separator</span></a></span><span>
</span><span id="line-81"></span><span id="defaultSep"><span class="annot"><span class="annottext">defaultSep :: Text
</span><a href="Frames.CSV.html#defaultSep"><span class="hs-identifier hs-var hs-var">defaultSep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Helper to split a 'T.Text' on commas and strip leading and</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- trailing whitespace from each resulting chunk.</span><span>
</span><span id="line-85"></span><span class="annot"><a href="Frames.CSV.html#tokenizeRow"><span class="hs-identifier hs-type">tokenizeRow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span id="tokenizeRow"><span class="annot"><span class="annottext">tokenizeRow :: ParserOptions -&gt; Text -&gt; [Text]
</span><a href="Frames.CSV.html#tokenizeRow"><span class="hs-identifier hs-var hs-var">tokenizeRow</span></a></span></span><span> </span><span id="local-6989586621679157535"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157535"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157534"><span class="hs-identifier hs-var">handleQuoting</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; (Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157532"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157532"><span class="annot"><span class="annottext">sep :: Text
</span><a href="#local-6989586621679157532"><span class="hs-identifier hs-var hs-var">sep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Text
</span><a href="Frames.CSV.html#columnSeparator"><span class="hs-identifier hs-var hs-var">columnSeparator</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157535"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span id="local-6989586621679157531"><span class="annot"><span class="annottext">quoting :: QuotingMode
</span><a href="#local-6989586621679157531"><span class="hs-identifier hs-var hs-var">quoting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; QuotingMode
</span><a href="Frames.CSV.html#quotingMode"><span class="hs-identifier hs-var hs-var">quotingMode</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157535"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621679157534"><span class="annot"><span class="annottext">handleQuoting :: [Text] -&gt; [Text]
</span><a href="#local-6989586621679157534"><span class="hs-identifier hs-var hs-var">handleQuoting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QuotingMode
</span><a href="#local-6989586621679157531"><span class="hs-identifier hs-var">quoting</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-91"></span><span>          </span><span class="annot"><span class="annottext">QuotingMode
</span><a href="Frames.CSV.html#NoQuoting"><span class="hs-identifier hs-var">NoQuoting</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-92"></span><span>          </span><span class="annot"><a href="Frames.CSV.html#RFC4180Quoting"><span class="hs-identifier hs-type">RFC4180Quoting</span></a></span><span> </span><span id="local-6989586621679157529"><span class="annot"><span class="annottext">QuoteChar
</span><a href="#local-6989586621679157529"><span class="hs-identifier hs-var">quote</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; QuoteChar -&gt; [Text] -&gt; [Text]
</span><a href="Frames.CSV.html#reassembleRFC4180QuotedParts"><span class="hs-identifier hs-var">reassembleRFC4180QuotedParts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157532"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteChar
</span><a href="#local-6989586621679157529"><span class="hs-identifier hs-var">quote</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Post processing applied to a list of tokens split by the</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- separator which should have quoted sections reassembeld</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Frames.CSV.html#reassembleRFC4180QuotedParts"><span class="hs-identifier hs-type">reassembleRFC4180QuotedParts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#Separator"><span class="hs-identifier hs-type">Separator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#QuoteChar"><span class="hs-identifier hs-type">QuoteChar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span id="reassembleRFC4180QuotedParts"><span class="annot"><span class="annottext">reassembleRFC4180QuotedParts :: Text -&gt; QuoteChar -&gt; [Text] -&gt; [Text]
</span><a href="Frames.CSV.html#reassembleRFC4180QuotedParts"><span class="hs-identifier hs-var hs-var">reassembleRFC4180QuotedParts</span></a></span></span><span> </span><span id="local-6989586621679157527"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157527"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span id="local-6989586621679157526"><span class="annot"><span class="annottext">QuoteChar
</span><a href="#local-6989586621679157526"><span class="hs-identifier hs-var">quoteChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157525"><span class="annot"><span class="annottext">go :: [Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679157524"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679157523"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157523"><span class="hs-identifier hs-var">parts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier hs-var">T.empty</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157523"><span class="hs-identifier hs-var">parts</span></a></span><span>
</span><span id="line-101"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679157520"><span class="hs-identifier hs-var">prefixQuoted</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679157519"><span class="hs-identifier hs-var">suffixQuoted</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679157518"><span class="hs-identifier hs-var">unescape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.dropEnd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157523"><span class="hs-identifier hs-var">parts</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; ([Text], [Text])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">break</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679157519"><span class="hs-identifier hs-var">suffixQuoted</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157523"><span class="hs-identifier hs-var">parts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>                   </span><span class="hs-special">(</span><span id="local-6989586621679157514"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157514"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679157518"><span class="hs-identifier hs-var">unescape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157527"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157514"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span>                   </span><span class="hs-special">(</span><span id="local-6989586621679157512"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157512"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679157511"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157511"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679157510"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157510"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679157518"><span class="hs-identifier hs-var">unescape</span></a></span><span>
</span><span id="line-107"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span>
</span><span id="line-108"></span><span>                                    </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157527"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-109"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157512"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.dropEnd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157511"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                               </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157510"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.strip</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157524"><span class="hs-identifier hs-var">part</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
</span><a href="#local-6989586621679157525"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157523"><span class="hs-identifier hs-var">parts</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621679157520"><span class="annot"><span class="annottext">prefixQuoted :: Text -&gt; Bool
</span><a href="#local-6989586621679157520"><span class="hs-identifier hs-var hs-var">prefixQuoted</span></a></span></span><span> </span><span id="local-6989586621679157508"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157508"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; QuoteChar
</span><span class="hs-identifier hs-var">T.head</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157508"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteChar -&gt; QuoteChar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QuoteChar
</span><a href="#local-6989586621679157526"><span class="hs-identifier hs-var">quoteChar</span></a></span><span class="hs-comment">--  &amp;&amp;</span><span>
</span><span id="line-115"></span><span>          </span><span class="hs-comment">-- T.length (T.takeWhile (== quoteChar) t) `rem` 2 == 1</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>        </span><span id="local-6989586621679157519"><span class="annot"><span class="annottext">suffixQuoted :: Text -&gt; Bool
</span><a href="#local-6989586621679157519"><span class="hs-identifier hs-var hs-var">suffixQuoted</span></a></span></span><span> </span><span id="local-6989586621679157506"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157506"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157505"><span class="hs-identifier hs-var">quoteText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isSuffixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157506"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-comment">--  &amp;&amp;</span><span>
</span><span id="line-119"></span><span>          </span><span class="hs-comment">-- T.length (T.takeWhileEnd (== quoteChar) t) `rem` 2 == 1</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679157505"><span class="annot"><span class="annottext">quoteText :: Text
</span><a href="#local-6989586621679157505"><span class="hs-identifier hs-var hs-var">quoteText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QuoteChar -&gt; Text
</span><span class="hs-identifier hs-var">T.singleton</span></span><span> </span><span class="annot"><span class="annottext">QuoteChar
</span><a href="#local-6989586621679157526"><span class="hs-identifier hs-var">quoteChar</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><a href="#local-6989586621679157518"><span class="hs-identifier hs-type">unescape</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621679157518"><span class="annot"><span class="annottext">unescape :: Text -&gt; Text
</span><a href="#local-6989586621679157518"><span class="hs-identifier hs-var hs-var">unescape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.replace</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157501"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157505"><span class="hs-identifier hs-var">quoteText</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157501"><span class="annot"><span class="annottext">q2 :: Text
</span><a href="#local-6989586621679157501"><span class="hs-identifier hs-var hs-var">q2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157505"><span class="hs-identifier hs-var">quoteText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157505"><span class="hs-identifier hs-var">quoteText</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">--tokenizeRow :: Separator -&gt; T.Text -&gt; [T.Text]</span><span>
</span><span id="line-128"></span><span class="hs-comment">--tokenizeRow sep = map (unquote . T.strip) . T.splitOn sep</span><span>
</span><span id="line-129"></span><span class="hs-comment">--  where unquote txt</span><span>
</span><span id="line-130"></span><span class="hs-comment">--          | quoted txt = case T.dropEnd 1 (T.drop 1 txt) of</span><span>
</span><span id="line-131"></span><span class="hs-comment">--                           txt' | T.null txt' -&gt; &quot;Col&quot;</span><span>
</span><span id="line-132"></span><span class="hs-comment">--                                | numish txt' -&gt; txt</span><span>
</span><span id="line-133"></span><span class="hs-comment">--                                | otherwise -&gt; txt'</span><span>
</span><span id="line-134"></span><span class="hs-comment">--          | otherwise = txt</span><span>
</span><span id="line-135"></span><span class="hs-comment">--        numish = T.all (`elem` (&quot;-+.0123456789&quot;::String))</span><span>
</span><span id="line-136"></span><span class="hs-comment">--        quoted txt = case T.uncons txt of</span><span>
</span><span id="line-137"></span><span class="hs-comment">--                       Just ('&quot;', rst)</span><span>
</span><span id="line-138"></span><span class="hs-comment">--                         | not (T.null rst) -&gt; T.last rst == '&quot;'</span><span>
</span><span id="line-139"></span><span class="hs-comment">--                       _ -&gt; False</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Infer column types from a prefix (up to 1000 lines) of a CSV</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- file.</span><span>
</span><span id="line-143"></span><span id="local-6989586621679157799"><span id="local-6989586621679157800"><span class="annot"><a href="Frames.CSV.html#prefixInference"><span class="hs-identifier hs-type">prefixInference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.ColumnTypeable.html#ColumnTypeable"><span class="hs-identifier hs-type">ColumnTypeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157800"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679157800"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157799"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Parser</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679157799"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679157800"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-145"></span><span id="prefixInference"><span class="annot"><span class="annottext">prefixInference :: Parser [Text] m [a]
</span><a href="Frames.CSV.html#prefixInference"><span class="hs-identifier hs-var hs-var">prefixInference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m x) m (Maybe [Text])
forall (m :: * -&gt; *) a. Monad m =&gt; Parser a m (Maybe a)
</span><span class="hs-identifier hs-var">P.draw</span></span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m x) m (Maybe [Text])
-&gt; (Maybe [Text] -&gt; StateT (Producer [Text] m x) m [a])
-&gt; StateT (Producer [Text] m x) m [a]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">Maybe [Text]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; StateT (Producer [Text] m x) m [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679157498"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157498"><span class="hs-identifier hs-var">row1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [Text] -&gt; [a])
-&gt; [a] -&gt; ([a] -&gt; [a]) -&gt; Parser [Text] m [a]
forall (m :: * -&gt; *) x a b.
Monad m =&gt;
(x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Parser a m b
</span><span class="hs-identifier hs-var">P.foldAll</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679157496"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679157496"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679157496"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; ([Text] -&gt; [a]) -&gt; [Text] -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [a]
</span><a href="#local-6989586621679157494"><span class="hs-identifier hs-var">inferCols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [a]
</span><a href="#local-6989586621679157494"><span class="hs-identifier hs-var">inferCols</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157498"><span class="hs-identifier hs-var">row1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>                         </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157494"><span class="annot"><span class="annottext">inferCols :: [Text] -&gt; [a]
</span><a href="#local-6989586621679157494"><span class="hs-identifier hs-var hs-var">inferCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; a) -&gt; [Text] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; a
forall a. ColumnTypeable a =&gt; Text -&gt; a
</span><a href="Frames.ColumnTypeable.html#inferType"><span class="hs-identifier hs-var">inferType</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | Extract column names and inferred types from a CSV file.</span><span>
</span><span id="line-153"></span><span id="local-6989586621679157491"><span id="local-6989586621679157492"><span class="annot"><a href="Frames.CSV.html#readColHeaders"><span class="hs-identifier hs-type">readColHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.ColumnTypeable.html#ColumnTypeable"><span class="hs-identifier hs-type">ColumnTypeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679157492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157491"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679157491"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679157491"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679157492"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-155"></span><span id="readColHeaders"><span class="annot"><span class="annottext">readColHeaders :: ParserOptions -&gt; Producer [Text] m () -&gt; m [(Text, a)]
</span><a href="Frames.CSV.html#readColHeaders"><span class="hs-identifier hs-var hs-var">readColHeaders</span></a></span></span><span> </span><span id="local-6989586621679157489"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157489"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m ()) m [(Text, a)]
-&gt; Producer [Text] m () -&gt; m [(Text, a)]
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">P.evalStateT</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Producer [Text] m ()) m [(Text, a)]
 -&gt; Producer [Text] m () -&gt; m [(Text, a)])
-&gt; StateT (Producer [Text] m ()) m [(Text, a)]
-&gt; Producer [Text] m ()
-&gt; m [(Text, a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679157487"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157487"><span class="hs-identifier hs-var">headerRow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m ()) m [Text]
-&gt; ([Text] -&gt; StateT (Producer [Text] m ()) m [Text])
-&gt; Maybe [Text]
-&gt; StateT (Producer [Text] m ()) m [Text]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Maybe [Text] -&gt; [Text]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Text]
forall a. a
</span><a href="#local-6989586621679157485"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Text] -&gt; [Text])
-&gt; StateT (Producer [Text] m ()) m (Maybe [Text])
-&gt; StateT (Producer [Text] m ()) m [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m ()) m (Maybe [Text])
forall (m :: * -&gt; *) a. Monad m =&gt; Parser a m (Maybe a)
</span><span class="hs-identifier hs-var">P.draw</span></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                        </span><span class="annot"><span class="annottext">[Text] -&gt; StateT (Producer [Text] m ()) m [Text]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-158"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Maybe [Text]
</span><a href="Frames.CSV.html#headerOverride"><span class="hs-identifier hs-var hs-var">headerOverride</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157489"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>     </span><span id="local-6989586621679157483"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679157483"><span class="hs-identifier hs-var">colTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Producer [Text] m ()) m [a]
forall a (m :: * -&gt; *).
(ColumnTypeable a, Monoid a, Monad m) =&gt;
Parser [Text] m [a]
</span><a href="Frames.CSV.html#prefixInference"><span class="hs-identifier hs-var">prefixInference</span></a></span><span>
</span><span id="line-160"></span><span>     </span><span class="annot"><span class="annottext">Bool
-&gt; StateT (Producer [Text] m ()) m ()
-&gt; StateT (Producer [Text] m ()) m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157487"><span class="hs-identifier hs-var">headerRow</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679157483"><span class="hs-identifier hs-var">colTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; StateT (Producer [Text] m ()) m ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157480"><span class="hs-identifier hs-var">errNumColumns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>     </span><span class="annot"><span class="annottext">[(Text, a)] -&gt; StateT (Producer [Text] m ()) m [(Text, a)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [a] -&gt; [(Text, a)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157487"><span class="hs-identifier hs-var">headerRow</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679157483"><span class="hs-identifier hs-var">colTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157485"><span class="annot"><span class="annottext">err :: a
</span><a href="#local-6989586621679157485"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty Producer has no header row&quot;</span></span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621679157480"><span class="annot"><span class="annottext">errNumColumns :: String
</span><a href="#local-6989586621679157480"><span class="hs-identifier hs-var hs-var">errNumColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-165"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-166"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error parsing CSV: &quot;</span></span><span>
</span><span id="line-167"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Number of columns in header differs from number of columns&quot;</span></span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  found in the remaining file. This may be due to newlines&quot;</span></span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  being present within the data itself (not just separating&quot;</span></span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  rows). If support for embedded newlines is required, &quot;</span></span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  consider using the Frames-dsv package in conjunction with&quot;</span></span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Frames to make use of a different CSV parser.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- * Loading CSV Data</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | Parsing each component of a 'RecF' from a list of text chunks,</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- one chunk per record component.</span><span>
</span><span id="line-178"></span><span class="hs-keyword">class</span><span> </span><span id="ReadRec"><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-var">ReadRec</span></a></span></span><span> </span><span id="local-6989586621679157786"><span class="annot"><a href="#local-6989586621679157786"><span class="hs-identifier hs-type">rs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>  </span><span id="readRec"><span class="annot"><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-type">readRec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157786"><span class="hs-identifier hs-type">rs</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679157475"><span class="annot"><span class="annottext">readRec :: [Text] -&gt; Rec (Either Text :. ElField) '[]
</span><a href="#local-6989586621679157475"><span class="hs-identifier hs-var hs-var hs-var hs-var">readRec</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rec (Either Text :. ElField) '[]
forall u (a :: u -&gt; *). Rec a '[]
</span><span class="hs-identifier hs-var">RNil</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621679157471"><span id="local-6989586621679157472"><span id="local-6989586621679157473"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.ColumnTypeable.html#Parseable"><span class="hs-identifier hs-type">Parseable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157473"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157472"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownSymbol</span></span><span> </span><span class="annot"><a href="#local-6989586621679157471"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679157471"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Frames.Col.html#%3A-%3E"><span class="hs-operator hs-type">:-&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157473"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679157472"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679157469"><span class="annot"><span class="annottext">readRec :: [Text] -&gt; Rec (Either Text :. ElField) ((s :-&gt; t) : ts)
</span><a href="#local-6989586621679157469"><span class="hs-identifier hs-var hs-var hs-var hs-var">readRec</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text (ElField (s :-&gt; t))
-&gt; Compose (Either Text) ElField (s :-&gt; t)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (x :: k).
f (g x) -&gt; Compose f g x
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text (ElField (s :-&gt; t))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Compose (Either Text) ElField (s :-&gt; t)
-&gt; Rec (Either Text :. ElField) ts
-&gt; Rec (Either Text :. ElField) ((s :-&gt; t) : ts)
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Rec (Either Text :. ElField) ts
forall (rs :: [(Symbol, *)]).
ReadRec rs =&gt;
[Text] -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-var">readRec</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-var">readRec</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679157466"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157466"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679157465"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157465"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Compose (Either Text) ElField (s :-&gt; t)
-&gt; (t -&gt; Compose (Either Text) ElField (s :-&gt; t))
-&gt; Maybe t
-&gt; Compose (Either Text) ElField (s :-&gt; t)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either Text (ElField (s :-&gt; t))
-&gt; Compose (Either Text) ElField (s :-&gt; t)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (x :: k).
f (g x) -&gt; Compose f g x
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text (ElField (s :-&gt; t))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.copy</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157466"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either Text (ElField (s :-&gt; t))
-&gt; Compose (Either Text) ElField (s :-&gt; t)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (x :: k).
f (g x) -&gt; Compose f g x
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="annot"><span class="annottext">(Either Text (ElField (s :-&gt; t))
 -&gt; Compose (Either Text) ElField (s :-&gt; t))
-&gt; (t -&gt; Either Text (ElField (s :-&gt; t)))
-&gt; t
-&gt; Compose (Either Text) ElField (s :-&gt; t)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ElField (s :-&gt; t) -&gt; Either Text (ElField (s :-&gt; t))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(ElField (s :-&gt; t) -&gt; Either Text (ElField (s :-&gt; t)))
-&gt; (t -&gt; ElField (s :-&gt; t)) -&gt; t -&gt; Either Text (ElField (s :-&gt; t))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; ElField (s :-&gt; t)
forall (s :: Symbol) t. KnownSymbol s =&gt; t -&gt; ElField '(s, t)
</span><span class="hs-identifier hs-var">Field</span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe t
forall (m :: * -&gt; *) a. (MonadPlus m, Parseable a) =&gt; Text -&gt; m a
</span><a href="Frames.ColumnTypeable.html#parse%27"><span class="hs-identifier hs-var">parse'</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157466"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Compose (Either Text) ElField (s :-&gt; t)
-&gt; Rec (Either Text :. ElField) ts
-&gt; Rec (Either Text :. ElField) ((s :-&gt; t) : ts)
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Rec (Either Text :. ElField) ts
forall (rs :: [(Symbol, *)]).
ReadRec rs =&gt;
[Text] -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-var">readRec</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679157465"><span class="hs-identifier hs-var">t</span></a></span></span></span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- | Opens a file (in 'P.MonadSafe') and repeatedly applies the given</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- function to the 'Handle' to obtain lines to yield. Adapted from the</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- moribund pipes-text package.</span><span>
</span><span id="line-193"></span><span id="local-6989586621679157743"><span class="annot"><a href="Frames.CSV.html#pipeLines"><span class="hs-identifier hs-type">pipeLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157743"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-194"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157743"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-197"></span><span id="pipeLines"><span class="annot"><span class="annottext">pipeLines :: (Handle -&gt; IO (Either IOException Text))
-&gt; String -&gt; Producer Text m ()
</span><a href="Frames.CSV.html#pipeLines"><span class="hs-identifier hs-var hs-var">pipeLines</span></a></span></span><span> </span><span id="local-6989586621679157459"><span class="annot"><span class="annottext">Handle -&gt; IO (Either IOException Text)
</span><a href="#local-6989586621679157459"><span class="hs-identifier hs-var">pgetLine</span></a></span></span><span> </span><span id="local-6989586621679157458"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157458"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOMode -&gt; (Handle -&gt; Producer Text m ()) -&gt; Producer Text m ()
forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
String -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><span class="hs-identifier hs-var">Safe.withFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157458"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; Producer Text m ()) -&gt; Producer Text m ())
-&gt; (Handle -&gt; Producer Text m ()) -&gt; Producer Text m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679157456"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679157456"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679157455"><span class="annot"><span class="annottext">loop :: Producer Text m ()
</span><a href="#local-6989586621679157455"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679157454"><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621679157454"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either IOException Text)
-&gt; Proxy X () () Text m (Either IOException Text)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">P.liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; IO (Either IOException Text)
</span><a href="#local-6989586621679157459"><span class="hs-identifier hs-var">pgetLine</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679157456"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621679157454"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679157452"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679157452"><span class="hs-identifier hs-var">_e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Producer Text m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679157451"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157451"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Producer Text m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">P.yield</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157451"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Producer Text m () -&gt; Producer Text m () -&gt; Producer Text m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Producer Text m ()
</span><a href="#local-6989586621679157455"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Producer Text m ()
</span><a href="#local-6989586621679157455"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Produce lines of 'T.Text'.</span><span>
</span><span id="line-205"></span><span id="local-6989586621679157738"><span class="annot"><a href="Frames.CSV.html#produceTextLines"><span class="hs-identifier hs-type">produceTextLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157738"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157738"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-206"></span><span id="produceTextLines"><span class="annot"><span class="annottext">produceTextLines :: String -&gt; Producer Text m ()
</span><a href="Frames.CSV.html#produceTextLines"><span class="hs-identifier hs-var hs-var">produceTextLines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO (Either IOException Text))
-&gt; String -&gt; Producer Text m ()
forall (m :: * -&gt; *).
MonadSafe m =&gt;
(Handle -&gt; IO (Either IOException Text))
-&gt; String -&gt; Producer Text m ()
</span><a href="Frames.CSV.html#pipeLines"><span class="hs-identifier hs-var">pipeLines</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Text -&gt; IO (Either IOException Text)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO Text -&gt; IO (Either IOException Text))
-&gt; (Handle -&gt; IO Text) -&gt; Handle -&gt; IO (Either IOException Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO Text
</span><span class="hs-identifier hs-var">T.hGetLine</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Produce lines of tokens that were separated by the given</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- separator.</span><span>
</span><span id="line-210"></span><span id="local-6989586621679157711"><span class="annot"><a href="Frames.CSV.html#produceTokens"><span class="hs-identifier hs-type">produceTokens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157711"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-211"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-212"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#Separator"><span class="hs-identifier hs-type">Separator</span></a></span><span>
</span><span id="line-213"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679157711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-214"></span><span id="produceTokens"><span class="annot"><span class="annottext">produceTokens :: String -&gt; Text -&gt; Producer [Text] m ()
</span><a href="Frames.CSV.html#produceTokens"><span class="hs-identifier hs-var hs-var">produceTokens</span></a></span></span><span> </span><span id="local-6989586621679157446"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157446"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621679157445"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157445"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Producer Text m ()
forall (m :: * -&gt; *). MonadSafe m =&gt; String -&gt; Producer Text m ()
</span><a href="Frames.CSV.html#produceTextLines"><span class="hs-identifier hs-var">produceTextLines</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157446"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Producer Text m ()
-&gt; Proxy () Text () [Text] m () -&gt; Producer [Text] m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Proxy () Text () [Text] m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><a href="#local-6989586621679157443"><span class="hs-identifier hs-var">tokenize</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157443"><span class="annot"><span class="annottext">tokenize :: Text -&gt; [Text]
</span><a href="#local-6989586621679157443"><span class="hs-identifier hs-var hs-var">tokenize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Text -&gt; [Text]
</span><a href="Frames.CSV.html#tokenizeRow"><span class="hs-identifier hs-var">tokenizeRow</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157442"><span class="hs-identifier hs-var">popts</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621679157442"><span class="annot"><span class="annottext">popts :: ParserOptions
</span><a href="#local-6989586621679157442"><span class="hs-identifier hs-var hs-var">popts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">columnSeparator :: Text
</span><a href="Frames.CSV.html#columnSeparator"><span class="hs-identifier hs-var">columnSeparator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679157445"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Consume lines of 'T.Text', writing them to a file.</span><span>
</span><span id="line-219"></span><span id="local-6989586621679157601"><span id="local-6989586621679157602"><span class="annot"><a href="Frames.CSV.html#consumeTextLines"><span class="hs-identifier hs-type">consumeTextLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Consumer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157601"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-220"></span><span id="consumeTextLines"><span class="annot"><span class="annottext">consumeTextLines :: String -&gt; Consumer Text m r
</span><a href="Frames.CSV.html#consumeTextLines"><span class="hs-identifier hs-var hs-var">consumeTextLines</span></a></span></span><span> </span><span id="local-6989586621679157440"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157440"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOMode -&gt; (Handle -&gt; Consumer Text m r) -&gt; Consumer Text m r
forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
String -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><span class="hs-identifier hs-var">Safe.withFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157440"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">WriteMode</span></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; Consumer Text m r) -&gt; Consumer Text m r)
-&gt; (Handle -&gt; Consumer Text m r) -&gt; Consumer Text m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679157439"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679157439"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679157438"><span class="annot"><span class="annottext">loop :: Consumer Text m r
</span><a href="#local-6989586621679157438"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy () Text () X m Text
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><span class="hs-identifier hs-var">P.await</span></span><span> </span><span class="annot"><span class="annottext">Proxy () Text () X m Text
-&gt; (Text -&gt; Proxy () Text () X m ()) -&gt; Proxy () Text () X m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Proxy () Text () X m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">P.liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Proxy () Text () X m ())
-&gt; (Text -&gt; IO ()) -&gt; Text -&gt; Proxy () Text () X m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679157439"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy () Text () X m () -&gt; Consumer Text m r -&gt; Consumer Text m r
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Consumer Text m r
</span><a href="#local-6989586621679157438"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Consumer Text m r
</span><a href="#local-6989586621679157438"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- | Produce the lines of a latin1 (or ISO8859 Part 1) encoded file as</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- &#8217;T.Text&#8217; values.</span><span>
</span><span id="line-226"></span><span id="local-6989586621679157435"><span class="annot"><a href="Frames.CSV.html#readFileLatin1Ln"><span class="hs-identifier hs-type">readFileLatin1Ln</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157435"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679157435"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-227"></span><span id="readFileLatin1Ln"><span class="annot"><span class="annottext">readFileLatin1Ln :: String -&gt; Producer [Text] m ()
</span><a href="Frames.CSV.html#readFileLatin1Ln"><span class="hs-identifier hs-var hs-var">readFileLatin1Ln</span></a></span></span><span> </span><span id="local-6989586621679157433"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157433"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Handle -&gt; IO (Either IOException Text))
-&gt; String -&gt; Producer Text m ()
forall (m :: * -&gt; *).
MonadSafe m =&gt;
(Handle -&gt; IO (Either IOException Text))
-&gt; String -&gt; Producer Text m ()
</span><a href="Frames.CSV.html#pipeLines"><span class="hs-identifier hs-var">pipeLines</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Text -&gt; IO (Either IOException Text)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO Text -&gt; IO (Either IOException Text))
-&gt; (Handle -&gt; IO Text) -&gt; Handle -&gt; IO (Either IOException Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; IO ByteString -&gt; IO Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">T.decodeLatin1</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO Text)
-&gt; (Handle -&gt; IO ByteString) -&gt; Handle -&gt; IO Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B8.hGetLine</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157433"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-228"></span><span>                      </span><span class="annot"><span class="annottext">Producer Text m ()
-&gt; Proxy () Text () [Text] m () -&gt; Producer [Text] m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Proxy () Text () [Text] m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Text -&gt; [Text]
</span><a href="Frames.CSV.html#tokenizeRow"><span class="hs-identifier hs-var">tokenizeRow</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Read a 'RecF' from one line of CSV.</span><span>
</span><span id="line-231"></span><span id="local-6989586621679157684"><span class="annot"><a href="Frames.CSV.html#readRow"><span class="hs-identifier hs-type">readRow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157684"><span class="hs-identifier hs-type">rs</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157684"><span class="hs-identifier hs-type">rs</span></a></span></span><span>
</span><span id="line-233"></span><span id="readRow"><span class="annot"><span class="annottext">readRow :: ParserOptions -&gt; Text -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRow"><span class="hs-identifier hs-var hs-var">readRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Rec (Either Text :. ElField) rs
forall (rs :: [(Symbol, *)]).
ReadRec rs =&gt;
[Text] -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-var">readRec</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Rec (Either Text :. ElField) rs)
-&gt; (Text -&gt; [Text]) -&gt; Text -&gt; Rec (Either Text :. ElField) rs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text -&gt; [Text]) -&gt; Text -&gt; Rec (Either Text :. ElField) rs)
-&gt; (ParserOptions -&gt; Text -&gt; [Text])
-&gt; ParserOptions
-&gt; Text
-&gt; Rec (Either Text :. ElField) rs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Text -&gt; [Text]
</span><a href="Frames.CSV.html#tokenizeRow"><span class="hs-identifier hs-var">tokenizeRow</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | Produce rows where any given entry can fail to parse.</span><span>
</span><span id="line-236"></span><span id="local-6989586621679157680"><span id="local-6989586621679157681"><span class="annot"><a href="Frames.CSV.html#readTableMaybeOpt"><span class="hs-identifier hs-type">readTableMaybeOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157680"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157680"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span>
</span><span id="line-238"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-239"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157680"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157681"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-240"></span><span id="readTableMaybeOpt"><span class="annot"><span class="annottext">readTableMaybeOpt :: ParserOptions
-&gt; String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#readTableMaybeOpt"><span class="hs-identifier hs-var hs-var">readTableMaybeOpt</span></a></span></span><span> </span><span id="local-6989586621679157428"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157428"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679157427"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157427"><span class="hs-identifier hs-var">csvFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; Producer [Text] m ()
forall (m :: * -&gt; *).
MonadSafe m =&gt;
String -&gt; Text -&gt; Producer [Text] m ()
</span><a href="Frames.CSV.html#produceTokens"><span class="hs-identifier hs-var">produceTokens</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157427"><span class="hs-identifier hs-var">csvFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Text
</span><a href="Frames.CSV.html#columnSeparator"><span class="hs-identifier hs-var hs-var">columnSeparator</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157428"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Producer [Text] m ()
-&gt; Proxy () [Text] () (Rec (Maybe :. ElField) rs) m ()
-&gt; Producer (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParserOptions
-&gt; Proxy () [Text] () (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(Monad m, ReadRec rs, RMap rs) =&gt;
ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-identifier hs-var">pipeTableMaybeOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157428"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-242"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#readTableMaybeOpt"><span class="hs-pragma hs-type">readTableMaybeOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Stream lines of CSV data into rows of &#8217;Rec&#8217; values values where</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- any given entry can fail to parse.</span><span>
</span><span id="line-246"></span><span id="local-6989586621679157709"><span id="local-6989586621679157710"><span class="annot"><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-identifier hs-type">pipeTableMaybeOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157710"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157709"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157709"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span>
</span><span id="line-248"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157709"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157710"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-249"></span><span id="pipeTableMaybeOpt"><span class="annot"><span class="annottext">pipeTableMaybeOpt :: ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-identifier hs-var hs-var">pipeTableMaybeOpt</span></a></span></span><span> </span><span id="local-6989586621679157425"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157425"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
-&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [Text] -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Maybe [Text]
</span><a href="Frames.CSV.html#headerOverride"><span class="hs-identifier hs-var hs-var">headerOverride</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157425"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">()
-&gt; Proxy () [Text] () (Rec (Maybe :. ElField) rs) m [Text]
-&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Proxy () [Text] () (Rec (Maybe :. ElField) rs) m [Text]
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><span class="hs-identifier hs-var">P.await</span></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="annottext">([Text] -&gt; Rec (Maybe :. ElField) rs)
-&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall (x :: (Symbol, *)).
 (:.) (Either Text) ElField x -&gt; (:.) Maybe ElField x)
-&gt; Rec (Either Text :. ElField) rs -&gt; Rec (Maybe :. ElField) rs
forall u (rs :: [u]) (f :: u -&gt; *) (g :: u -&gt; *).
RMap rs =&gt;
(forall (x :: u). f x -&gt; g x) -&gt; Rec f rs -&gt; Rec g rs
</span><span class="hs-identifier hs-var">rmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Compose Maybe ElField x)
-&gt; (ElField x -&gt; Compose Maybe ElField x)
-&gt; Either Text (ElField x)
-&gt; Compose Maybe ElField x
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Compose Maybe ElField x -&gt; Text -&gt; Compose Maybe ElField x
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ElField x) -&gt; Compose Maybe ElField x
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (x :: k).
f (g x) -&gt; Compose f g x
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ElField x)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ElField x) -&gt; Compose Maybe ElField x
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (x :: k).
f (g x) -&gt; Compose f g x
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (ElField x) -&gt; Compose Maybe ElField x)
-&gt; (ElField x -&gt; Maybe (ElField x))
-&gt; ElField x
-&gt; Compose Maybe ElField x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ElField x -&gt; Maybe (ElField x)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either Text (ElField x) -&gt; Compose Maybe ElField x)
-&gt; (Compose (Either Text) ElField x -&gt; Either Text (ElField x))
-&gt; Compose (Either Text) ElField x
-&gt; Compose Maybe ElField x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Compose (Either Text) ElField x -&gt; Either Text (ElField x)
forall l (f :: l -&gt; *) k (g :: k -&gt; l) (x :: k).
Compose f g x -&gt; f (g x)
</span><span class="hs-identifier hs-var hs-var">getCompose</span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>         </span><span class="annot"><span class="annottext">(Rec (Either Text :. ElField) rs -&gt; Rec (Maybe :. ElField) rs)
-&gt; ([Text] -&gt; Rec (Either Text :. ElField) rs)
-&gt; [Text]
-&gt; Rec (Maybe :. ElField) rs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Rec (Either Text :. ElField) rs
forall (rs :: [(Symbol, *)]).
ReadRec rs =&gt;
[Text] -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRec"><span class="hs-identifier hs-var">readRec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-pragma hs-type">pipeTableMaybeOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Stream lines of CSV data into rows of &#8217;Rec&#8217; values values where</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- any given entry can fail to parse. In the case of a parse failure, the</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- raw 'T.Text' of that entry is retained.</span><span>
</span><span id="line-259"></span><span id="local-6989586621679157674"><span id="local-6989586621679157675"><span class="annot"><a href="Frames.CSV.html#pipeTableEitherOpt"><span class="hs-identifier hs-type">pipeTableEitherOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157675"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157674"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span>
</span><span id="line-261"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157674"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-262"></span><span id="pipeTableEitherOpt"><span class="annot"><span class="annottext">pipeTableEitherOpt :: ParserOptions -&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableEitherOpt"><span class="hs-identifier hs-var hs-var">pipeTableEitherOpt</span></a></span></span><span> </span><span id="local-6989586621679157419"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157419"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
-&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [Text] -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Maybe [Text]
</span><a href="Frames.CSV.html#headerOverride"><span class="hs-identifier hs-var hs-var">headerOverride</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157419"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">()
-&gt; Proxy () Text () (Rec (Either Text :. ElField) rs) m Text
-&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Proxy () Text () (Rec (Either Text :. ElField) rs) m Text
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><span class="hs-identifier hs-var">P.await</span></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">(Text -&gt; Rec (Either Text :. ElField) rs)
-&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParserOptions -&gt; Text -&gt; Rec (Either Text :. ElField) rs
forall (rs :: [(Symbol, *)]).
ReadRec rs =&gt;
ParserOptions -&gt; Text -&gt; Rec (Either Text :. ElField) rs
</span><a href="Frames.CSV.html#readRow"><span class="hs-identifier hs-var">readRow</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157419"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTableEitherOpt"><span class="hs-pragma hs-type">pipeTableEitherOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | Produce rows where any given entry can fail to parse.</span><span>
</span><span id="line-268"></span><span id="local-6989586621679157417"><span id="local-6989586621679157418"><span class="annot"><a href="Frames.CSV.html#readTableMaybe"><span class="hs-identifier hs-type">readTableMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157417"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157417"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157417"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157418"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-270"></span><span id="readTableMaybe"><span class="annot"><span class="annottext">readTableMaybe :: String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#readTableMaybe"><span class="hs-identifier hs-var hs-var">readTableMaybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions
-&gt; String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(MonadSafe m, ReadRec rs, RMap rs) =&gt;
ParserOptions
-&gt; String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#readTableMaybeOpt"><span class="hs-identifier hs-var">readTableMaybeOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span>
</span><span id="line-271"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#readTableMaybe"><span class="hs-pragma hs-type">readTableMaybe</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Stream lines of CSV data into rows of &#8217;Rec&#8217; values where any</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- given entry can fail to parse.</span><span>
</span><span id="line-275"></span><span id="local-6989586621679157414"><span id="local-6989586621679157415"><span class="annot"><a href="Frames.CSV.html#pipeTableMaybe"><span class="hs-identifier hs-type">pipeTableMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157415"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157414"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157414"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157414"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157415"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-277"></span><span id="pipeTableMaybe"><span class="annot"><span class="annottext">pipeTableMaybe :: Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableMaybe"><span class="hs-identifier hs-var hs-var">pipeTableMaybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(Monad m, ReadRec rs, RMap rs) =&gt;
ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-identifier hs-var">pipeTableMaybeOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span>
</span><span id="line-278"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTableMaybe"><span class="hs-pragma hs-type">pipeTableMaybe</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- | Stream lines of CSV data into rows of &#8217;Rec&#8217; values where any</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- given entry can fail to parse. In the case of a parse failure, the</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- raw 'T.Text' of that entry is retained.</span><span>
</span><span id="line-283"></span><span id="local-6989586621679157411"><span id="local-6989586621679157412"><span class="annot"><a href="Frames.CSV.html#pipeTableEither"><span class="hs-identifier hs-type">pipeTableEither</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157412"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157411"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157411"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157412"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-285"></span><span id="pipeTableEither"><span class="annot"><span class="annottext">pipeTableEither :: Pipe Text (Rec (Either Text :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableEither"><span class="hs-identifier hs-var hs-var">pipeTableEither</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(Monad m, ReadRec rs) =&gt;
ParserOptions -&gt; Pipe Text (Rec (Either Text :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableEitherOpt"><span class="hs-identifier hs-var">pipeTableEitherOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span>
</span><span id="line-286"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTableEither"><span class="hs-pragma hs-type">pipeTableEither</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- -- | Returns a `MonadPlus` producer of rows for which each column was</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- -- successfully parsed. This is typically slower than 'readTableOpt'.</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- readTableOpt' :: forall m rs.</span><span>
</span><span id="line-291"></span><span class="hs-comment">--                  (MonadPlus m, MonadIO m, ReadRec rs)</span><span>
</span><span id="line-292"></span><span class="hs-comment">--               =&gt; ParserOptions -&gt; FilePath -&gt; m (Record rs)</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- readTableOpt' opts csvFile =</span><span>
</span><span id="line-294"></span><span class="hs-comment">--   do h &lt;- liftIO $ do</span><span>
</span><span id="line-295"></span><span class="hs-comment">--             h &lt;- openFile csvFile ReadMode</span><span>
</span><span id="line-296"></span><span class="hs-comment">--             when (isNothing $ headerOverride opts) (void $ T.hGetLine h)</span><span>
</span><span id="line-297"></span><span class="hs-comment">--             return h</span><span>
</span><span id="line-298"></span><span class="hs-comment">--      let go = liftIO (hIsEOF h) &gt;&gt;= \case</span><span>
</span><span id="line-299"></span><span class="hs-comment">--               True -&gt; mzero</span><span>
</span><span id="line-300"></span><span class="hs-comment">--               False -&gt; let r = recMaybe . readRow opts &lt;$&gt; T.hGetLine h</span><span>
</span><span id="line-301"></span><span class="hs-comment">--                        in liftIO r &gt;&gt;= maybe go (flip mplus go . return)</span><span>
</span><span id="line-302"></span><span class="hs-comment">--      go</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- {-# INLINE readTableOpt' #-}</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- -- | Returns a `MonadPlus` producer of rows for which each column was</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- -- successfully parsed. This is typically slower than 'readTable'.</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- readTable' :: forall m rs. (P.MonadSafe m, ReadRec rs)</span><span>
</span><span id="line-308"></span><span class="hs-comment">--            =&gt; FilePath -&gt; m (Record rs)</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- readTable' = readTableOpt' defaultParser</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- {-# INLINE readTable' #-}</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- | Returns a producer of rows for which each column was successfully</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- parsed.</span><span>
</span><span id="line-314"></span><span id="local-6989586621679157658"><span id="local-6989586621679157659"><span class="annot"><a href="Frames.CSV.html#readTableOpt"><span class="hs-identifier hs-type">readTableOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157659"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157658"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157658"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157658"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157659"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-316"></span><span id="readTableOpt"><span class="annot"><span class="annottext">readTableOpt :: ParserOptions -&gt; String -&gt; Producer (Record rs) m ()
</span><a href="Frames.CSV.html#readTableOpt"><span class="hs-identifier hs-var hs-var">readTableOpt</span></a></span></span><span> </span><span id="local-6989586621679157408"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157408"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679157407"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157407"><span class="hs-identifier hs-var">csvFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions
-&gt; String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(MonadSafe m, ReadRec rs, RMap rs) =&gt;
ParserOptions
-&gt; String -&gt; Producer (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#readTableMaybeOpt"><span class="hs-identifier hs-var">readTableMaybeOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157408"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157407"><span class="hs-identifier hs-var">csvFile</span></a></span><span> </span><span class="annot"><span class="annottext">Producer (Rec (Maybe :. ElField) rs) m ()
-&gt; Proxy () (Rec (Maybe :. ElField) rs) () (Record rs) m ()
-&gt; Producer (Record rs) m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">P.&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Rec (Maybe :. ElField) rs) () (Record rs) m ()
forall (cs :: [(Symbol, *)]) b.
Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
</span><a href="#local-6989586621679157406"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157406"><span class="annot"><span class="annottext">go :: Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
</span><a href="#local-6989586621679157406"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy
  ()
  (Rec (Maybe :. ElField) cs)
  ()
  (Record cs)
  m
  (Rec (Maybe :. ElField) cs)
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><span class="hs-identifier hs-var">P.await</span></span><span> </span><span class="annot"><span class="annottext">Proxy
  ()
  (Rec (Maybe :. ElField) cs)
  ()
  (Record cs)
  m
  (Rec (Maybe :. ElField) cs)
-&gt; (Rec (Maybe :. ElField) cs
    -&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b)
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
-&gt; (Record cs
    -&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b)
-&gt; Maybe (Record cs)
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
</span><a href="#local-6989586621679157406"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679157405"><span class="annot"><span class="annottext">Record cs
</span><a href="#local-6989586621679157405"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Record cs
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">P.yield</span></span><span> </span><span class="annot"><span class="annottext">Record cs
</span><a href="#local-6989586621679157405"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m ()
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
</span><a href="#local-6989586621679157406"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Record cs)
 -&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b)
-&gt; (Rec (Maybe :. ElField) cs -&gt; Maybe (Record cs))
-&gt; Rec (Maybe :. ElField) cs
-&gt; Proxy () (Rec (Maybe :. ElField) cs) () (Record cs) m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Rec (Maybe :. ElField) cs -&gt; Maybe (Record cs)
forall (cs :: [(Symbol, *)]).
Rec (Maybe :. ElField) cs -&gt; Maybe (Record cs)
</span><a href="Frames.Rec.html#recMaybe"><span class="hs-identifier hs-var">recMaybe</span></a></span><span>
</span><span id="line-318"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#readTableOpt"><span class="hs-pragma hs-type">readTableOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | Pipe lines of CSV text into rows for which each column was</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- successfully parsed.</span><span>
</span><span id="line-322"></span><span id="local-6989586621679157654"><span id="local-6989586621679157655"><span class="annot"><a href="Frames.CSV.html#pipeTableOpt"><span class="hs-identifier hs-type">pipeTableOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157655"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157655"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157654"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.CSV.html#ParserOptions"><span class="hs-identifier hs-type">ParserOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157655"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157654"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-324"></span><span id="pipeTableOpt"><span class="annot"><span class="annottext">pipeTableOpt :: ParserOptions -&gt; Pipe [Text] (Record rs) m ()
</span><a href="Frames.CSV.html#pipeTableOpt"><span class="hs-identifier hs-var hs-var">pipeTableOpt</span></a></span></span><span> </span><span id="local-6989586621679157402"><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157402"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(Monad m, ReadRec rs, RMap rs) =&gt;
ParserOptions -&gt; Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
</span><a href="Frames.CSV.html#pipeTableMaybeOpt"><span class="hs-identifier hs-var">pipeTableMaybeOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="#local-6989586621679157402"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Pipe [Text] (Rec (Maybe :. ElField) rs) m ()
-&gt; Proxy () (Rec (Maybe :. ElField) rs) () (Maybe (Record rs)) m ()
-&gt; Proxy () [Text] () (Maybe (Record rs)) m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Rec (Maybe :. ElField) rs -&gt; Maybe (Record rs))
-&gt; Proxy () (Rec (Maybe :. ElField) rs) () (Maybe (Record rs)) m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="annot"><span class="annottext">Rec (Maybe :. ElField) rs -&gt; Maybe (Record rs)
forall (cs :: [(Symbol, *)]).
Rec (Maybe :. ElField) cs -&gt; Maybe (Record cs)
</span><a href="Frames.Rec.html#recMaybe"><span class="hs-identifier hs-var">recMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy () [Text] () (Maybe (Record rs)) m ()
-&gt; Proxy () (Maybe (Record rs)) () (Record rs) m ()
-&gt; Pipe [Text] (Record rs) m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Maybe (Record rs)) () (Record rs) m ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a r.
(Functor m, Foldable f) =&gt;
Pipe (f a) a m r
</span><span class="hs-identifier hs-var">P.concat</span></span><span>
</span><span id="line-325"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTableOpt"><span class="hs-pragma hs-type">pipeTableOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | Returns a producer of rows for which each column was successfully</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- parsed.</span><span>
</span><span id="line-329"></span><span id="local-6989586621679157399"><span id="local-6989586621679157400"><span class="annot"><a href="Frames.CSV.html#readTable"><span class="hs-identifier hs-type">readTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">P.MonadSafe</span></span><span> </span><span class="annot"><a href="#local-6989586621679157400"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157399"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157399"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157399"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157400"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-331"></span><span id="readTable"><span class="annot"><span class="annottext">readTable :: String -&gt; Producer (Record rs) m ()
</span><a href="Frames.CSV.html#readTable"><span class="hs-identifier hs-var hs-var">readTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; String -&gt; Producer (Record rs) m ()
forall (m :: * -&gt; *) (rs :: [(Symbol, *)]).
(MonadSafe m, ReadRec rs, RMap rs) =&gt;
ParserOptions -&gt; String -&gt; Producer (Record rs) m ()
</span><a href="Frames.CSV.html#readTableOpt"><span class="hs-identifier hs-var">readTableOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span>
</span><span id="line-332"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#readTable"><span class="hs-pragma hs-type">readTable</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- | Pipe lines of CSV text into rows for which each column was</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- successfully parsed.</span><span>
</span><span id="line-336"></span><span id="local-6989586621679157396"><span id="local-6989586621679157397"><span class="annot"><a href="Frames.CSV.html#pipeTable"><span class="hs-identifier hs-type">pipeTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.CSV.html#ReadRec"><span class="hs-identifier hs-type">ReadRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157397"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679157397"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157396"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157397"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679157396"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-338"></span><span id="pipeTable"><span class="annot"><span class="annottext">pipeTable :: Pipe [Text] (Record rs) m ()
</span><a href="Frames.CSV.html#pipeTable"><span class="hs-identifier hs-var hs-var">pipeTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ParserOptions -&gt; Pipe [Text] (Record rs) m ()
forall (rs :: [(Symbol, *)]) (m :: * -&gt; *).
(ReadRec rs, RMap rs, Monad m) =&gt;
ParserOptions -&gt; Pipe [Text] (Record rs) m ()
</span><a href="Frames.CSV.html#pipeTableOpt"><span class="hs-identifier hs-var">pipeTableOpt</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOptions
</span><a href="Frames.CSV.html#defaultParser"><span class="hs-identifier hs-var">defaultParser</span></a></span><span>
</span><span id="line-339"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Frames.CSV.html#pipeTable"><span class="hs-pragma hs-type">pipeTable</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- * Writing CSV Data</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span id="local-6989586621679157617"><span class="annot"><a href="Frames.CSV.html#showFieldsCSV"><span class="hs-identifier hs-type">showFieldsCSV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecMapMethod</span></span><span> </span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157617"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RecordToList</span></span><span> </span><span class="annot"><a href="#local-6989586621679157617"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157617"><span class="hs-identifier hs-type">ts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-345"></span><span id="showFieldsCSV"><span class="annot"><span class="annottext">showFieldsCSV :: Record ts -&gt; [Text]
</span><a href="Frames.CSV.html#showFieldsCSV"><span class="hs-identifier hs-var hs-var">showFieldsCSV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rec (Const Text) ts -&gt; [Text]
forall u (rs :: [u]) a. RecordToList rs =&gt; Rec (Const a) rs -&gt; [a]
</span><span class="hs-identifier hs-var">recordToList</span></span><span> </span><span class="annot"><span class="annottext">(Rec (Const Text) ts -&gt; [Text])
-&gt; (Record ts -&gt; Rec (Const Text) ts) -&gt; Record ts -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall (a :: (Symbol, *)).
 ShowCSV (PayloadType ElField a) =&gt;
 ElField a -&gt; Const Text a)
-&gt; Record ts -&gt; Rec (Const Text) ts
forall u (c :: * -&gt; Constraint) (f :: u -&gt; *) (ts :: [u])
       (g :: u -&gt; *).
RecMapMethod c f ts =&gt;
(forall (a :: u). c (PayloadType f a) =&gt; f a -&gt; g a)
-&gt; Rec f ts -&gt; Rec g ts
</span><span class="hs-identifier hs-var">rmapMethod</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: (Symbol, *)).
ShowCSV (PayloadType ElField a) =&gt;
ElField a -&gt; Const Text a
</span><a href="#local-6989586621679157393"><span class="hs-identifier hs-var">aux</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157392"><span class="annot"><a href="#local-6989586621679157393"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PayloadType</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157392"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157392"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Const</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157392"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621679157393"><span class="annot"><span class="annottext">aux :: ElField a -&gt; Const Text a
</span><a href="#local-6989586621679157393"><span class="hs-identifier hs-var hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Field</span></span><span> </span><span id="local-6989586621679157391"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679157391"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Const Text a
forall k a (b :: k). a -&gt; Const a b
</span><span class="hs-identifier hs-var">Const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Text
forall a. ShowCSV a =&gt; a -&gt; Text
</span><a href="Frames.ShowCSV.html#showCSV"><span class="hs-identifier hs-var">showCSV</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679157391"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- | 'P.yield' a header row with column names followed by a line of</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- text for each 'Record' with each field separated by a comma. If</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- your source of 'Record' values is a 'P.Producer', consider using</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- 'pipeToCSV' to keep everything streaming.</span><span>
</span><span id="line-354"></span><span class="annot"><a href="Frames.CSV.html#produceCSV"><span class="hs-identifier hs-type">produceCSV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679157604"><span class="annot"><a href="#local-6989586621679157604"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679157605"><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span></span><span> </span><span id="local-6989586621679157603"><span class="annot"><a href="#local-6989586621679157603"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-355"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Frames.RecF.html#ColumnHeaders"><span class="hs-identifier hs-type">ColumnHeaders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679157604"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157603"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RecordToList</span></span><span> </span><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">RecMapMethod</span></span><span> </span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679157604"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Producer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679157603"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span id="produceCSV"><span class="annot"><span class="annottext">produceCSV :: f (Record ts) -&gt; Producer String m ()
</span><a href="Frames.CSV.html#produceCSV"><span class="hs-identifier hs-var hs-var">produceCSV</span></a></span></span><span> </span><span id="local-6989586621679157387"><span class="annot"><span class="annottext">f (Record ts)
</span><a href="#local-6989586621679157387"><span class="hs-identifier hs-var">recs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Producer String m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">P.yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (Record ts) -&gt; [String]
forall (cs :: [(Symbol, *)]) (proxy :: * -&gt; *)
       (f :: (Symbol, *) -&gt; *).
ColumnHeaders cs =&gt;
proxy (Rec f cs) -&gt; [String]
</span><a href="Frames.RecF.html#columnHeaders"><span class="hs-identifier hs-var">columnHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (Record ts)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157605"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><span class="annottext">(Record ts -&gt; Producer String m ())
-&gt; f (Record ts) -&gt; Producer String m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">F.mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Producer String m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">P.yield</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Producer String m ())
-&gt; (Record ts -&gt; String) -&gt; Record ts -&gt; Producer String m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; (Record ts -&gt; Text) -&gt; Record ts -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Record ts -&gt; [Text]) -&gt; Record ts -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Record ts -&gt; [Text]
forall (ts :: [(Symbol, *)]).
(RecMapMethod ShowCSV ElField ts, RecordToList ts) =&gt;
Record ts -&gt; [Text]
</span><a href="Frames.CSV.html#showFieldsCSV"><span class="hs-identifier hs-var">showFieldsCSV</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Record ts)
</span><a href="#local-6989586621679157387"><span class="hs-identifier hs-var">recs</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | 'P.yield' a header row with column names followed by a line of</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- text for each 'Record' with each field separated by a comma. This</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- is the same as 'produceCSV', but adapated for cases where you have</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- streaming input that you wish to use to produce streaming output.</span><span>
</span><span id="line-366"></span><span class="annot"><a href="Frames.CSV.html#pipeToCSV"><span class="hs-identifier hs-type">pipeToCSV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679157381"><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span></span><span> </span><span id="local-6989586621679157380"><span class="annot"><a href="#local-6989586621679157380"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-367"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679157380"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Frames.RecF.html#ColumnHeaders"><span class="hs-identifier hs-type">ColumnHeaders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RecordToList</span></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-368"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">RecMapMethod</span></span><span> </span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span id="pipeToCSV"><span class="annot"><span class="annottext">pipeToCSV :: Pipe (Record ts) Text m ()
</span><a href="Frames.CSV.html#pipeToCSV"><span class="hs-identifier hs-var hs-var">pipeToCSV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pipe (Record ts) Text m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">P.yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; [String] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679157379"><span class="hs-identifier hs-var">header</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pipe (Record ts) Text m ()
-&gt; Pipe (Record ts) Text m () -&gt; Pipe (Record ts) Text m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pipe (Record ts) Text m ()
</span><a href="#local-6989586621679157378"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679157379"><span class="annot"><span class="annottext">header :: [String]
</span><a href="#local-6989586621679157379"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (Record ts) -&gt; [String]
forall (cs :: [(Symbol, *)]) (proxy :: * -&gt; *)
       (f :: (Symbol, *) -&gt; *).
ColumnHeaders cs =&gt;
proxy (Rec f cs) -&gt; [String]
</span><a href="Frames.RecF.html#columnHeaders"><span class="hs-identifier hs-var">columnHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (Record ts)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><a href="#local-6989586621679157378"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pipe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157381"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679157380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621679157378"><span class="annot"><span class="annottext">go :: Pipe (Record ts) Text m ()
</span><a href="#local-6989586621679157378"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Record ts -&gt; Text) -&gt; Pipe (Record ts) Text m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Record ts -&gt; [Text]) -&gt; Record ts -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Record ts -&gt; [Text]
forall (ts :: [(Symbol, *)]).
(RecMapMethod ShowCSV ElField ts, RecordToList ts) =&gt;
Record ts -&gt; [Text]
</span><a href="Frames.CSV.html#showFieldsCSV"><span class="hs-identifier hs-var">showFieldsCSV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- | Write a header row with column names followed by a line of text</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- for each 'Record' to the given file.</span><span>
</span><span id="line-377"></span><span id="local-6989586621679157376"><span id="local-6989586621679157377"><span class="annot"><a href="Frames.CSV.html#writeCSV"><span class="hs-identifier hs-type">writeCSV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.RecF.html#ColumnHeaders"><span class="hs-identifier hs-type">ColumnHeaders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157377"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679157376"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RecordToList</span></span><span> </span><span class="annot"><a href="#local-6989586621679157377"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-378"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">RecMapMethod</span></span><span> </span><span class="annot"><a href="Frames.ShowCSV.html#ShowCSV"><span class="hs-identifier hs-type">ShowCSV</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ElField</span></span><span> </span><span class="annot"><a href="#local-6989586621679157377"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679157376"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Frames.Rec.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157377"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-380"></span><span id="writeCSV"><span class="annot"><span class="annottext">writeCSV :: String -&gt; f (Record ts) -&gt; IO ()
</span><a href="Frames.CSV.html#writeCSV"><span class="hs-identifier hs-var hs-var">writeCSV</span></a></span></span><span> </span><span id="local-6989586621679157374"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157374"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621679157373"><span class="annot"><span class="annottext">f (Record ts)
</span><a href="#local-6989586621679157373"><span class="hs-identifier hs-var">recs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeT IO () -&gt; IO ()
forall (m :: * -&gt; *) r.
(MonadMask m, MonadIO m) =&gt;
SafeT m r -&gt; m r
</span><span class="hs-identifier hs-var">P.runSafeT</span></span><span> </span><span class="annot"><span class="annottext">(SafeT IO () -&gt; IO ())
-&gt; (Effect (SafeT IO) () -&gt; SafeT IO ())
-&gt; Effect (SafeT IO) ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Effect (SafeT IO) () -&gt; SafeT IO ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><span class="hs-identifier hs-var">P.runEffect</span></span><span> </span><span class="annot"><span class="annottext">(Effect (SafeT IO) () -&gt; IO ()) -&gt; Effect (SafeT IO) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-381"></span><span>                   </span><span class="annot"><span class="annottext">f (Record ts) -&gt; Producer String (SafeT IO) ()
forall (f :: * -&gt; *) (ts :: [(Symbol, *)]) (m :: * -&gt; *).
(ColumnHeaders ts, Foldable f, Monad m, RecordToList ts,
 RecMapMethod ShowCSV ElField ts) =&gt;
f (Record ts) -&gt; Producer String m ()
</span><a href="Frames.CSV.html#produceCSV"><span class="hs-identifier hs-var">produceCSV</span></a></span><span> </span><span class="annot"><span class="annottext">f (Record ts)
</span><a href="#local-6989586621679157373"><span class="hs-identifier hs-var">recs</span></a></span><span> </span><span class="annot"><span class="annottext">Producer String (SafeT IO) ()
-&gt; Proxy () String () Text (SafeT IO) ()
-&gt; Proxy X () () Text (SafeT IO) ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; Proxy () String () Text (SafeT IO) ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><span class="hs-identifier hs-var">P.map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">Proxy X () () Text (SafeT IO) ()
-&gt; Proxy () Text () X (SafeT IO) () -&gt; Effect (SafeT IO) ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><span class="hs-operator hs-var">&gt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Proxy () Text () X (SafeT IO) ()
forall (m :: * -&gt; *) r. MonadSafe m =&gt; String -&gt; Consumer Text m r
</span><a href="Frames.CSV.html#consumeTextLines"><span class="hs-identifier hs-var">consumeTextLines</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679157374"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-382"></span></pre></body></html>