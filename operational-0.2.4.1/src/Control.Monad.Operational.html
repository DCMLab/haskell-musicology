<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTSyntax, ExistentialQuantification, Rank2Types, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances, MultiParamTypeClasses, FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Search for UndecidableInstances to see why this is needed</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Monad.Operational</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Synopsis</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><span class="hs-comment">-- $synopsis</span></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Overview</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- $intro</span></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Monad</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#Program"><span class="hs-identifier">Program</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramView"><span class="hs-identifier">ProgramView</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#view"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- $example</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#interpretWithMonad"><span class="hs-identifier">interpretWithMonad</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Monad transformer</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier">ProgramT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier">ProgramViewT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier">viewT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- $exampleT</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier">liftProgram</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#mapInstr"><span class="hs-identifier">mapInstr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#unviewT"><span class="hs-identifier">unviewT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#interpretWithMonadT"><span class="hs-identifier">interpretWithMonadT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Identity</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-comment">-- mtl  classes to instantiate.</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-comment">-- Those commented out cannot be instantiated. For reasons see below.</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- import Control.Monad.Cont.Class</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- import Control.Monad.Error.Class</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader.Class</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Class</span></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- import Control.Monad.Writer.Class</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">{------------------------------------------------------------------------------
    Introduction
------------------------------------------------------------------------------}</span><span>
</span><span id="line-39"></span><span class="hs-comment">{-$synopsis
To write a monad, use the 'Program' type.

To write a monad transformer, use the 'ProgramT' type.

For easier interoperability,
the 'Program' type is actually a type synonym
and defined in terms of 'ProgramT'.
-}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">{-$intro

The basic idea for implementing monads with this libary
is to think of monads as /sequences of primitive instructions/.
For instance, imagine that you want to write a web application
with a custom monad that features an instruction

&gt; askUserInput :: CustomMonad UserInput

which sends a form to the remote user and waits for the user
to send back his input

To implement this monad, you decide that this instruction is
a primitive, i.e. should not be implemented in terms of other,
more basic instructions.
Once you have chosen your primitives, collect them in a data type

@
data CustomMonadInstruction a where
    AskUserInput :: CustomMonadInstruction UserInput
@

Then, obtain your custom monad simply by applying the 'Program'
type constructor

&gt; type CustomMonad a = Program CustomMonadInstruction a

The library makes sure that it is an instance of the 'Monad' class
and fulfills all the required laws.

Essentially, the monad you now obtained is just a
fancy list of primitive instructions.
In particular, you can pattern match on the first element of this &quot;list&quot;.
This is how you implement an @interpret@ or @run@ function for your monad.
Note that pattern matching is done using the 'view' function

@
runCustomMonad :: CustomMonad a -&gt; IO a
runCustomMonad m = case view m of
    Return a            -&gt; return a -- done, return the result
    AskUserInput :&gt;&gt;= k -&gt; do
        b &lt;- waitForUserInput       -- wait for external user input
        runCustomMonad (k b)        -- proceed with next instruction
@

The point is that you can now proceed in any way you like:
you can wait for the user to return input as shown,
or you store the continuation @k@ and retrieve it when
your web application receives another HTTP request,
or you can keep a log of all user inputs on the client side and replay them,
and so on. Moreover, you can implement different @run@ functions
for one and the same custom monad, which is useful for testing.
Also note that the result type of the @run@ function does not need to
be a monad at all.

In essence, your custom monad allows you to express
your web application as a simple imperative program,
while the underlying implementation can freely map this to
an event-drived model or some other control flow architecture
of your choice.

The possibilities are endless.
More usage examples can be found here:
&lt;https://github.com/HeinrichApfelmus/operational/tree/master/doc/examples#readme&gt;

-}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">{------------------------------------------------------------------------------
   Program
------------------------------------------------------------------------------}</span><span>
</span><span id="line-119"></span><span class="hs-comment">{-| The abstract data type @'Program' instr a@ represents programs,
    i.e. sequences of primitive instructions.

    * The /primitive instructions/ are given by the type constructor @instr :: * -&gt; *@.

    * @a@ is the return type of a program.

    @'Program' instr@ is always a monad and
    automatically obeys the monad laws.
-}</span><span>
</span><span id="line-129"></span><span class="hs-keyword">type</span><span> </span><span id="Program"><span class="annot"><a href="Control.Monad.Operational.html#Program"><span class="hs-identifier hs-var">Program</span></a></span></span><span> </span><span id="local-6989586621679032632"><span class="annot"><a href="#local-6989586621679032632"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032632"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | View type for inspecting the first instruction.</span><span>
</span><span id="line-132"></span><span class="hs-comment">--   It has two constructors 'Return' and @:&gt;&gt;=@.</span><span>
</span><span id="line-133"></span><span class="hs-comment">--   (For technical reasons, they are documented at 'ProgramViewT'.)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">type</span><span> </span><span id="ProgramView"><span class="annot"><a href="Control.Monad.Operational.html#ProgramView"><span class="hs-identifier hs-var">ProgramView</span></a></span></span><span> </span><span id="local-6989586621679032631"><span class="annot"><a href="#local-6989586621679032631"><span class="hs-identifier hs-type">instr</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032631"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | View function for inspecting the first instruction.</span><span>
</span><span id="line-137"></span><span id="local-6989586621679032820"><span id="local-6989586621679032821"><span class="annot"><a href="Control.Monad.Operational.html#view"><span class="hs-identifier hs-type">view</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032821"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032820"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramView"><span class="hs-identifier hs-type">ProgramView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032821"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032820"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-138"></span><span id="view"><span class="annot"><span class="annottext">view :: Program instr a -&gt; ProgramView instr a
</span><a href="Control.Monad.Operational.html#view"><span class="hs-identifier hs-var hs-var">view</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity (ProgramView instr a) -&gt; ProgramView instr a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (ProgramView instr a) -&gt; ProgramView instr a)
-&gt; (Program instr a -&gt; Identity (ProgramView instr a))
-&gt; Program instr a
-&gt; ProgramView instr a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Program instr a -&gt; Identity (ProgramView instr a)
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
ProgramT instr m a -&gt; m (ProgramViewT instr m a)
</span><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Utility function that extends</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- a given interpretation of instructions as monadic actions</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- to an interpration of 'Program's as monadic actions.</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- This function can be useful if you are mainly interested in</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- mapping a 'Program' to different standard monads, like the state monad.</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- For implementing a truly custom monad,</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- you should write your interpreter directly with 'view' instead.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Control.Monad.Operational.html#interpretWithMonad"><span class="hs-identifier hs-type">interpretWithMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032812"><span class="annot"><a href="#local-6989586621679032812"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621679032813"><span class="annot"><a href="#local-6989586621679032813"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679032811"><span class="annot"><a href="#local-6989586621679032811"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032813"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032825"><span class="annot"><a href="#local-6989586621679032825"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679032812"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032813"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032825"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032812"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032811"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032813"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032811"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="interpretWithMonad"><span class="annot"><span class="annottext">interpretWithMonad :: (forall a. instr a -&gt; m a) -&gt; Program instr b -&gt; m b
</span><a href="Control.Monad.Operational.html#interpretWithMonad"><span class="hs-identifier hs-var hs-var">interpretWithMonad</span></a></span></span><span> </span><span id="local-6989586621679032628"><span class="annot"><span class="annottext">forall a. instr a -&gt; m a
</span><a href="#local-6989586621679032628"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramView instr b -&gt; m b
forall a. ProgramView instr a -&gt; m a
</span><a href="#local-6989586621679032627"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramView instr b -&gt; m b)
-&gt; (Program instr b -&gt; ProgramView instr b)
-&gt; Program instr b
-&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Program instr b -&gt; ProgramView instr b
forall (instr :: * -&gt; *) a. Program instr a -&gt; ProgramView instr a
</span><a href="Control.Monad.Operational.html#view"><span class="hs-identifier hs-var">view</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621679032627"><span class="hs-identifier hs-type">eval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032822"><span class="annot"><a href="#local-6989586621679032822"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramView"><span class="hs-identifier hs-type">ProgramView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032812"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032822"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032813"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032822"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679032627"><span class="annot"><span class="annottext">eval :: ProgramView instr a -&gt; m a
</span><a href="#local-6989586621679032627"><span class="hs-identifier hs-var hs-var">eval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679032625"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032625"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032625"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="#local-6989586621679032627"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679032624"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032624"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621679032622"><span class="annot"><span class="annottext">b -&gt; ProgramT instr Identity a
</span><a href="#local-6989586621679032622"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr b -&gt; m b
forall a. instr a -&gt; m a
</span><a href="#local-6989586621679032628"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032624"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(forall a. instr a -&gt; m a) -&gt; ProgramT instr Identity a -&gt; m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b.
Monad m =&gt;
(forall a. instr a -&gt; m a) -&gt; Program instr b -&gt; m b
</span><a href="Control.Monad.Operational.html#interpretWithMonad"><span class="hs-identifier hs-var">interpretWithMonad</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. instr a -&gt; m a
</span><a href="#local-6989586621679032628"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr Identity a -&gt; m a)
-&gt; (b -&gt; ProgramT instr Identity a) -&gt; b -&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr Identity a
</span><a href="#local-6989586621679032622"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">{- $example

/Example usage/

Stack machine from \&quot;The Operational Monad Tutorial\&quot;.

&gt;    data StackInstruction a where
&gt;        Push :: Int -&gt; StackInstruction ()
&gt;        Pop  :: StackInstruction Int
&gt;
&gt;    type StackProgram a = Program StackInstruction a
&gt;    type Stack b        = [b]
&gt;
&gt;    interpret :: StackProgram a -&gt; (Stack Int -&gt; a)
&gt;    interpret = eval . view
&gt;        where
&gt;        eval :: ProgramView StackInstruction a -&gt; (Stack Int -&gt; a)
&gt;        eval (Push a :&gt;&gt;= is) stack     = interpret (is ()) (a:stack)
&gt;        eval (Pop    :&gt;&gt;= is) (a:stack) = interpret (is a ) stack
&gt;        eval (Return a)       stack     = a

In this example, the type signature for the `eval` helper function is optional.

-}</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">{------------------------------------------------------------------------------
    ProgramT - monad transformer
------------------------------------------------------------------------------}</span><span>
</span><span id="line-185"></span><span class="hs-comment">{-| The abstract data type @'ProgramT' instr m a@ represents programs
    over a base monad @m@,
    i.e. sequences of primitive instructions and actions from the base monad.

    * The /primitive instructions/ are given by the type constructor @instr :: * -&gt; *@.

    * @m@ is the base monad, embedded with 'lift'.

    * @a@ is the return type of a program.

    @'ProgramT' instr m@ is a monad transformer and
    automatically obeys both the monad and the lifting laws.
-}</span><span>
</span><span id="line-198"></span><span class="hs-keyword">data</span><span> </span><span id="ProgramT"><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-var">ProgramT</span></a></span></span><span> </span><span id="local-6989586621679032621"><span class="annot"><a href="#local-6989586621679032621"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621679032620"><span class="annot"><a href="#local-6989586621679032620"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679032619"><span class="annot"><a href="#local-6989586621679032619"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679032801"><span id="local-6989586621679032802"><span id="local-6989586621679032803"><span id="Lift"><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-var">Lift</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679032803"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032802"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032801"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032803"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032802"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679032617"><span id="local-6989586621679032795"><span id="local-6989586621679032797"><span id="local-6989586621679032798"><span id="Bind"><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-identifier hs-var">Bind</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032798"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032617"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679032617"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032798"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032795"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032798"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032795"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679032742"><span id="local-6989586621679032743"><span id="local-6989586621679032744"><span id="Instr"><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679032744"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032743"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032744"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032742"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032743"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- basic instances</span><span>
</span><span id="line-205"></span><span id="local-6989586621679032613"><span id="local-6989586621679032614"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032609"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032614"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032613"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032614"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679032606"><span class="annot"><span class="annottext">return :: a -&gt; ProgramT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a (instr :: * -&gt; *). m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-var">Lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; ProgramT instr m a)
-&gt; (a -&gt; m a) -&gt; a -&gt; ProgramT instr m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621679032605"><span class="annot"><span class="annottext">&gt;&gt;= :: ProgramT instr m a
-&gt; (a -&gt; ProgramT instr m b) -&gt; ProgramT instr m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;&gt;=)</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m a
-&gt; (a -&gt; ProgramT instr m b) -&gt; ProgramT instr m b
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-identifier hs-var">Bind</span></a></span></span></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621679032604"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032604"><span class="hs-identifier hs-type">instr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679032601"><span class="annot"><span class="annottext">lift :: m a -&gt; ProgramT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a (instr :: * -&gt; *). m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-var">Lift</span></a></span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span id="local-6989586621679032598"><span id="local-6989586621679032599"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032595"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032599"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032598"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032599"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679032593"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; ProgramT instr m a -&gt; ProgramT instr m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; ProgramT instr m a -&gt; ProgramT instr m b
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span></span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621679032590"><span id="local-6989586621679032591"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032581"><span id="local-6989586621679032583"><span id="local-6989586621679032585"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032590"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032591"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679032579"><span class="annot"><span class="annottext">pure :: a -&gt; ProgramT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679032578"><span class="annot"><span class="annottext">&lt;*&gt; :: ProgramT instr m (a -&gt; b)
-&gt; ProgramT instr m a -&gt; ProgramT instr m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m (a -&gt; b)
-&gt; ProgramT instr m a -&gt; ProgramT instr m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span></span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | Program made from a single primitive instruction.</span><span>
</span><span id="line-220"></span><span id="local-6989586621679032574"><span id="local-6989586621679032575"><span id="local-6989586621679032576"><span class="annot"><a href="Control.Monad.Operational.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679032576"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032576"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032574"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032575"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-221"></span><span id="singleton"><span class="annot"><span class="annottext">singleton :: instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#singleton"><span class="hs-identifier hs-var hs-var">singleton</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr a -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) a (m :: * -&gt; *).
instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | View type for inspecting the first instruction.</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- This is very similar to pattern matching on lists.</span><span>
</span><span id="line-225"></span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- * The case @(Return a)@ means that the program contains no instructions</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- and just returns the result @a@.</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- *The case @(someInstruction :&gt;&gt;= k)@ means that the first instruction</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- is @someInstruction@ and the remaining program is given by the function @k@.</span><span>
</span><span id="line-231"></span><span class="hs-keyword">data</span><span> </span><span id="ProgramViewT"><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-var">ProgramViewT</span></a></span></span><span> </span><span id="local-6989586621679032573"><span class="annot"><a href="#local-6989586621679032573"><span class="hs-identifier hs-type">instr</span></a></span></span><span> </span><span id="local-6989586621679032572"><span class="annot"><a href="#local-6989586621679032572"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679032571"><span class="annot"><a href="#local-6989586621679032571"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679032733"><span id="local-6989586621679032734"><span id="local-6989586621679032735"><span id="Return"><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-var">Return</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679032735"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032734"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032733"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032735"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679032570"><span id="local-6989586621679032725"><span id="local-6989586621679032726"><span id="local-6989586621679032728"><span id="%3A%3E%3E%3D"><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">(:&gt;&gt;=)</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679032728"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032570"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-234"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679032570"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032728"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032726"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032725"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032728"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032726"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032725"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span id="local-6989586621679032568"><span id="local-6989586621679032569"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032565"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032568"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032569"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679032564"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; ProgramViewT instr m a -&gt; ProgramViewT instr m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679032563"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679032563"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679032562"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032562"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramViewT instr m b
forall a (instr :: * -&gt; *) (m :: * -&gt; *).
a -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ProgramViewT instr m b) -&gt; b -&gt; ProgramViewT instr m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679032563"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032562"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">fmap</span></span><span> </span><span id="local-6989586621679032561"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679032561"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679032560"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032560"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621679032559"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032559"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032560"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">instr b -&gt; (b -&gt; ProgramT instr m b) -&gt; ProgramViewT instr m b
forall (instr :: * -&gt; *) b (m :: * -&gt; *) a.
instr b -&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; ProgramT instr m a -&gt; ProgramT instr m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679032561"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr m a -&gt; ProgramT instr m b)
-&gt; (b -&gt; ProgramT instr m a) -&gt; b -&gt; ProgramT instr m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032559"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span id="local-6989586621679032557"><span id="local-6989586621679032558"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032548"><span id="local-6989586621679032550"><span id="local-6989586621679032552"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032558"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032557"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032558"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679032547"><span class="annot"><span class="annottext">pure :: a -&gt; ProgramViewT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679032546"><span class="annot"><span class="annottext">&lt;*&gt; :: ProgramViewT instr m (a -&gt; b)
-&gt; ProgramViewT instr m a -&gt; ProgramViewT instr m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m (a -&gt; b)
-&gt; ProgramViewT instr m a -&gt; ProgramViewT instr m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span></span></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span id="local-6989586621679032544"><span id="local-6989586621679032545"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032540"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032545"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032544"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621679032538"><span class="annot"><span class="annottext">return :: a -&gt; ProgramViewT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m a
forall a (instr :: * -&gt; *) (m :: * -&gt; *).
a -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679032537"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032537"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679032536"><span class="annot"><span class="annottext">&gt;&gt;= :: ProgramViewT instr m a
-&gt; (a -&gt; ProgramViewT instr m b) -&gt; ProgramViewT instr m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679032535"><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m b
</span><a href="#local-6989586621679032535"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m b
</span><a href="#local-6989586621679032535"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032537"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679032534"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032534"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621679032533"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032533"><span class="hs-identifier hs-var">cont1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span id="local-6989586621679032532"><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m b
</span><a href="#local-6989586621679032532"><span class="hs-identifier hs-var">cont2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032534"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">instr b -&gt; (b -&gt; ProgramT instr m b) -&gt; ProgramViewT instr m b
forall (instr :: * -&gt; *) b (m :: * -&gt; *) a.
instr b -&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032533"><span class="hs-identifier hs-var">cont1</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ProgramT instr m a)
-&gt; (a -&gt; ProgramT instr m b) -&gt; b -&gt; ProgramT instr m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m b -&gt; ProgramT instr m b
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
ProgramViewT instr m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#unviewT"><span class="hs-identifier hs-var">unviewT</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramViewT instr m b -&gt; ProgramT instr m b)
-&gt; (a -&gt; ProgramViewT instr m b) -&gt; a -&gt; ProgramT instr m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m b
</span><a href="#local-6989586621679032532"><span class="hs-identifier hs-var">cont2</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- | View function for inspecting the first instruction.</span><span>
</span><span id="line-251"></span><span id="local-6989586621679032829"><span id="local-6989586621679032830"><span id="local-6989586621679032831"><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-type">viewT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032830"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032829"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032830"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032829"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-252"></span><span id="viewT"><span class="annot"><span class="annottext">viewT :: ProgramT instr m a -&gt; m (ProgramViewT instr m a)
</span><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var hs-var">viewT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-type">Lift</span></a></span><span> </span><span id="local-6989586621679032530"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679032530"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679032530"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m a
-&gt; (a -&gt; m (ProgramViewT instr m a)) -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m a -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ProgramViewT instr m a -&gt; m (ProgramViewT instr m a))
-&gt; (a -&gt; ProgramViewT instr m a) -&gt; a -&gt; m (ProgramViewT instr m a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramViewT instr m a
forall a (instr :: * -&gt; *) (m :: * -&gt; *).
a -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-type">Lift</span></a></span><span> </span><span id="local-6989586621679032529"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679032529"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032528"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032528"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679032529"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m b
-&gt; (b -&gt; m (ProgramViewT instr m a)) -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m a -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
ProgramT instr m a -&gt; m (ProgramViewT instr m a)
</span><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr m a -&gt; m (ProgramViewT instr m a))
-&gt; (b -&gt; ProgramT instr m a) -&gt; b -&gt; m (ProgramViewT instr m a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032528"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679032527"><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032527"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032526"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m b
</span><a href="#local-6989586621679032526"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032525"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032525"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m a -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
ProgramT instr m a -&gt; m (ProgramViewT instr m a)
</span><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032527"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-var">`Bind`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679032524"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679032524"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m b
</span><a href="#local-6989586621679032526"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679032524"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-var">`Bind`</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032525"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span id="local-6989586621679032523"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032523"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032522"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032522"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m a -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032523"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">instr b -&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
forall (instr :: * -&gt; *) b (m :: * -&gt; *) a.
instr b -&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032522"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span class="annot"><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span id="local-6989586621679032521"><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m a -&gt; m (ProgramViewT instr m a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">instr a -&gt; (a -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
forall (instr :: * -&gt; *) b (m :: * -&gt; *) a.
instr b -&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramViewT instr m a
</span><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">{-| Lift a plain sequence of instructions to a sequence
    of instructions over a monad 'm'.
    This is the counterpart of the 'lift' function from 'MonadTrans'.

    It can be defined as follows:

@
    liftProgram = eval . view
        where
        eval :: ProgramView instr a -&gt; ProgramT instr m a
        eval (Return a) = return a
        eval (i :&gt;&gt;= k) = singleton i &gt;&gt;= liftProgram . k
@

-}</span><span>
</span><span id="line-273"></span><span id="local-6989586621679032684"><span id="local-6989586621679032685"><span id="local-6989586621679032686"><span class="annot"><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-type">liftProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032686"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032685"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032684"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032685"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032686"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032684"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-274"></span><span id="liftProgram"><span class="annot"><span class="annottext">liftProgram :: Program instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-var hs-var">liftProgram</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-type">Lift</span></a></span><span> </span><span id="local-6989586621679032520"><span class="annot"><span class="annottext">Identity a
</span><a href="#local-6989586621679032520"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identity a -&gt; a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">Identity a
</span><a href="#local-6989586621679032520"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span class="annot"><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-var">liftProgram</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679032519"><span class="annot"><span class="annottext">ProgramT instr Identity b
</span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032518"><span class="annot"><span class="annottext">b -&gt; Program instr a
</span><a href="#local-6989586621679032518"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr Identity b -&gt; ProgramT instr m b
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
Program instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-var">liftProgram</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr Identity b
</span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-var">`Bind`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program instr a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
Program instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-var">liftProgram</span></a></span><span> </span><span class="annot"><span class="annottext">(Program instr a -&gt; ProgramT instr m a)
-&gt; (b -&gt; Program instr a) -&gt; b -&gt; ProgramT instr m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Program instr a
</span><a href="#local-6989586621679032518"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span class="annot"><a href="Control.Monad.Operational.html#liftProgram"><span class="hs-identifier hs-var">liftProgram</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span id="local-6989586621679032517"><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr a -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) a (m :: * -&gt; *).
instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span><span> </span><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | Utility function that extends</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- a given interpretation of instructions as monadic actions</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- to an interpration of 'ProgramT's as monadic actions.</span><span>
</span><span id="line-282"></span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Ideally, you would not use another monad,</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- but write a custom interpreter directly with `viewT`.</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- See the remark at 'interpretWithMonad'.</span><span>
</span><span id="line-286"></span><span id="local-6989586621679032514"><span id="local-6989586621679032515"><span id="local-6989586621679032516"><span class="annot"><a href="Control.Monad.Operational.html#interpretWithMonadT"><span class="hs-identifier hs-type">interpretWithMonadT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032516"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032682"><span class="annot"><a href="#local-6989586621679032682"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679032515"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032682"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032516"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032682"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032515"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032516"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032516"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032514"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-287"></span><span id="interpretWithMonadT"><span class="annot"><span class="annottext">interpretWithMonadT :: (forall x. instr x -&gt; m x) -&gt; ProgramT instr m a -&gt; m a
</span><a href="Control.Monad.Operational.html#interpretWithMonadT"><span class="hs-identifier hs-var hs-var">interpretWithMonadT</span></a></span></span><span> </span><span id="local-6989586621679032513"><span class="annot"><span class="annottext">forall x. instr x -&gt; m x
</span><a href="#local-6989586621679032513"><span class="hs-identifier hs-var">interpreter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m a -&gt; m a
forall b. ProgramT instr m b -&gt; m b
</span><a href="#local-6989586621679032512"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679032512"><span class="annot"><span class="annottext">go :: ProgramT instr m b -&gt; m b
</span><a href="#local-6989586621679032512"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679032511"><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032511"><span class="hs-identifier hs-var">program</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>      </span><span id="local-6989586621679032510"><span class="annot"><span class="annottext">ProgramViewT instr m b
</span><a href="#local-6989586621679032510"><span class="hs-identifier hs-var">firstInstruction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b -&gt; m (ProgramViewT instr m b)
forall (m :: * -&gt; *) (instr :: * -&gt; *) a.
Monad m =&gt;
ProgramT instr m a -&gt; m (ProgramViewT instr m a)
</span><a href="Control.Monad.Operational.html#viewT"><span class="hs-identifier hs-var">viewT</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032511"><span class="hs-identifier hs-var">program</span></a></span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProgramViewT instr m b
</span><a href="#local-6989586621679032510"><span class="hs-identifier hs-var">firstInstruction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679032509"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679032509"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679032509"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621679032508"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032508"><span class="hs-identifier hs-var">instruction</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621679032507"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m b
</span><a href="#local-6989586621679032507"><span class="hs-identifier hs-var">continuation</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">instr b -&gt; m b
forall x. instr x -&gt; m x
</span><a href="#local-6989586621679032513"><span class="hs-identifier hs-var">interpreter</span></a></span><span> </span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032508"><span class="hs-identifier hs-var">instruction</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgramT instr m b -&gt; m b
</span><a href="#local-6989586621679032512"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr m b -&gt; m b)
-&gt; (b -&gt; ProgramT instr m b) -&gt; b -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m b
</span><a href="#local-6989586621679032507"><span class="hs-identifier hs-var">continuation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Utilitiy function for mapping a 'ProgramViewT' back into a 'ProgramT'.</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- </span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Semantically, the function 'unviewT' is an inverse of 'viewT',</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- e.g. we have</span><span>
</span><span id="line-299"></span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-301"></span><span class="hs-comment">--   viewT (singleton i) &gt;&gt;= unviewT = return (singleton i)</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-303"></span><span id="local-6989586621679032698"><span id="local-6989586621679032699"><span id="local-6989586621679032700"><span class="annot"><a href="Control.Monad.Operational.html#unviewT"><span class="hs-identifier hs-type">unviewT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032700"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramViewT"><span class="hs-identifier hs-type">ProgramViewT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032699"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032700"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032698"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032699"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032700"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032698"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-304"></span><span id="unviewT"><span class="annot"><span class="annottext">unviewT :: ProgramViewT instr m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#unviewT"><span class="hs-identifier hs-var hs-var">unviewT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679032506"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032506"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679032506"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Control.Monad.Operational.html#unviewT"><span class="hs-identifier hs-var">unviewT</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679032505"><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032505"><span class="hs-identifier hs-var">instruction</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621679032504"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032504"><span class="hs-identifier hs-var">continuation</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">instr b -&gt; ProgramT instr m b
forall (instr :: * -&gt; *) a (m :: * -&gt; *).
instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span><span> </span><span class="annot"><span class="annottext">instr b
</span><a href="#local-6989586621679032505"><span class="hs-identifier hs-var">instruction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-var">`Bind`</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032504"><span class="hs-identifier hs-var">continuation</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">-- | Extend a mapping of instructions to a mapping of 'ProgramT'.</span><span>
</span><span id="line-309"></span><span class="annot"><a href="Control.Monad.Operational.html#mapInstr"><span class="hs-identifier hs-type">mapInstr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032503"><span class="annot"><a href="#local-6989586621679032503"><span class="hs-identifier hs-type">instr1</span></a></span></span><span> </span><span id="local-6989586621679032502"><span class="annot"><a href="#local-6989586621679032502"><span class="hs-identifier hs-type">instr2</span></a></span></span><span> </span><span id="local-6989586621679032501"><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679032500"><span class="annot"><a href="#local-6989586621679032500"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032672"><span class="annot"><a href="#local-6989586621679032672"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679032503"><span class="hs-identifier hs-type">instr1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032672"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679032502"><span class="hs-identifier hs-type">instr2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032672"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032503"><span class="hs-identifier hs-type">instr1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032500"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032502"><span class="hs-identifier hs-type">instr2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032500"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-313"></span><span id="mapInstr"><span class="annot"><span class="annottext">mapInstr :: (forall x. instr1 x -&gt; instr2 x)
-&gt; ProgramT instr1 m a -&gt; ProgramT instr2 m a
</span><a href="Control.Monad.Operational.html#mapInstr"><span class="hs-identifier hs-var hs-var">mapInstr</span></a></span></span><span> </span><span id="local-6989586621679032499"><span class="annot"><span class="annottext">forall x. instr1 x -&gt; instr2 x
</span><a href="#local-6989586621679032499"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr1 m a -&gt; ProgramT instr2 m a
forall x. ProgramT instr1 m x -&gt; ProgramT instr2 m x
</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><a href="#local-6989586621679032498"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679032668"><span class="annot"><a href="#local-6989586621679032668"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032503"><span class="hs-identifier hs-type">instr1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032668"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032502"><span class="hs-identifier hs-type">instr2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032668"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621679032498"><span class="annot"><span class="annottext">go :: ProgramT instr1 m x -&gt; ProgramT instr2 m x
</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-type">Lift</span></a></span><span> </span><span id="local-6989586621679032497"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679032497"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m x -&gt; ProgramT instr2 m x
forall (m :: * -&gt; *) a (instr :: * -&gt; *). m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-var">Lift</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679032497"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-identifier hs-type">Bind</span></a></span><span> </span><span id="local-6989586621679032496"><span class="annot"><span class="annottext">ProgramT instr1 m b
</span><a href="#local-6989586621679032496"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679032495"><span class="annot"><span class="annottext">b -&gt; ProgramT instr1 m x
</span><a href="#local-6989586621679032495"><span class="hs-identifier hs-var">continuation</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProgramT instr2 m b
-&gt; (b -&gt; ProgramT instr2 m x) -&gt; ProgramT instr2 m x
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-identifier hs-var">Bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgramT instr1 m b -&gt; ProgramT instr2 m b
forall x. ProgramT instr1 m x -&gt; ProgramT instr2 m x
</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr1 m b
</span><a href="#local-6989586621679032496"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgramT instr1 m x -&gt; ProgramT instr2 m x
forall x. ProgramT instr1 m x -&gt; ProgramT instr2 m x
</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr1 m x -&gt; ProgramT instr2 m x)
-&gt; (b -&gt; ProgramT instr1 m x) -&gt; b -&gt; ProgramT instr2 m x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr1 m x
</span><a href="#local-6989586621679032495"><span class="hs-identifier hs-var">continuation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span id="local-6989586621679032494"><span class="annot"><span class="annottext">instr1 x
</span><a href="#local-6989586621679032494"><span class="hs-identifier hs-var">instruction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr2 x -&gt; ProgramT instr2 m x
forall (instr :: * -&gt; *) a (m :: * -&gt; *).
instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span><span> </span><span class="annot"><span class="annottext">(instr2 x -&gt; ProgramT instr2 m x)
-&gt; instr2 x -&gt; ProgramT instr2 m x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">instr1 x -&gt; instr2 x
forall x. instr1 x -&gt; instr2 x
</span><a href="#local-6989586621679032499"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">instr1 x
</span><a href="#local-6989586621679032494"><span class="hs-identifier hs-var">instruction</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">{- $exampleT

/Example usage/

List monad transformer.

&gt;    data PlusI m a where
&gt;        Zero :: PlusI m a
&gt;        Plus :: ListT m a -&gt; ListT m a -&gt; PlusI m a
&gt;
&gt;    type ListT m a = ProgramT (PlusI m) m a
&gt;
&gt;    runList :: Monad m =&gt; ListT m a -&gt; m [a]
&gt;    runList = eval &lt;=&lt; viewT
&gt;        where
&gt;        eval :: Monad m =&gt; ProgramViewT (PlusI m) m a -&gt; m [a]
&gt;        eval (Return x)        = return [x]
&gt;        eval (Zero     :&gt;&gt;= k) = return []
&gt;        eval (Plus m n :&gt;&gt;= k) =
&gt;            liftM2 (++) (runList (m &gt;&gt;= k)) (runList (n &gt;&gt;= k))

In this example, the type signature for the `eval` helper function is optional.

-}</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">{------------------------------------------------------------------------------
    mtl instances

  * All of these instances need UndecidableInstances,
    because they do not satisfy the coverage condition.
    Most of the instance in the  mtl  package itself have the same issue.

  * Lifting algebraic operations is easy,
    lifting control operations is more elaborate, but sometimes possible.
    See the design notes in  `doc/design.md`.
------------------------------------------------------------------------------}</span><span>
</span><span id="line-356"></span><span id="local-6989586621679032491"><span id="local-6989586621679032492"><span id="local-6989586621679032493"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032486"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679032493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032492"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679032493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032491"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032492"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679032484"><span class="annot"><span class="annottext">get :: ProgramT instr m s
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m s -&gt; ProgramT instr m s
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m s
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679032482"><span class="annot"><span class="annottext">put :: s -&gt; ProgramT instr m ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ProgramT instr m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ProgramT instr m ())
-&gt; (s -&gt; m ()) -&gt; s -&gt; ProgramT instr m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span></span></span></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span id="local-6989586621679032479"><span id="local-6989586621679032480"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679032480"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032479"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032480"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621679032475"><span class="annot"><span class="annottext">liftIO :: IO a -&gt; ProgramT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">liftIO</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ProgramT instr m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; ProgramT instr m a)
-&gt; (IO a -&gt; m a) -&gt; IO a -&gt; ProgramT instr m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span></span></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span id="local-6989586621679032471"><span id="local-6989586621679032472"><span id="local-6989586621679032473"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679032466"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679032473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032472"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679032473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#ProgramT"><span class="hs-identifier hs-type">ProgramT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032471"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679032472"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679032464"><span class="annot"><span class="annottext">ask :: ProgramT instr m r
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">ask</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m r -&gt; ProgramT instr m r
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m r
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621679032462"><span class="annot"><span class="annottext">local :: (r -&gt; r) -&gt; ProgramT instr m a -&gt; ProgramT instr m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">local</span></span></span><span> </span><span id="local-6989586621679032460"><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679032460"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-type">Lift</span></a></span><span> </span><span id="local-6989586621679032459"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ProgramT instr m a
forall (m :: * -&gt; *) a (instr :: * -&gt; *). m a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Lift"><span class="hs-identifier hs-var">Lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; m a -&gt; m a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679032460"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">local</span></span><span> </span><span id="local-6989586621679032458"><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679032457"><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032457"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-type">`Bind`</span></a></span><span> </span><span id="local-6989586621679032456"><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032456"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; ProgramT instr m b -&gt; ProgramT instr m b
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
</span><a href="#local-6989586621679032457"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) (m :: * -&gt; *) b a.
ProgramT instr m b
-&gt; (b -&gt; ProgramT instr m a) -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Bind"><span class="hs-operator hs-var">`Bind`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; ProgramT instr m a -&gt; ProgramT instr m a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgramT instr m a -&gt; ProgramT instr m a)
-&gt; (b -&gt; ProgramT instr m a) -&gt; b -&gt; ProgramT instr m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; ProgramT instr m a
</span><a href="#local-6989586621679032456"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span id="local-6989586621679032455"><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">instr a -&gt; ProgramT instr m a
forall (instr :: * -&gt; *) a (m :: * -&gt; *).
instr a -&gt; ProgramT instr m a
</span><a href="Control.Monad.Operational.html#Instr"><span class="hs-identifier hs-var">Instr</span></a></span><span> </span><span class="annot"><span class="annottext">instr a
</span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">i</span></a></span></span></span></span><span>
</span><span id="line-369"></span></pre></body></html>