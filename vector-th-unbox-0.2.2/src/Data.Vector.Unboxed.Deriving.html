<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS -Wall #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">{-|
Module:      Data.Vector.Unboxed.Deriving
Copyright:   &#169; 2012&#8722;2015 Liyang HU
License:     BSD3
Maintainer:  vector-th-unbox@liyang.hu
Stability:   experimental
Portability: non-portable
-}</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Vector.Unboxed.Deriving</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- $usage</span></span><span>
</span><span id="line-21"></span><span>      </span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#derivingUnbox"><span class="hs-identifier">derivingUnbox</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAlphaNum</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Generic</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Generic.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed.Base</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MVector</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Vector</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Unbox</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- Create a @Pat@ bound to the given name and an @Exp@ for said binding.</span><span>
</span><span id="line-33"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-type">newPatExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span id="newPatExp"><span class="annot"><span class="annottext">newPatExp :: String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var hs-var">newPatExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; (Pat, Exp)) -&gt; Q Name -&gt; Q (Pat, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Pat) -&gt; (Name -&gt; Exp) -&gt; Name -&gt; (Pat, Exp)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q Name -&gt; Q (Pat, Exp))
-&gt; (String -&gt; Q Name) -&gt; String -&gt; Q (Pat, Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Name
</span><span class="hs-identifier hs-var">newName</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">data</span><span> </span><span id="Common"><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#Common"><span class="hs-identifier hs-var">Common</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Common"><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#Common"><span class="hs-identifier hs-var">Common</span></a></span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="mvName"><span class="annot"><span class="annottext">Common -&gt; Name
</span><a href="Data.Vector.Unboxed.Deriving.html#mvName"><span class="hs-identifier hs-var hs-var">mvName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="vName"><span class="annot"><span class="annottext">Common -&gt; Name
</span><a href="Data.Vector.Unboxed.Deriving.html#vName"><span class="hs-identifier hs-var hs-var">vName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="i"><span class="annot"><span class="annottext">Common -&gt; (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#i"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="n"><span class="annot"><span class="annottext">Common -&gt; (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#n"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="mv"><span class="annot"><span class="annottext">Common -&gt; (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#mv"><span class="hs-identifier hs-var hs-var">mv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="mv%27"><span class="annot"><span class="annottext">Common -&gt; (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#mv%27"><span class="hs-identifier hs-var hs-var">mv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="v"><span class="annot"><span class="annottext">Common -&gt; (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#v"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#common"><span class="hs-identifier hs-type">common</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#Common"><span class="hs-identifier hs-type">Common</span></a></span><span>
</span><span id="line-41"></span><span id="common"><span class="annot"><span class="annottext">common :: String -&gt; Q Common
</span><a href="Data.Vector.Unboxed.Deriving.html#common"><span class="hs-identifier hs-var hs-var">common</span></a></span></span><span> </span><span id="local-6989586621679040589"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040589"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- A bit looser than &#8220;Haskell 2010: &#167;2.4 Identifiers and Operators&#8221;&#8230;</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040588"><span class="annot"><span class="annottext">valid :: Char -&gt; Bool
</span><a href="#local-6989586621679040588"><span class="hs-identifier hs-var hs-var">valid</span></a></span></span><span> </span><span id="local-6989586621679040587"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679040587"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679040587"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679040587"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679040587"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679040587"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Q () -&gt; Q ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621679040588"><span class="hs-identifier hs-var">valid</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040589"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; Q ()) -&gt; Q () -&gt; Q ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Q ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040589"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not a valid constructor suffix!&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040582"><span class="annot"><span class="annottext">mvName :: Name
</span><a href="#local-6989586621679040582"><span class="hs-identifier hs-var hs-var">mvName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MV_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040589"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040581"><span class="annot"><span class="annottext">vName :: Name
</span><a href="#local-6989586621679040581"><span class="hs-identifier hs-var hs-var">vName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;V_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040589"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679040580"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040580"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;idx&quot;</span></span><span>
</span><span id="line-49"></span><span>    </span><span id="local-6989586621679040579"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040579"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;len&quot;</span></span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621679040578"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040578"><span class="hs-identifier hs-var">mv</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; Pat) -&gt; (Pat, Exp) -&gt; (Pat, Exp)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="#local-6989586621679040577"><span class="hs-identifier hs-var">conPCompat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040582"><span class="hs-identifier hs-var">mvName</span></a></span><span> </span><span class="annot"><span class="annottext">([Pat] -&gt; Pat) -&gt; (Pat -&gt; [Pat]) -&gt; Pat -&gt; Pat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; [Pat] -&gt; [Pat]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Pat, Exp) -&gt; (Pat, Exp)) -&gt; Q (Pat, Exp) -&gt; Q (Pat, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mvec&quot;</span></span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679040575"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040575"><span class="hs-identifier hs-var">mv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; Pat) -&gt; (Pat, Exp) -&gt; (Pat, Exp)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="#local-6989586621679040577"><span class="hs-identifier hs-var">conPCompat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040582"><span class="hs-identifier hs-var">mvName</span></a></span><span> </span><span class="annot"><span class="annottext">([Pat] -&gt; Pat) -&gt; (Pat -&gt; [Pat]) -&gt; Pat -&gt; Pat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; [Pat] -&gt; [Pat]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Pat, Exp) -&gt; (Pat, Exp)) -&gt; Q (Pat, Exp) -&gt; Q (Pat, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mvec'&quot;</span></span><span>
</span><span id="line-52"></span><span>    </span><span id="local-6989586621679040574"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040574"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; Pat) -&gt; (Pat, Exp) -&gt; (Pat, Exp)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="#local-6989586621679040577"><span class="hs-identifier hs-var">conPCompat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040581"><span class="hs-identifier hs-var">vName</span></a></span><span>  </span><span class="annot"><span class="annottext">([Pat] -&gt; Pat) -&gt; (Pat -&gt; [Pat]) -&gt; Pat -&gt; Pat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; [Pat] -&gt; [Pat]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Pat, Exp) -&gt; (Pat, Exp)) -&gt; Q (Pat, Exp) -&gt; Q (Pat, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;vec&quot;</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">Common -&gt; Q Common
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Common :: Name
-&gt; Name
-&gt; (Pat, Exp)
-&gt; (Pat, Exp)
-&gt; (Pat, Exp)
-&gt; (Pat, Exp)
-&gt; (Pat, Exp)
-&gt; Common
</span><a href="Data.Vector.Unboxed.Deriving.html#Common"><span class="hs-identifier hs-type">Common</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Name
(Pat, Exp)
v :: (Pat, Exp)
mv' :: (Pat, Exp)
mv :: (Pat, Exp)
n :: (Pat, Exp)
i :: (Pat, Exp)
vName :: Name
mvName :: Name
v :: (Pat, Exp)
mv' :: (Pat, Exp)
mv :: (Pat, Exp)
n :: (Pat, Exp)
i :: (Pat, Exp)
vName :: Name
mvName :: Name
</span><a href="#local-6989586621679040574"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679040577"><span class="annot"><span class="annottext">conPCompat :: Name -&gt; [Pat] -&gt; Pat
</span><a href="#local-6989586621679040577"><span class="hs-identifier hs-var hs-var">conPCompat</span></a></span></span><span> </span><span id="local-6989586621679040573"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040573"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679040572"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679040572"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><span class="hs-identifier hs-var">ConP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040573"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,18,0)
</span><span>                             </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>                             </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679040572"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-type">liftE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-62"></span><span id="liftE"><span class="annot"><span class="annottext">liftE :: Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var hs-var">liftE</span></a></span></span><span> </span><span id="local-6989586621679040569"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040569"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040569"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">liftM</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Exp -&gt; Exp) -&gt; (Exp -&gt; Maybe Exp) -&gt; Exp -&gt; Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- Create a wrapper for the given function with the same 'nameBase', given</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- a list of argument bindings and expressions in terms of said bindings.</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- A final coercion (@Exp &#8594; Exp@) is applied to the body of the function.</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- Complimentary @INLINE@ pragma included.</span><span>
</span><span id="line-68"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span id="wrap"><span class="annot"><span class="annottext">wrap :: Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621679040566"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040566"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Pat, Exp)] -&gt; ([Pat], [Exp])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679040564"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679040564"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679040563"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679040563"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679040562"><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679040562"><span class="hs-identifier hs-var">coerce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040561"><span class="hs-identifier hs-var">inline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040560"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621679040561"><span class="annot"><span class="annottext">inline :: Dec
</span><a href="#local-6989586621679040561"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pragma -&gt; Dec
</span><span class="hs-identifier hs-var">PragmaD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Inline -&gt; RuleMatch -&gt; Phases -&gt; Pragma
</span><span class="hs-identifier hs-var">InlineP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040566"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Inline
</span><span class="hs-identifier hs-var">Inline</span></span><span> </span><span class="annot"><span class="annottext">RuleMatch
</span><span class="hs-identifier hs-var">FunLike</span></span><span> </span><span class="annot"><span class="annottext">Phases
</span><span class="hs-identifier hs-var">AllPhases</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679040557"><span class="annot"><span class="annottext">body :: Exp
</span><a href="#local-6989586621679040557"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp
</span><a href="#local-6989586621679040562"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; Exp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; Exp -&gt; [Exp] -&gt; Exp
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040566"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679040563"><span class="hs-identifier hs-var">exps</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679040560"><span class="annot"><span class="annottext">method :: Dec
</span><a href="#local-6989586621679040560"><span class="hs-identifier hs-var hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040566"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679040564"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040557"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">{-| Let's consider a more complex example: suppose we want an @Unbox@
instance for @Maybe a@. We could encode this using the pair @(Bool, a)@,
with the boolean indicating whether we have @Nothing@ or @Just@ something.
This encoding requires a dummy value in the @Nothing@ case, necessitating an
additional &lt;http://hackage.haskell.org/package/data-default/docs/Data-Default.html#t:Default Default&gt;
constraint. Thus:

&gt;derivingUnbox &quot;Maybe&quot;
&gt;    [t| &#8704; a. (Default a, Unbox a) &#8658; Maybe a &#8594; (Bool, a) |]
&gt;    [| maybe (False, def) (\ x &#8594; (True, x)) |]
&gt;    [| \ (b, x) &#8594; if b then Just x else Nothing |]
-}</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#derivingUnbox"><span class="hs-identifier hs-type">derivingUnbox</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="hs-comment">-- ^ Unique constructor suffix for the MVector and Vector data families</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeQ</span></span><span>    </span><span class="hs-comment">-- ^ Quotation of the form @[t| /ctxt/ &#8658; src &#8594; rep |]@</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExpQ</span></span><span>     </span><span class="hs-comment">-- ^ Quotation of an expression of type @src &#8594; rep@</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExpQ</span></span><span>     </span><span class="hs-comment">-- ^ Quotation of an expression of type @rep &#8594; src@</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecsQ</span></span><span>    </span><span class="hs-comment">-- ^ Declarations to be spliced for the derived Unbox instance</span><span>
</span><span id="line-92"></span><span id="derivingUnbox"><span class="annot"><span class="annottext">derivingUnbox :: String -&gt; TypeQ -&gt; ExpQ -&gt; ExpQ -&gt; DecsQ
</span><a href="Data.Vector.Unboxed.Deriving.html#derivingUnbox"><span class="hs-identifier hs-var hs-var">derivingUnbox</span></a></span></span><span> </span><span id="local-6989586621679040551"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040551"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679040550"><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679040550"><span class="hs-identifier hs-var">argsQ</span></a></span></span><span> </span><span id="local-6989586621679040549"><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679040549"><span class="hs-identifier hs-var">toRepQ</span></a></span></span><span> </span><span id="local-6989586621679040548"><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679040548"><span class="hs-identifier hs-var">fromRepQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#Common"><span class="hs-identifier hs-type">Common</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679040541"><span id="local-6989586621679040542"><span id="local-6989586621679040543"><span id="local-6989586621679040544"><span id="local-6989586621679040545"><span id="local-6989586621679040546"><span id="local-6989586621679040547"><span class="annot"><span class="annottext">Name
(Pat, Exp)
v :: (Pat, Exp)
mv' :: (Pat, Exp)
mv :: (Pat, Exp)
n :: (Pat, Exp)
i :: (Pat, Exp)
vName :: Name
mvName :: Name
v :: Common -&gt; (Pat, Exp)
mv' :: Common -&gt; (Pat, Exp)
mv :: Common -&gt; (Pat, Exp)
n :: Common -&gt; (Pat, Exp)
i :: Common -&gt; (Pat, Exp)
vName :: Common -&gt; Name
mvName :: Common -&gt; Name
</span><a href="#local-6989586621679040541"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Common
</span><a href="Data.Vector.Unboxed.Deriving.html#common"><span class="hs-identifier hs-var">common</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679040551"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679040540"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040540"><span class="hs-identifier hs-var">toRep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679040549"><span class="hs-identifier hs-var">toRepQ</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679040539"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040539"><span class="hs-identifier hs-var">fromRep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpQ
</span><a href="#local-6989586621679040548"><span class="hs-identifier hs-var">fromRepQ</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679040538"><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040538"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp) -&gt; (Pat, Exp) -&gt; (Pat, Exp)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040540"><span class="hs-identifier hs-var">toRep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Pat, Exp) -&gt; (Pat, Exp)) -&gt; Q (Pat, Exp) -&gt; Q (Pat, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Pat, Exp)
</span><a href="Data.Vector.Unboxed.Deriving.html#newPatExp"><span class="hs-identifier hs-var">newPatExp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;val&quot;</span></span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679040536"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040536"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679040550"><span class="hs-identifier hs-var">argsQ</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679040535"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040535"><span class="hs-identifier hs-var">cxts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679040534"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679040533"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040533"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040536"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679040531"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040531"><span class="hs-identifier hs-var">cxts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`AppT`</span></span><span> </span><span id="local-6989586621679040528"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040528"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`AppT`</span></span><span> </span><span id="local-6989586621679040527"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040527"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Cxt, Type, Type) -&gt; Q (Cxt, Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040531"><span class="hs-identifier hs-var">cxts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040528"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040527"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`AppT`</span></span><span> </span><span id="local-6989586621679040526"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040526"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`AppT`</span></span><span> </span><span id="local-6989586621679040525"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040525"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Cxt, Type, Type) -&gt; Q (Cxt, Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040526"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040525"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Cxt, Type, Type)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expecting a type of the form: cxts =&gt; typ -&gt; rep&quot;</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040524"><span class="annot"><span class="annottext">s :: Type
</span><a href="#local-6989586621679040524"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;s&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040522"><span class="annot"><span class="annottext">lazy :: Bang
</span><a href="#local-6989586621679040522"><span class="hs-identifier hs-var hs-var">lazy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><span class="hs-identifier hs-var">Bang</span></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><span class="hs-identifier hs-var">NoSourceUnpackedness</span></span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><span class="hs-identifier hs-var">NoSourceStrictness</span></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040518"><span class="annot"><span class="annottext">newtypeMVector :: Dec
</span><a href="#local-6989586621679040518"><span class="hs-identifier hs-var hs-var">newtypeMVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Cxt -&gt; Con -&gt; Dec
</span><a href="Data.Vector.Unboxed.Deriving.html#newtypeInstD%27"><span class="hs-identifier hs-var">newtypeInstD'</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MVector</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040524"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040547"><span class="hs-identifier hs-var">mvName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621679040522"><span class="hs-identifier hs-var">lazy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MVector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040524"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040533"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040514"><span class="annot"><span class="annottext">mvCon :: Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var hs-var">mvCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040547"><span class="hs-identifier hs-var">mvName</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040512"><span class="annot"><span class="annottext">instanceMVector :: Dec
</span><a href="#local-6989586621679040512"><span class="hs-identifier hs-var hs-var">instanceMVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap -&gt; Cxt -&gt; Type -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040535"><span class="hs-identifier hs-var">cxts</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">M.MVector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MVector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; Dec) -&gt; [Dec] -&gt; Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]] -&gt; [Dec]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-110"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicLength</span><span>           </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-111"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeSlice</span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040544"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var">mvCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicOverlaps</span><span>         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040542"><span class="hs-identifier hs-var">mv'</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeNew</span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040544"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var">mvCon</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_vector(0,11,0)
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicInitialize</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-cpp">
#endif
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeReplicate</span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040544"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040538"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var">mvCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeRead</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040539"><span class="hs-identifier hs-var">fromRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeWrite</span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040538"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-120"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicClear</span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-121"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicSet</span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040538"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-122"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeCopy</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040542"><span class="hs-identifier hs-var">mv'</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeMove</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040542"><span class="hs-identifier hs-var">mv'</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">M.basicUnsafeGrow</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040544"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var">mvCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040508"><span class="annot"><span class="annottext">newtypeVector :: Dec
</span><a href="#local-6989586621679040508"><span class="hs-identifier hs-var hs-var">newtypeVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Cxt -&gt; Con -&gt; Dec
</span><a href="Data.Vector.Unboxed.Deriving.html#newtypeInstD%27"><span class="hs-identifier hs-var">newtypeInstD'</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Vector</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040546"><span class="hs-identifier hs-var">vName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621679040522"><span class="hs-identifier hs-var">lazy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Vector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040533"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040507"><span class="annot"><span class="annottext">vCon :: Exp
</span><a href="#local-6989586621679040507"><span class="hs-identifier hs-var hs-var">vCon</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040546"><span class="hs-identifier hs-var">vName</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679040506"><span class="annot"><span class="annottext">instanceVector :: Dec
</span><a href="#local-6989586621679040506"><span class="hs-identifier hs-var hs-var">instanceVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap -&gt; Cxt -&gt; Type -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040535"><span class="hs-identifier hs-var">cxts</span></a></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">G.Vector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Vector</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; Dec) -&gt; [Dec] -&gt; Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]] -&gt; [Dec]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicUnsafeFreeze</span><span>     </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040507"><span class="hs-identifier hs-var">vCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicUnsafeThaw</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040514"><span class="hs-identifier hs-var">mvCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicLength</span><span>           </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicUnsafeSlice</span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040544"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040507"><span class="hs-identifier hs-var">vCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicUnsafeIndexM</span><span>     </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="Data.Vector.Unboxed.Deriving.html#liftE"><span class="hs-identifier hs-var">liftE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679040539"><span class="hs-identifier hs-var">fromRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.basicUnsafeCopy</span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040543"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [(Pat, Exp)] -&gt; (Exp -&gt; Exp) -&gt; [Dec]
</span><a href="Data.Vector.Unboxed.Deriving.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">G.elemseq</span><span>               </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Pat, Exp)
</span><a href="#local-6989586621679040538"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Exp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">[Dec] -&gt; DecsQ
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap -&gt; Cxt -&gt; Type -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040535"><span class="hs-identifier hs-var">cxts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Unbox</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679040534"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040518"><span class="hs-identifier hs-var">newtypeMVector</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040512"><span class="hs-identifier hs-var">instanceMVector</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040508"><span class="hs-identifier hs-var">newtypeVector</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679040506"><span class="hs-identifier hs-var">instanceVector</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Data.Vector.Unboxed.Deriving.html#newtypeInstD%27"><span class="hs-identifier hs-type">newtypeInstD'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-145"></span><span id="newtypeInstD%27"><span class="annot"><span class="annottext">newtypeInstD' :: Name -&gt; Cxt -&gt; Con -&gt; Dec
</span><a href="Data.Vector.Unboxed.Deriving.html#newtypeInstD%27"><span class="hs-identifier hs-var hs-var">newtypeInstD'</span></a></span></span><span> </span><span id="local-6989586621679040505"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040505"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679040504"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040504"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679040503"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679040503"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,15,0)
</span><span>    </span><span class="annot"><span class="annottext">Cxt
-&gt; Maybe [TyVarBndr]
-&gt; Type
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">NewtypeInstD</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; Cxt -&gt; Type
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679040505"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679040504"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679040503"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-152"></span><span class="hs-comment">{-$usage

Writing @Unbox@ instances for new data types is tedious and formulaic. More
often than not, there is a straightforward mapping of the new type onto some
existing one already imbued with an @Unbox@ instance. The
&lt;http://hackage.haskell.org/package/vector/docs/Data-Vector-Unboxed.html example&gt;
from the @vector@ package represents @Complex a@ as pairs @(a, a)@. Using
'derivingUnbox', we can define the same instances much more succinctly:

&gt;derivingUnbox &quot;Complex&quot;
&gt;    [t| &#8704; a. (Unbox a) &#8658; Complex a &#8594; (a, a) |]
&gt;    [| \ (r :+ i) &#8594; (r, i) |]
&gt;    [| \ (r, i) &#8594; r :+ i |]

Requires the @MultiParamTypeClasses@, @TemplateHaskell@, @TypeFamilies@ and
probably the @FlexibleInstances@ @LANGUAGE@ extensions. Note that GHC 7.4
(but not earlier nor later) needs the 'G.Vector' and 'M.MVector' class
method names to be in scope in order to define the appropriate instances:

&gt;#if __GLASGOW_HASKELL__ == 704
&gt;import qualified Data.Vector.Generic
&gt;import qualified Data.Vector.Generic.Mutable
&gt;#endif

Consult the &lt;https://github.com/liyang/vector-th-unbox/blob/master/tests/sanity.hs sanity test&gt;
for a working example.

-}</span><span>
</span><span id="line-180"></span></pre></body></html>