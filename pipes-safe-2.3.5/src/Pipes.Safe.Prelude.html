<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Simple resource management functions</span></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes, Safe #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pipes.Safe.Prelude</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Handle management</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-identifier">withFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#withBinaryFile"><span class="hs-identifier">withBinaryFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#openFile"><span class="hs-identifier">openFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#openBinaryFile"><span class="hs-identifier">openBinaryFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><span class="hs-comment">-- * String I/O</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><span class="hs-comment">-- $strings</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#readFile"><span class="hs-identifier">readFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#writeFile"><span class="hs-identifier">writeFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Registering/releasing</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier">allocate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Pipes.Safe.Prelude.html#allocate_"><span class="hs-identifier">allocate_</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mask_</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pipes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Producer'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Consumer'</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Pipes.Safe.html"><span class="hs-identifier">Pipes.Safe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#bracket"><span class="hs-identifier">bracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier">liftBase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#register"><span class="hs-identifier">register</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier">Base</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier">MonadSafe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier">ReleaseKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Pipes.Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IO</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readFile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><span class="hs-comment">{- | Acquire a 'IO.Handle' within 'MonadSafe'

     The file is opened in text mode. See also: 'withBinaryFile'
-}</span></span><span>
</span><span id="line-34"></span><span id="local-6989586621679062374"><span id="local-6989586621679062379"><span class="annot"><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-identifier hs-type">withFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.IOMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO.Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062379"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062379"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-35"></span><span id="withFile"><span class="annot"><span class="annottext">withFile :: forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-identifier hs-var hs-var">withFile</span></a></span></span><span> </span><span id="local-6989586621679062470"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062470"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679062471"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062471"><span class="hs-identifier hs-var">ioMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Base m Handle -&gt; (Handle -&gt; Base m ()) -&gt; (Handle -&gt; m r) -&gt; m r
forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Pipes.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Handle -&gt; Base m Handle
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Handle -&gt; Base m Handle) -&gt; IO Handle -&gt; Base m Handle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">IO.openFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062470"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062471"><span class="hs-identifier hs-var">ioMode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Base m ()
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Base m ()) -&gt; (Handle -&gt; IO ()) -&gt; Handle -&gt; Base m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">IO.hClose</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-pragma hs-type">withFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><span class="hs-comment">{- | Like 'withFile', but open the file in binary mode

     See 'System.IO.hSetBinaryMode' for the differences between binary and text mode.
-}</span></span><span>
</span><span id="line-42"></span><span id="local-6989586621679062475"><span id="local-6989586621679062476"><span class="annot"><a href="Pipes.Safe.Prelude.html#withBinaryFile"><span class="hs-identifier hs-type">withBinaryFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.IOMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO.Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062476"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062476"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-43"></span><span id="withBinaryFile"><span class="annot"><span class="annottext">withBinaryFile :: forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><a href="Pipes.Safe.Prelude.html#withBinaryFile"><span class="hs-identifier hs-var hs-var">withBinaryFile</span></a></span></span><span> </span><span id="local-6989586621679062482"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062482"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679062483"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062483"><span class="hs-identifier hs-var">ioMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Base m Handle -&gt; (Handle -&gt; Base m ()) -&gt; (Handle -&gt; m r) -&gt; m r
forall (m :: * -&gt; *) a b c.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Pipes.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Handle -&gt; Base m Handle
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Handle -&gt; Base m Handle) -&gt; IO Handle -&gt; Base m Handle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">IO.openBinaryFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062482"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062483"><span class="hs-identifier hs-var">ioMode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Base m ()
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Base m ()) -&gt; (Handle -&gt; IO ()) -&gt; Handle -&gt; Base m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">IO.hClose</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#withBinaryFile"><span class="hs-pragma hs-type">withBinaryFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">{- | Acquire a 'IO.Handle' within 'MonadSafe'

     The 'ReleaseKey' can be used to close the handle with 'Pipes.Safe.release';
     otherwise the handle will be closed automatically at the conclusion of the
     'MonadSafe' block.

     The file is opened in text mode. See also: 'openBinaryFile'
-}</span></span><span>
</span><span id="line-54"></span><span id="local-6989586621679062399"><span class="annot"><a href="Pipes.Safe.Prelude.html#openFile"><span class="hs-identifier hs-type">openFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062399"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.IOMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062399"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.Handle</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-55"></span><span id="openFile"><span class="annot"><span class="annottext">openFile :: forall (m :: * -&gt; *).
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; m (ReleaseKey, Handle)
</span><a href="Pipes.Safe.Prelude.html#openFile"><span class="hs-identifier hs-var hs-var">openFile</span></a></span></span><span> </span><span id="local-6989586621679062490"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062490"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679062491"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062491"><span class="hs-identifier hs-var">ioMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Base m Handle -&gt; (Handle -&gt; Base m ()) -&gt; m (ReleaseKey, Handle)
forall (m :: * -&gt; *) a.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m ()) -&gt; m (ReleaseKey, a)
</span><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Handle -&gt; Base m Handle
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Handle -&gt; Base m Handle) -&gt; IO Handle -&gt; Base m Handle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">IO.openFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062490"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062491"><span class="hs-identifier hs-var">ioMode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Base m ()
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Base m ()) -&gt; (Handle -&gt; IO ()) -&gt; Handle -&gt; Base m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">IO.hClose</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#openFile"><span class="hs-pragma hs-type">openFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><span class="hs-comment">{- | Like 'openFile', but open the file in binary mode

     See 'System.IO.hSetBinaryMode' for the differences between binary and text mode.
-}</span></span><span>
</span><span id="line-62"></span><span id="local-6989586621679062492"><span class="annot"><a href="Pipes.Safe.Prelude.html#openBinaryFile"><span class="hs-identifier hs-type">openBinaryFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.IOMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO.Handle</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-63"></span><span id="openBinaryFile"><span class="annot"><span class="annottext">openBinaryFile :: forall (m :: * -&gt; *).
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; m (ReleaseKey, Handle)
</span><a href="Pipes.Safe.Prelude.html#openBinaryFile"><span class="hs-identifier hs-var hs-var">openBinaryFile</span></a></span></span><span> </span><span id="local-6989586621679062498"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062498"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679062499"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062499"><span class="hs-identifier hs-var">ioMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Base m Handle -&gt; (Handle -&gt; Base m ()) -&gt; m (ReleaseKey, Handle)
forall (m :: * -&gt; *) a.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m ()) -&gt; m (ReleaseKey, a)
</span><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Handle -&gt; Base m Handle
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Handle -&gt; Base m Handle) -&gt; IO Handle -&gt; Base m Handle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">IO.openBinaryFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062498"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679062499"><span class="hs-identifier hs-var">ioMode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Base m ()
forall a. IO a -&gt; Base m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Base m ()) -&gt; (Handle -&gt; IO ()) -&gt; Handle -&gt; Base m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">IO.hClose</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#openBinaryFile"><span class="hs-pragma hs-type">openBinaryFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><span class="hs-comment">{- $strings
    Note that 'String's are very inefficient, and I will release future separate
    packages with 'Data.ByteString.ByteString' and 'Data.Text.Text' operations.
    I only provide these to allow users to test simple I/O without requiring any
    additional library dependencies.
-}</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">{-| Read lines from a file, automatically opening and closing the file as
    necessary
-}</span></span><span>
</span><span id="line-76"></span><span id="local-6989586621679062405"><span class="annot"><a href="Pipes.Safe.Prelude.html#readFile"><span class="hs-identifier hs-type">readFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Producer'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679062405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-77"></span><span id="readFile"><span class="annot"><span class="annottext">readFile :: forall (m :: * -&gt; *).
MonadSafe m =&gt;
FilePath -&gt; Producer' FilePath m ()
</span><a href="Pipes.Safe.Prelude.html#readFile"><span class="hs-identifier hs-var hs-var">readFile</span></a></span></span><span> </span><span id="local-6989586621679062506"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062506"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; IOMode
-&gt; (Handle -&gt; Proxy x' x () FilePath m ())
-&gt; Proxy x' x () FilePath m ()
forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-identifier hs-var">withFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062506"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">IO.ReadMode</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Proxy x' x () FilePath m ()
forall (m :: * -&gt; *) x' x.
MonadIO m =&gt;
Handle -&gt; Proxy x' x () FilePath m ()
</span><span class="hs-identifier hs-var">P.fromHandle</span></span><span>
</span><span id="line-78"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#readFile"><span class="hs-pragma hs-type">readFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">{-| Write lines to a file, automatically opening and closing the file as
    necessary
-}</span></span><span>
</span><span id="line-83"></span><span id="local-6989586621679062419"><span id="local-6989586621679062420"><span class="annot"><a href="Pipes.Safe.Prelude.html#writeFile"><span class="hs-identifier hs-type">writeFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062419"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Consumer'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679062419"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062420"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-84"></span><span id="writeFile"><span class="annot"><span class="annottext">writeFile :: forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
FilePath -&gt; Consumer' FilePath m r
</span><a href="Pipes.Safe.Prelude.html#writeFile"><span class="hs-identifier hs-var hs-var">writeFile</span></a></span></span><span> </span><span id="local-6989586621679062513"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062513"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; IOMode
-&gt; (Handle -&gt; Proxy () FilePath y' y m r)
-&gt; Proxy () FilePath y' y m r
forall (m :: * -&gt; *) r.
MonadSafe m =&gt;
FilePath -&gt; IOMode -&gt; (Handle -&gt; m r) -&gt; m r
</span><a href="Pipes.Safe.Prelude.html#withFile"><span class="hs-identifier hs-var">withFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679062513"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">IO.WriteMode</span></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; Proxy () FilePath y' y m r)
 -&gt; Proxy () FilePath y' y m r)
-&gt; (Handle -&gt; Proxy () FilePath y' y m r)
-&gt; Proxy () FilePath y' y m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062515"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679062515"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Consumer' FilePath m r
forall (m :: * -&gt; *) r.
MonadIO m =&gt;
Handle -&gt; Consumer' FilePath m r
</span><span class="hs-identifier hs-var">P.toHandle</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679062515"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-85"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Safe.Prelude.html#writeFile"><span class="hs-pragma hs-type">writeFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">{- | Acquire some resource with a guarantee that it will eventually be released

     The 'ReleaseKey' can be passed to 'Pipes.Safe.release' to
     release the resource manually. If this has not been done by the end
     of the 'MonadSafe' block, the resource will be released automatically.
-}</span></span><span>
</span><span id="line-93"></span><span id="local-6989586621679062402"><span id="local-6989586621679062403"><span class="annot"><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier hs-type">allocate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062403"><span class="hs-identifier hs-type">a</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Acquire</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062403"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Release</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679062403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-97"></span><span id="allocate"><span class="annot"><span class="annottext">allocate :: forall (m :: * -&gt; *) a.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m ()) -&gt; m (ReleaseKey, a)
</span><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier hs-var hs-var">allocate</span></a></span></span><span> </span><span id="local-6989586621679062531"><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679062531"><span class="hs-identifier hs-var">acq</span></a></span></span><span> </span><span id="local-6989586621679062532"><span class="annot"><span class="annottext">a -&gt; Base m ()
</span><a href="#local-6989586621679062532"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (ReleaseKey, a) -&gt; m (ReleaseKey, a)
forall (m :: * -&gt; *) a. (HasCallStack, MonadMask m) =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(m (ReleaseKey, a) -&gt; m (ReleaseKey, a))
-&gt; m (ReleaseKey, a) -&gt; m (ReleaseKey, a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679062533"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062533"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Base m a -&gt; m a
forall r. Base m r -&gt; m r
forall (m :: * -&gt; *) r. MonadSafe m =&gt; Base m r -&gt; m r
</span><a href="Pipes.Safe.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span> </span><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679062531"><span class="hs-identifier hs-var">acq</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679062534"><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679062534"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Base m () -&gt; m ReleaseKey
forall (m :: * -&gt; *). MonadSafe m =&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.html#register"><span class="hs-identifier hs-var">register</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Base m ()
</span><a href="#local-6989586621679062532"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062533"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">(ReleaseKey, a) -&gt; m (ReleaseKey, a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReleaseKey
</span><a href="#local-6989586621679062534"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062533"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><span class="hs-comment">{- | Like 'allocate', but for when the resource itself is not needed

     The acquire  action runs immediately. The 'ReleaseKey' can be passed
     to 'Pipes.Safe.release' to run the release action. If this has not been
     done by the end of the 'MonadSafe' block, the release action will be
     run automatically.
-}</span></span><span>
</span><span id="line-109"></span><span id="local-6989586621679062437"><span id="local-6989586621679062438"><span class="annot"><a href="Pipes.Safe.Prelude.html#allocate_"><span class="hs-identifier hs-type">allocate_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Safe.html#MonadSafe"><span class="hs-identifier hs-type">MonadSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062438"><span class="hs-identifier hs-type">a</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Acquire</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Safe.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Release</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Pipes.Safe.html#ReleaseKey"><span class="hs-identifier hs-type">ReleaseKey</span></a></span></span></span><span>
</span><span id="line-113"></span><span id="allocate_"><span class="annot"><span class="annottext">allocate_ :: forall (m :: * -&gt; *) a.
MonadSafe m =&gt;
Base m a -&gt; Base m () -&gt; m ReleaseKey
</span><a href="Pipes.Safe.Prelude.html#allocate_"><span class="hs-identifier hs-var hs-var">allocate_</span></a></span></span><span> </span><span id="local-6989586621679062544"><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679062544"><span class="hs-identifier hs-var">acq</span></a></span></span><span> </span><span id="local-6989586621679062545"><span class="annot"><span class="annottext">Base m ()
</span><a href="#local-6989586621679062545"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ReleaseKey, a) -&gt; ReleaseKey)
-&gt; m (ReleaseKey, a) -&gt; m ReleaseKey
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ReleaseKey, a) -&gt; ReleaseKey
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Base m a -&gt; (a -&gt; Base m ()) -&gt; m (ReleaseKey, a)
forall (m :: * -&gt; *) a.
MonadSafe m =&gt;
Base m a -&gt; (a -&gt; Base m ()) -&gt; m (ReleaseKey, a)
</span><a href="Pipes.Safe.Prelude.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span> </span><span class="annot"><span class="annottext">Base m a
</span><a href="#local-6989586621679062544"><span class="hs-identifier hs-var">acq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Base m () -&gt; a -&gt; Base m ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Base m ()
</span><a href="#local-6989586621679062545"><span class="hs-identifier hs-var">rel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span></pre></body></html>