<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-2"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Euterpea.IO.MIDI.MidiIO</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-3"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#getAllDevices"><span class="hs-identifier">getAllDevices</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">--isValidInputDevice, isValidOutputDevice, -- Used only by Euterpea.IO.MUI.MidiWidgets</span><span>
</span><span id="line-4"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#terminateMidi"><span class="hs-identifier">terminateMidi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#initializeMidi"><span class="hs-identifier">initializeMidi</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Used only by Euterpea.IO.MUI</span><span>
</span><span id="line-5"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#outputMidi"><span class="hs-identifier">outputMidi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#deliverMidiEvent"><span class="hs-identifier">deliverMidiEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Used only by Euterpea.IO.MUI.MidiWidgets (particularly by midiOut)</span><span>
</span><span id="line-6"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#pollMidi"><span class="hs-identifier">pollMidi</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Used only by Euterpea.IO.MUI.MidiWidgets (particularly by midiIn)</span><span>
</span><span id="line-7"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#defaultOutput"><span class="hs-identifier">defaultOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#defaultInput"><span class="hs-identifier">defaultInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#playMidi"><span class="hs-identifier">playMidi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#MidiMessage"><span class="hs-identifier">MidiMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#ANote"><span class="hs-identifier">ANote</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#Std"><span class="hs-identifier">Std</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier">getTimeNow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="hs-identifier">DeviceInfo</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier">InputDeviceID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier">OutputDeviceID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Message</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Time</span></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeInputID"><span class="hs-identifier">unsafeInputID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeOutputID"><span class="hs-identifier">unsafeOutputID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Midi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Channel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Key</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Velocity</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span class="hs-operator">&gt;</span><span>                    </span><span class="annot"><span class="hs-identifier">Message</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Midi</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Track</span></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span class="hs-operator">&gt;</span><span>                    </span><span class="annot"><span class="hs-identifier">toRealTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toAbsTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toSingleTrack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isTrackEnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Sound.PortMidi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeviceInfo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getDeviceInfo</span></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">DeviceID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">countDevices</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">time</span></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">getDefaultOutputDeviceID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getDefaultInputDeviceID</span></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">openInput</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">openOutput</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readEvents</span></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">close</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeShort</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getErrorText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">terminate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">initialize</span></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">PMStream</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PMError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">PMEvent</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PMMsg</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-25"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">encodeMsg</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decodeMsg</span></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span class="hs-operator">&gt;</span><span>                        </span><span class="annot"><span class="hs-identifier">PMSuccess</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">finally</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-29"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM.TChan</span></span><span>
</span><span id="line-30"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.|.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">findIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Heap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Heap</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hPutStrLn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-44"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">declarations</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-45"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">type</span><span> </span><span id="MidiEvent"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#MidiEvent"><span class="hs-identifier hs-var">MidiEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#MidiMessage"><span class="hs-identifier hs-type">MidiMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="MidiMessage"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#MidiMessage"><span class="hs-identifier hs-var">MidiMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ANote"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#ANote"><span class="hs-identifier hs-var">ANote</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="channel"><span class="annot"><span class="annottext">MidiMessage -&gt; Channel
</span><a href="Euterpea.IO.MIDI.MidiIO.html#channel"><span class="hs-identifier hs-var hs-var">channel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Channel</span></span><span class="hs-special">,</span><span> </span><span id="key"><span class="annot"><span class="annottext">MidiMessage -&gt; Channel
</span><a href="Euterpea.IO.MIDI.MidiIO.html#key"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Key</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span class="hs-operator">&gt;</span><span>                           </span><span id="velocity"><span class="annot"><span class="annottext">MidiMessage -&gt; Channel
</span><a href="Euterpea.IO.MIDI.MidiIO.html#velocity"><span class="hs-identifier hs-var hs-var">velocity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Velocity</span></span><span class="hs-special">,</span><span> </span><span id="duration"><span class="annot"><span class="annottext">MidiMessage -&gt; Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#duration"><span class="hs-identifier hs-var hs-var">duration</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-51"></span><span class="hs-operator">&gt;</span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="Std"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#Std"><span class="hs-identifier hs-var">Std</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-52"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679092273"><span id="local-6989586621679092275"><span id="local-6989586621679092277"><span class="annot"><span class="annottext">Channel -&gt; MidiMessage -&gt; ShowS
[MidiMessage] -&gt; ShowS
MidiMessage -&gt; String
(Channel -&gt; MidiMessage -&gt; ShowS)
-&gt; (MidiMessage -&gt; String)
-&gt; ([MidiMessage] -&gt; ShowS)
-&gt; Show MidiMessage
forall a.
(Channel -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MidiMessage] -&gt; ShowS
$cshowList :: [MidiMessage] -&gt; ShowS
show :: MidiMessage -&gt; String
$cshow :: MidiMessage -&gt; String
showsPrec :: Channel -&gt; MidiMessage -&gt; ShowS
$cshowsPrec :: Channel -&gt; MidiMessage -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span id="InputDeviceID"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-var">InputDeviceID</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InputDeviceID"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-var">InputDeviceID</span></a></span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DeviceID</span></span><span>
</span><span id="line-55"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092267"><span id="local-6989586621679092269"><span class="annot"><span class="annottext">InputDeviceID -&gt; InputDeviceID -&gt; Bool
(InputDeviceID -&gt; InputDeviceID -&gt; Bool)
-&gt; (InputDeviceID -&gt; InputDeviceID -&gt; Bool) -&gt; Eq InputDeviceID
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InputDeviceID -&gt; InputDeviceID -&gt; Bool
$c/= :: InputDeviceID -&gt; InputDeviceID -&gt; Bool
== :: InputDeviceID -&gt; InputDeviceID -&gt; Bool
$c== :: InputDeviceID -&gt; InputDeviceID -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092260"><span id="local-6989586621679092262"><span id="local-6989586621679092264"><span class="annot"><span class="annottext">Channel -&gt; InputDeviceID -&gt; ShowS
[InputDeviceID] -&gt; ShowS
InputDeviceID -&gt; String
(Channel -&gt; InputDeviceID -&gt; ShowS)
-&gt; (InputDeviceID -&gt; String)
-&gt; ([InputDeviceID] -&gt; ShowS)
-&gt; Show InputDeviceID
forall a.
(Channel -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InputDeviceID] -&gt; ShowS
$cshowList :: [InputDeviceID] -&gt; ShowS
show :: InputDeviceID -&gt; String
$cshow :: InputDeviceID -&gt; String
showsPrec :: Channel -&gt; InputDeviceID -&gt; ShowS
$cshowsPrec :: Channel -&gt; InputDeviceID -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092258"><span class="annot"><span class="annottext">InputDeviceID -&gt; ()
(InputDeviceID -&gt; ()) -&gt; NFData InputDeviceID
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: InputDeviceID -&gt; ()
$crnf :: InputDeviceID -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span id="OutputDeviceID"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-var">OutputDeviceID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OutputDeviceID"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-var">OutputDeviceID</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeviceID</span></span><span>
</span><span id="line-57"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092252"><span id="local-6989586621679092254"><span class="annot"><span class="annottext">OutputDeviceID -&gt; OutputDeviceID -&gt; Bool
(OutputDeviceID -&gt; OutputDeviceID -&gt; Bool)
-&gt; (OutputDeviceID -&gt; OutputDeviceID -&gt; Bool) -&gt; Eq OutputDeviceID
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: OutputDeviceID -&gt; OutputDeviceID -&gt; Bool
$c/= :: OutputDeviceID -&gt; OutputDeviceID -&gt; Bool
== :: OutputDeviceID -&gt; OutputDeviceID -&gt; Bool
$c== :: OutputDeviceID -&gt; OutputDeviceID -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092246"><span id="local-6989586621679092248"><span id="local-6989586621679092250"><span class="annot"><span class="annottext">Channel -&gt; OutputDeviceID -&gt; ShowS
[OutputDeviceID] -&gt; ShowS
OutputDeviceID -&gt; String
(Channel -&gt; OutputDeviceID -&gt; ShowS)
-&gt; (OutputDeviceID -&gt; String)
-&gt; ([OutputDeviceID] -&gt; ShowS)
-&gt; Show OutputDeviceID
forall a.
(Channel -&gt; a -&gt; ShowS)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [OutputDeviceID] -&gt; ShowS
$cshowList :: [OutputDeviceID] -&gt; ShowS
show :: OutputDeviceID -&gt; String
$cshow :: OutputDeviceID -&gt; String
showsPrec :: Channel -&gt; OutputDeviceID -&gt; ShowS
$cshowsPrec :: Channel -&gt; OutputDeviceID -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092244"><span class="annot"><span class="annottext">OutputDeviceID -&gt; ()
(OutputDeviceID -&gt; ()) -&gt; NFData OutputDeviceID
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: OutputDeviceID -&gt; ()
$crnf :: OutputDeviceID -&gt; ()
</span><a href="#local-6989586621679092244"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeInputID"><span class="hs-identifier hs-type">unsafeInputID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span>
</span><span id="line-60"></span><span class="hs-operator">&gt;</span><span> </span><span id="unsafeInputID"><span class="annot"><span class="annottext">unsafeInputID :: Channel -&gt; InputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeInputID"><span class="hs-identifier hs-var hs-var">unsafeInputID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; InputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-var">InputDeviceID</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeOutputID"><span class="hs-identifier hs-type">unsafeOutputID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span>
</span><span id="line-63"></span><span class="hs-operator">&gt;</span><span> </span><span id="unsafeOutputID"><span class="annot"><span class="annottext">unsafeOutputID :: Channel -&gt; OutputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#unsafeOutputID"><span class="hs-identifier hs-var hs-var">unsafeOutputID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; OutputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-var">OutputDeviceID</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">----------</span><span>
</span><span id="line-66"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Time</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-67"></span><span class="hs-comment">----------</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-identifier">Is</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">want</span><span class="hs-operator">?</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">comes</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">PortMidi</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">there's</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-70"></span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">FRP.UISF.SOE.timeGetTime</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">uses</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">GLFW</span><span class="hs-operator">.</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-type">getTimeNow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span>
</span><span id="line-73"></span><span class="hs-operator">&gt;</span><span> </span><span id="getTimeNow"><span class="annot"><span class="annottext">getTimeNow :: IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var hs-var">getTimeNow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092243"><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679092243"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Timestamp
</span><span class="hs-identifier hs-var">time</span></span><span>
</span><span id="line-75"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">Time -&gt; IO Time
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Timestamp -&gt; Time
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679092243"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-79"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Device</span><span> </span><span class="hs-identifier">Functions</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-80"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-identifier">getAllDevices</span><span> </span><span class="hs-identifier">returns</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">DeviceInfos</span><span> </span><span class="hs-identifier">found</span><span class="hs-operator">.</span><span>
</span><span id="line-83"></span><span class="hs-identifier">It</span><span> </span><span class="hs-identifier">calls</span><span> </span><span class="hs-identifier">Port.Midi.getDeviceInfo</span><span> </span><span class="hs-identifier">over</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">numbers</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#getAllDevices"><span class="hs-identifier hs-type">getAllDevices</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeviceInfo</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeviceInfo</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-operator">&gt;</span><span> </span><span id="getAllDevices"><span class="annot"><span class="annottext">getAllDevices :: IO ([(InputDeviceID, DeviceInfo)], [(OutputDeviceID, DeviceInfo)])
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getAllDevices"><span class="hs-identifier hs-var hs-var">getAllDevices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092241"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092241"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Channel
</span><span class="hs-identifier hs-var">countDevices</span></span><span>
</span><span id="line-88"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092240"><span class="annot"><span class="annottext">[DeviceInfo]
</span><a href="#local-6989586621679092240"><span class="hs-identifier hs-var">deviceInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Channel -&gt; IO DeviceInfo) -&gt; [Channel] -&gt; IO [DeviceInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO DeviceInfo
</span><span class="hs-identifier hs-var">getDeviceInfo</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092241"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679092238"><span class="annot"><span class="annottext">devs :: [(Channel, DeviceInfo)]
</span><a href="#local-6989586621679092238"><span class="hs-identifier hs-var hs-var">devs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Channel] -&gt; [DeviceInfo] -&gt; [(Channel, DeviceInfo)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092241"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[DeviceInfo]
</span><a href="#local-6989586621679092240"><span class="hs-identifier hs-var">deviceInfos</span></a></span><span>
</span><span id="line-90"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">([(InputDeviceID, DeviceInfo)], [(OutputDeviceID, DeviceInfo)])
-&gt; IO
     ([(InputDeviceID, DeviceInfo)], [(OutputDeviceID, DeviceInfo)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; InputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-var">InputDeviceID</span></a></span><span>  </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092237"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092236"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092237"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092237"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092236"><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092236"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Channel, DeviceInfo)]
</span><a href="#local-6989586621679092238"><span class="hs-identifier hs-var">devs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeviceInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var">input</span></span><span>  </span><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092236"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; OutputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-var">OutputDeviceID</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092234"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092233"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092234"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092234"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092233"><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092233"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Channel, DeviceInfo)]
</span><a href="#local-6989586621679092238"><span class="hs-identifier hs-var">devs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeviceInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var">output</span></span><span> </span><span class="annot"><span class="annottext">DeviceInfo
</span><a href="#local-6989586621679092233"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-identifier">isValidInputDevice</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">isValideOutputDevice</span><span> </span><span class="hs-identifier">check</span><span> </span><span class="hs-identifier">whether</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">given</span><span>
</span><span id="line-95"></span><span class="hs-identifier">devices</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">respectively</span><span> </span><span class="hs-identifier">valid</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">input</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">output</span><span class="hs-operator">.</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-identifier">isValidInputDevice</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isValidOutputDevice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DeviceID</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-98"></span><span class="hs-identifier">isValidInputDevice</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isValidDevice</span><span> </span><span class="hs-identifier">input</span><span>
</span><span id="line-99"></span><span class="hs-identifier">isValidOutputDevice</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isValidDevice</span><span> </span><span class="hs-identifier">output</span><span>
</span><span id="line-100"></span><span class="hs-identifier">isValidDevice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DeviceInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DeviceID</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-101"></span><span class="hs-identifier">isValidDevice</span><span> </span><span class="hs-identifier">pred</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">countDevices</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getAllDevices</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">pred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">snd</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-operator">!!</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-109"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Default</span><span> </span><span class="hs-identifier">devices</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-110"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-identifier">Rather</span><span> </span><span class="hs-identifier">than</span><span> </span><span class="hs-identifier">export</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">deviceIDs</span><span> </span><span class="hs-identifier">directly</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">allow</span><span>
</span><span id="line-113"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">caller</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">DeviceID</span><span> </span><span class="hs-identifier">without</span><span> </span><span class="hs-identifier">directly</span><span> </span><span class="hs-identifier">controlling</span><span> </span><span class="hs-identifier">it</span><span class="hs-operator">.</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-identifier">They</span><span> </span><span class="hs-identifier">take</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">such</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">playMidi</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">auxiary</span><span> </span><span class="hs-identifier">argument</span><span> </span><span class="hs-identifier">and</span><span>
</span><span id="line-116"></span><span class="hs-identifier">apply</span><span> </span><span class="hs-identifier">them</span><span> </span><span class="hs-identifier">together</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">default</span><span> </span><span class="hs-identifier">device</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">If</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-keyword">default</span><span> </span><span class="hs-identifier">device</span><span>
</span><span id="line-117"></span><span class="hs-identifier">exists</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">thrown</span><span class="hs-operator">.</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679092230"><span id="local-6989586621679092231"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#defaultOutput"><span class="hs-identifier hs-type">defaultOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092231"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679092230"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092231"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679092230"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-120"></span><span class="hs-operator">&gt;</span><span> </span><span id="defaultOutput"><span class="annot"><span class="annottext">defaultOutput :: (OutputDeviceID -&gt; a -&gt; IO b) -&gt; a -&gt; IO b
</span><a href="Euterpea.IO.MIDI.MidiIO.html#defaultOutput"><span class="hs-identifier hs-var hs-var">defaultOutput</span></a></span></span><span> </span><span id="local-6989586621679092229"><span class="annot"><span class="annottext">OutputDeviceID -&gt; a -&gt; IO b
</span><a href="#local-6989586621679092229"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679092228"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092228"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092227"><span class="annot"><span class="annottext">Maybe Channel
</span><a href="#local-6989586621679092227"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Channel)
</span><span class="hs-identifier hs-var">getDefaultOutputDeviceID</span></span><span>
</span><span id="line-122"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Channel
</span><a href="#local-6989586621679092227"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe Channel
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No MIDI output device found&quot;</span></span><span>
</span><span id="line-124"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092225"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092225"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; a -&gt; IO b
</span><a href="#local-6989586621679092229"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; OutputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-var">OutputDeviceID</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092225"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092228"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-125"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-126"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679092223"><span id="local-6989586621679092224"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#defaultInput"><span class="hs-identifier hs-type">defaultInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092224"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679092223"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092224"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679092223"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-127"></span><span class="hs-operator">&gt;</span><span> </span><span id="defaultInput"><span class="annot"><span class="annottext">defaultInput :: (InputDeviceID -&gt; a -&gt; IO b) -&gt; a -&gt; IO b
</span><a href="Euterpea.IO.MIDI.MidiIO.html#defaultInput"><span class="hs-identifier hs-var hs-var">defaultInput</span></a></span></span><span> </span><span id="local-6989586621679092222"><span class="annot"><span class="annottext">InputDeviceID -&gt; a -&gt; IO b
</span><a href="#local-6989586621679092222"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679092221"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092221"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092220"><span class="annot"><span class="annottext">Maybe Channel
</span><a href="#local-6989586621679092220"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Channel)
</span><span class="hs-identifier hs-var">getDefaultInputDeviceID</span></span><span>
</span><span id="line-129"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Channel
</span><a href="#local-6989586621679092220"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-130"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe Channel
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No MIDI input device found&quot;</span></span><span>
</span><span id="line-131"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092219"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092219"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InputDeviceID -&gt; a -&gt; IO b
</span><a href="#local-6989586621679092222"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; InputDeviceID
</span><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-var">InputDeviceID</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092219"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092221"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-135"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Priority</span><span> </span><span class="hs-identifier">Channels</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-136"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">priority</span><span> </span><span class="hs-identifier">channel</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">constructor</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">used</span><span>
</span><span id="line-139"></span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">devices</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">them</span><span> </span><span class="hs-identifier">here</span><span class="hs-operator">.</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="PrioChannel"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-var">PrioChannel</span></a></span></span><span> </span><span id="local-6989586621679092416"><span class="annot"><a href="#local-6989586621679092416"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679092415"><span class="annot"><a href="#local-6989586621679092415"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PrioChannel"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-var">PrioChannel</span></a></span></span><span>
</span><span id="line-142"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-special">{</span><span> </span><span id="get"><span class="annot"><span class="annottext">PrioChannel a b -&gt; IO (MinPrioHeap a b)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#get"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Heap.MinPrioHeap</span></span><span> </span><span class="annot"><a href="#local-6989586621679092416"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679092415"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span class="hs-operator">&gt;</span><span>       </span><span id="push"><span class="annot"><span class="annottext">PrioChannel a b -&gt; a -&gt; b -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#push"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679092416"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092415"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span class="hs-operator">&gt;</span><span>       </span><span id="pop"><span class="annot"><span class="annottext">PrioChannel a b -&gt; IO (a, b)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#pop"><span class="hs-identifier hs-var hs-var">pop</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679092416"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679092415"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span class="hs-operator">&gt;</span><span>       </span><span id="peek"><span class="annot"><span class="annottext">PrioChannel a b -&gt; IO (Maybe (a, b))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#peek"><span class="hs-identifier hs-var hs-var">peek</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679092416"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679092415"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#makePriorityChannel"><span class="hs-identifier hs-type">makePriorityChannel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-type">PrioChannel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-operator">&gt;</span><span> </span><span id="makePriorityChannel"><span class="annot"><span class="annottext">makePriorityChannel :: IO (PrioChannel Time Message)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#makePriorityChannel"><span class="hs-identifier hs-var hs-var">makePriorityChannel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092212"><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092212"><span class="hs-identifier hs-var">heapRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
-&gt; IO (IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
forall prio val. HeapT prio val
</span><span class="hs-identifier hs-var">Heap.empty</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Heap.MinPrioHeap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679092209"><span class="annot"><span class="annottext">get :: IO (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092209"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
-&gt; IO (HeapT (Prio FstMinPolicy (Time, Message)) Message)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092212"><span class="hs-identifier hs-var">heapRef</span></a></span><span>
</span><span id="line-151"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092207"><span class="annot"><span class="annottext">push :: Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092207"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span> </span><span id="local-6989586621679092206"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092206"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679092205"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092205"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
-&gt; (HeapT (Prio FstMinPolicy (Time, Message)) Message
    -&gt; HeapT (Prio FstMinPolicy (Time, Message)) Message)
-&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092212"><span class="hs-identifier hs-var">heapRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Time, Message)
-&gt; HeapT
     (Prio FstMinPolicy (Time, Message))
     (Val FstMinPolicy (Time, Message))
-&gt; HeapT
     (Prio FstMinPolicy (Time, Message))
     (Val FstMinPolicy (Time, Message))
forall pol item.
HeapItem pol item =&gt;
item -&gt; Heap pol item -&gt; Heap pol item
</span><span class="hs-identifier hs-var">Heap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092206"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092205"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092202"><span class="annot"><span class="annottext">pop :: IO (Time, Message)
</span><a href="#local-6989586621679092202"><span class="hs-identifier hs-var hs-var">pop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092201"><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
</span><a href="#local-6989586621679092201"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092209"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-154"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092200"><span class="annot"><span class="annottext">(Time, Message)
</span><a href="#local-6989586621679092200"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092199"><span class="annot"><span class="annottext">HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
</span><a href="#local-6989586621679092199"><span class="hs-identifier hs-var">h'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
-&gt; Maybe
     ((Time, Message),
      HeapT
        (Prio FstMinPolicy (Time, Message))
        (Val FstMinPolicy (Time, Message)))
forall pol item.
HeapItem pol item =&gt;
Heap pol item -&gt; Maybe (item, Heap pol item)
</span><span class="hs-identifier hs-var">Heap.view</span></span><span> </span><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
</span><a href="#local-6989586621679092201"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-155"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
-&gt; (HeapT (Prio FstMinPolicy (Time, Message)) Message
    -&gt; HeapT (Prio FstMinPolicy (Time, Message)) Message)
-&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092212"><span class="hs-identifier hs-var">heapRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
</span><a href="#local-6989586621679092199"><span class="hs-identifier hs-var">h'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO (Time, Message)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Time, Message)
</span><a href="#local-6989586621679092200"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-157"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092197"><span class="annot"><span class="annottext">peek :: IO (Maybe (Time, Message))
</span><a href="#local-6989586621679092197"><span class="hs-identifier hs-var hs-var">peek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092196"><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
</span><a href="#local-6989586621679092196"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (HeapT (Prio FstMinPolicy (Time, Message)) Message)
</span><a href="#local-6989586621679092209"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-159"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Maybe (Time, Message) -&gt; IO (Maybe (Time, Message))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Time, Message) -&gt; IO (Maybe (Time, Message)))
-&gt; Maybe (Time, Message) -&gt; IO (Maybe (Time, Message))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
-&gt; Maybe (Time, Message)
forall pol item. HeapItem pol item =&gt; Heap pol item -&gt; Maybe item
</span><span class="hs-identifier hs-var">Heap.viewHead</span></span><span> </span><span class="annot"><span class="annottext">HeapT (Prio FstMinPolicy (Time, Message)) Message
HeapT
  (Prio FstMinPolicy (Time, Message))
  (Val FstMinPolicy (Time, Message))
</span><a href="#local-6989586621679092196"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-160"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-161"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">PrioChannel Time Message -&gt; IO (PrioChannel Time Message)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PrioChannel Time Message -&gt; IO (PrioChannel Time Message))
-&gt; PrioChannel Time Message -&gt; IO (PrioChannel Time Message)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO
  (HeapT
     (Prio FstMinPolicy (Time, Message))
     (Val FstMinPolicy (Time, Message)))
-&gt; (Time -&gt; Message -&gt; IO ())
-&gt; IO (Time, Message)
-&gt; IO (Maybe (Time, Message))
-&gt; PrioChannel Time Message
forall a b.
IO (MinPrioHeap a b)
-&gt; (a -&gt; b -&gt; IO ())
-&gt; IO (a, b)
-&gt; IO (Maybe (a, b))
-&gt; PrioChannel a b
</span><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-var">PrioChannel</span></a></span><span> </span><span class="annot"><span class="annottext">IO (HeapT (Prio FstMinPolicy (Time, Message)) Message)
IO
  (HeapT
     (Prio FstMinPolicy (Time, Message))
     (Val FstMinPolicy (Time, Message)))
</span><a href="#local-6989586621679092209"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092207"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Time, Message)
</span><a href="#local-6989586621679092202"><span class="hs-identifier hs-var">pop</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Time, Message))
</span><a href="#local-6989586621679092197"><span class="hs-identifier hs-var">peek</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-165"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Global</span><span> </span><span class="hs-identifier">Device</span><span> </span><span class="hs-identifier">Data</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-166"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">keep</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">mapping</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">DeviceID</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">priority</span><span> </span><span class="hs-identifier">channel</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">keeping</span><span>
</span><span id="line-169"></span><span class="hs-identifier">track</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">future</span><span> </span><span class="hs-identifier">MIDI</span><span> </span><span class="hs-identifier">messages</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">produce</span><span> </span><span class="hs-identifier">sound</span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">stop</span><span> </span><span class="hs-identifier">function</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">mapping</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">stored</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">global</span><span> </span><span class="hs-identifier">ref</span><span>
</span><span id="line-171"></span><span class="hs-identifier">outDevMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">accessed</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">getOutDev</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">looks</span><span> </span><span class="hs-identifier">up</span><span> </span><span class="hs-identifier">info</span><span>
</span><span id="line-172"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">adds</span><span> </span><span class="hs-identifier">associations</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">necessary</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">terminateMidi</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">calls</span><span>
</span><span id="line-173"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">stop</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">elements</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">clears</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">mapping</span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-identifier">outDevMap</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">global</span><span> </span><span class="hs-identifier">mapping</span><span class="hs-operator">.</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-type">outDevMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span class="hs-operator">&gt;</span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-type">PrioChannel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- priority channel</span><span>
</span><span id="line-179"></span><span class="hs-operator">&gt;</span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- sound output function</span><span>
</span><span id="line-180"></span><span class="hs-operator">&gt;</span><span>                       </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- stop/terminate function</span><span>
</span><span id="line-181"></span><span class="hs-operator">&gt;</span><span> </span><span id="outDevMap"><span class="annot"><span class="annottext">outDevMap :: IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-var hs-var">outDevMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO
  (IORef
     [(OutputDeviceID,
       (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
-&gt; IORef
     [(OutputDeviceID,
       (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (IORef
      [(OutputDeviceID,
        (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
 -&gt; IORef
      [(OutputDeviceID,
        (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
-&gt; IO
     (IORef
        [(OutputDeviceID,
          (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
-&gt; IORef
     [(OutputDeviceID,
       (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; IO
     (IORef
        [(OutputDeviceID,
          (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-identifier">outPort</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">inPort</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">global</span><span> </span><span class="hs-identifier">memory</span><span> </span><span class="hs-identifier">refs</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">contain</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">mapping</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span class="hs-identifier">DeviceID</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">Port</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Streams</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">They</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">modified</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">addPort</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">which</span><span>
</span><span id="line-186"></span><span class="hs-identifier">adds</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-identifier">mapping</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">lookupPort</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">which</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">DeviceID</span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span class="hs-identifier">returns</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Port</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Stream</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">it</span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-type">outPort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-type">inPort</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span class="hs-operator">&gt;</span><span> </span><span id="outPort"><span class="annot"><span class="annottext">outPort :: IORef [(OutputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-var hs-var">outPort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (IORef [(OutputDeviceID, PMStream)])
-&gt; IORef [(OutputDeviceID, PMStream)]
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(OutputDeviceID, PMStream)]
-&gt; IO (IORef [(OutputDeviceID, PMStream)])
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span class="hs-operator">&gt;</span><span> </span><span id="inPort"><span class="annot"><span class="annottext">inPort :: IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var hs-var">inPort</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (IORef [(InputDeviceID, PMStream)])
-&gt; IORef [(InputDeviceID, PMStream)]
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(InputDeviceID, PMStream)]
-&gt; IO (IORef [(InputDeviceID, PMStream)])
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679092393"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-type">lookupPort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679092393"><span class="hs-identifier hs-type">deviceid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679092393"><span class="hs-identifier hs-type">deviceid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679092393"><span class="hs-identifier hs-type">deviceid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-195"></span><span class="hs-operator">&gt;</span><span> </span><span id="lookupPort"><span class="annot"><span class="annottext">lookupPort :: IORef [(deviceid, PMStream)] -&gt; deviceid -&gt; IO (Maybe PMStream)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-var hs-var">lookupPort</span></a></span></span><span> </span><span id="local-6989586621679092190"><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)]
</span><a href="#local-6989586621679092190"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679092189"><span class="annot"><span class="annottext">deviceid
</span><a href="#local-6989586621679092189"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)] -&gt; IO [(deviceid, PMStream)]
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)]
</span><a href="#local-6989586621679092190"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">IO [(deviceid, PMStream)]
-&gt; ([(deviceid, PMStream)] -&gt; IO (Maybe PMStream))
-&gt; IO (Maybe PMStream)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe PMStream -&gt; IO (Maybe PMStream)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe PMStream -&gt; IO (Maybe PMStream))
-&gt; ([(deviceid, PMStream)] -&gt; Maybe PMStream)
-&gt; [(deviceid, PMStream)]
-&gt; IO (Maybe PMStream)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">deviceid -&gt; [(deviceid, PMStream)] -&gt; Maybe PMStream
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">deviceid
</span><a href="#local-6989586621679092189"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679092392"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#addPort"><span class="hs-identifier hs-type">addPort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679092392"><span class="hs-identifier hs-type">deviceid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679092392"><span class="hs-identifier hs-type">deviceid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-198"></span><span class="hs-operator">&gt;</span><span> </span><span id="addPort"><span class="annot"><span class="annottext">addPort :: IORef [(deviceid, PMStream)] -&gt; (deviceid, PMStream) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#addPort"><span class="hs-identifier hs-var hs-var">addPort</span></a></span></span><span> </span><span id="local-6989586621679092185"><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)]
</span><a href="#local-6989586621679092185"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679092184"><span class="annot"><span class="annottext">(deviceid, PMStream)
</span><a href="#local-6989586621679092184"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)]
-&gt; ([(deviceid, PMStream)] -&gt; [(deviceid, PMStream)]) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef [(deviceid, PMStream)]
</span><a href="#local-6989586621679092185"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(deviceid, PMStream)
</span><a href="#local-6989586621679092184"><span class="hs-identifier hs-var">is</span></a></span><span class="annot"><span class="annottext">(deviceid, PMStream)
-&gt; [(deviceid, PMStream)] -&gt; [(deviceid, PMStream)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-202"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Global</span><span> </span><span class="hs-identifier">Device</span><span> </span><span class="hs-identifier">Initialization</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">Termination</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-203"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-identifier">initializeMidi</span><span> </span><span class="hs-identifier">just</span><span> </span><span class="hs-identifier">initializes</span><span> </span><span class="hs-identifier">PortMidi</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#initializeMidi"><span class="hs-identifier hs-type">initializeMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span class="hs-operator">&gt;</span><span> </span><span id="initializeMidi"><span class="annot"><span class="annottext">initializeMidi :: IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#initializeMidi"><span class="hs-identifier hs-var hs-var">initializeMidi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092183"><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092183"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">initialize</span></span><span>
</span><span id="line-210"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092183"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-211"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">PMSuccess
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679092182"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092182"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initializeMidi&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092182"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-identifier">terminateMidi</span><span> </span><span class="hs-identifier">calls</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">stop</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">elements</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">outDevMap</span><span>
</span><span id="line-215"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">clears</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">mapping</span><span> </span><span class="hs-identifier">entirely</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">It</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">clears</span><span> </span><span class="hs-identifier">outPort</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">inPort</span><span class="hs-operator">.</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#terminateMidi"><span class="hs-identifier hs-type">terminateMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span class="hs-operator">&gt;</span><span> </span><span id="terminateMidi"><span class="annot"><span class="annottext">terminateMidi :: IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#terminateMidi"><span class="hs-identifier hs-var hs-var">terminateMidi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092180"><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="#local-6989586621679092180"><span class="hs-identifier hs-var">inits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; IO
     [(OutputDeviceID,
       (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-var">outDevMap</span></a></span><span>
</span><span id="line-220"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">((OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))
 -&gt; IO ())
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDeviceID
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679092178"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092178"><span class="hs-identifier hs-var">_out</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092177"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092177"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092177"><span class="hs-identifier hs-var">stop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="#local-6989586621679092180"><span class="hs-identifier hs-var">inits</span></a></span><span>
</span><span id="line-221"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">terminate</span></span><span>
</span><span id="line-222"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; ([(OutputDeviceID,
      (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
    -&gt; [(OutputDeviceID,
         (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
-&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-var">outDevMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
-&gt; [(OutputDeviceID, PMStream)] -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-var">outPort</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-224"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
-&gt; [(InputDeviceID, PMStream)] -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var">inPort</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-228"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Device</span><span> </span><span class="hs-identifier">Lookup</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-229"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-identifier">getOutDev</span><span> </span><span class="hs-identifier">looks</span><span> </span><span class="hs-identifier">up</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">outDevMap</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">adds</span><span> </span><span class="hs-identifier">associations</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">necessary</span><span class="hs-operator">.</span><span>
</span><span id="line-232"></span><span class="hs-identifier">It</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">accessed</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">helper</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">outputMidi</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">deliverMidiEvent</span><span class="hs-operator">.</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#getOutDev"><span class="hs-identifier hs-type">getOutDev</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#PrioChannel"><span class="hs-identifier hs-type">PrioChannel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span class="hs-operator">&gt;</span><span> </span><span id="getOutDev"><span class="annot"><span class="annottext">getOutDev :: OutputDeviceID
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getOutDev"><span class="hs-identifier hs-var hs-var">getOutDev</span></a></span></span><span> </span><span id="local-6989586621679092173"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092173"><span class="hs-identifier hs-var">devId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092172"><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="#local-6989586621679092172"><span class="hs-identifier hs-var">inits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; IO
     [(OutputDeviceID,
       (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-var">outDevMap</span></a></span><span>
</span><span id="line-237"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; Maybe
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092173"><span class="hs-identifier hs-var">devId</span></a></span><span> </span><span class="annot"><span class="annottext">[(OutputDeviceID,
  (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="#local-6989586621679092172"><span class="hs-identifier hs-var">inits</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092171"><span class="annot"><span class="annottext">(PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092171"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092171"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-239"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092170"><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092170"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime%27"><span class="hs-identifier hs-var">midiOutRealTime'</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092173"><span class="hs-identifier hs-var">devId</span></a></span><span> </span><span class="hs-comment">-- Changes made by Donya Quick: this line used to pattern match against Just.</span><span>
</span><span id="line-241"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092168"><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092168"><span class="hs-identifier hs-var">pChan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (PrioChannel Time Message)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#makePriorityChannel"><span class="hs-identifier hs-var">makePriorityChannel</span></a></span><span>
</span><span id="line-242"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092170"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092167"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092167"><span class="hs-identifier hs-var">mout</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092166"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092166"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Case statement added.</span><span>
</span><span id="line-243"></span><span class="hs-operator">&gt;</span><span>         				</span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; ([(OutputDeviceID,
      (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
    -&gt; [(OutputDeviceID,
         (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))])
-&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef
  [(OutputDeviceID,
    (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outDevMap"><span class="hs-identifier hs-var">outDevMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092173"><span class="hs-identifier hs-var">devId</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092168"><span class="hs-identifier hs-var">pChan</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092167"><span class="hs-identifier hs-var">mout</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092166"><span class="hs-identifier hs-var">stop</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">(OutputDeviceID,
 (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
-&gt; [(OutputDeviceID,
     (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ()))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span class="hs-operator">&gt;</span><span>         				</span><span class="annot"><span class="annottext">(PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092168"><span class="hs-identifier hs-var">pChan</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092167"><span class="hs-identifier hs-var">mout</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092166"><span class="hs-identifier hs-var">stop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092168"><span class="hs-identifier hs-var">pChan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (Time, Message) -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Nothing case added</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-249"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Input</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-250"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-identifier">pollMidi</span><span> </span><span class="hs-identifier">take</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">input</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">callback</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">polls</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">device</span><span>
</span><span id="line-253"></span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">midi</span><span> </span><span class="hs-identifier">events</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Any</span><span> </span><span class="hs-identifier">events</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">sent</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">along</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">current</span><span> </span><span class="hs-identifier">time</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-254"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">callback</span><span> </span><span class="hs-identifier">function</span><span class="hs-operator">.</span><span>
</span><span id="line-255"></span><span class="hs-identifier">DWC</span><span> </span><span class="hs-identifier">NOTE</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">Why</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">even</span><span> </span><span class="hs-identifier">used</span><span class="hs-operator">?</span><span>  </span><span class="hs-identifier">All</span><span> </span><span class="hs-identifier">messages</span><span> </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">same</span><span> </span><span class="hs-identifier">time</span><span class="hs-operator">?</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#pollMidiCB"><span class="hs-identifier hs-type">pollMidiCB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span class="hs-operator">&gt;</span><span> </span><span id="pollMidiCB"><span class="annot"><span class="annottext">pollMidiCB :: InputDeviceID -&gt; ((Time, [Message]) -&gt; IO ()) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#pollMidiCB"><span class="hs-identifier hs-var hs-var">pollMidiCB</span></a></span></span><span> </span><span id="local-6989586621679092164"><span class="annot"><span class="annottext">idid :: InputDeviceID
</span><a href="#local-6989586621679092164"><span class="hs-identifier hs-var">idid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span> </span><span id="local-6989586621679092163"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092163"><span class="hs-identifier hs-var">devId</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679092162"><span class="annot"><span class="annottext">(Time, [Message]) -&gt; IO ()
</span><a href="#local-6989586621679092162"><span class="hs-identifier hs-var">callback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092161"><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092161"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
-&gt; InputDeviceID -&gt; IO (Maybe PMStream)
forall deviceid.
Eq deviceid =&gt;
IORef [(deviceid, PMStream)] -&gt; deviceid -&gt; IO (Maybe PMStream)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-var">lookupPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var">inPort</span></a></span><span> </span><span class="annot"><span class="annottext">InputDeviceID
</span><a href="#local-6989586621679092164"><span class="hs-identifier hs-var">idid</span></a></span><span>
</span><span id="line-260"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092161"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-261"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe PMStream
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092160"><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092160"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO (Either PMError PMStream)
</span><span class="hs-identifier hs-var">openInput</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092163"><span class="hs-identifier hs-var">devId</span></a></span><span>
</span><span id="line-263"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092160"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092159"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092159"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pollMidiCB&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092159"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-265"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092158"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092158"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
-&gt; (InputDeviceID, PMStream) -&gt; IO ()
forall deviceid.
IORef [(deviceid, PMStream)] -&gt; (deviceid, PMStream) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#addPort"><span class="hs-identifier hs-var">addPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var">inPort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputDeviceID
</span><a href="#local-6989586621679092164"><span class="hs-identifier hs-var">idid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092158"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO ()
</span><a href="#local-6989586621679092157"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092158"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-266"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092156"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092156"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO ()
</span><a href="#local-6989586621679092157"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092156"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-267"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-268"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="#local-6989586621679092157"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092157"><span class="annot"><span class="annottext">input :: PMStream -&gt; IO ()
</span><a href="#local-6989586621679092157"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679092155"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092155"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092154"><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679092154"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError [PMEvent])
</span><span class="hs-identifier hs-var">readEvents</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092155"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-271"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679092154"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-272"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092153"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092153"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pollMidiCB&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092153"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-273"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092152"><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679092152"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span class="hs-operator">&gt;</span><span>           </span><span id="local-6989586621679092151"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092151"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-275"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(PMEvent -&gt; Maybe Message) -&gt; [PMEvent] -&gt; [Message]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe Message
</span><a href="Euterpea.IO.MIDI.MidiIO.html#msgToMidi"><span class="hs-identifier hs-var">msgToMidi</span></a></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe Message)
-&gt; (PMEvent -&gt; PMMsg) -&gt; PMEvent -&gt; Maybe Message
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">decodeMsg</span></span><span> </span><span class="annot"><span class="annottext">(CLong -&gt; PMMsg) -&gt; (PMEvent -&gt; CLong) -&gt; PMEvent -&gt; PMMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PMEvent -&gt; CLong
</span><span class="hs-identifier hs-var hs-var">message</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679092152"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092148"><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679092148"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Time, [Message]) -&gt; IO ()
</span><a href="#local-6989586621679092162"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092151"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679092148"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#pollMidi"><span class="hs-identifier hs-type">pollMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span class="hs-operator">&gt;</span><span> </span><span id="pollMidi"><span class="annot"><span class="annottext">pollMidi :: InputDeviceID -&gt; IO (Maybe (Time, [Message]))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#pollMidi"><span class="hs-identifier hs-var hs-var">pollMidi</span></a></span></span><span> </span><span id="local-6989586621679092147"><span class="annot"><span class="annottext">idid :: InputDeviceID
</span><a href="#local-6989586621679092147"><span class="hs-identifier hs-var">idid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#InputDeviceID"><span class="hs-identifier hs-type">InputDeviceID</span></a></span><span> </span><span id="local-6989586621679092146"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092146"><span class="hs-identifier hs-var">devId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092145"><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092145"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
-&gt; InputDeviceID -&gt; IO (Maybe PMStream)
forall deviceid.
Eq deviceid =&gt;
IORef [(deviceid, PMStream)] -&gt; deviceid -&gt; IO (Maybe PMStream)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-var">lookupPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var">inPort</span></a></span><span> </span><span class="annot"><span class="annottext">InputDeviceID
</span><a href="#local-6989586621679092147"><span class="hs-identifier hs-var">idid</span></a></span><span>
</span><span id="line-282"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092145"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe PMStream
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092144"><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092144"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO (Either PMError PMStream)
</span><span class="hs-identifier hs-var">openInput</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092146"><span class="hs-identifier hs-var">devId</span></a></span><span>
</span><span id="line-285"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092144"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092143"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092143"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pollMIDI&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092143"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Maybe (Time, [Message])) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-287"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092142"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092142"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
-&gt; (InputDeviceID, PMStream) -&gt; IO ()
forall deviceid.
IORef [(deviceid, PMStream)] -&gt; (deviceid, PMStream) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#addPort"><span class="hs-identifier hs-var">addPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(InputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#inPort"><span class="hs-identifier hs-var">inPort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputDeviceID
</span><a href="#local-6989586621679092147"><span class="hs-identifier hs-var">idid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092142"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Maybe (Time, [Message])) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Maybe (Time, [Message]))
</span><a href="#local-6989586621679092141"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092142"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-288"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092140"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092140"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Maybe (Time, [Message]))
</span><a href="#local-6989586621679092141"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092140"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-289"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="#local-6989586621679092141"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMStream</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092141"><span class="annot"><span class="annottext">input :: PMStream -&gt; IO (Maybe (Time, [Message]))
</span><a href="#local-6989586621679092141"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679092139"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092139"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092138"><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679092138"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError [PMEvent])
</span><span class="hs-identifier hs-var">readEvents</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092139"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-293"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679092138"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-294"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092137"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092137"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pollMIDI&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092137"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Maybe (Time, [Message])) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-295"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092136"><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679092136"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span class="hs-operator">&gt;</span><span>           </span><span id="local-6989586621679092135"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092135"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-297"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(PMEvent -&gt; Maybe Message) -&gt; [PMEvent] -&gt; [Message]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe Message
</span><a href="Euterpea.IO.MIDI.MidiIO.html#msgToMidi"><span class="hs-identifier hs-var">msgToMidi</span></a></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe Message)
-&gt; (PMEvent -&gt; PMMsg) -&gt; PMEvent -&gt; Maybe Message
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">decodeMsg</span></span><span> </span><span class="annot"><span class="annottext">(CLong -&gt; PMMsg) -&gt; (PMEvent -&gt; CLong) -&gt; PMEvent -&gt; PMMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PMEvent -&gt; CLong
</span><span class="hs-identifier hs-var hs-var">message</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679092136"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-298"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-299"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092134"><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679092134"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message])))
-&gt; Maybe (Time, [Message]) -&gt; IO (Maybe (Time, [Message]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Time, [Message]) -&gt; Maybe (Time, [Message])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092135"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679092134"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-303"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Output</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">inidividual</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">events</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-304"></span><span class="hs-comment">---------------------------------------------</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">following</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">sending</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">playing</span><span> </span><span class="hs-identifier">individual</span><span>
</span><span id="line-307"></span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">events</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">devices</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Typically</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">usage</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">call</span><span> </span><span class="hs-identifier">outputMidi</span><span>
</span><span id="line-308"></span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">play</span><span> </span><span class="hs-identifier">anything</span><span> </span><span class="hs-identifier">that's</span><span> </span><span class="hs-identifier">ready</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">play</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">send</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">latest</span><span>
</span><span id="line-309"></span><span class="hs-identifier">messages</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">deliverMidiEvent</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Of</span><span> </span><span class="hs-identifier">course</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-identifier">messages</span><span> </span><span class="hs-identifier">are</span><span>
</span><span id="line-310"></span><span class="hs-identifier">ready</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">delivered</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">step</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">omitted</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Either</span><span> </span><span class="hs-identifier">way</span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span class="hs-identifier">outputMidi</span><span> </span><span class="hs-identifier">should</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">many</span><span> </span><span class="hs-identifier">times</span><span> </span><span class="hs-identifier">per</span><span> </span><span class="hs-identifier">second</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">assure</span><span> </span><span class="hs-identifier">that</span><span>
</span><span id="line-312"></span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">messages</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">played</span><span> </span><span class="hs-identifier">approximately</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">scheduled</span><span class="hs-operator">.</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-identifier">deliverMidiEvent</span><span> </span><span class="hs-identifier">sends</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">MidiEvent</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">device</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">If</span><span>
</span><span id="line-315"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">event</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">scheduled</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">happen</span><span> </span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-identifier">now''</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">immediately</span><span>
</span><span id="line-316"></span><span class="hs-identifier">played</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Otherwise</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">queued</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">later</span><span class="hs-operator">.</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#deliverMidiEvent"><span class="hs-identifier hs-type">deliverMidiEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#MidiEvent"><span class="hs-identifier hs-type">MidiEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span class="hs-operator">&gt;</span><span> </span><span id="deliverMidiEvent"><span class="annot"><span class="annottext">deliverMidiEvent :: OutputDeviceID -&gt; MidiEvent -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#deliverMidiEvent"><span class="hs-identifier hs-var hs-var">deliverMidiEvent</span></a></span></span><span> </span><span id="local-6989586621679092133"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092133"><span class="hs-identifier hs-var">devId</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092132"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092132"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092131"><span class="annot"><span class="annottext">MidiMessage
</span><a href="#local-6989586621679092131"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span id="local-6989586621679092130"><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092130"><span class="hs-identifier hs-var">pChan</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092129"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092129"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092128"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092128"><span class="hs-identifier hs-var">_stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getOutDev"><span class="hs-identifier hs-var">getOutDev</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092133"><span class="hs-identifier hs-var">devId</span></a></span><span>
</span><span id="line-321"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092127"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092127"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-322"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679092126"><span class="annot"><span class="annottext">deliver :: Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092126"><span class="hs-identifier hs-var hs-var">deliver</span></a></span></span><span> </span><span id="local-6989586621679092125"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092125"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679092124"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092124"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-323"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092125"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">0</span></span><span>
</span><span id="line-324"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092129"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092127"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092124"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message -&gt; Time -&gt; Message -&gt; IO ()
forall a b. PrioChannel a b -&gt; a -&gt; b -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#push"><span class="hs-identifier hs-var hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092130"><span class="hs-identifier hs-var">pChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092127"><span class="hs-identifier hs-var">now</span></a></span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092125"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092124"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-326"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-327"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MidiMessage
</span><a href="#local-6989586621679092131"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#Std"><span class="hs-identifier hs-type">Std</span></a></span><span> </span><span id="local-6989586621679092122"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092122"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092126"><span class="hs-identifier hs-var">deliver</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092132"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092122"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-329"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#ANote"><span class="hs-identifier hs-type">ANote</span></a></span><span> </span><span id="local-6989586621679092121"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092121"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679092120"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092120"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679092119"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092119"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679092118"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092118"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092126"><span class="hs-identifier hs-var">deliver</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092132"><span class="hs-identifier hs-var">t</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">NoteOn</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092121"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092120"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092119"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Time -&gt; Message -&gt; IO ()
</span><a href="#local-6989586621679092126"><span class="hs-identifier hs-var">deliver</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092132"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092118"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">NoteOff</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092121"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092120"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092119"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-identifier">outputMidi</span><span> </span><span class="hs-identifier">plays</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">midi</span><span> </span><span class="hs-identifier">events</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">waiting</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">device's</span><span>
</span><span id="line-335"></span><span class="hs-identifier">priority</span><span> </span><span class="hs-identifier">queue</span><span> </span><span class="hs-identifier">whose</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">play</span><span> </span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">come</span><span class="hs-operator">.</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#outputMidi"><span class="hs-identifier hs-type">outputMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span class="hs-operator">&gt;</span><span> </span><span id="outputMidi"><span class="annot"><span class="annottext">outputMidi :: OutputDeviceID -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outputMidi"><span class="hs-identifier hs-var hs-var">outputMidi</span></a></span></span><span> </span><span id="local-6989586621679092115"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092115"><span class="hs-identifier hs-var">devId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span id="local-6989586621679092114"><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092114"><span class="hs-identifier hs-var">pChan</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092113"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092113"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092112"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092112"><span class="hs-identifier hs-var">_stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
-&gt; IO (PrioChannel Time Message, (Time, Message) -&gt; IO (), IO ())
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getOutDev"><span class="hs-identifier hs-var">getOutDev</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092115"><span class="hs-identifier hs-var">devId</span></a></span><span>
</span><span id="line-340"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679092111"><span class="annot"><span class="annottext">loop :: IO ()
</span><a href="#local-6989586621679092111"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092110"><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092110"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message -&gt; IO (Maybe (Time, Message))
forall a b. PrioChannel a b -&gt; IO (Maybe (a, b))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#peek"><span class="hs-identifier hs-var hs-var">peek</span></a></span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092114"><span class="hs-identifier hs-var">pChan</span></a></span><span>
</span><span id="line-342"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092110"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span class="hs-operator">&gt;</span><span>           </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span class="hs-operator">&gt;</span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092109"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092109"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679092108"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092108"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092107"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092107"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-346"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092109"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092107"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-347"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092113"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092107"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092108"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Time, Message) -&gt; IO (Time, Message)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message -&gt; IO (Time, Message)
forall a b. PrioChannel a b -&gt; IO (a, b)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#pop"><span class="hs-identifier hs-var hs-var">pop</span></a></span><span> </span><span class="annot"><span class="annottext">PrioChannel Time Message
</span><a href="#local-6989586621679092114"><span class="hs-identifier hs-var">pChan</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Time, Message) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092111"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-348"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092111"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-350"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-------------------------------------------</span><span>
</span><span id="line-354"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">Output</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">complete</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">track</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-355"></span><span class="hs-comment">-------------------------------------------</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-identifier">When</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">entire</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">track</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">ready</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">played</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">playMidi</span><span> </span><span class="hs-identifier">function</span><span>
</span><span id="line-358"></span><span class="hs-identifier">may</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">appropriate</span><span> </span><span class="hs-identifier">than</span><span> </span><span class="hs-identifier">deliverMidiEvent</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">outputMidi</span><span class="hs-operator">.</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-identifier">playMidi</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">queue</span><span> </span><span class="hs-identifier">up</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">entire</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">track</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">close</span><span>
</span><span id="line-361"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">device</span><span class="hs-operator">.</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#playMidi"><span class="hs-identifier hs-type">playMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Midi</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span class="hs-operator">&gt;</span><span> </span><span id="playMidi"><span class="annot"><span class="annottext">playMidi :: OutputDeviceID -&gt; Midi -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#playMidi"><span class="hs-identifier hs-var hs-var">playMidi</span></a></span></span><span> </span><span id="local-6989586621679092105"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092105"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679092104"><span class="annot"><span class="annottext">midi :: Midi
</span><a href="#local-6989586621679092104"><span class="hs-identifier hs-var">midi</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Midi</span></span><span> </span><span class="annot"><span class="annottext">FileType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679092102"><span class="annot"><span class="annottext">TimeDiv
</span><a href="#local-6989586621679092102"><span class="hs-identifier hs-var">division</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Track Channel]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679092101"><span class="annot"><span class="annottext">track :: Track Time
</span><a href="#local-6989586621679092101"><span class="hs-identifier hs-var hs-var">track</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeDiv -&gt; Track Channel -&gt; Track Time
</span><span class="hs-identifier hs-var">toRealTime</span></span><span> </span><span class="annot"><span class="annottext">TimeDiv
</span><a href="#local-6989586621679092102"><span class="hs-identifier hs-var">division</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Track Channel -&gt; Track Channel
forall a. Num a =&gt; Track a -&gt; Track a
</span><span class="hs-identifier hs-var">toAbsTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Track Channel] -&gt; Track Channel
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; [Track Channel]
</span><span class="hs-identifier hs-var hs-var">tracks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Midi -&gt; Midi
</span><span class="hs-identifier hs-var">toSingleTrack</span></span><span> </span><span class="annot"><span class="annottext">Midi
</span><a href="#local-6989586621679092104"><span class="hs-identifier hs-var">midi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092098"><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092098"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime"><span class="hs-identifier hs-var">midiOutRealTime</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092105"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-367"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679092098"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092096"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092096"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092095"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092095"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092094"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092094"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-371"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; ((Time, Message) -&gt; IO ()) -&gt; Track Time -&gt; IO ()
forall t (m :: * -&gt; *).
(Num t, Monad m) =&gt;
t -&gt; t -&gt; ((t, Message) -&gt; m ()) -&gt; [(t, Message)] -&gt; m ()
</span><a href="#local-6989586621679092093"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092094"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679092096"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">Track Time
</span><a href="#local-6989586621679092101"><span class="hs-identifier hs-var">track</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092095"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-372"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092093"><span class="annot"><span class="annottext">playTrack :: t -&gt; t -&gt; ((t, Message) -&gt; m ()) -&gt; [(t, Message)] -&gt; m ()
</span><a href="#local-6989586621679092093"><span class="hs-identifier hs-var hs-var">playTrack</span></a></span></span><span> </span><span id="local-6989586621679092092"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092092"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span id="local-6989586621679092091"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092091"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span id="local-6989586621679092090"><span class="annot"><span class="annottext">(t, Message) -&gt; m ()
</span><a href="#local-6989586621679092090"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(t, Message) -&gt; m ()
</span><a href="#local-6989586621679092090"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092092"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092091"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier hs-var">TrackEnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="#local-6989586621679092093"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span id="local-6989586621679092088"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092088"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span id="local-6989586621679092087"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092087"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span id="local-6989586621679092086"><span class="annot"><span class="annottext">(t, Message) -&gt; m ()
</span><a href="#local-6989586621679092086"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092085"><span class="annot"><span class="annottext">e :: (t, Message)
</span><a href="#local-6989586621679092085"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679092084"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092084"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092083"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092083"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679092082"><span class="annot"><span class="annottext">[(t, Message)]
</span><a href="#local-6989586621679092082"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">(t, Message) -&gt; m ()
</span><a href="#local-6989586621679092086"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092088"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092084"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092083"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Bool
</span><span class="hs-identifier hs-var">isTrackEnd</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092083"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-377"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; ((t, Message) -&gt; m ()) -&gt; [(t, Message)] -&gt; m ()
</span><a href="#local-6989586621679092093"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092088"><span class="hs-identifier hs-var">t0</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092084"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(t, Message) -&gt; m ()
</span><a href="#local-6989586621679092086"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">[(t, Message)]
</span><a href="#local-6989586621679092082"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-382"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">midiOutRealTime</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-383"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">following</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">open</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">output</span><span class="hs-operator">.</span><span>
</span><span id="line-386"></span><span class="hs-identifier">They</span><span> </span><span class="hs-identifier">should</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">hasn't</span><span> </span><span class="hs-identifier">yet</span><span> </span><span class="hs-identifier">been</span><span> </span><span class="hs-identifier">opened</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span>
</span><span id="line-387"></span><span class="hs-identifier">they</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-identifier">play''</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-identifier">stop''</span><span> </span><span class="hs-identifier">function</span><span class="hs-operator">.</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-identifier">Currently</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">midiOutRealTime'</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">inidividual</span><span>
</span><span id="line-390"></span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">events</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">midiOutRealTime</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">complete</span><span>
</span><span id="line-391"></span><span class="hs-identifier">Midi</span><span> </span><span class="hs-identifier">track</span><span class="hs-operator">.</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-identifier">DWC</span><span> </span><span class="hs-identifier">Notes</span><span class="hs-glyph">:</span><span>
</span><span id="line-394"></span><span class="hs-identifier">I'm</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">entirely</span><span> </span><span class="hs-identifier">sure</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">they</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">work</span><span> </span><span class="hs-identifier">yet</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">midiOutRealTime'</span><span>
</span><span id="line-395"></span><span class="hs-identifier">actually</span><span> </span><span class="hs-identifier">looks</span><span> </span><span class="hs-identifier">pretty</span><span> </span><span class="hs-identifier">straightforward</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">just</span><span> </span><span class="hs-identifier">creates</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">process</span><span>
</span><span id="line-396"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">stop</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">adds</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">outPort</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">list</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span>
</span><span id="line-397"></span><span class="hs-identifier">process</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">look</span><span> </span><span class="hs-identifier">up</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">outPort</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">list</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span>
</span><span id="line-398"></span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">finds</span><span> </span><span class="hs-identifier">it</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">writes</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">message</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">it</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">stop</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">removes</span><span>
</span><span id="line-399"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">device</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">outPort</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">closes</span><span> </span><span class="hs-identifier">it</span><span class="hs-operator">.</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-identifier">On</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">other</span><span> </span><span class="hs-identifier">hand</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">midiOutRealTime</span><span> </span><span class="hs-identifier">spawns</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-identifier">thread</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">does</span><span> </span><span class="hs-identifier">some</span><span>
</span><span id="line-402"></span><span class="hs-identifier">concurrent</span><span> </span><span class="hs-identifier">stuff</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Really</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">looks</span><span> </span><span class="hs-identifier">similar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">I</span><span> </span><span class="hs-identifier">don't</span><span> </span><span class="hs-identifier">know</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-403"></span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">other</span><span class="hs-operator">.</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime%27"><span class="hs-identifier hs-type">midiOutRealTime'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span class="hs-operator">&gt;</span><span> </span><span id="midiOutRealTime%27"><span class="annot"><span class="annottext">midiOutRealTime' :: OutputDeviceID -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime%27"><span class="hs-identifier hs-var hs-var">midiOutRealTime'</span></a></span></span><span> </span><span id="local-6989586621679092081"><span class="annot"><span class="annottext">odid :: OutputDeviceID
</span><a href="#local-6989586621679092081"><span class="hs-identifier hs-var">odid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span id="local-6989586621679092080"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092080"><span class="hs-identifier hs-var">devId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-407"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092079"><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092079"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; IO (Either PMError PMStream)
</span><span class="hs-identifier hs-var">openOutput</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092080"><span class="hs-identifier hs-var">devId</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">1</span></span><span>
</span><span id="line-408"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092079"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-409"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092078"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092078"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unable to open output device in midiOutRealTime'&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092078"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-410"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092077"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092077"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
-&gt; (OutputDeviceID, PMStream) -&gt; IO ()
forall deviceid.
IORef [(deviceid, PMStream)] -&gt; (deviceid, PMStream) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#addPort"><span class="hs-identifier hs-var">addPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-var">outPort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092081"><span class="hs-identifier hs-var">odid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092077"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ((Time, Message) -&gt; IO (), IO ())
 -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ())))
-&gt; Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Time, Message) -&gt; IO (), IO ())
-&gt; Maybe ((Time, Message) -&gt; IO (), IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDeviceID -&gt; (Time, Message) -&gt; IO ()
forall a. RealFrac a =&gt; OutputDeviceID -&gt; (a, Message) -&gt; IO ()
</span><a href="#local-6989586621679092076"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092081"><span class="hs-identifier hs-var">odid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; IO ()
</span><a href="#local-6989586621679092075"><span class="hs-identifier hs-var">finalize</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092081"><span class="hs-identifier hs-var">odid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092076"><span class="annot"><span class="annottext">process :: OutputDeviceID -&gt; (a, Message) -&gt; IO ()
</span><a href="#local-6989586621679092076"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span id="local-6989586621679092074"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092074"><span class="hs-identifier hs-var">odid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092073"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092073"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092072"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092072"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092071"><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092071"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
-&gt; OutputDeviceID -&gt; IO (Maybe PMStream)
forall deviceid.
Eq deviceid =&gt;
IORef [(deviceid, PMStream)] -&gt; deviceid -&gt; IO (Maybe PMStream)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-var">lookupPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-var">outPort</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092074"><span class="hs-identifier hs-var">odid</span></a></span><span>
</span><span id="line-416"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092071"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-417"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Maybe PMStream
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;midiOutRealTime': port &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092074"><span class="hs-identifier hs-var">odid</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not open for output&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092069"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092069"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Bool
</span><span class="hs-identifier hs-var">isTrackEnd</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092072"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-420"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe PMMsg
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092072"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092067"><span class="annot"><span class="annottext">PMMsg
</span><a href="#local-6989586621679092067"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; a -&gt; CLong -&gt; IO ()
forall a. RealFrac a =&gt; PMStream -&gt; a -&gt; CLong -&gt; IO ()
</span><a href="#local-6989586621679092066"><span class="hs-identifier hs-var">writeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092069"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092073"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(CLong -&gt; IO ()) -&gt; CLong -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; CLong
</span><span class="hs-identifier hs-var">encodeMsg</span></span><span> </span><span class="annot"><span class="annottext">PMMsg
</span><a href="#local-6989586621679092067"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-423"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="annottext">Maybe PMMsg
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092066"><span class="annot"><span class="annottext">writeMsg :: PMStream -&gt; a -&gt; CLong -&gt; IO ()
</span><a href="#local-6989586621679092066"><span class="hs-identifier hs-var hs-var">writeMsg</span></a></span></span><span> </span><span id="local-6989586621679092065"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092065"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679092064"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092064"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679092063"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679092063"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679092062"><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092062"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; PMEvent -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">writeShort</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092065"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Timestamp -&gt; PMEvent
</span><span class="hs-identifier hs-var">PMEvent</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679092063"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Timestamp
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679092064"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1e3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092062"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-427"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679092058"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092058"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;midiOutRealTime'&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092058"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-428"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">PMSuccess
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092075"><span class="annot"><span class="annottext">finalize :: OutputDeviceID -&gt; IO ()
</span><a href="#local-6989586621679092075"><span class="hs-identifier hs-var hs-var">finalize</span></a></span></span><span> </span><span id="local-6989586621679092057"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092057"><span class="hs-identifier hs-var">odid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-430"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092056"><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092056"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
-&gt; OutputDeviceID -&gt; IO (Maybe PMStream)
forall deviceid.
Eq deviceid =&gt;
IORef [(deviceid, PMStream)] -&gt; deviceid -&gt; IO (Maybe PMStream)
</span><a href="Euterpea.IO.MIDI.MidiIO.html#lookupPort"><span class="hs-identifier hs-var">lookupPort</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(OutputDeviceID, PMStream)]
</span><a href="Euterpea.IO.MIDI.MidiIO.html#outPort"><span class="hs-identifier hs-var">outPort</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679092057"><span class="hs-identifier hs-var">odid</span></a></span><span>
</span><span id="line-431"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092055"><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092055"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess)
-&gt; (PMStream -&gt; IO (Either PMError PMSuccess))
-&gt; Maybe PMStream
-&gt; IO (Either PMError PMSuccess)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either PMError PMSuccess -&gt; IO (Either PMError PMSuccess)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PMSuccess -&gt; Either PMError PMSuccess
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">PMSuccess
</span><span class="hs-identifier hs-var">NoError'NoData</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Maybe PMStream
</span><a href="#local-6989586621679092056"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-432"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679092055"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-433"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679092052"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092052"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;midiOutRealTime'&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092052"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-434"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">PMSuccess
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime"><span class="hs-identifier hs-type">midiOutRealTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span class="hs-operator">&gt;</span><span> </span><span id="midiOutRealTime"><span class="annot"><span class="annottext">midiOutRealTime :: OutputDeviceID -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime"><span class="hs-identifier hs-var hs-var">midiOutRealTime</span></a></span></span><span> </span><span id="local-6989586621679092051"><span class="annot"><span class="annottext">odid :: OutputDeviceID
</span><a href="#local-6989586621679092051"><span class="hs-identifier hs-var">odid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span id="local-6989586621679092050"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092050"><span class="hs-identifier hs-var">devId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679092049"><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092049"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; IO (Either PMError PMStream)
</span><span class="hs-identifier hs-var">openOutput</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679092050"><span class="hs-identifier hs-var">devId</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">1</span></span><span>
</span><span id="line-440"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679092049"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-441"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679092048"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092048"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputMidi&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679092048"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-442"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679092047"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092047"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092046"><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092046"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (TChan (Maybe (Time, Message)))
-&gt; IO (TChan (Maybe (Time, Message)))
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM (TChan (Maybe (Time, Message)))
forall a. STM (TChan a)
</span><span class="hs-identifier hs-var">newTChan</span></span><span>
</span><span id="line-444"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092044"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092044"><span class="hs-identifier hs-var">wait</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-445"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679092042"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092042"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-446"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PMStream
-&gt; TChan (Maybe (Time, Message)) -&gt; MVar () -&gt; MVar () -&gt; IO ()
</span><a href="#local-6989586621679092040"><span class="hs-identifier hs-var">pump</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092047"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092046"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092044"><span class="hs-identifier hs-var">wait</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092042"><span class="hs-identifier hs-var">fin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ((Time, Message) -&gt; IO (), IO ())
 -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ())))
-&gt; Maybe ((Time, Message) -&gt; IO (), IO ())
-&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Time, Message) -&gt; IO (), IO ())
-&gt; Maybe ((Time, Message) -&gt; IO (), IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PMStream
-&gt; TChan (Maybe (Time, Message))
-&gt; MVar ()
-&gt; (Time, Message)
-&gt; IO ()
forall p a.
p -&gt; TChan (Maybe (a, Message)) -&gt; MVar () -&gt; (a, Message) -&gt; IO ()
</span><a href="#local-6989586621679092039"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092047"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092046"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092044"><span class="hs-identifier hs-var">wait</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message)) -&gt; MVar () -&gt; IO ()
forall a b. TChan (Maybe a) -&gt; MVar b -&gt; IO b
</span><a href="#local-6989586621679092038"><span class="hs-identifier hs-var">stop</span></a></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092046"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092042"><span class="hs-identifier hs-var">fin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-449"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092038"><span class="annot"><span class="annottext">stop :: TChan (Maybe a) -&gt; MVar b -&gt; IO b
</span><a href="#local-6989586621679092038"><span class="hs-identifier hs-var hs-var">stop</span></a></span></span><span> </span><span id="local-6989586621679092037"><span class="annot"><span class="annottext">TChan (Maybe a)
</span><a href="#local-6989586621679092037"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679092036"><span class="annot"><span class="annottext">MVar b
</span><a href="#local-6989586621679092036"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan (Maybe a) -&gt; Maybe a -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">unGetTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe a)
</span><a href="#local-6989586621679092037"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar b -&gt; IO b
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar b
</span><a href="#local-6989586621679092036"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-450"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092039"><span class="annot"><span class="annottext">output :: p -&gt; TChan (Maybe (a, Message)) -&gt; MVar () -&gt; (a, Message) -&gt; IO ()
</span><a href="#local-6989586621679092039"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679092033"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679092033"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679092032"><span class="annot"><span class="annottext">TChan (Maybe (a, Message))
</span><a href="#local-6989586621679092032"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679092031"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092031"><span class="hs-identifier hs-var">wait</span></a></span></span><span> </span><span id="local-6989586621679092030"><span class="annot"><span class="annottext">evt :: (a, Message)
</span><a href="#local-6989586621679092030"><span class="hs-identifier hs-var">evt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092029"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092029"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (a, Message)) -&gt; Maybe (a, Message) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (a, Message))
</span><a href="#local-6989586621679092032"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, Message) -&gt; Maybe (a, Message)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(a, Message)
</span><a href="#local-6989586621679092030"><span class="hs-identifier hs-var">evt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Bool
</span><span class="hs-identifier hs-var">isTrackEnd</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092029"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; IO ()
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092031"><span class="hs-identifier hs-var">wait</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679092040"><span class="annot"><span class="annottext">pump :: PMStream
-&gt; TChan (Maybe (Time, Message)) -&gt; MVar () -&gt; MVar () -&gt; IO ()
</span><a href="#local-6989586621679092040"><span class="hs-identifier hs-var hs-var">pump</span></a></span></span><span> </span><span id="local-6989586621679092027"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092027"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679092026"><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092026"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span id="local-6989586621679092025"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092025"><span class="hs-identifier hs-var">wait</span></a></span></span><span> </span><span id="local-6989586621679092024"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092024"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092023"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-454"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679092023"><span class="annot"><span class="annottext">loop :: IO ()
</span><a href="#local-6989586621679092023"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span class="hs-operator">&gt;</span><span>           </span><span id="local-6989586621679092022"><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092022"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message))
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message)))
-&gt; STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message)) -&gt; STM (Maybe (Time, Message))
forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092026"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-457"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092022"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-458"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092027"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092024"><span class="hs-identifier hs-var">fin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679092019"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092019"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679092018"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092018"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679092017"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092017"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-461"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092019"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092017"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message)) -&gt; Maybe (Time, Message) -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">unGetTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092026"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092022"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">10000</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092023"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-463"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span class="hs-operator">&gt;</span><span>                   </span><span id="local-6989586621679092014"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679092014"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Time -&gt; Message -&gt; IO Bool
forall t. RealFrac t =&gt; t -&gt; Message -&gt; IO Bool
</span><a href="#local-6989586621679092013"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092019"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092018"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-465"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679092014"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-466"></span><span class="hs-operator">&gt;</span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Time -&gt; IO ()
</span><a href="#local-6989586621679092012"><span class="hs-identifier hs-var">waitUntil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092019"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span class="hs-operator">&gt;</span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092023"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-468"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-469"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092012"><span class="annot"><span class="annottext">waitUntil :: Time -&gt; IO ()
</span><a href="#local-6989586621679092012"><span class="hs-identifier hs-var hs-var">waitUntil</span></a></span></span><span> </span><span id="local-6989586621679092011"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092011"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679092010"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092010"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-471"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092011"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092010"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-472"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="annot"><span class="annottext">Channel -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">(Channel -&gt; IO ()) -&gt; Channel -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">10000</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time -&gt; Channel
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092011"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092010"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">1E6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span class="hs-operator">&gt;</span><span>                   </span><span id="local-6989586621679092008"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679092008"><span class="hs-identifier hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM Bool -&gt; IO Bool
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Bool -&gt; IO Bool) -&gt; STM Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message)) -&gt; STM Bool
forall a. TChan a -&gt; STM Bool
</span><span class="hs-identifier hs-var">isEmptyTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092026"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-475"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679092008"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-476"></span><span class="hs-operator">&gt;</span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Time -&gt; IO ()
</span><a href="#local-6989586621679092012"><span class="hs-identifier hs-var">waitUntil</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092011"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-477"></span><span class="hs-operator">&gt;</span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span class="hs-operator">&gt;</span><span>                       </span><span id="local-6989586621679092006"><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092006"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message))
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message)))
-&gt; STM (Maybe (Time, Message)) -&gt; IO (Maybe (Time, Message))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message)) -&gt; STM (Maybe (Time, Message))
forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan (Maybe (Time, Message))
</span><a href="#local-6989586621679092026"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-479"></span><span class="hs-operator">&gt;</span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><a href="#local-6989586621679092006"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-480"></span><span class="hs-operator">&gt;</span><span>                         </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092005"><span class="hs-identifier hs-var">finishup</span></a></span><span>
</span><span id="line-481"></span><span class="hs-operator">&gt;</span><span>                         </span><span class="annot"><span class="annottext">Maybe (Time, Message)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Time -&gt; IO ()
</span><a href="#local-6989586621679092012"><span class="hs-identifier hs-var">waitUntil</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679092011"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-482"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679092005"><span class="hs-identifier hs-var">finishup</span></a></span><span>
</span><span id="line-483"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092005"><span class="annot"><span class="annottext">finishup :: IO ()
</span><a href="#local-6989586621679092005"><span class="hs-identifier hs-var hs-var">finishup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092025"><span class="hs-identifier hs-var">wait</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; IO (Either PMError PMSuccess) -&gt; IO (Either PMError PMSuccess)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092027"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679092024"><span class="hs-identifier hs-var">fin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092013"><span class="annot"><span class="annottext">process :: t -&gt; Message -&gt; IO Bool
</span><a href="#local-6989586621679092013"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span id="local-6989586621679092004"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092004"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679092003"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092003"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Bool
</span><span class="hs-identifier hs-var">isTrackEnd</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092003"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-485"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-486"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe PMMsg
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679092003"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-487"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679092002"><span class="annot"><span class="annottext">PMMsg
</span><a href="#local-6989586621679092002"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; CLong -&gt; IO Bool
forall t. RealFrac t =&gt; t -&gt; CLong -&gt; IO Bool
</span><a href="#local-6989586621679092001"><span class="hs-identifier hs-var">writeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092004"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(CLong -&gt; IO Bool) -&gt; CLong -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; CLong
</span><span class="hs-identifier hs-var">encodeMsg</span></span><span> </span><span class="annot"><span class="annottext">PMMsg
</span><a href="#local-6989586621679092002"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-488"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="annottext">Maybe PMMsg
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-489"></span><span class="hs-operator">&gt;</span><span>             </span><span id="local-6989586621679092001"><span class="annot"><span class="annottext">writeMsg :: t -&gt; CLong -&gt; IO Bool
</span><a href="#local-6989586621679092001"><span class="hs-identifier hs-var hs-var">writeMsg</span></a></span></span><span> </span><span id="local-6989586621679092000"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092000"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679091999"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091999"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679091998"><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679091998"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; PMEvent -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">writeShort</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679092027"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Timestamp -&gt; PMEvent
</span><span class="hs-identifier hs-var">PMEvent</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091999"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Timestamp
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1e3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMSuccess
</span><a href="#local-6989586621679091998"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-492"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><span class="hs-identifier hs-var">BufferOverflow</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;overflow&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">10000</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Bool -&gt; IO Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; CLong -&gt; IO Bool
</span><a href="#local-6989586621679092001"><span class="hs-identifier hs-var">writeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679092000"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091999"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-493"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679091995"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091995"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputMidi&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091995"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Bool -&gt; IO Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-494"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">PMSuccess
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-498"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">MIDI</span><span> </span><span class="hs-identifier">Conversion</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-499"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-identifier">A</span><span> </span><span class="hs-identifier">conversion</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">Codec.Midi</span><span> </span><span class="hs-identifier">Messages</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">PortMidi</span><span> </span><span class="hs-identifier">PMMsgs</span><span class="hs-operator">.</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-type">midiEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMMsg</span></span><span>
</span><span id="line-504"></span><span class="hs-operator">&gt;</span><span> </span><span id="midiEvent"><span class="annot"><span class="annottext">midiEvent :: Message -&gt; Maybe PMMsg
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var hs-var">midiEvent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoteOff</span></span><span> </span><span id="local-6989586621679091994"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091994"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091993"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091993"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679091992"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091992"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">128</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091994"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091993"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091992"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoteOn</span></span><span> </span><span id="local-6989586621679091991"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091991"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091990"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091990"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679091989"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091989"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">144</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091991"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091990"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091989"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeyPressure</span></span><span> </span><span id="local-6989586621679091987"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091987"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091986"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091986"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679091985"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091985"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">160</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091987"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091986"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091985"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ControlChange</span></span><span> </span><span id="local-6989586621679091983"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091983"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091982"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621679091981"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091981"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">176</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091983"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091982"><span class="hs-identifier hs-var">cn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091981"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProgramChange</span></span><span> </span><span id="local-6989586621679091979"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091979"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091978"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091978"><span class="hs-identifier hs-var">pn</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">192</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091979"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091978"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0</span></span><span>
</span><span id="line-509"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ChannelPressure</span></span><span> </span><span id="local-6989586621679091976"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091976"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091975"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091975"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">208</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091976"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091975"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0</span></span><span>
</span><span id="line-510"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PitchWheel</span></span><span> </span><span id="local-6989586621679091973"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091973"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679091972"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091972"><span class="hs-identifier hs-var">pb</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe PMMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe PMMsg) -&gt; PMMsg -&gt; Maybe PMMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">PMMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">224</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091973"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091971"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; CLong
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091970"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span class="hs-operator">&gt;</span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091970"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091970"><span class="hs-identifier hs-var">hi</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679091971"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091971"><span class="hs-identifier hs-var">lo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091972"><span class="hs-identifier hs-var">pb</span></a></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel
forall a. Bits a =&gt; a -&gt; Channel -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091972"><span class="hs-identifier hs-var">pb</span></a></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">0xFF</span></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiEvent"><span class="hs-identifier hs-var">midiEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PMMsg
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-identifier">A</span><span> </span><span class="hs-identifier">conversion</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">PortMidi</span><span> </span><span class="hs-identifier">PMMsgs</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">Codec.Midi</span><span> </span><span class="hs-identifier">Messages</span><span class="hs-operator">.</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#msgToMidi"><span class="hs-identifier hs-type">msgToMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMMsg</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-518"></span><span class="hs-operator">&gt;</span><span> </span><span id="msgToMidi"><span class="annot"><span class="annottext">msgToMidi :: PMMsg -&gt; Maybe Message
</span><a href="Euterpea.IO.MIDI.MidiIO.html#msgToMidi"><span class="hs-identifier hs-var hs-var">msgToMidi</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PMMsg</span></span><span> </span><span id="local-6989586621679091969"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091969"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679091968"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621679091967"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-519"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091966"><span class="annot"><span class="annottext">k :: CLong
</span><a href="#local-6989586621679091966"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091969"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLong -&gt; Channel -&gt; CLong
forall a. Bits a =&gt; a -&gt; Channel -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">4</span></span><span>
</span><span id="line-520"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091965"><span class="annot"><span class="annottext">c :: Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091969"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0x0F</span></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091966"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-522"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0x8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">NoteOff</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0x9</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">NoteOn</span></span><span>  </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xA</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">KeyPressure</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xB</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">ControlChange</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xC</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">ProgramChange</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xD</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">ChannelPressure</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xE</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Maybe Message
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; Maybe Message) -&gt; Message -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Channel -&gt; Channel -&gt; Message
</span><span class="hs-identifier hs-var">PitchWheel</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091965"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong -&gt; Channel
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091968"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; CLong -&gt; CLong
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091967"><span class="hs-identifier hs-var">d2</span></a></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; Channel -&gt; CLong
forall a. Bits a =&gt; a -&gt; Channel -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0xF</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Message
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- SysEx event not handled</span><span>
</span><span id="line-530"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Message
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-534"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Error</span><span> </span><span class="hs-identifier">Reporting</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-535"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-type">reportError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PMError</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span class="hs-operator">&gt;</span><span> </span><span id="reportError"><span class="annot"><span class="annottext">reportError :: String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var hs-var">reportError</span></a></span></span><span> </span><span id="local-6989586621679091964"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679091964"><span class="hs-identifier hs-var">prompt</span></a></span></span><span> </span><span id="local-6989586621679091963"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091963"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679091962"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679091962"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMError -&gt; IO String
</span><span class="hs-identifier hs-var">getErrorText</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091963"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-540"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679091964"><span class="hs-identifier hs-var">prompt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679091962"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-547"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Unused</span><span> </span><span class="hs-identifier">Functions</span><span> </span><span class="hs-glyph">|</span><span>
</span><span id="line-548"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-comment">-- Prints all DeviceInfo found by getAllDevices.</span><span>
</span><span id="line-551"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#printAllDeviceInfo"><span class="hs-identifier hs-type">printAllDeviceInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span class="hs-operator">&gt;</span><span> </span><span id="printAllDeviceInfo"><span class="annot"><span class="annottext">printAllDeviceInfo :: IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#printAllDeviceInfo"><span class="hs-identifier hs-var hs-var">printAllDeviceInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span id="local-6989586621679091960"><span class="annot"><span class="annottext">[(InputDeviceID, DeviceInfo)]
</span><a href="#local-6989586621679091960"><span class="hs-identifier hs-var">indevs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091959"><span class="annot"><span class="annottext">[(OutputDeviceID, DeviceInfo)]
</span><a href="#local-6989586621679091959"><span class="hs-identifier hs-var">outdevs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ([(InputDeviceID, DeviceInfo)], [(OutputDeviceID, DeviceInfo)])
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getAllDevices"><span class="hs-identifier hs-var">getAllDevices</span></a></span><span>
</span><span id="line-554"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">((InputDeviceID, DeviceInfo) -&gt; IO ())
-&gt; [(InputDeviceID, DeviceInfo)] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeviceInfo -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(DeviceInfo -&gt; IO ())
-&gt; ((InputDeviceID, DeviceInfo) -&gt; DeviceInfo)
-&gt; (InputDeviceID, DeviceInfo)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InputDeviceID, DeviceInfo) -&gt; DeviceInfo
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(InputDeviceID, DeviceInfo)]
</span><a href="#local-6989586621679091960"><span class="hs-identifier hs-var">indevs</span></a></span><span>
</span><span id="line-555"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">((OutputDeviceID, DeviceInfo) -&gt; IO ())
-&gt; [(OutputDeviceID, DeviceInfo)] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeviceInfo -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(DeviceInfo -&gt; IO ())
-&gt; ((OutputDeviceID, DeviceInfo) -&gt; DeviceInfo)
-&gt; (OutputDeviceID, DeviceInfo)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OutputDeviceID, DeviceInfo) -&gt; DeviceInfo
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(OutputDeviceID, DeviceInfo)]
</span><a href="#local-6989586621679091959"><span class="hs-identifier hs-var">outdevs</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-comment">-- Given whether the device is an input device and the device name,</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- returns the DeviceID.</span><span>
</span><span id="line-559"></span><span> </span><span class="hs-identifier">getDeviceId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">DeviceID</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span> </span><span class="hs-identifier">getDeviceId</span><span> </span><span class="hs-identifier">isInput</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-561"></span><span>   </span><span class="hs-identifier">devs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getAllDevices</span><span>
</span><span id="line-562"></span><span>   </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">findIndex</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">input</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">isInput</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">devs</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679091958"><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#playTrackRealTime"><span class="hs-identifier hs-type">playTrackRealTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#OutputDeviceID"><span class="hs-identifier hs-type">OutputDeviceID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679091958"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-565"></span><span class="hs-operator">&gt;</span><span> </span><span id="playTrackRealTime"><span class="annot"><span class="annottext">playTrackRealTime :: OutputDeviceID -&gt; [(t, Message)] -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#playTrackRealTime"><span class="hs-identifier hs-var hs-var">playTrackRealTime</span></a></span></span><span> </span><span id="local-6989586621679091956"><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679091956"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679091955"><span class="annot"><span class="annottext">[(t, Message)]
</span><a href="#local-6989586621679091955"><span class="hs-identifier hs-var">track</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679091954"><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679091954"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OutputDeviceID -&gt; IO (Maybe ((Time, Message) -&gt; IO (), IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiOutRealTime"><span class="hs-identifier hs-var">midiOutRealTime</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDeviceID
</span><a href="#local-6989586621679091956"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-567"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><a href="#local-6989586621679091954"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-568"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe ((Time, Message) -&gt; IO (), IO ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091953"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091953"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091952"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091952"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Time, Message) -&gt; IO ()) -&gt; [(t, Message)] -&gt; IO ()
forall a. ((Time, Message) -&gt; IO ()) -&gt; [(a, Message)] -&gt; IO ()
</span><a href="#local-6989586621679091951"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091953"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">[(t, Message)]
</span><a href="#local-6989586621679091955"><span class="hs-identifier hs-var">track</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091952"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-570"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-571"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679091951"><span class="annot"><span class="annottext">playTrack :: ((Time, Message) -&gt; IO ()) -&gt; [(a, Message)] -&gt; IO ()
</span><a href="#local-6989586621679091951"><span class="hs-identifier hs-var hs-var">playTrack</span></a></span></span><span> </span><span id="local-6989586621679091950"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091950"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091949"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091949"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-573"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091950"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091949"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier hs-var">TrackEnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><a href="#local-6989586621679091951"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span id="local-6989586621679091948"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091948"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091947"><span class="annot"><span class="annottext">e :: (a, Message)
</span><a href="#local-6989586621679091947"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679091946"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679091946"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679091945"><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679091945"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091944"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091944"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-576"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091948"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091944"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679091946"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Bool
</span><span class="hs-identifier hs-var">isTrackEnd</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679091946"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-578"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span class="hs-operator">&gt;</span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">((Time, Message) -&gt; IO ()) -&gt; [(a, Message)] -&gt; IO ()
</span><a href="#local-6989586621679091951"><span class="hs-identifier hs-var">playTrack</span></a></span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO ()
</span><a href="#local-6989586621679091948"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Message)]
</span><a href="#local-6989586621679091945"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-580"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-comment">{-
&gt;     ticksPerBeat = case division of
&gt;       TicksPerBeat n -&gt; n
&gt;       TicksPerSecond mode nticks -&gt; (256 - mode - 128) * nticks `div` 2
&gt; -}</span><span>
</span><span id="line-585"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-comment">{-
&gt; runTrack tpb = runTrack' 0 0 120                 -- 120 beat/s is the default tempo
&gt;   where
&gt;     runTrack' t t0 bps ((_, TempoChange tempo) : l) =
&gt;       let bps' = 1000000 `div` fromIntegral tempo
&gt;       in runTrack' t t0 bps' l
&gt;     runTrack' t t0 bps ((t1, m) : l) =
&gt;       let t' = t + 1000 * fromIntegral (t1 - t0) `div` (tpb * bps)
&gt;       in (t', m) : runTrack' t' t1 bps l
&gt;     runTrack' _ _ _ [] = []
&gt;
&gt; playTrack s ch t0 = playTrack' 0
&gt;   where
&gt;     playTrack' t [] = putStrLn &quot;done&quot; &gt;&gt; putMVar ch Nothing &gt;&gt; return (round (t * 1.0E3))
&gt;     playTrack' _ ((t, e):es) = putMVar ch (Just io) &gt;&gt; playTrack' t es
&gt;       where
&gt;         io = case midiEvent e of
&gt;           Just m  -&gt; writeShort s (PMEvent m (t0 + round (t * 1.0E3)))
&gt;           Nothing -&gt; return NoError
&gt; -}</span><span>
</span><span id="line-605"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#recordMidi"><span class="hs-identifier hs-type">recordMidi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeviceID</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Track</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span class="hs-operator">&gt;</span><span> </span><span id="recordMidi"><span class="annot"><span class="annottext">recordMidi :: Channel -&gt; (Track Time -&gt; IO ()) -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#recordMidi"><span class="hs-identifier hs-var hs-var">recordMidi</span></a></span></span><span> </span><span id="local-6989586621679091942"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091942"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679091941"><span class="annot"><span class="annottext">Track Time -&gt; IO ()
</span><a href="#local-6989586621679091941"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679091940"><span class="annot"><span class="annottext">Chan (Time, Message)
</span><a href="#local-6989586621679091940"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Chan (Time, Message))
forall a. IO (Chan a)
</span><span class="hs-identifier hs-var">newChan</span></span><span>
</span><span id="line-608"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679091938"><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621679091938"><span class="hs-identifier hs-var">final</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; ((Time, Message) -&gt; IO Bool) -&gt; IO (Maybe (IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiInRealTime"><span class="hs-identifier hs-var">midiInRealTime</span></a></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091942"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679091936"><span class="annot"><span class="annottext">(Time, Message)
</span><a href="#local-6989586621679091936"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Chan (Time, Message) -&gt; (Time, Message) -&gt; IO ()
forall a. Chan a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeChan</span></span><span> </span><span class="annot"><span class="annottext">Chan (Time, Message)
</span><a href="#local-6989586621679091940"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">(Time, Message)
</span><a href="#local-6989586621679091936"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Bool -&gt; IO Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621679091938"><span class="hs-identifier hs-var">final</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-610"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">Maybe (IO ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679091934"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091934"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091933"><span class="annot"><span class="annottext">Track Time
</span><a href="#local-6989586621679091933"><span class="hs-identifier hs-var">track</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Chan (Time, Message) -&gt; IO (Track Time)
forall a. Chan a -&gt; IO [a]
</span><span class="hs-identifier hs-var">getChanContents</span></span><span> </span><span class="annot"><span class="annottext">Chan (Time, Message)
</span><a href="#local-6989586621679091940"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-613"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091931"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091931"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-614"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Track Time -&gt; IO ()
</span><a href="#local-6989586621679091941"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Track Time
</span><a href="#local-6989586621679091933"><span class="hs-identifier hs-var">track</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091931"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Start recording, hit ENTER when you are done.&quot;</span></span><span>
</span><span id="line-616"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getLine</span></span><span>
</span><span id="line-617"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091934"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-618"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">MVar () -&gt; IO ()
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091931"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-619"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Euterpea.IO.MIDI.MidiIO.html#midiInRealTime"><span class="hs-identifier hs-type">midiInRealTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeviceID</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span class="hs-operator">&gt;</span><span> </span><span id="midiInRealTime"><span class="annot"><span class="annottext">midiInRealTime :: Channel -&gt; ((Time, Message) -&gt; IO Bool) -&gt; IO (Maybe (IO ()))
</span><a href="Euterpea.IO.MIDI.MidiIO.html#midiInRealTime"><span class="hs-identifier hs-var hs-var">midiInRealTime</span></a></span></span><span> </span><span id="local-6989586621679091929"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091929"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679091928"><span class="annot"><span class="annottext">(Time, Message) -&gt; IO Bool
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">callback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-622"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679091927"><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679091927"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Channel -&gt; IO (Either PMError PMStream)
</span><span class="hs-identifier hs-var">openInput</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679091929"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-623"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError PMStream
</span><a href="#local-6989586621679091927"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-624"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679091926"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091926"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;midiInRealTime&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091926"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Maybe (IO ())) -&gt; IO (Maybe (IO ()))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ()) -&gt; IO (Maybe (IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-625"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679091925"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091925"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091924"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091924"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-627"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Timestamp -&gt; PMStream -&gt; MVar () -&gt; IO ()
forall a. Maybe Timestamp -&gt; PMStream -&gt; MVar a -&gt; IO ()
</span><a href="#local-6989586621679091923"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091925"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091924"><span class="hs-identifier hs-var">fin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span class="hs-operator">&gt;</span><span>       </span><span class="annot"><span class="annottext">Maybe (IO ()) -&gt; IO (Maybe (IO ()))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091924"><span class="hs-identifier hs-var">fin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679091924"><span class="hs-identifier hs-var">fin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-630"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679091923"><span class="annot"><span class="annottext">loop :: Maybe Timestamp -&gt; PMStream -&gt; MVar a -&gt; IO ()
</span><a href="#local-6989586621679091923"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679091922"><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091922"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679091921"><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679091920"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-631"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091919"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679091919"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; IO (Maybe a)
forall a. MVar a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">tryTakeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-632"></span><span class="hs-operator">&gt;</span><span>       </span><span id="local-6989586621679091917"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091917"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-633"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679091919"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-634"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess) -&gt; IO Bool -&gt; IO Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO Bool
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091917"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier hs-var">TrackEnd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; IO a
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fin</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span class="hs-operator">&gt;</span><span>           </span><span id="local-6989586621679091916"><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679091916"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError [PMEvent])
</span><span class="hs-identifier hs-var">readEvents</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-637"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either PMError [PMEvent]
</span><a href="#local-6989586621679091916"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-638"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679091915"><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091915"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="annottext">String -&gt; PMError -&gt; IO ()
</span><a href="Euterpea.IO.MIDI.MidiIO.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;midiInRealTime&quot;</span></span><span> </span><span class="annot"><span class="annottext">PMError
</span><a href="#local-6989586621679091915"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-640"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO Bool
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091917"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><span class="hs-identifier hs-var">TrackEnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span class="hs-operator">&gt;</span><span>                 </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679091914"><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679091914"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679091913"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091913"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
</span><a href="Euterpea.IO.MIDI.MidiIO.html#getTimeNow"><span class="hs-identifier hs-var">getTimeNow</span></a></span><span>
</span><span id="line-644"></span><span class="hs-operator">&gt;</span><span>               </span><span class="annot"><span class="annottext">Maybe Timestamp -&gt; Time -&gt; [PMEvent] -&gt; IO ()
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">sendEvts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091922"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091913"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679091914"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-645"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-646"></span><span class="hs-operator">&gt;</span><span>         </span><span id="local-6989586621679091912"><span class="annot"><span class="annottext">sendEvts :: Maybe Timestamp -&gt; Time -&gt; [PMEvent] -&gt; IO ()
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var hs-var">sendEvts</span></a></span></span><span> </span><span id="local-6989586621679091911"><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091911"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679091910"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091910"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp -&gt; PMStream -&gt; MVar a -&gt; IO ()
</span><a href="#local-6989586621679091923"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091911"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-647"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">sendEvts</span></a></span><span> </span><span id="local-6989586621679091909"><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091909"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679091908"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091908"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679091907"><span class="annot"><span class="annottext">e :: PMEvent
</span><a href="#local-6989586621679091907"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PMEvent</span></span><span> </span><span id="local-6989586621679091906"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091906"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679091905"><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091905"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679091904"><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679091904"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-648"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091903"><span class="annot"><span class="annottext">t0 :: Timestamp
</span><a href="#local-6989586621679091903"><span class="hs-identifier hs-var hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Timestamp
-&gt; (Timestamp -&gt; Timestamp) -&gt; Maybe Timestamp -&gt; Timestamp
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091905"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Timestamp -&gt; Timestamp
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp
</span><a href="#local-6989586621679091909"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-649"></span><span class="hs-operator">&gt;</span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PMMsg -&gt; Maybe Message
</span><a href="Euterpea.IO.MIDI.MidiIO.html#msgToMidi"><span class="hs-identifier hs-var">msgToMidi</span></a></span><span> </span><span class="annot"><span class="annottext">(PMMsg -&gt; Maybe Message) -&gt; PMMsg -&gt; Maybe Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; PMMsg
</span><span class="hs-identifier hs-var">decodeMsg</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679091906"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-650"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679091901"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679091901"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span class="hs-operator">&gt;</span><span>               </span><span id="local-6989586621679091900"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679091900"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Time, Message) -&gt; IO Bool
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091908"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Timestamp -&gt; Time
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091905"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Timestamp -&gt; Timestamp -&gt; Timestamp
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091903"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; Time
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><span class="hs-number">1E3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679091901"><span class="hs-identifier hs-var">m'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679091900"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PMStream -&gt; IO (Either PMError PMSuccess)
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">PMStream
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either PMError PMSuccess) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp -&gt; Time -&gt; [PMEvent] -&gt; IO ()
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">sendEvts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Timestamp -&gt; Maybe Timestamp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091903"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091908"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679091904"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-653"></span><span class="hs-operator">&gt;</span><span>             </span><span class="annot"><span class="annottext">Maybe Message
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp -&gt; Time -&gt; [PMEvent] -&gt; IO ()
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">sendEvts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Timestamp -&gt; Maybe Timestamp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679091903"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679091908"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">[PMEvent]
</span><a href="#local-6989586621679091904"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span></pre></body></html>